(this["webpackJsonpcom.orbitalshift.app"]=this["webpackJsonpcom.orbitalshift.app"]||[]).push([[6],{104:function(e,t,n){e.exports=n(132)},110:function(e,t,n){var a={"./ion-action-sheet-ios.entry.js":[135,67],"./ion-action-sheet-md.entry.js":[136,68],"./ion-alert-ios.entry.js":[137,59],"./ion-alert-md.entry.js":[138,60],"./ion-app_8-ios.entry.js":[139,53],"./ion-app_8-md.entry.js":[140,54],"./ion-avatar_3-ios.entry.js":[141,8],"./ion-avatar_3-md.entry.js":[142,9],"./ion-back-button-ios.entry.js":[143,10],"./ion-back-button-md.entry.js":[144,11],"./ion-backdrop-ios.entry.js":[145,12],"./ion-backdrop-md.entry.js":[146,13],"./ion-button_2-ios.entry.js":[147,69],"./ion-button_2-md.entry.js":[148,70],"./ion-card_5-ios.entry.js":[149,14],"./ion-card_5-md.entry.js":[150,15],"./ion-checkbox-ios.entry.js":[151,16],"./ion-checkbox-md.entry.js":[152,17],"./ion-chip-ios.entry.js":[153,18],"./ion-chip-md.entry.js":[154,19],"./ion-col_3.entry.js":[155,20],"./ion-datetime_3-ios.entry.js":[156,57],"./ion-datetime_3-md.entry.js":[157,58],"./ion-fab_3-ios.entry.js":[158,21],"./ion-fab_3-md.entry.js":[159,22],"./ion-img.entry.js":[160,23],"./ion-infinite-scroll_2-ios.entry.js":[161,24],"./ion-infinite-scroll_2-md.entry.js":[162,25],"./ion-input-ios.entry.js":[163,26],"./ion-input-md.entry.js":[164,27],"./ion-item-option_3-ios.entry.js":[165,71],"./ion-item-option_3-md.entry.js":[166,72],"./ion-item_8-ios.entry.js":[167,73],"./ion-item_8-md.entry.js":[168,74],"./ion-loading-ios.entry.js":[169,28],"./ion-loading-md.entry.js":[170,29],"./ion-menu_3-ios.entry.js":[171,75],"./ion-menu_3-md.entry.js":[172,76],"./ion-modal-ios.entry.js":[173,55],"./ion-modal-md.entry.js":[174,56],"./ion-nav_2.entry.js":[175,66],"./ion-popover-ios.entry.js":[176,30],"./ion-popover-md.entry.js":[177,31],"./ion-progress-bar-ios.entry.js":[178,32],"./ion-progress-bar-md.entry.js":[179,33],"./ion-radio_2-ios.entry.js":[180,34],"./ion-radio_2-md.entry.js":[181,35],"./ion-range-ios.entry.js":[182,77],"./ion-range-md.entry.js":[183,78],"./ion-refresher_2-ios.entry.js":[184,61],"./ion-refresher_2-md.entry.js":[185,62],"./ion-reorder_2-ios.entry.js":[186,36],"./ion-reorder_2-md.entry.js":[187,37],"./ion-ripple-effect.entry.js":[188,38],"./ion-route_4.entry.js":[189,79],"./ion-searchbar-ios.entry.js":[190,80],"./ion-searchbar-md.entry.js":[191,81],"./ion-segment_2-ios.entry.js":[192,82],"./ion-segment_2-md.entry.js":[193,83],"./ion-select_3-ios.entry.js":[194,84],"./ion-select_3-md.entry.js":[195,85],"./ion-slide_2-ios.entry.js":[196,86],"./ion-slide_2-md.entry.js":[197,87],"./ion-spinner.entry.js":[198,39],"./ion-split-pane-ios.entry.js":[199,40],"./ion-split-pane-md.entry.js":[200,41],"./ion-tab-bar_2-ios.entry.js":[201,42],"./ion-tab-bar_2-md.entry.js":[202,43],"./ion-tab_2.entry.js":[203,44],"./ion-text.entry.js":[204,45],"./ion-textarea-ios.entry.js":[205,46],"./ion-textarea-md.entry.js":[206,47],"./ion-toast-ios.entry.js":[207,63],"./ion-toast-md.entry.js":[208,64],"./ion-toggle-ios.entry.js":[209,48],"./ion-toggle-md.entry.js":[210,49],"./ion-virtual-scroll.entry.js":[211,50]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=110,e.exports=r},112:function(e,t,n){var a={"./ion-icon.entry.js":[215,90]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=112,e.exports=r},130:function(e,t,n){},132:function(e,t,n){"use strict";n.r(t);var a,r,o=n(0),i=n.n(o),c=n(54),s=n.n(c),l=n(15),u=n(58),d=n(1),m=n(71),p=n(2),f=n(6),v=(n(9),n(7)),E=n(3),h=n.n(E),g=n(5),b=n(102),y=function(){return Object(b.a)("osKeyStore",1,{upgrade:function(e){e.createObjectStore("userStore"),e.createObjectStore("authItems")}})},O=function(){var e=Object(g.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return n=e.sent,e.next=5,n.put("userStore",t,"user");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(g.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return t=e.sent,e.next=5,t.get("userStore","user");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=Object(g.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return t=e.sent,e.next=5,t.get("userStore","user").then((function(e){return e?e.access_token:void 0}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=Object(g.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return n=e.sent,e.next=5,n.put("authItems",t,"authItems");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(g.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return t=e.sent,e.next=5,t.get("authItems","authItems");case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C={getKeyStore:y,putUserState:O,getUserState:I,getAccessToken:S,putAuthItems:k,getAuthItems:j},T=n(38),D=n(61);n(133);function A(e){switch(e){case r.None:return"None";case r.Standard:return"Standard";case r.Premium:return"Premium";case r.Enterprise:return"Enterprise";default:return"Unknown"}}!function(e){e.Employee="Employee",e.Admin="Admin",e.LocationAdmin="Location Admin",e.BusinessAdmin="Business Admin",e.Orbital="Orbital"}(a||(a={})),function(e){e[e.None=-1]="None",e[e.Standard=0]="Standard",e[e.Premium=1]="Premium",e[e.Enterprise=2]="Enterprise"}(r||(r={}));var N,w,x,M,P,R;r.None,a.Employee;!function(e){e[e.HoursMinutes=0]="HoursMinutes",e[e.HoursAndDecimals=1]="HoursAndDecimals"}(N||(N={})),function(e){e[e.Unit=1]="Unit",e[e.Money=2]="Money"}(w||(w={})),function(e){e[e.None=0]="None",e[e.CanViewWages=1]="CanViewWages",e[e.CanEditPublishedTo=2]="CanEditPublishedTo",e[e.CanEditTemplates=4]="CanEditTemplates",e[e.CanEditSchedules=8]="CanEditSchedules",e[e.CanEditEmployeeClockEvents=16]="CanEditEmployeeClockEvents",e[e.CanEditOwnClockEvents=32]="CanEditOwnClockEvents",e[e.CanEditUserAccounts=64]="CanEditUserAccounts"}(x||(x={})),function(e){e[e.Both=0]="Both",e[e.Unpaid=1]="Unpaid",e[e.Paid=2]="Paid",e[e.None=3]="None"}(M||(M={})),function(e){e[e.UnscheduledUnpaid=0]="UnscheduledUnpaid",e[e.UnscheduledPaid=1]="UnscheduledPaid",e[e.Scheduled=2]="Scheduled"}(P||(P={})),function(e){e[e.FirstName=1]="FirstName",e[e.LastName=2]="LastName",e[e.EmploymentStart=3]="EmploymentStart",e[e.EarliestEventStart=4]="EarliestEventStart"}(R||(R={}));var L=n(12),F=n(13),U=function(){function e(){Object(L.a)(this,e),this.items={},this._count=0}return Object(F.a)(e,[{key:"containsKey",value:function(e){return this.items.hasOwnProperty(e)}},{key:"count",value:function(){return this._count}},{key:"add",value:function(e,t){this.items.hasOwnProperty(e)||this._count++,this.items[e]=t}},{key:"remove",value:function(e){var t=this.items[e];return delete this.items[e],this._count--,t}},{key:"item",value:function(e){return this.items[e]}},{key:"keys",value:function(){var e=[];for(var t in this.items)this.items.hasOwnProperty(t)&&e.push(t);return e}},{key:"values",value:function(){var e=[];for(var t in this.items)this.items.hasOwnProperty(t)&&e.push(this.items[t]);return e}}]),e}(),B={constants:{checkUnreadMessageCountTimer:3e4,refreshScheduleTimer:6e4,refreshTimeclockSettingsTimer:15e3,maxStaleAuthItemsInMinutes:15,minimumFeetForGeolocationUpdate:15},key:"prod",name:"",url:""},V=[Object(v.a)({},B,{key:"prod",name:"Production",url:"https://api.orbitalshift.com/"}),Object(v.a)({},B,{key:"sbx",name:"Sandbox",url:"https://sandboxapi.orbitalshift.com/"}),Object(v.a)({},B,{key:"loc",name:"Local",url:"http://localhost:54825/"}),Object(v.a)({},B,{key:"emu",name:"Local (Emu)",url:"http://10.0.2.2:54825/"}),Object(v.a)({},B,{key:"tst",name:"TestServer",url:"http://TestServer:8000/"})],z=new U;V.map((function(e){return z.add(e.key,e)}));var q={env:z,versionName:"2.0.0",versionCode:"6154",revisionHash:"722715d",buildDate:"Tue 05/19/2020 5:37P",appVersionString:"2.0.0.6154 (722715d)",hasCapacitor:Object(d.T)("capacitor"),platform:Object(d.T)("ios")?"ios":Object(d.T)("android")?"android":"other"},W=function(e){return e.isLoggedin?q.env.item(e.environment).constants:B.constants},_={settings:q,getApiUrl:function(e,t){return q.env.item(e.environment).url+t},getUserAndEnvironmentFromInput:function(e){if(e.length<4)return{username:e,env:q.env.item("prod")};var t=e.toLowerCase().substring(0,4),n=e.substring(4);switch(t){case"sbx ":return{username:n,env:q.env.item("sbx")};case"loc ":return{username:n,env:q.env.item("loc")};case"emu ":return{username:n,env:q.env.item("emu")};case"tst ":return{username:n,env:q.env.item("tst")};default:return{username:e,env:q.env.item("prod")}}}},Y={apiKey:"AIzaSyAS526InuG-53VGKi5SA780Mh0YwHkhMDE",authDomain:"orbital-shift-team-dashboard.firebaseapp.com",databaseURL:"https://orbital-shift-team-dashboard.firebaseio.com",projectId:"orbital-shift-team-dashboard",storageBucket:"orbital-shift-team-dashboard.appspot.com",messagingSenderId:"475985033328",appId:"1:475985033328:web:77740655a89e28de035cb5",measurementId:"G-TGE8788D28"};function G(e,t){D.analytics().logEvent(e,t)}function J(e,t){if(e.isLoggedin){var n=_.settings.env.item(e.environment);void 0!==e.username&&D.analytics().setUserId(e.username),D.analytics().setUserProperties({userRole:t.role,subscriptionType:A(t.subscriptionType),businessName:t.businessName,userName:e.username,version:_.settings.appVersionString,environment:n.name})}}var H,K=function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r,o,i,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=_.getApiUrl(t,n),console.log("API: "+n),e.prev=2,e.next=5,fetch(r,{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token),AppVersion:_.settings.appVersionString}});case 5:if(o=e.sent,!(i=o.headers.get("content-type"))||-1===i.indexOf("application/json")){e.next=13;break}return e.next=10,o.json();case 10:return c=e.sent,G("api_succeeded",{method:"POST",baseUrl:n,username:t.username}),e.abrupt("return",c);case 13:G("api_succeeded",{method:"POST",baseUrl:n,username:t.username}),e.next=21;break;case 16:throw e.prev=16,e.t0=e.catch(2),G("api_err",Object(v.a)({method:"POST",baseUrl:n,username:null===t||void 0===t?void 0:t.username},a,{appVersion:_.settings.appVersionString})),console.error("Error calling post against url, "+n+": "+e.t0),e.t0;case 21:case"end":return e.stop()}}),e,null,[[2,16]])})));return function(t,n,a){return e.apply(this,arguments)}}(),Q=function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r,o,i,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=_.getApiUrl(t,n),console.log("API: "+n),e.prev=2,o=JSON.stringify(a),e.next=6,fetch(r,{method:"PUT",body:o,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token),AppVersion:_.settings.appVersionString}});case 6:return i=e.sent,e.next=9,i.json();case 9:return c=e.sent,G("api_succeeded",{method:"PUT",baseUrl:n,username:t.username}),e.abrupt("return",c);case 14:throw e.prev=14,e.t0=e.catch(2),G("api_err",Object(v.a)({method:"PUT",baseUrl:n,username:null===t||void 0===t?void 0:t.username},a,{appVersion:_.settings.appVersionString})),console.error("Error calling putData against url, "+n+": "+e.t0),e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(t,n,a){return e.apply(this,arguments)}}(),X={get:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r,o,i,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=_.getApiUrl(t,n),console.log("API: "+n),e.prev=2,o={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token),AppVersion:_.settings.appVersionString},body:null},a&&(o.body=JSON.stringify(a)),e.next=7,fetch(r,o);case 7:return i=e.sent,e.next=10,i.json();case 10:return c=e.sent,G("api_succeeded",{method:"GET",baseUrl:n,username:t.username}),e.abrupt("return",c);case 15:throw e.prev=15,e.t0=e.catch(2),G("api_err",{method:"GET",baseUrl:n,username:null===t||void 0===t?void 0:t.username,appVersion:_.settings.appVersionString}),console.error("Error calling get against url, "+n+": "+e.t0),e.t0;case 20:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t,n,a){return e.apply(this,arguments)}}(),post:K,put:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r,o,i,c,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=_.getApiUrl(t,n),console.log("API: "+n),o={method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token),AppVersion:_.settings.appVersionString}},a&&(o.body=JSON.stringify(a)),e.prev=4,e.next=7,fetch(r,o);case 7:if(i=e.sent,!(c=i.headers.get("content-type"))||-1===c.indexOf("application/json")){e.next=15;break}return e.next=12,i.json();case 12:return s=e.sent,G("api_succeeded",{method:"PUT",baseUrl:n,username:t.username}),e.abrupt("return",s);case 15:G("api_succeeded",{method:"PUT",baseUrl:n,username:t.username}),e.next=23;break;case 18:throw e.prev=18,e.t0=e.catch(4),G("api_err",Object(v.a)({method:"PUT",baseUrl:n,username:null===t||void 0===t?void 0:t.username},a,{appVersion:_.settings.appVersionString})),console.error("Error calling put against url, "+n+": "+e.t0),e.t0;case 23:case"end":return e.stop()}}),e,null,[[4,18]])})));return function(t,n,a){return e.apply(this,arguments)}}(),putData:Q,del:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r,o,i,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=_.getApiUrl(t,n),console.log("API: "+n),o={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token),AppVersion:_.settings.appVersionString}},a&&(o.body=JSON.stringify(a)),e.prev=4,e.next=7,fetch(r,o);case 7:if(i=e.sent,!(c=i.headers.get("content-type"))||-1===c.indexOf("application/json")){e.next=14;break}return G("api_succeeded",{method:"DELETE",baseUrl:n,username:t.username}),e.next=13,i.json();case 13:return e.abrupt("return",e.sent);case 14:return G("api_succeeded",{method:"DELETE",baseUrl:n,username:t.username}),e.abrupt("return");case 18:throw e.prev=18,e.t0=e.catch(4),G("api_err",Object(v.a)({method:"DELETE",baseUrl:n,username:null===t||void 0===t?void 0:t.username},a,{appVersion:_.settings.appVersionString})),console.error("Error calling delete against url, "+n+": "+e.t0),e.t0;case 23:case"end":return e.stop()}}),e,null,[[4,18]])})));return function(t,n,a){return e.apply(this,arguments)}}()};!function(e){e[e.iOS=1]="iOS",e[e.Android=2]="Android"}(H||(H={}));var $={subscribe:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v1/employee/notifications/subscribe",a="ios"===_.settings.platform?H.iOS:H.Android,G("pushNotifications_subscribeCalled",{token:n,operatingSystem:a,username:t.username,access_token:t.access_token}),e.next=5,X.putData(t,"api/v1/employee/notifications/subscribe",{TokenId:n,OperatingSystem:a});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),unsubscribe:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v1/employee/notifications/unsubscribe",a="ios"===_.settings.platform?H.iOS:H.Android,e.next=4,X.putData(t,"api/v1/employee/notifications/unsubscribe",{TokenId:n,OperatingSystem:a});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),getTypesSelectedByUser:function(){var e=Object(g.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v1/employee/notifications/types",e.next=3,X.get(t,"api/v1/employee/notifications/types");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),putTypes:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v1/employee/notifications/types",a={ids:n},e.next=4,X.put(t,"api/v1/employee/notifications/types",a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),listTypes:function(){var e=Object(g.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v1/employee/notifications/list-types",e.next=3,X.get(t,"api/v1/employee/notifications/list-types");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Z=n(26),ee=T.c.PushNotifications,te=function(e,t,n){var a=Object(Z.a)({forceRefresh:!0});_.settings.hasCapacitor&&(ee.register().then((function(){console.log("PushNotificationController: register called and returned")})),ee.addListener("registration",(function(a){$.subscribe(e,a.value),t(!0),n("Push registration success, token: "+a.value),G("pushNotifications_registered",{token:a.value,platform:_.settings.platform})})),ee.addListener("registrationError",(function(e){n("Error on registration: "+JSON.stringify(e)),G("pushNotifications_registrationError",{error:e,platform:_.settings.platform})})),ee.addListener("pushNotificationReceived",(function(e){var t;e&&(e.data&&e.data.MessageId?(n("NOTIFICATION: "+e.title+": "+e.body+" id:"+e.data.MessageId),a.push("/tabs/messages/"+e.data.MessageId),a.goForward()):n("NOTIFICATION: "+e.title+": "+e.body+" (no id)"),G("pushNotifications_receivedWhenOpen",{title:e.title,body:e.body,messageId:null!==(t=e.data.MessageId)&&void 0!==t?t:-123}))})),ee.addListener("pushNotificationActionPerformed",(function(e){var t;e.notification.data&&e.notification.data.MessageId?(n("TAPPED ON NOTIFICATION: "+e.notification.title+": "+e.notification.body+" id:"+e.notification.data.MessageId),a.push("/tabs/messages/"+e.notification.data.MessageId),a.goForward()):n("TAPPED ON NOTIFICATION: "+e.notification.title+": "+e.notification.body+" (no id)"),G("pushNotifications_actionPerformed",{title:e.notification.title,body:e.notification.body,messageId:null!==(t=e.notification.data.MessageId)&&void 0!==t?t:-123})})))},ne={isLoggedin:!1,access_token:void 0,username:"",darkMode:!1,loading:!0,environment:"prod",isPushEnabled:!1},ae={user:ne,logout:function(){var e=Object(g.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),userLoggedIn:function(e,t,n){return new Promise((function(){return ne}))},pushEnabled:function(e){}},re=i.a.createContext(ae),oe=function(e){var t=Object(o.useState)(Object(v.a)({},ne)),n=Object(p.a)(t,2),a=n[0],r=n[1];Object(o.useEffect)((function(){var e=!0;return Promise.all([C.getUserState()]).then((function(t){if(e){var n=t[0];r(n?Object(v.a)({},n,{loading:!1}):Object(v.a)({},a,{loading:!1}))}})),function(){e=!1}}),[]),Object(o.useEffect)((function(){a&&!a.isPushEnabled&&a.access_token&&a.access_token.length>0&&"other"!==_.settings.platform&&te(a,c,(function(){}))}),[a.isPushEnabled,a.access_token]);var c=function(e){r(Object(v.a)({},a,{isPushEnabled:e}))},s=function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var o,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.getUserState();case 2:return o=e.sent,i={username:t,access_token:n,environment:a,isLoggedin:!0,darkMode:o?o.darkMode:ne.darkMode,loading:!1,isPushEnabled:!1},e.next=6,C.putUserState(i);case 6:return r(i),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),l=function(){var e=Object(g.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(v.a)({},a,{isLoggedin:!1,access_token:void 0,latitude:void 0,longitude:void 0,isPushEnabled:!1,requestedGeoPermission:!1,refusedGeoPermission:!1}),r(t),e.next=4,C.putUserState(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i.a.createElement(re.Provider,{value:{user:a,userLoggedIn:s,logout:l,pushEnabled:c}},e.children)};var ie=function(){var e=Object(o.useState)(!1),t=Object(p.a)(e,2),n=t[0],a=t[1],r=Object(o.useState)({header:"",message:"",onDismiss:function(){}}),c=Object(p.a)(r,2),s=c[0],l=c[1];return{showAlert:function(e,t,n){l({header:e,message:t,onDismiss:n}),a(!0)},alertBoxJsx:i.a.createElement(d.b,{isOpen:n,onDidDismiss:function(){a(!1),s.onDismiss()},header:s.header,message:s.message,buttons:["OK"]})}},ce=function(e){var t=e.list,n=e.selected,a=e.selectionChanged,r=function(e){if(!n||0===n.length)return!1;for(var t=0;t<n.length;t++)if(n[t].id===e)return!0;return!1};return t?i.a.createElement(d.o,{lines:"none"},i.a.createElement(d.r,null,i.a.createElement(d.o,{lines:"none",key:-1},i.a.createElement(d.P,{mode:"md",key:-1,checked:(null===t||void 0===t?void 0:t.length)===(null===n||void 0===n?void 0:n.length),onClick:function(){return function(){var e=(null===t||void 0===t?void 0:t.length)!==(null===n||void 0===n?void 0:n.length);if((null===t||void 0===t?void 0:t.length)===(null===n||void 0===n?void 0:n.length)){if(e)return;a([])}else{if(!e)return;a(t?t.slice():null)}}()}}),i.a.createElement(d.p,null,"SELECT ALL")),t&&t.map((function(e){return i.a.createElement(d.o,{lines:"none",key:e.id},i.a.createElement(d.P,{mode:"md",key:e.id,onClick:function(){!function(e){if(null!==n)if(!n.map((function(e){return e.id})).includes(e.id)){var t=n.slice();t.push(e),a(t)}else{var r=n.filter((function(t){return t.id!==e.id}));a(r)}}(e)},checked:r(e.id)}),i.a.createElement(d.p,null,e.name))})))):i.a.createElement("div",null,"Loading...")},se=function(e){var t=e.onDismissModal,n=e.isOpen,a=Object(o.useContext)(re).user,r=Object(o.useState)(null),c=Object(p.a)(r,2),s=c[0],l=c[1],u=Object(o.useState)(null),m=Object(p.a)(u,2),v=m[0],E=m[1];Object(o.useEffect)((function(){if(!n)return E(null),void l(null);var e=!0;return Promise.all([$.getTypesSelectedByUser(a),$.listTypes(a)]).then((function(t){e&&(E(t[0]),l(t[1]))})),function(){e=!1}}),[n,a]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,null,i.a.createElement(d.e,{slot:"start"},i.a.createElement(d.d,{onClick:function(){t()}},i.a.createElement(d.m,{icon:f.c,mode:"md",slot:"icon-only"}))),i.a.createElement(d.N,null,"Notifications"))),i.a.createElement(d.h,{class:"outer-content"},i.a.createElement(ce,{list:s,selected:v,selectionChanged:function(e){var t=e.map((function(e){return e.id}));$.putTypes(a,t).then((function(){E(e)}))}})),i.a.createElement(d.j,null,i.a.createElement(d.Q,null)))};var le,ue=function(){var e=Object(o.useState)(!1),t=Object(p.a)(e,2),n=t[0],a=t[1],r=Object(o.useState)({message:""}),c=Object(p.a)(r,2),s=c[0],l=c[1];return{showToast:function(e){l({message:e}),a(!0)},simpleToastJsx:i.a.createElement(d.O,{isOpen:n,onDidDismiss:function(){return a(!1)},position:"top",message:s.message,duration:1500})}},de=n(219),me=n(220),pe=n(100),fe=n(221),ve=n(222),Ee=n(232),he=n(223),ge=n(98),be=n(218);!function(e){e[e.Shift=1]="Shift",e[e.Unavailable=2]="Unavailable",e[e.Vacation=3]="Vacation",e[e.Cover=4]="Cover",e[e.Clock=6]="Clock",e[e.Absent=7]="Absent"}(le||(le={}));var ye=[{id:1,name:"Shift"},{id:2,name:"Unavailable"},{id:3,name:"Vacation"},{id:4,name:"Cover"},{id:6,name:"Clock"},{id:7,name:"Absent"}];function Oe(e){var t=ye.find((function(t){return t.id===e}));if(void 0===t)throw new Error("getEventTypeIdList: Unknown event type: "+e);return t}var Ie,Se=le;!function(e){e[e.Approved=1]="Approved",e[e.Request=2]="Request",e[e.RequestDenied=4]="RequestDenied"}(Ie||(Ie={}));var ke=[{id:1,name:"Approved"},{id:2,name:"Request"},{id:4,name:"Request Denied"}];function je(e){var t=ke.find((function(t){return t.id===e}));if(void 0===t)throw new Error("getEventStatusIdName: Unknown event status: "+e);return t}var Ce,Te=Ie;!function(e){e[e.All=-1]="All",e[e.Scheduled=-2]="Scheduled",e[e.DontWork=-3]="DontWork",e[e.ClockAndSched=-6]="ClockAndSched",e[e.Custom=0]="Custom"}(Ce||(Ce={}));var De=Ce,Ae=new Date(9e3,1,1);function Ne(e,t){return e===Se.Shift&&t===Te.Approved||e===Se.Cover&&t===Te.Request||e===Se.Cover&&t===Te.RequestDenied}function we(e,t){return e===Se.Absent&&t===Te.Approved}function xe(e,t,n,a){return e===De.DontWork&&t===De.DontWork?function(e,t){return e===Se.Unavailable&&t===Te.Approved||e===Se.Vacation&&t===Te.Approved||e===Se.Absent&&t===Te.Approved||e===Se.Cover&&t===Te.Approved}(n,a):e>0&&t>0?e===n&&t===a:e>0&&t===De.All?e===n:e===De.All&&t>0?t===a:e===De.Scheduled&&t===De.Scheduled?Ne(n,a)||we(n,a):e!==De.ClockAndSched||t!==De.ClockAndSched||(function(e,t){return Ne(e,t)||e===Se.Clock&&t===Te.Approved}(n,a)||we(n,a))}var Me=n(97),Pe=n(231),Re=new Date(9e3,1,1);function Le(e){return void 0!==e.BusinessId}function Fe(e){var t=Intl.DateTimeFormat().resolvedOptions().timeZone,n=Object(Me.a)(e,{timeZone:t});return Object(Pe.a)(n,"yyyy-MM-dd",{timeZone:t})+"T"+Object(Pe.a)(n,"HH:mm:ssXXX",{timeZone:t})}function Ue(e){if(!e)return 0;var t,n,a=e.split(":");if(a[0].indexOf(".")>=0){var r=a[0].split(".");t=24*parseInt(r[0])+parseInt(r[1]),n=parseInt(a[1])}else t=parseInt(a[0]),n=parseInt(a[1]);return 60*t+n}function Be(e){if(e<60)return"(".concat(e,"m)");var t="(".concat(Math.floor(e/60),"h");return e%60===0?t+")":t+" ".concat(e%60,"m)")}function Ve(e){var t,n=Object(pe.a)(Object(de.a)(e.EventStart),"h:mmaaa").replace("M","");return t=!Le(e)&&e.IsClockedIn||Le(e)&&function(e){return e.EventTypeId===Se.Clock&&e.EventStatusId===Te.Approved&&Object(be.a)(e.EventEnd,Ae)}(e)?Object(pe.a)(new Date,"h:mmaaa").replace("M",""):Object(pe.a)(Object(de.a)(e.EventEnd),"h:mmaaa").replace("M",""),"".concat(n," - ").concat(t)}function ze(e){var t=Object(pe.a)(Object(de.a)(e.BreakStart),"h:mmaa").replace("M",""),n=e.BreakEnd?Object(pe.a)(Object(de.a)(e.BreakEnd),"h:mmaa").replace("M",""):Object(pe.a)(new Date,"h:mmaa").replace("M","");return"".concat(t," - ").concat(n)}function qe(e,t,n){var a=!n||n.indexOf("T")<0?0:Ue(n.split("T")[1]),r=e;r.setHours(0,a,0,0);for(var o=0;Object(pe.a)(r,"EEEE")!==t&&o<20;)r=Object(he.a)(r,-1),o++;return o>15&&console.error("Could not calculate week start based on date ".concat(e)+'and weekStartsOn "'.concat(t,'"')),r}function We(e,t){var n=new Date(e.valueOf()),a=Ue(t.DayStartTime.split("T")[1]);n.setMinutes(-1*a,n.getSeconds(),n.getMilliseconds());var r=!Object(ge.a)(n,e),o=new Date(e.valueOf());return r?o.setHours(-24,a,0,0):o.setHours(0,a,0,0),o}function _e(e){return e.getFullYear()+"-"+Ge(e.getMonth()+1,2)+"-"+Ge(e.getDate(),2)+"T"+Ge(e.getHours(),2)+":"+Ge(e.getMinutes(),2)+":00"}function Ye(e,t,n){var a=Number(e).toFixed(n).toString(),r="";0===a.indexOf("-")&&(a=a.substring(1),r="-");var o="0000000000"+a;return-1===a.indexOf(".")?r+o.substr(o.length-Math.max(a.length,t)):r+o.substr(o.length-Math.max(a.length,t+n+1))}function Ge(e,t){var n="0000000000"+e;return n.substr(n.length-t)}var Je={getEmployeesByLocationIdPositionIdAndActiveDateRange:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o,i){var c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={locId:n,posId:a,start:_e(r),end:_e(o),sort:i},e.next=3,X.post(t,"api/v2/employees/at-position",c);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o,i){return e.apply(this,arguments)}}(),getEmployeeListForCommunication:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o,i){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.post(t,"api/v2/employees/get-communication-list",{locId:n,depId:a,posId:r,channel:o,role:i});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o,i){return e.apply(this,arguments)}}(),submitFeedback:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={version:_.settings.appVersionString,buildDate:_.settings.buildDate,environment:_.settings.env.item(t.environment).name,os:_.settings.platform,msg:n},e.next=3,X.post(t,"/api/v2/employees/submit-feedback",a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()};function He(e){var t=Object(o.useState)(!1),n=Object(p.a)(t,2),a=n[0],r=n[1],c=i.a.createElement(d.s,{isOpen:a,onDidDismiss:function(){return r(!1)},spinner:"dots",message:e,duration:1e4});return{showLoading:a,setShowLoading:r,showLoadingJsx:c}}var Ke=function(e){var t=e.onDismissModal,n=Object(o.useContext)(re).user,a=Object(o.useState)(""),r=Object(p.a)(a,2),c=r[0],s=r[1],l=He("Submitting your message...");return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,null,i.a.createElement(d.e,{slot:"start"},i.a.createElement(d.d,{onClick:function(){t(!1)}},i.a.createElement(d.m,{icon:f.c,slot:"icon-only"}))),i.a.createElement(d.N,null,"Ticket Details"))),i.a.createElement(d.h,{class:"outer-content"},i.a.createElement(d.r,null,i.a.createElement(d.o,{lines:"none"},i.a.createElement(d.M,{value:c,placeholder:"Enter message",autoGrow:!0,spellcheck:!0,wrap:"hard",debounce:50,onIonChange:function(e){s(e.detail.value)}}))),l.showLoadingJsx),i.a.createElement(d.j,null,i.a.createElement(d.d,{className:"apply-button",expand:"block",onClick:function(){null!==c&&void 0!==c&&(l.setShowLoading(!0),Je.submitFeedback(n,c).then((function(e){G("submit-feedback",{succeeded:!e.error}),l.setShowLoading(!1),t(!0)})))},disabled:null===c||void 0===c||0===c.length},"Submit")))},Qe=function(){var e=Object(o.useState)(!1),t=Object(p.a)(e,1)[0],n=i.a.useContext(re).user,a=_.settings.env.item(n.environment),r="prod"!==a.key?n.username.substr(4):n.username,c=ie(),s=Object(o.useState)(!1),l=Object(p.a)(s,2),u=l[0],m=l[1],v=Object(o.useState)(!1),E=Object(p.a)(v,2),h=E[0],g=E[1],b=ue();return i.a.createElement(d.t,{type:"overlay",disabled:t,contentId:"main"},i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,null,i.a.createElement(d.N,null,"Menu"))),i.a.createElement(d.h,{className:"outer-content"},"prod"!==a.key&&i.a.createElement("div",{className:"username-header"},r.toUpperCase()," (",a.name.toUpperCase(),")"),"prod"===a.key&&i.a.createElement("div",{className:"username-header"},"User ",r),i.a.createElement(d.r,null,i.a.createElement(d.v,{"auto-hide":"false"},i.a.createElement(d.o,{button:!0,onClick:function(){m(!0)}},i.a.createElement(d.p,null,"Notifications"),i.a.createElement(d.m,{slot:"end",icon:f.t}))),i.a.createElement(d.v,{"auto-hide":"false"},i.a.createElement(d.o,{button:!0,onClick:function(){g(!0)}},i.a.createElement(d.p,null,"Submit a Ticket"),i.a.createElement(d.m,{slot:"end",icon:f.s}))),i.a.createElement(d.v,{"auto-hide":"false"},i.a.createElement(d.o,{button:!0,routerLink:"/logout",routerDirection:"none"},i.a.createElement(d.m,{slot:"end",icon:f.q}),i.a.createElement(d.p,null,"Logout")))),c.alertBoxJsx,b.simpleToastJsx),i.a.createElement(d.j,null,i.a.createElement("div",{className:"debug-info"},"Capacitor: ",_.settings.hasCapacitor?"Yes":"No",i.a.createElement("br",null),"Build Date: ",_.settings.buildDate,i.a.createElement("br",null),"Version: ",_.settings.appVersionString)),i.a.createElement(d.w,{isOpen:u},i.a.createElement(se,{onDismissModal:function(){m(!1)},isOpen:u})),i.a.createElement(d.w,{isOpen:h},i.a.createElement(Ke,{onDismissModal:function(e){g(!1),e&&b.showToast("Submitted, thank you!")},isOpen:h})))},Xe=(n(120),n(121),n(122),n(123),n(124),n(125),n(126),n(127),n(128),n(129),n(130),{authenticateUser:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r,o,i,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Authenticating against ".concat(_.settings.env.item(a).name," (").concat(_.settings.env.item(a).url,")")),r=_.settings.env.item(a).url+"token",o="grant_type=password&username=".concat(t,"&password=").concat(n),e.prev=3,e.next=6,fetch(r,{method:"POST",body:o});case 6:return i=e.sent,e.next=9,i.json();case 9:if(!(c=e.sent).error&&!c.error_description){e.next=12;break}return e.abrupt("return",{loggedIn:!1,error:c.error_description,access_token:""});case 12:return e.abrupt("return",{loggedIn:!0,access_token:c.access_token});case 15:return e.prev=15,e.t0=e.catch(3),console.error("Error returned from authentication request: "+e.t0),e.abrupt("return",{loggedIn:!1,err:e.t0,error:"Error attempting to log in",access_token:""});case 19:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(t,n,a){return e.apply(this,arguments)}}(),getAuthorizedItems:function(){var e=Object(g.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.get(t,"api/v3/home/get-auth");case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),$e=function(e,t){return e&&e.locations&&0!==e.locations.length?t<=0?null:e.locations.filter((function(e){return e.id===t}))[0]:null},Ze=function(e,t){if(!e||!e.locations||0===e.locations.length)return null;if(t<=0)return null;var n=null;return e.locations.flatMap((function(e){return e.departments.map((function(e){return 1===e.positions.filter((function(e){return e.id===t})).length?(n=e,e):null}))})),n},et=function(e,t,n,r){if(!e||!e.locations||0===e.locations.length)return!1;if(e.role===a.Employee)return!1;if(e.role===a.LocationAdmin||e.role===a.BusinessAdmin)return!0;if(-1===n){var o=$e(e,t);return!0===(null===o||void 0===o?void 0:o.adminAllDepts)}return(e.locations.flatMap((function(e){return e.departments.filter((function(e){return e.id===n}))}))[0].adminAuth&r)===r};var tt={adminCan:function(e,t){return(e&t)===t},getLocSettingsForLocationId:function(e,t){if(!e||!e.locations||0===e.locations.length)throw new Error("getLocSettingsForLocationId: called with invalid auth parameter");return 0===t?e.locations[0].settings:e.locations.filter((function(e){return e.id===t}))[0].settings},getLocationFromLocationId:$e,getLocationIdFromPositionid:function(e,t){for(var n=0;n<e.locations.length;n++)for(var a=e.locations[n],r=0;r<a.departments.length;r++){if(void 0!==a.departments[r].positions.find((function(e){return e.id===t})))return a.id}throw new Error("getLocationIdFromPositionId: Could not find a location that had positionid "+t)},getDepartmentFromPositionId:Ze,getPositionIdsForEmployee:function(e){return e.locations.flatMap((function(e){return e.departments.flatMap((function(e){return e.positions.filter((function(e){return e.hasPosition})).map((function(e){return e.id}))}))}))},isPositionSpecificEvent:function(e){return e===Se.Shift||e===Se.Cover||e===Se.Clock||e===Se.Absent},canEditSchedules:function(e,t,n){return(e.locations.filter((function(e){return e.id===t}))[0].departments.filter((function(e){return e.id===n}))[0].adminAuth&x.CanEditSchedules)===x.CanEditSchedules},getAdminAuthorizationForDepartment:function(e,t){return e.locations.flatMap((function(e){return e.departments.filter((function(e){return e.id===t}))}))[0].adminAuth},adminIsInDepartment:function(e,t){return e.role===a.Admin&&e.locations.flatMap((function(e){return e.departments.filter((function(e){return e.id===t}))}))[0].positions.filter((function(e){return e.hasPosition})).length>0},canEditNonPositionEvents:function(e,t){var n=e.locations.flatMap((function(e){return e.departments.filter((function(e){return e.id===t}))}))[0];return(n.adminAuth&x.CanEditSchedules)===x.CanEditSchedules&&n.positions.filter((function(e){return e.hasPosition})).length>0},hasPosition:function(e,t){return e.locations.flatMap((function(e){return e.departments.flatMap((function(e){return e.positions.filter((function(e){return e.hasPosition&&e.id===t}))}))})).length>0},isAuthItemsValid:function(e){return null!==e&&void 0!==e&&void 0!==e.locations&&null!==e.locations&&e.locations.length>0},isShiftTypeEvent:function(e,t){return e===Se.Shift&&t===Te.Approved||e===Se.Cover&&t===Te.Request||e===Se.Cover&&t===Te.RequestDenied},isDeptAdmin:function(e,t){return!(!e||!e.locations||0===e.locations.length)&&(e.role!==a.Employee&&(e.role===a.BusinessAdmin||e.role===a.LocationAdmin||e.locations.flatMap((function(e){return e.departments.filter((function(e){return e.id===t}))}))[0].isDeptAdmin))},isAdminForAllDepts:function(e,t){if(e.role===a.BusinessAdmin||e.role===a.LocationAdmin)return!0;if(e.role===a.Employee)return!1;var n=$e(e,t);return!0===(null===n||void 0===n?void 0:n.adminAllDepts)},isAdminForThisEvent:function(e,t){if(t.role===a.Employee)return!1;if(t.role===a.BusinessAdmin||t.role===a.LocationAdmin)return!0;if(t.role===a.Admin){var n=Ze(t,e.position.position.id);return null!==n&&et(t,e.locationId,n.id,x.CanEditSchedules)}return!1},isAdminAuthorizedFor:et,getSelectedDepartment:function(e,t,n){var a=$e(e,t);if(null===a)throw new Error('getSelectedDepartment: Could not find locationId "'.concat(t,'"'));if(-1===n)return{location:a,department:null};var r=a.departments.filter((function(e){return e.id===n}))[0];return{location:a,department:r}},getSelectedPositionWithLocId:function(e,t,n){var a=e.filter((function(e){return e.id===t}))[0],r=a.departments.flatMap((function(e){return e.positions.filter((function(e){return e.id===n}))}))[0];return{location:a,position:r}},getSelectedPosition:function(e,t){for(var n=0;n<e.length;n++)for(var a=0;a<e[n].departments.length;a++)for(var r=0;r<e[n].departments[a].positions.length;r++)if(e[n].departments[a].positions[r].id===t)return{location:e[n],position:e[n].departments[a].positions[r]};return{location:{},position:{}}},getAdminDetpartments:function(e){return!e||!e.locations||e.locations.length>0||e.role===a.Employee?[]:e.role===a.BusinessAdmin||e.role===a.LocationAdmin?e.locations.flatMap((function(e){return e.departments})):e.role===a.Admin?e.locations.flatMap((function(e){return e.departments})).filter((function(e){return e.isDeptAdmin})):[]},requiresGeolocation:function(e){for(var t=0;t<e.length;t++)if(e[t].settings.RequireGeoLocation)return!0;return!1}},nt={subscriptionType:r.None,businessId:0,businessName:"",employeeId:0,firstOrNickName:"",firstName:"",nickName:"",middleName:"",lastName:"",fullName:"",timeClock:!1,role:a.Employee,locations:[],loading:!1,payrollEvents:[],tags:[],lastRefresh:void 0},at={auth:nt,refreshAuth:function(e,t){return new Promise((function(){}))},clearAuth:function(){var e=Object(g.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),authLoading:!1},rt=i.a.createContext(at);function ot(e,t){return it.apply(this,arguments)}function it(){return(it=Object(g.a)(h.a.mark((function e(t,n){var a,r,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLoggedin){e.next=5;break}return a=Object(v.a)({},nt),e.next=4,C.putAuthItems(a).then((function(){G("indexdb_authitems_cleared")}));case 4:return e.abrupt("return",a);case 5:if(n){e.next=12;break}return e.next=8,C.getAuthItems();case 8:if(r=e.sent,!(tt.isAuthItemsValid(r)&&void 0!==r.lastRefresh&&Object(Ee.a)(new Date,r.lastRefresh)<W(t).maxStaleAuthItemsInMinutes)){e.next=12;break}return J(t,r),e.abrupt("return",r);case 12:return e.next=14,Xe.getAuthorizedItems(t);case 14:if(!((o=e.sent)&&o.locations&&o.locations.length>0)){e.next=23;break}return e.next=18,C.putAuthItems(Object(v.a)({},o,{lastRefresh:new Date}));case 18:return G("indexdb_authitems_put",{employeeId:o.employeeId}),J(t,o),e.abrupt("return",o);case 23:return e.abrupt("return",null);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ct=function(e){var t=Object(o.useState)(Object(v.a)({},nt)),n=Object(p.a)(t,2),a=n[0],r=n[1],c=Object(o.useState)(!1),s=Object(p.a)(c,2),l=s[0],u=s[1],d=function(){var e=Object(g.a)(h.a.mark((function e(t,n){var o,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u(!0),n.isLoggedin||(o=Object(v.a)({},nt),r(o),C.putAuthItems(o).then((function(){G("indexdb_authitems_cleared")})),u(!1)),!(!t&&a.employeeId>0&&void 0!==a.lastRefresh&&Object(Ee.a)(new Date,a.lastRefresh)<W(n).maxStaleAuthItemsInMinutes)){e.next=4;break}return e.abrupt("return",a);case 4:return e.next=6,ot(n,t);case 6:return i=e.sent,u(!1),i&&r(i),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=Object(g.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r(nt),e.next=3,C.putAuthItems(nt);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i.a.createElement(rt.Provider,{value:{auth:a,refreshAuth:d,clearAuth:m,authLoading:l}},e.children)};function st(e,t){return e.length>0&&t.length>5}var lt=function(e){var t=e.history,n=ie(),a=n.alertBoxJsx,r=n.showAlert,c=i.a.useContext(re),s=c.user,l=c.userLoggedIn,u=c.logout,m=i.a.useContext(rt).refreshAuth,f=Object(o.useState)(!1),v=Object(p.a)(f,2),E=v[0],b=v[1],y=Object(o.useState)(""),O=Object(p.a)(y,2),I=O[0],S=O[1],k=Object(o.useState)(""),j=Object(p.a)(k,2),C=j[0],T=j[1],D=Object(o.useState)(""),A=Object(p.a)(D,1)[0],N=Object(o.useState)(""),w=Object(p.a)(N,1)[0],x=Object(o.useState)(!1),M=Object(p.a)(x,2),P=M[0],R=M[1],L=function(){var e=Object(g.a)(h.a.mark((function e(){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I&&C){e.next=2;break}return e.abrupt("return");case 2:n=_.getUserAndEnvironmentFromInput(I),b(!0),Xe.authenticateUser(n.username,C,n.env.key).then((function(e){if(e.loggedIn)l(I,e.access_token,n.env.key).then((function(e){m(!0,e).then((function(){G("login",{username:n.username,appVersion:_.settings.appVersionString,environment:n.env.name}),console.log("logged in to ".concat(n.env.name,": ").concat(n.username)),t.push("/tabs/schedule",{direction:"none"}),t.goForward(),b(!1)})).catch((function(){b(!1),r("Failed to log in","Could not retreive user data",(function(){u()}))}))})).catch((function(){b(!1),r("Failed to log in","Could not set access token",(function(){u()}))}));else{b(!1),G("login_failure",{username:n.username,appVersion:_.settings.appVersionString,environment:n.env.name});var a=e.error?e.error:"Could not log in";r("Failed to log in",a,(function(){T(""),R(!1)}))}}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(d.W)((function(){s.isLoggedin&&(t.push("/tabs/schedule",{direction:"forward"}),t.goForward())})),i.a.createElement(d.x,{id:"login-page"},i.a.createElement(d.h,{className:"login-content"},i.a.createElement("div",{className:"login-logo"},i.a.createElement("img",{className:"logo",src:"assets/img/OS Logo - 4pt Rounded _ 2 Tone Orange.svg",alt:"Orbital Shift Logo"})),i.a.createElement(d.s,{isOpen:E,onDidDismiss:function(){return b(!1)},spinner:"dots",message:"Logging in...",duration:0}),a,i.a.createElement(d.r,{className:"form-list"},i.a.createElement("div",{className:"item"},i.a.createElement("div",{className:"label"},"User"),i.a.createElement("div",{className:"field-container"},i.a.createElement("input",{className:"input",id:"username",name:"username",type:"text",value:I,onChange:function(e){var t;t=e.target.value,S(t),R(st(t,C))}}))),A.length>0&&i.a.createElement(d.L,{color:"light"},i.a.createElement("p",{className:"ion-padding-start"},A)),i.a.createElement("div",{className:"item"},i.a.createElement("div",{className:"label"},"Password"),i.a.createElement("div",{className:"field-container"},i.a.createElement("input",{className:"input",id:"password",name:"password",type:"password",value:C,onChange:function(e){var t;t=e.target.value,T(t),R(st(I,t))}}))),w.length>0&&i.a.createElement(d.L,{color:"light"},i.a.createElement("p",{className:"ion-padding-start"},w))),i.a.createElement(d.B,null,i.a.createElement(d.g,null,i.a.createElement(d.d,{className:"login-button",type:"submit",onClick:L,expand:"block",disabled:!P},"LOG IN")))))},ut=n(73);function dt(e){return e.length>19?e.slice(0,19):e}var mt,pt={getScheduleEvent:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.get(t,"api/v2/employee/schedule-events/get/"+n);case 2:if(!(a=e.sent).error){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),getScheduleEventsByFilter:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(v.a)({},n,{start:_e(n.start),end:_e(n.end)}),console.log("start: "+a.start+", end: "+a.end),e.next=4,X.post(t,"api/v2/employee/schedule-events/filter",a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),getDailyNotesByFilter:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(v.a)({start:_e(n.start),end:_e(n.end)},n),e.next=3,X.post(t,"api/v2/daily-notes/filter",a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),updateScheduleEvent:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={scheduleEventId:n.scheduleEventId,eventType:n.eventType,eventStatus:n.eventStatus,isConfirmed:n.isConfirmed,positionId:n.position.position.id,employeeId:n.employee.id,eventStart:dt(n.eventStart),eventEnd:dt(n.eventEnd),tagId:null===(r=n.tag)||void 0===r?void 0:r.id,eventBreaks:n.eventBreaks,isClockedIn:n.isClockedIn,breakStart:null,breakDuration:null,clockOutValue:n.clockoutValue,absentId:n.absentId,absentTime:n.absentTimeMinutes,notes:n.notes,sendMessage:!1,recurrenceId:n.recurrenceId,recurrenceStart:n.recurrenceStart,recurrenceEnd:n.recurrenceEnd,recurrenceType:n.recurrenceType,repeatInterval:n.repeatInterval,repeatWeekdays:n.repeatWeekdays,recurrenceUpdateType:a},e.next=3,X.post(t,"api/v2/employee/schedule-events/update",o);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),createScheduleEvent:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={sceduleEventId:0,eventType:n.eventType,eventStatus:n.eventStatus,isConfirmed:n.isConfirmed,positionId:n.position.position.id,employeeId:n.employee.id,eventStart:dt(n.eventStart),eventEnd:dt(n.eventEnd),tagId:null===(r=n.tag)||void 0===r?void 0:r.id,eventBreaks:n.eventBreaks,isClockedIn:n.isClockedIn,breakStart:null,breakDuration:null,clockOutValue:n.clockoutValue,absentId:n.absentId,absentTime:n.absentTimeMinutes,notes:n.notes,sendMessage:!1,recurrenceId:n.recurrenceId,recurrenceStart:n.recurrenceStart,recurrenceEnd:n.recurrenceEnd,recurrenceType:n.recurrenceType,repeatInterval:n.repeatInterval,repeatWeekdays:n.repeatWeekdays,recurrenceUpdateType:a},e.next=3,X.post(t,"api/v2/employee/schedule-events/create",o);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),deleteScheduleEvent:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={scheduleEventId:n,recurrenceUpdateType:a,sendMessage:!1},e.next=3,X.post(t,"api/v2/employee/schedule-events/delete",r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),updateConfirmedScheduleEvent:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={id:n,confirm:a},e.next=3,X.post(t,"api/v2/employee/schedule-events/confirm",r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()};!function(e){e[e.schedule=0]="schedule",e[e.clock=1]="clock"}(mt||(mt={}));var ft={settingsLocId:0,dnLocIds:[],start:new Date,end:new Date,filterByEmployee:!1,positionIds:[],eventTypeId:De.ClockAndSched,eventStatusId:De.ClockAndSched,tagId:void 0,view:mt.schedule},vt={settingsLocId:0,dnLocIds:[],positionIds:[],tagId:void 0,eventTypeId:De.ClockAndSched,eventStatusId:De.ClockAndSched},Et=function(e){var t=e.startDate,n=e.setStartDate,a=e.onWeekdayClick,r=Object(o.useRef)(t),c=function(e){Object(ge.a)(e,r.current)||(r.current=e,n(e))};return i.a.createElement("div",{className:"chooser"},i.a.createElement("div",{className:"top"},i.a.createElement("button",{onClick:function(){return c(Object(he.a)(t,-7))},className:"arrow",key:-1},i.a.createElement(d.m,{mode:"ios",icon:f.b})),i.a.createElement("div",{className:"month-year-container"},i.a.createElement("div",{className:"datetime-picker-container"},i.a.createElement(d.i,{mode:"ios",className:"datetime-picker",displayFormat:"MMM YYYY",pickerFormat:"MMM D YYYY",min:"2005-01-01",max:"2030-01-01",value:t.toISOString(),onIonChange:function(e){c(Object(de.a)(e.detail.value))}}),i.a.createElement(d.m,{mode:"md",icon:f.k}))),i.a.createElement("button",{onClick:function(){return c(Object(he.a)(t,7))},className:"arrow",key:7},i.a.createElement(d.m,{mode:"ios",icon:f.e}))),i.a.createElement("div",{className:"weekday-list"},[0,1,2,3,4,5,6].map((function(e){var n=Object(he.a)(t,e),r=Object(me.a)(n)?"today":"not-today";return i.a.createElement("button",{key:e,className:"weekday-button",style:{outline:"none"},onClick:function(){a(n)}},i.a.createElement("div",null,i.a.createElement("div",{className:"weekday-abbr"},Object(pe.a)(n,"EEE")),i.a.createElement("div",{className:r}),i.a.createElement("div",{className:"weekday-num"},Object(pe.a)(n,"d"))))}))))},ht=n(224);var gt={1:"#9CBA6A",2:"#BFBFBF",3:"#FFAD00",4:"#C41A26",6:"#677A46",7:"#FFAD00"},bt={1:{color:"black"},2:{color:"#C41A26"},4:{color:"#BCBCBC"}},yt=function(e){var t,n=e.location,r=e.event,c=e.multiLocation,s=e.showEmployeeName,l=e.onEdit,u=Object(o.useContext)(rt).auth,m=s?{display:"inline-block"}:{display:"none"},p=Object(de.a)(r.EventStart),v=!!c||n.departments.filter((function(e){return e.positions.filter((function(e){return e.hasPosition}))})).length>1,E="";c&&r.AbbreviatedLocationName&&(E=r.AbbreviatedLocationName+"/"),v&&r.AbbreviatedDepartmentName&&(E+=r.AbbreviatedDepartmentName+"/"),E+=r.PositionName;var h={borderLeft:"7px solid ".concat(gt[r.EventTypeId]," ")},g=void 0!==(null===(t=r.EventBreaks)||void 0===t?void 0:t.find((function(e){return null===e.BreakEnd}))),b=bt[r.EventStatusId],y=function(){(function(e,t,n,r,o,i,c,s,l,u){if(u.role===a.BusinessAdmin)return!0;if(u.role===a.LocationAdmin)return!tt.isPositionSpecificEvent(e)||0!==u.locations.filter((function(e){return e.id===i})).length;var d=Object(de.a)(o),m=new Date,p=Object(be.a)(m,d),f=!1,v=tt.getAdminAuthorizationForDepartment(u,c);if(u.role===a.Admin)if(n===u.employeeId){if(e===Se.Clock)return(v&x.CanEditOwnClockEvents)===x.CanEditOwnClockEvents;if((v&x.CanEditSchedules)===x.CanEditSchedules)return!0;f=!0}else{if(e===Se.Clock)return(v&x.CanEditEmployeeClockEvents)===x.CanEditEmployeeClockEvents;if(tt.canEditSchedules(u,i,c))return!0;if(!tt.adminIsInDepartment(u,c))return!1;f=!0}return!(u.role!==a.Employee&&!f)&&(n===u.employeeId?!p&&(e!==Se.Clock&&(e===Se.Shift?t===Te.Approved||t===Te.Request:e===Se.Cover?t===Te.Request:!(tt.isPositionSpecificEvent(e)||!tt.canEditNonPositionEvents(u,c))||t===Te.Request)):e===Se.Cover&&t===Te.Request)})(r.EventTypeId,r.EventStatusId,r.EmployeeId,r.EventStart,r.EventEnd,r.LocationId,r.DepartmentId,r.PositionId,r.IsConfirmed,u)&&l(r)};return i.a.createElement("button",{className:"card",onClick:function(){y()}},i.a.createElement("div",{className:"card-first-col"},i.a.createElement("div",{className:"day-name"},Object(pe.a)(p,"EEE")," "),i.a.createElement("div",{className:"day-number"},Object(pe.a)(p,"d"))),i.a.createElement("div",{className:"card-second-col",style:h},i.a.createElement("div",{className:"time-row"},g&&i.a.createElement(d.m,{icon:f.h}),r.IsClockedIn&&!g&&i.a.createElement(d.m,{icon:f.w}),i.a.createElement("span",{style:b},Ve(r),"\xa0\xa0"),function(e){if(!e)return"(0m)";var t,n,a=e.split(":");if(a[0].indexOf(".")>=0){var r=a[0].split(".");t=24*parseInt(r[0])+parseInt(r[1]),n=parseInt(a[1])}else t=parseInt(a[0]),n=parseInt(a[1]);return t>0?"(".concat(t,"h ").concat(n,"m)"):"(".concat(n,"m)")}(r.EventTypeId===Se.Absent?r.Time:r.EventDuration)),i.a.createElement("div",{className:"name-row",style:m},r.FirstName," ",r.LastName),i.a.createElement("div",{className:"dept-position-row"},r.IsConfirmed&&i.a.createElement(d.m,{icon:f.m}),E,"\xa0\xa0",r.Tag&&"~".concat(r.Tag))))};var Ot=function(){var e=Object(o.useState)(!1),t=Object(p.a)(e,2),n=t[0],a=t[1],r=Object(o.useState)({header:"",message:"",options:[],onDismiss:function(e){}}),c=Object(p.a)(r,2),s=c[0],l=c[1],u=function(e){a(!1),s.onDismiss(e)};return{showDialog:function(e,t,n,r){l({header:e,message:t,options:n,onDismiss:r}),a(!0)},dialogBoxJsx:i.a.createElement(d.w,{isOpen:n,cssClass:"mini-modal orbital-dialog-modal",onDidDismiss:function(){return u(null)}},i.a.createElement(d.h,{className:"modal-content"},i.a.createElement(d.l,{mode:"ios"},i.a.createElement(d.Q,null,i.a.createElement(d.N,null,s.header))),i.a.createElement(d.k,null,s.options.map((function(e){return i.a.createElement(d.B,{key:e.value},i.a.createElement(d.g,{size:"12"},i.a.createElement(d.d,{expand:"block",color:e.color,className:"apply-button",onClick:function(){return u(e.value)}},e.text)))})),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12"},i.a.createElement(d.d,{expand:"block",className:"cancel-button",onClick:function(){return u(null)}},"Cancel"))))))}},It=function(e){var t=e.currentDepartment,n=e.onDepartmentUpdate,a=Object(o.useContext)(rt).auth,r=Object(o.useState)(t),c=Object(p.a)(r,2),s=c[0],l=c[1];if(a&&a.locations&&0!==a.locations.length){var u=null!==s.department?s.department.id:null;return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Location"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:s.location.id,onIonChange:function(e){return function(e){if(e){var t={location:a.locations.filter((function(t){return t.id===e}))[0],department:null};l(t),n(t)}}(e.detail.value)}},a.locations.map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.name)})))),i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Department"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:u,onIonChange:function(e){return function(e){if(void 0!==e){var t={location:s.location,department:null===e?null:s.location.departments.filter((function(t){return t.id===e}))[0]};l(t),n(t)}}(e.detail.value)}},tt.isAdminForAllDepts(a,s.location.id)&&i.a.createElement(d.F,{key:-1,value:null},"All Departments"),s.location.departments.filter((function(e){return tt.isAdminAuthorizedFor(a,s.location.id,e.id,x.CanEditSchedules)})).map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.name)})))))}return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,"Loading"))},St=function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o){var i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.post(t,"api/v2/daily-notes/update",{dailyNoteId:n,date:_e(o),text:a,role:r});case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o){return e.apply(this,arguments)}}(),kt=function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o,i){var c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.post(t,"api/v2/daily-notes/insert",{locId:n,depId:a,role:r,date:o,text:i});case 2:return c=e.sent,e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o,i){return e.apply(this,arguments)}}(),jt=function(){var e=Object(g.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.post(t,"api/v2/daily-notes/delete/"+n);case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ct={getDailyNote:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o){var i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.post(t,"api/v2/daily-notes/get",{locId:n,depId:a,role:r,date:o});case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o){return e.apply(this,arguments)}}(),updateDailyNote:St,insertDailyNote:kt,deleteDailyNote:jt};var Tt=function(e){var t=e.onCloseModal,n=e.isOpen,r=e.note,c=e.initialDate,s=Object(o.useState)(r),l=Object(p.a)(s,2),u=l[0],m=l[1],v=ue(),E=ie(),h=Object(o.useContext)(re).user,g=Object(o.useContext)(rt).auth,b=Ot(),y=Object(o.useState)(null!==r?r.Role:1),O=Object(p.a)(y,2),I=O[0],S=O[1],k=Object(o.useState)(null!==r?tt.getSelectedDepartment(g,r.LocationId,r.DepartmentId):function(e){for(var t=0;t<e.locations.length;t++){var n=e.locations[t];if(n.adminAllDepts)return{location:n,department:null};for(var r=0;r<n.departments.length;r++){var o=n.departments[r];if(e.role===a.LocationAdmin||e.role===a.BusinessAdmin)return{location:n,department:o};if(o.isDeptAdmin)return{location:n,department:o}}}throw new Error("Could not find a department for this user to add a note")}(g)),j=Object(p.a)(k,2),C=j[0],T=j[1],D=Object(o.useState)(null!==r?r.Notes:""),A=Object(p.a)(D,2),N=A[0],w=A[1],x=Object(o.useRef)(null!==r?r.Notes.length:0),M=Object(o.useState)(null!==r?Object(de.a)(r.EventStart):c),P=Object(p.a)(M,2),R=P[0],L=P[1];Object(o.useEffect)((function(){var e=!0;return n&&null===u&&e&&U(C,I,R),function(){e=!1}}),[n,u]);var F,U=function(e,t,n){Ct.getDailyNote(h,e.location.id,null===e.department?-1:e.department.id,t,n).then((function(e){if("message"in e)e.error||m(null);else{if(null!==u&&u.DailyNoteId===e.DailyNoteId)return;a=u,(null===(n=e)&&null!==a||null!==n&&null===a||(null!==n||null!==a)&&((null===n||void 0===n?void 0:n.Role)!==(null===a||void 0===a?void 0:a.Role)||(null===n||void 0===n?void 0:n.DailyNoteId)!==(null===a||void 0===a?void 0:a.DailyNoteId)))&&m(e);var t=Object(de.a)(e.EventStart);Object(ge.a)(t,R)||L(t),(e.LocationId!==C.location.id||-1===e.DepartmentId&&null!==C.department||-1!==e.DepartmentId&&null===C.department||null!==C.department&&e.DepartmentId!==C.department.id)&&T(tt.getSelectedDepartment(g,e.LocationId,e.DepartmentId)),e.Role!==I&&S(e.Role),e.Notes!==N&&(w(e.Notes),x.current=e.Notes.length)}var n,a}))},B=function(e,n,a,r,o){null===u&&0===N.length||null!==u&&u.Notes===N?o&&t(""):null!==u?(0===r.length&&Ct.deleteDailyNote(h,u.DailyNoteId).then((function(e){e.error?E.showAlert("Can't Delete Note",e.message,(function(){})):o?t("Note Deleted"):v.showToast("Note Deleted")})),Ct.updateDailyNote(h,u.DailyNoteId,r,n,a).then((function(e){e.error?E.showAlert("Can't Update Note",e.message,(function(){})):o?t("Note Updated"):v.showToast("Note Updated")}))):Ct.insertDailyNote(h,e.location.id,null===e.department?-1:e.department.id,n,a,r).then((function(e){e.error?E.showAlert("Can't Add Daily Note",e.message,(function(){})):o?t("Note Added"):v.showToast("Note Added")}))};return n&&g&&g.locations&&0!==g.locations.length?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,null,i.a.createElement(d.e,{slot:"start"},i.a.createElement(d.d,{onClick:function(){null===u&&null!=N||null!==u&&u.Notes!==N?B(C,I,R,N,!0):t("")}},i.a.createElement(d.m,{icon:f.c,slot:"icon-only"}))),i.a.createElement(d.N,null,"Daily Notes"))),i.a.createElement(d.h,{class:"edit-daily-modal-content"},i.a.createElement(d.r,null,i.a.createElement(It,{currentDepartment:C,onDepartmentUpdate:function(e){e.location.id===C.location.id&&e.department===C.department||(T(e),B(C,I,R,N,!1),U(e,I,R))}}),i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Viewable By"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:I,onIonChange:function(e){var t;(t=e.detail.value)!==I&&(S(t),B(C,I,R,N,!1),U(C,t,R))}},i.a.createElement(d.F,{value:1,key:1},"Employees"),i.a.createElement(d.F,{value:2,key:2},"Admins"))),i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Date"),i.a.createElement(d.i,{mode:"ios",displayFormat:"DDD, M/DD/YY",pickerFormat:"MMM D YYYY",min:"2005-01-01",max:"2030-01-01",value:R.toISOString(),onIonChange:function(e){!function(e){if(null!==e&&void 0!==e){var t=Object(de.a)(e);t!==R&&(L(t),B(C,I,R,N,!1),U(C,I,t))}}(e.detail.value)}})),i.a.createElement(d.o,null,i.a.createElement(d.M,{value:N,placeholder:"Enter daily note",maxlength:180,rows:4,spellcheck:!0,wrap:"hard",debounce:50,onIonChange:function(e){var t;null!==(t=e.detail.value)&&void 0!==t&&(t.length!==x.current&&(x.current=t.length),t!==N&&w(t))}})),i.a.createElement("div",{className:"character-counter"},null!==(F=null===N||void 0===N?void 0:N.length)&&void 0!==F?F:0,"/180"))),E.alertBoxJsx,b.dialogBoxJsx,v.simpleToastJsx):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,"Loading"),E.alertBoxJsx)},Dt=function(e){var t=e.note,n=e.onForceRefresh,r=Object(de.a)(t.EventStart),c=-1===t.DepartmentId?"All Depts":t.DepartmentName,s=Object(o.useState)(!1),l=Object(p.a)(s,2),u=l[0],m=l[1],f=Object(o.useContext)(rt).auth;return i.a.createElement(i.a.Fragment,null,i.a.createElement("button",{className:"card daily-note",onClick:function(){if(f.role!==a.Employee)return!!tt.isAdminAuthorizedFor(f,t.LocationId,t.DepartmentId,x.CanEditSchedules)&&void m(!0)}},i.a.createElement("div",{className:"card-first-col"},i.a.createElement("div",{className:"day-name"},Object(pe.a)(r,"EEE")," "),i.a.createElement("div",{className:"day-number"},Object(pe.a)(r,"d"))),i.a.createElement("div",{className:"card-second-col"},i.a.createElement("div",{className:"first-row"},c,": ",1===t.Role?"Employees":"Admins",i.a.createElement("br",null),t.Notes))),i.a.createElement(d.w,{isOpen:u,onDidDismiss:function(){return m(!1)}},i.a.createElement(Tt,{isOpen:u,note:t,onCloseModal:function(e){return n(e),void m(!1)},initialDate:new Date,newNoteClicked:!0})))};var At=function(e){var t=e.date,n=e.onForceRefresh,r=Object(o.useState)(!1),c=Object(p.a)(r,2),s=c[0],l=c[1];if(!function(e){if(e.role===a.Employee)return!1;if(e.role===a.BusinessAdmin||e.role===a.LocationAdmin)return!0;for(var t=0;t<e.locations.length;t++){var n=e.locations[t];if(n.adminAllDepts)return!0;for(var r=0;r<n.departments.length;r++)if(n.departments[r].isDeptAdmin)return!0}return!1}(Object(o.useContext)(rt).auth))return i.a.createElement("span",null);return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.d,{mode:"md",className:"add-dailynote-button",onClick:function(){l(!0)}},"+ Daily Note"),i.a.createElement(d.w,{isOpen:s,onDidDismiss:function(){return l(!1)}},i.a.createElement(Tt,{isOpen:s,note:null,initialDate:t,onCloseModal:function(e){var t;t=e,l(!1),n(t)},newNoteClicked:!0})))},Nt=function(){return i.a.createElement("div",null,i.a.createElement("span",{className:"no-messagesOrEvents-text"},"No Events"))},wt=Object(o.forwardRef)((function(e,t){var n=e.locations,a=e.header,r=e.events,c=e.notes,s=e.showEmployeeNames,l=e.onEdit,u=e.dailyNotesAddButtonDate,d=e.onForceRefresh,m=i.a.createRef(),p=n.filter((function(e){return e.departments.filter((function(e){return e.positions.filter((function(e){return e.hasPosition}))}))})).length>1;return Object(o.useImperativeHandle)(t,(function(){return{scrollIntoView:function(){null!==m.current&&(m.current.scrollIntoView({behavior:"smooth",block:"start",inline:"start"}),setTimeout((function(){null!==m.current&&m.current.focus()}),1e3))}}})),i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{tabIndex:0,ref:m,className:"event-list-header"},a,null!==u&&i.a.createElement(At,{onForceRefresh:d,date:u})),0===c.length&&0===r.length&&i.a.createElement(Nt,null),i.a.createElement("div",null,c.map((function(e){return i.a.createElement(Dt,{onForceRefresh:d,key:e.DailyNoteId,note:e,location:n.filter((function(t){return t.id===e.LocationId}))[0]})}))),i.a.createElement("div",null,r.map((function(e){return i.a.createElement(yt,{onEdit:l,key:e.ScheduleEventId,event:e,location:n.filter((function(t){return t.id===e.LocationId}))[0],multiLocation:p,showEmployeeName:s})}))))})),xt=Object(o.forwardRef)((function(e,t){var n=e.events,a=e.notes,r=e.hoursPerDay,c=e.listType,s=e.auth,l=e.onEdit,u=e.onForceRefresh,d=e.weekStart,m=new U;switch(c){case"requests":m=function(e,t,n){var a=new U;return a.add("MY REQUESTS",{events:e.filter((function(e){return e.EmployeeId===n})),notes:[],date:null}),a.add("CO-WORKERS",{events:e.filter((function(e){return e.EmployeeId!==n})),notes:[],date:null}),a}(n,0,s.employeeId);break;case"my":m=function(e,t,n,a){var r=new U;if(0===e.length&&0===t.length)return r;var o=new Date(2199,1,1);if(e.length>0&&(o=qe(Object(de.a)(e[0].EventStart),n.DayWeekStartsOn,n.DayStartTime)),t.length>0){var i=qe(Object(de.a)(t[0].EventStart),n.DayWeekStartsOn,n.DayStartTime);Object(ht.a)(i,o)&&(o=i)}var c=Object(he.a)(o,7),s="".concat(Object(pe.a)(o,"MMM d")," - ").concat(Object(pe.a)(c,"MMM d")).toUpperCase()+" "+Be(a.map((function(e){return Ue(e.time)})).reduce((function(e,t){return e+t}),0));return r.add(s,{events:e,notes:t,date:o}),r}(n,a,s.locations[0].settings,r);break;case"today":m=function(e,t,n,a){for(var r=We(new Date,n),o=0,i=0;i<a.length;i++)o+=Ue(a[i].time);var c=o>0?Be(o):"",s=Object(pe.a)(r,"h:mmaaa").replace("M","")+" "+Object(pe.a)(r,"MMM d, yyyy").toUpperCase()+" "+c,l=new Date(r.valueOf());l.setHours(0,0,0,0);var u=new U;return u.add(s,{events:e,notes:t,date:l}),u}(n,a,s.locations[0].settings,r);break;default:m=function(e,t){var n=new U;return e.map((function(e){var a=Object(pe.a)(Object(de.a)(e.EventStart).setHours(0,0,0,0),"MMM d, yyyy").toUpperCase();if(!n.containsKey(a)){var r=t.filter((function(e){return Object(pe.a)(Object(de.a)(e.EventStart).setHours(0,0,0,0),"MMM d, yyyy").toUpperCase()===a}));n.add(a,{notes:r,events:[],date:Object(de.a)(e.EventStart)})}return n.item(a).events.push(e),a})),n}(n,a)}Object(o.useImperativeHandle)(t,(function(){return{scrollToDate:function(e){for(var t=Object(pe.a)(e,"MMM d, yyyy").toUpperCase(),n=m.keys(),a=0;a<n.length;a++)if(n[a]===t){var r=m.item(n[a]);if(void 0!==r.segmentRef&&null!==r.segmentRef.current){r.segmentRef.current.scrollIntoView();break}}}}}));var p=[-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10].map((function(e){return{segName:Object(pe.a)(Object(he.a)(d,e).setHours(0,0,0,0),"MMM d, yyyy").toUpperCase(),segRef:Object(o.useRef)(null)}}));return i.a.createElement(i.a.Fragment,null,m.keys().map((function(e){var t=p.find((function(t){return e===t.segName})),n=void 0!==t?t.segRef:p[0].segRef;return m.item(e).segmentRef=n,i.a.createElement(wt,{ref:n,onEdit:l,key:e,header:e,locations:s.locations,events:m.item(e).events,notes:m.item(e).notes,showEmployeeNames:"all"===c||"CO-WORKERS"===e,showTotalDuration:"requests"!==c,dailyNotesAddButtonDate:m.item(e).date,onForceRefresh:u})})))})),Mt=function(e,t){if(!e||!e.locations||0===e.locations.length)return[];var n=e.locations[0].settings,a=[{value:Se.Shift,text:"SHIFT",color:"green"},{value:Se.Cover,text:"COVER",color:"red"}];if(t&&a.unshift({value:-1,text:"ALL",color:"black"}),a.push({value:Se.Clock,text:"CLOCK",color:"green"}),n.ShowUnavailableEventType&&a.push({value:Se.Unavailable,text:"UNAVAILABLE",color:"yellow"}),n.ShowVacationEventType&&a.push({value:Se.Vacation,text:"VACATION",color:"yellow"}),n.ShowAbsentEventType){var r=[],o={};return e.locations.flatMap((function(e){return e.departments.flatMap((function(t){return t.positions.map((function(t){return o[t.id]=e}))}))})),e.payrollEvents.map((function(e){return e.name.startsWith("--")?null:(t?e.positionIds.some((function(e){return t.positionIds.indexOf(e)>=0}))&&r.push({value:e.id,text:"".concat(e.name," (").concat(o[e.positionIds[0]].name,")"),color:"yellow"}):r.push({value:e.id,text:"".concat(e.name," (").concat(o[e.positionIds[0]].name,")"),color:"yellow"}),e)})),r.sort((function(e,t){return e.text>t.text?1:-1})),a.concat(r)}return a},Pt={areEqual:function(e,t){if(!e&&t||e&&!t)return!1;if(!e&&!t)return!0;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!Pt.contains(t,e[n]))return!1;return!0},contains:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},containsAny:function(e,t){for(var n=0;n<e.length;n++)if(t.includes(e[n]))return!0;return!1},unique:function(e){var t=[];return e.map((function(e){Pt.contains(t,e)||t.push(e)})),t},uniqueObject:function(e,t){var n=[];return e.map((function(e){for(var a=!1,r=0;r<n.length;r++)if(t(n[r],e)){a=!0;break}a||n.push(e)})),n}},Rt=Pt;function Lt(e,t){return Object(v.a)({},ft,{start:t.start,end:t.end,tagId:-1,positionIds:e.locations.flatMap((function(e){return e.departments.flatMap((function(e){return e.positions.map((function(e){return e.id}))}))})),dnLocIds:e.locations.map((function(e){return e.id})),settingsLocId:e.locations[0].id})}function Ft(e,t){return void 0===e&&-1===t||-1===e&&void 0===t||e===t}var Ut={getFilter:function(e){var t=Object(v.a)({},vt),n=localStorage.getItem("scheduleEventFilter");return null!==n&&(t=JSON.parse(n)),tt.isAuthItemsValid(e)&&(void 0!==t.positionIds&&0!==t.positionIds.length||(t.positionIds=e.locations.flatMap((function(e){return e.departments.flatMap((function(e){return e.positions.map((function(e){return e.id}))}))}))),void 0!==t.dnLocIds&&0!==t.dnLocIds.length||(t.dnLocIds=e.locations.map((function(e){return e.id}))),void 0!==t.settingsLocId&&0!==t.settingsLocId||(t.settingsLocId=e.locations[0].id)),t},putFilter:function(e){var t={settingsLocId:e.settingsLocId,dnLocIds:e.dnLocIds,positionIds:e.positionIds,tagId:e.tagId,eventStatusId:e.eventStatusId,eventTypeId:e.eventTypeId};localStorage.setItem("scheduleEventFilter",JSON.stringify(t))},isFilterApplied:function(e,t){var n=Lt(e,t);return!(n.eventTypeId===t.eventTypeId&&n.eventStatusId===t.eventStatusId&&Ft(n.tagId,t.tagId)&&Rt.areEqual(n.positionIds,t.positionIds))},getDefaultFilter:Lt,clear:function(){localStorage.removeItem("scheduleEventFilter")},tagIsEqual:Ft};var Bt=function(e){var t=e.auth,n=e.filter,a=e.onDismissModal,r=e.onCancelModal,c=e.isOpen,s=function(e,t){var n=[],a=[],r=[];return tt.isAuthItemsValid(e)?(e.locations.map((function(e){return e.departments.map((function(o){return o.positions.map((function(i){if(t.positionIds.includes(i.id)){var c=e.id.toString(),s=o.id.toString();n.includes(c)||n.push(c),a.includes(s)||a.push(s),r.push(i.id.toString())}return i.id}))}))})),[n,a,r]):[[],[],[]]}(t,n),l=Object(p.a)(s,3),u=l[0],m=l[1],E=l[2],h=Object(o.useState)(function(e,t){return console.log("Event Type: "+t.eventTypeId),t.eventTypeId===De.All&&t.eventStatusId===De.All?De.All:t.eventTypeId===De.ClockAndSched&&t.eventStatusId===De.ClockAndSched?De.ClockAndSched:t.eventTypeId===De.DontWork&&t.eventStatusId===De.DontWork?De.DontWork:t.eventTypeId===De.Scheduled&&t.eventStatusId===De.Scheduled?De.Scheduled:De.Custom}(0,n)),g=Object(p.a)(h,2),b=g[0],y=g[1],O=Object(o.useState)(n),I=Object(p.a)(O,2),S=I[0],k=I[1],j=Object(o.useState)(Mt(t,n)),C=Object(p.a)(j,2),T=C[0],D=C[1],A=Object(o.useState)(u),N=Object(p.a)(A,2),w=N[0],x=N[1],M=Object(o.useState)(m),P=Object(p.a)(M,2),R=P[0],L=P[1],F=Object(o.useState)(E),U=Object(p.a)(F,2),B=U[0],V=U[1],z=Object(o.useState)(!1),q=Object(p.a)(z,2),W=q[0],_=q[1];Object(o.useEffect)((function(){k(n)}),[n]),Object(o.useEffect)((function(){c&&_(!1)}),[c]);var Y=function(e){var t,n;y(e),_(!0),k((t=S,(n=e)===De.Custom?Object(v.a)({},t,{eventTypeId:t.eventTypeId,eventStatusId:t.eventStatusId}):Object(v.a)({},t,{eventTypeId:n,eventStatusId:n})))};return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,null,i.a.createElement(d.e,{slot:"start"},i.a.createElement(d.d,{onClick:function(){r()}},i.a.createElement(d.m,{icon:f.c,mode:"md",slot:"icon-only"}))),i.a.createElement(d.N,null,"Filter"),i.a.createElement(d.e,{slot:"end"},i.a.createElement(d.d,{onClick:function(){y(De.ClockAndSched),D(Mt(t,n)),x(t.locations.map((function(e){return""+e.id}))),L(t.locations.flatMap((function(e){return e.departments})).map((function(e){return""+e.id}))),V(t.locations.flatMap((function(e){return e.departments})).flatMap((function(e){return e.positions})).map((function(e){return""+e.id}))),k(Ut.getDefaultFilter(t,n)),_(!1)}},"RESET")))),i.a.createElement(d.h,{class:"outer-content"},i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Events"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:b,onIonChange:function(e){return Y(e.detail.value)}},i.a.createElement(d.F,{value:De.ClockAndSched},"Clock + Sched"),i.a.createElement(d.F,{value:De.Scheduled},"Scheduled"),i.a.createElement(d.F,{value:De.DontWork},"Don't Work"),i.a.createElement(d.F,{value:De.Custom},"Custom"),i.a.createElement(d.F,{value:De.All},"ALL"))),b===De.Custom&&i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Type"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:S.eventTypeId,onIonChange:function(e){k(Object(v.a)({},S,{eventTypeId:e.detail.value})),_(!0)}},T.map((function(e){return i.a.createElement(d.F,{key:e.value,value:e.value},e.text)})))),b===De.Custom&&i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Status"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:S.eventStatusId,onIonChange:function(e){k(Object(v.a)({},S,{eventStatusId:e.detail.value})),_(!0)}},i.a.createElement(d.F,{value:-1},"ALL"),i.a.createElement(d.F,{value:1},"Approved"),i.a.createElement(d.F,{value:2},"Request"),i.a.createElement(d.F,{value:4},"Request Denied"))),i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Tags"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:S.tagId||-1,onIonChange:function(e){k(Object(v.a)({},S,{tagId:e.detail.value})),_(!0)}},i.a.createElement(d.F,{key:-1,value:-1},"ALL"),t.tags.map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},"~",e.name)})))),t.locations.length>1&&i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Locations"),i.a.createElement(d.E,{mode:"ios",multiple:!0,onIonChange:function(e){return n=e.detail.value,x(n),_(!0),L(t.locations.filter((function(e){return n.indexOf(e.id.toString())>=0})).flatMap((function(e){return e.departments})).map((function(e){return""+e.id}))),void D(Mt(t,S));var n},value:w},t.locations.map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id.toString()},e.name)})))),t.locations.flatMap((function(e){return e.departments})).length>1&&i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Departments"),i.a.createElement(d.E,{mode:"ios",multiple:!0,onIonChange:function(e){return n=e.detail.value,L(n),_(!0),void V(t.locations.filter((function(e){return w.indexOf(e.id.toString())>=0})).flatMap((function(e){return e.departments})).filter((function(e){return n.includes(e.id.toString())})).flatMap((function(e){return e.positions})).map((function(e){return""+e.id})));var n},value:R},t.locations.filter((function(e){return w.indexOf(e.id.toString())>=0})).map((function(e){return e.departments.map((function(t){return i.a.createElement(d.F,{key:t.id,value:t.id.toString()},e.abbr,"/",t.name)}))})))),t.locations.flatMap((function(e){return e.departments})).flatMap((function(e){return e.positions})).length>1&&i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Positions"),i.a.createElement(d.E,{mode:"ios",multiple:!0,onIonChange:function(e){return t=e.detail.value,V(t),void _(!0);var t},value:B},t.locations.filter((function(e){return w.indexOf(e.id.toString())>=0})).flatMap((function(e){return e.departments})).filter((function(e){return R.indexOf(e.id.toString())>=0})).map((function(e){return e.positions.map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id.toString()},e.name)}))}))))),i.a.createElement(d.j,null,i.a.createElement(d.d,{className:"apply-button",expand:"block",onClick:function(){var e=B.map((function(e){return parseInt(e)})),n=Object(v.a)({},S,{positionIds:e}),r=Ut.isFilterApplied(t,n);a(n,r)},disabled:!W},"APPLY FILTER")))};var Vt=function(e){var t=Object(o.useRef)(null),n={ionicRefresherJsx:i.a.createElement(d.y,{slot:"fixed",ref:t,onIonRefresh:e},i.a.createElement(d.z,{pullingIcon:"arrow-dropdown",pullingText:"Pull down to refresh",refreshingSpinner:"dots",refreshingText:"Refreshing..."}))};return Object(v.a)({},n)};function zt(e){return e.eventType!==Se.Absent?e.eventType:e.absentId}function qt(e,t){return e.payrollEvents.filter((function(e){return e.positionIds.includes(t)&&!e.name.startsWith("--")})).map((function(e){return{id:e.id,name:e.name}})).sort((function(e,t){return e.name>t.name?1:t.name>e.name?-1:0}))}function Wt(e,t){if(!tt.isAuthItemsValid(e))return[];var n=[],r=[],o=t.position.location.settings,i=tt.getDepartmentFromPositionId(e,t.position.position.id);if(null===i)return[];if(function(e,t,n){return e.role===a.BusinessAdmin||e.role===a.LocationAdmin||e.role!==a.Employee&&(t.employee.id===e.employeeId?tt.adminCan(n,x.CanEditOwnClockEvents):tt.adminCan(n,x.CanEditEmployeeClockEvents))}(e,t,tt.getAdminAuthorizationForDepartment(e,i.id))&&r.push(Se.Clock),r.push(Se.Shift),e.role===a.BusinessAdmin||e.role===a.LocationAdmin||e.role===a.Admin&&void 0!==i&&tt.isAdminAuthorizedFor(e,t.locationId,i.id,x.CanEditSchedules))r.push(Se.Cover),o.ShowVacationEventType&&r.push(Se.Vacation),o.ShowUnavailableEventType&&r.push(Se.Unavailable),o.ShowAbsentEventType&&(n=qt(e,t.position.position.id));else if(e.role===a.Admin&&void 0!==i)o.ShowVacationEventType&&r.push(Se.Vacation),o.ShowUnavailableEventType&&r.push(Se.Unavailable),o.ShowAbsentEventType&&(n=qt(e,t.position.position.id));else{if(t.scheduleEventId>0&&t.eventType===Se.Cover)return[Oe(t.eventType)];o.ShowVacationEventType&&r.push(Se.Vacation),o.ShowUnavailableEventType&&r.push(Se.Unavailable),o.ShowAbsentEventType&&(n=qt(e,t.position.position.id))}return r.map((function(e){return Oe(e)})).concat(n)}function _t(e,t){if(!tt.isAuthItemsValid(e))return[];if(e.role===a.Employee)return 0===t.scheduleEventId?[je(Te.Request)]:[je(t.eventStatus)];if(e.role===a.LocationAdmin||e.role===a.BusinessAdmin)return ke;var n=tt.getDepartmentFromPositionId(e,t.position.position.id);return null===n?[]:tt.isAdminAuthorizedFor(e,t.locationId,n.id,x.CanEditSchedules)?ke:0===t.scheduleEventId?[je(Te.Request)]:[je(t.eventStatus)]}var Yt=function(e){var t=e.auth,n=e.editorValues,r=e.update,c=Object(o.useState)("Ex: 00:00"),s=Object(p.a)(c,2),l=s[0],u=s[1],m=Object(o.useState)(null),f=Object(p.a)(m,2),v=f[0],E=f[1],h=Object(o.useState)(null),g=Object(p.a)(h,2),b=g[0],y=g[1];Object(o.useEffect)((function(){-1!==n.scheduleEventId&&t.role===a.Employee&&n.scheduleEventId<=0&&n.eventStatus!==Te.Request&&r({type:"TYPESTATUS-UPDATED",eventType:n.eventType,eventStatus:Te.Request,absentId:n.absentId,absentTimeMinutes:n.absentTimeMinutes})}),[t,n.eventType,n.eventStatus,n.position,n.absentId,n.scheduleEventId]),Object(o.useEffect)((function(){if(!n.isFromEventInfo){var e=Wt(t,n);if(0!==e.length)void 0===e.find((function(e){return e.id===zt(n)}))&&r({type:"TYPESTATUS-UPDATED",eventType:e[0].id>100?Se.Absent:e[0].id,eventStatus:n.eventStatus,absentId:e[0].id>100?e[0].id:void 0,absentTimeMinutes:n.absentTimeMinutes})}}),[n.employee,n.isFromEventInfo]),Object(o.useEffect)((function(){var e=_t(t,n);void 0===e.find((function(e){return e.id===n.eventStatus}))&&r({type:"TYPESTATUS-UPDATED",eventType:n.eventType,eventStatus:e[0].id,absentId:n.absentId,absentTimeMinutes:n.absentTimeMinutes})}),[n.position]),Object(o.useEffect)((function(){-1!==n.scheduleEventId&&v&&y(null===n.absentTimeMinutes?null:function(e,t){if(e.TimeFormat===N.HoursMinutes){if(null===t)return"00:00";var n=Math.floor(t/60),a=t%60;return"".concat(Ge(n,2),":").concat(Ge(a,2))}return null===t?"0":Ye(t/60,e.TimeFormatDigits,e.TimeFormatDecimals)}(v,n.absentTimeMinutes))}),[v,n.absentTimeMinutes,n.scheduleEventId]),Object(o.useEffect)((function(){if(-1!==n.scheduleEventId&&(!v||n.locationId!==v.LocationId)&&t&&t.locations&&0!==t.locations.length){var e=tt.getLocSettingsForLocationId(t,n.locationId);E(e),u(e.TimeFormat===N.HoursMinutes?"Ex: 00:00":"Ex: 0.0")}}),[n.locationId,n.scheduleEventId]);var O=function(e){if(void 0===e&&(e=null),null!=e){var t=function(e,t){if(!t||0===t.length)return 0;if(e.TimeFormat===N.HoursMinutes){if(!/^\d*(:\d{2})?$/.test(t))return 0;if(":"===t[0])return parseInt(t.substring(1));var n=t.split(":");return 1===n.length?60*parseInt(t):60*parseInt(n[0])+parseInt(n[1])}return/^\d+(.\d*)?$/.test(t)?Math.round(60*parseFloat(t)):0}(v,e);t!==n.absentTimeMinutes&&r({type:"TYPESTATUS-UPDATED",eventType:n.eventType,eventStatus:n.eventStatus,absentId:n.absentId,absentTimeMinutes:t})}else r({type:"TYPESTATUS-UPDATED",eventType:n.eventType,eventStatus:n.eventStatus,absentId:n.absentId,absentTimeMinutes:null})};return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Type")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.E,{mode:"ios",className:"select",interface:"action-sheet",disabled:n.isReadonly||n.isConfirmed||null!==n.transferToEmployeeId,value:zt(n),onIonChange:function(e){!function(e){if(e!==n.eventType){var t=e!==Se.Absent&&e<100?null:n.absentTimeMinutes;r({type:"TYPESTATUS-UPDATED",eventType:e>=100?Se.Absent:e,eventStatus:n.eventStatus,absentId:e>=100?e:void 0,absentTimeMinutes:t})}}(e.detail.value)}},Wt(t,n).map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.name)}))))),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Status")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.E,{mode:"ios",className:"select",interface:"action-sheet",disabled:n.isReadonly||n.isConfirmed||null!==n.transferToEmployeeId||t.role===a.Employee&&n.scheduleEventId<=0,value:n.eventStatus,onIonChange:function(e){var t;(t=e.detail.value)!==n.eventStatus&&r({type:"TYPESTATUS-UPDATED",eventType:n.eventType,eventStatus:t,absentId:n.absentId,absentTimeMinutes:n.absentTimeMinutes})}},_t(t,n).map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.name)}))))),i.a.createElement(d.B,{className:n.eventType===Se.Absent?"visible edit-row":"invisible"},i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Hours")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.n,{className:"input-textbox",placeholder:l,disabled:n.isReadonly||n.isConfirmed,value:b,onIonChange:function(e){e.detail.value&&y(e.detail.value)},onIonBlur:function(){O(b)}}))))},Gt=function(e){var t=e.auth,n=e.editorValues,a=e.update,r=Object(o.useState)([]),c=Object(p.a)(r,2),s=c[0],l=c[1],u=Object(o.useRef)(null);Object(o.useEffect)((function(){-1!==n.scheduleEventId&&t&&t.locations&&t.locations.length>0&&l(function(e){var t=e.length>1;return e.flatMap((function(e){return e.departments.flatMap((function(n){return n.positions.map((function(a){var r=e.departments.length>1,o="";return t&&(o+=(e.abbr?e.abbr:e.name)+"/"),r&&(o+=(n.abbr?n.abbr:n.name)+"/"),o+=a.name,{id:a.id,name:o}}))}))})).sort((function(e,t){return e.name>t.name?1:t.name>e.name?-1:0}))}(t.locations))}),[t,n.scheduleEventId]);return i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Position")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.E,{mode:"ios",className:"select",interface:"action-sheet",disabled:n.isReadonly||n.isConfirmed||null!==n.transferToEmployeeId,value:n.position.position.id,onIonChange:function(e){return function(e){if(e!==u.current&&e!==n.position.position.id){var r=tt.getSelectedPosition(t.locations,e);a({type:"POSITION-UPDATED",selectedPosition:r})}}(e.detail.value)}},s.map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.name)})))))},Jt=function(e){var t=e.auth,n=e.editorValues,r=e.update,c=Object(o.useState)([]),s=Object(p.a)(c,2),l=s[0],u=s[1],m=He("Please wait..."),f=Object(o.useContext)(re).user,v=Object(o.useRef)(null);Object(o.useEffect)((function(){f&&f.isLoggedin&&-1!==n.scheduleEventId&&(G("edit_event_get_employeeList",{user:f.username}),m.setShowLoading(!0),E(n))}),[f,n.position.position.id,n.scheduleEventId,n.employee.id]);var E=function(e){var n=[{id:t.employeeId,name:t.fullName}];if(t.role===a.Employee)return u(n),void m.setShowLoading(!1);if(t.role===a.Admin){var o=tt.getDepartmentFromPositionId(t,e.position.position.id);if(null===o)return m.setShowLoading(!1),void u(n);if(!tt.isAdminAuthorizedFor(t,e.locationId,o.id,x.CanEditSchedules))return u(n),void m.setShowLoading(!1)}Je.getEmployeesByLocationIdPositionIdAndActiveDateRange(f,e.position.location.id,e.position.position.id,Object(de.a)(e.eventStart),Object(de.a)(e.eventEnd),e.position.location.settings.EmployeeSort).then((function(t){u(t),t.map((function(e){return e.id})).includes(e.employee.id)||r({type:"EMPLOYEE-UPDATED",employee:{id:-1,name:"SELECT EMPLOYEE"}}),m.setShowLoading(!1)}))};return 0===l.length?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Employee")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.E,{mode:"ios",className:"select",interface:"action-sheet",value:-5},i.a.createElement(d.F,{key:"-5",value:"-5"},n.employee.name)))),m.showLoadingJsx):i.a.createElement(i.a.Fragment,null,i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Employee")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.E,{mode:"ios",className:"select",interface:"action-sheet",disabled:n.isReadonly||t.role===a.Employee||n.isConfirmed||null!==n.transferToEmployeeId,value:n.employee.id,onIonChange:function(e){!function(e){if(-5!==e&&e!==n.employee.id&&e!==v.current){v.current=e;var t=l.filter((function(t){return t.id===e}))[0];r(-1===e?{type:"EMPLOYEE-UPDATED",employee:{id:-1,name:"SELECT EMPLOYEE"}}:{type:"EMPLOYEE-UPDATED",employee:{id:e,name:t.name}})}}(e.detail.value)}},l.length>1&&i.a.createElement(d.F,{key:-1,value:-1},"Select Employee"),l.map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.name)}))))),m.showLoadingJsx)},Ht=function(e){var t=e.editorValues,n=e.update;return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Start")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.i,{mode:"ios",className:"select",displayFormat:"h:mm A, M/D DDD",disabled:t.isReadonly||t.isConfirmed,pickerFormat:"h:mm A MMM D",minuteValues:"0,5,10,15,20,25,30,35,40,45,50,55",value:t.eventStart,onIonChange:function(e){var a;(a=e.detail.value)&&Object(de.a)(a)!==Object(de.a)(t.eventStart)&&n({type:"START-UPDATED",eventStart:a})}}))),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"End")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.i,{mode:"ios",className:"select",displayFormat:"h:mm A, M/D DDD",disabled:t.isReadonly||t.isClockedIn||t.isConfirmed,pickerFormat:"h:mm A MMM D",minuteValues:"0,5,10,15,20,25,30,35,40,45,50,55",value:t.eventEnd,onIonChange:function(e){var a;(a=e.detail.value)&&Object(de.a)(a)!==Object(de.a)(t.eventEnd)&&n({type:"END-UPDATED",eventEnd:a})}}))))},Kt=n(30),Qt=n(225),Xt=n(226),$t=n(227),Zt=function(e,t,n){var a=e,r=t,o=!1;return n.map((function(e){var t=Object(Qt.a)(Object(de.a)(e.BreakStart),3),n=e.BreakEnd?Object(Qt.a)(Object(de.a)(e.BreakEnd),-3):new Date(2200,1,1);return a<n&&r>t&&(o=!0),o})),o},en=function(e){var t=e.onCancel,n=e.onAdd,a=e.currentBreaks,r=e.eventStart,c=e.eventEnd,s=!Object(ge.a)(Object(de.a)(r),Object(de.a)(c)),l=Object(o.useState)(Object(Xt.a)(Object($t.a)(Object(de.a)(r),12),0)),u=Object(p.a)(l,2),m=u[0],v=u[1],E=Object(o.useState)(Object(Xt.a)(Object($t.a)(Object(de.a)(r),13),0)),h=Object(p.a)(E,2),g=h[0],b=h[1],y=Object(o.useState)(!1),O=Object(p.a)(y,2),I=O[0],S=O[1],k=Object(o.useState)(!1),j=Object(p.a)(k,2),C=j[0],T=j[1],D=Object(o.useState)(""),A=Object(p.a)(D,2),N=A[0],w=A[1],x=Object(o.useState)(!0),M=Object(p.a)(x,2),P=M[0],R=M[1],L=ie();return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{mode:"ios"},i.a.createElement(d.Q,null,i.a.createElement(d.N,null,"Add Break"),i.a.createElement(d.e,{slot:"end"},i.a.createElement(d.d,{onClick:t},i.a.createElement(d.m,{icon:f.n,mode:"ios",slot:"icon-only"}))))),i.a.createElement(d.h,null,i.a.createElement(d.k,null,i.a.createElement(d.B,null,i.a.createElement(d.g,{className:"label",size:"3"},"Start"),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.i,{className:"select",displayFormat:s?"h:mm A, M/D DDD":"h:mm a",pickerFormat:s?"h:mm A MMM D":"h:mm A",min:"2005-01-01",max:"2030-01-01",minuteValues:"0,5,10,15,20,25,30,35,40,45,50,55",value:m.toISOString(),onIonChange:function(e){return function(e){var t=Object(de.a)(e);v(t),Object(ht.a)(t,g)?Object(de.a)(r)>t?(R(!1),w("Start before Event begins")):Zt(t,g,a)?(R(!1),w("Pre-existing break overlaps")):(R(!0),w("")):(R(!1),w("Start must be before End"))}(e.detail.value)}}))),i.a.createElement(d.B,null,i.a.createElement(d.g,{className:"label",size:"3"},"End"),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.i,{className:"select",displayFormat:s?"h:mm A, M/D DDD":"h:mm a",pickerFormat:s?"h:mm A MMM D":"h:mm A",min:"2005-01-01",max:"2030-01-01",minuteValues:"0,5,10,15,20,25,30,35,40,45,50,55",value:g.toISOString(),onIonChange:function(e){return function(e){var t=Object(de.a)(e);b(t),Object(be.a)(t,m)?t>Object(de.a)(c)?(R(!1),w("End after Event ends")):Zt(m,t,a)?(R(!1),w("Pre-existing break overlaps")):(R(!0),w("")):(R(!1),w("End must be after Start"))}(e.detail.value)}}))),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.f,{className:"checkbox",checked:I,onIonChange:function(e){S(e.detail.checked)}})),i.a.createElement(d.g,{className:"label",size:"9"},"Restricted Break")),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.f,{className:"checkbox",onIonChange:function(e){T(e.detail.checked)}})),i.a.createElement(d.g,{className:"label",size:"9"},"Paid Break")),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12",className:"error-message"},N)))),i.a.createElement(d.j,null,i.a.createElement(d.d,{expand:"block",color:"secondary",onClick:function(){m>g?L.showAlert("Invalid Start / End","Break Start cannot come after Break End.",(function(){})):Object(de.a)(r)>m?(R(!1),w("Break Start must be after Event Start")):Object(de.a)(c)<g?(R(!1),w("Break End must be before Event End")):Zt(m,g,a)?(R(!1),w("Pre-existing break overlaps")):n(m,g,I,C)},disabled:!P},"ADD")),L.alertBoxJsx)},tn=function(e){var t=e.editorValues,n=e.update,a=Object(o.useState)([]),r=Object(p.a)(a,2),c=r[0],s=r[1],l=Object(o.useState)(!1),u=Object(p.a)(l,2),m=u[0],v=u[1];Object(o.useEffect)((function(){-1!==t.scheduleEventId&&s(t.eventBreaks)}),[t.eventBreaks,t.scheduleEventId]);return t.eventType===Se.Clock||tt.isShiftTypeEvent(t.eventType,t.eventStatus)||null!==t.transferToEmployeeId?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"(B)reaks")),i.a.createElement(d.g,{size:"2"},i.a.createElement(d.d,{size:"small",color:"light",disabled:t.isReadonly||t.isConfirmed,onClick:function(){v(!0)}},i.a.createElement(d.m,{slot:"icon-only",icon:f.a,color:"dark"})))),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"}),i.a.createElement(d.g,{size:"9"},c&&c.map((function(e){return i.a.createElement("div",{key:e.BreakStart,className:"break-div"},"(B) ",function(e){var t=Object(pe.a)(Object(de.a)(e.BreakStart),"h:mmaaa").replace("M","");if(!e.BreakEnd||e.BreakEnd>Re)return t;var n=Object(pe.a)(Object(de.a)(e.BreakEnd),"h:mmaaa").replace("M","");return"".concat(t," - ").concat(n)}(e),e.IsPaidBreak?i.a.createElement(d.m,{className:"paid-icon",icon:f.r}):i.a.createElement("span",null),function(e){return e.IsRestricted?i.a.createElement(d.m,{className:"restricted-icon",icon:f.p}):i.a.createElement("span",null)}(e),i.a.createElement("button",{disabled:t.isReadonly||t.isConfirmed,onClick:function(){!function(e){var t=c.filter((function(t){return t.BreakStart!==e}));s(t),n({type:"EVENTBREAKS-UPDATED",breaks:t})}(e.BreakStart)}},i.a.createElement(d.m,{slot:"icon-only",mode:"ios",icon:f.y,color:"gray"})))})))),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12"},i.a.createElement("div",{style:{borderBottom:"1px solid #ddd",width:"100%"}}))),i.a.createElement(d.w,{mode:"ios",isOpen:m,cssClass:"mini-modal add-break-modal",onDidDismiss:function(){return v(!1)}},i.a.createElement(en,{onCancel:function(){v(!1)},onAdd:function(e,a,r,o){v(!1);var i={BreakStart:_e(e),BreakEnd:_e(a),IsRestricted:r,IsPaidBreak:o,ScheduleEventId:t.scheduleEventId},l=[].concat(Object(Kt.a)(c),[i]);s(l),n({type:"EVENTBREAKS-UPDATED",breaks:l})},currentBreaks:c,eventStart:t.eventStart,eventEnd:t.eventEnd}))):i.a.createElement("div",null)},nn=function(e){var t=e.auth,n=e.editorValues,a=e.update,r=Object(o.useState)(-1),c=Object(p.a)(r,2),s=c[0],l=c[1],u=Object(o.useState)([]),m=Object(p.a)(u,2),f=m[0],v=m[1];Object(o.useEffect)((function(){if(-1!==n.scheduleEventId&&t&&t.locations&&t.locations.length>0){var e=t.tags.filter((function(e){return e.positionIds.includes(n.position.position.id)})).map((function(e){return{id:e.id,name:e.name}}));v(e);var a=e.map((function(e){return e.id}));a.includes(s)||(n.tag&&n.tag.id&&a.includes(n.tag.id)?l(n.tag.id):l(-1))}}),[t,n.position,n.scheduleEventId]);return 0===f.length?i.a.createElement(i.a.Fragment,null):i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"~Tag")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.E,{mode:"ios",className:"select",interface:"action-sheet",disabled:n.isReadonly||n.isConfirmed,value:s,onIonChange:function(e){!function(e){if(l(e),e!==n.tag.id)if(-1===e)a({type:"TAG-UPDATED",tag:{id:-1,name:"NONE"}});else{var t=f.filter((function(t){return t.id===e}))[0];a({type:"TAG-UPDATED",tag:t})}}(e.detail.value)}},i.a.createElement(d.F,{value:-1},"None"),f.map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.name)})))))};var an,rn=function(e){var t=e.auth,n=e.editorValues,r=e.update,o=e.onEmployeeUpdated;return function(e,t){if(!tt.isAuthItemsValid(e))return!1;if(-1===t.scheduleEventId)return!1;if(t.scheduleEventId<=0){if(e.role===a.Employee)return!1;if(e.role===a.Admin){var n=tt.getDepartmentFromPositionId(e,t.position.position.id);if(null===n)return!1;if(!tt.isAdminAuthorizedFor(e,t.locationId,n.id,x.CanEditSchedules))return!1}}return t.eventType===Se.Shift&&t.eventStatus===Te.Approved||t.eventType===Se.Cover&&(t.eventStatus===Te.Request||t.eventStatus===Te.RequestDenied)}(t,n)?function(e,t){if(!tt.isAuthItemsValid(e))return!1;if(e.role===a.Employee)return!0;if(e.role===a.LocationAdmin||e.role===a.BusinessAdmin)return!1;var n=tt.getDepartmentFromPositionId(e,t.position.position.id);return null!==n&&!tt.isAdminAuthorizedFor(e,t.locationId,n.id,x.CanEditSchedules)}(t,n)?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Confirm")),i.a.createElement(d.g,{size:"3"},i.a.createElement(d.d,{onClick:function(){o()}},n.isConfirmed?"Unconfirm":"Confirm",i.a.createElement(d.m,{className:"icon-right-of-checkbox",icon:f.m})))):i.a.createElement(i.a.Fragment,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Confirm")),i.a.createElement(d.g,{size:"3"},i.a.createElement(d.f,{checked:n.isConfirmed,onClick:function(){r({type:"CONFIRM-UPDATED",isConfirmed:!n.isConfirmed})}}),i.a.createElement(d.m,{className:"icon-right-of-checkbox",icon:f.m}))):i.a.createElement(i.a.Fragment,null)},on=function(e){var t=e.auth,n=e.editorValues,a=e.update,r=Object(o.useState)(!1),c=Object(p.a)(r,2),s=c[0],l=c[1],u=Object(o.useState)(!1),m=Object(p.a)(u,2),v=m[0],E=m[1];Object(o.useEffect)((function(){-1!==n.scheduleEventId&&t&&t.locations&&t.locations.length>0&&l(n.isClockedIn)}),[t,n.eventStart,n.eventEnd,n.isClockedIn,n.scheduleEventId]),Object(o.useEffect)((function(){-1!==n.scheduleEventId&&E(n.eventType===Se.Clock)}),[n.eventType,n.eventStatus,n.scheduleEventId]);return v?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Clocked In")),i.a.createElement(d.g,{size:"3"},i.a.createElement(d.f,{checked:s,onIonChange:function(e){var t;(t=e.detail.checked)!==s&&v&&(l(t),a({type:"ISCLOCKEDIN-UPDATED",isClockedIn:t}))}}),i.a.createElement(d.m,{className:"icon-right-of-checkbox",icon:f.w}))):i.a.createElement(i.a.Fragment,null)},cn=n(228);!function(e){e[e.Daily=0]="Daily",e[e.Weekly=1]="Weekly",e[e.MonthlyByDayOfMonth=2]="MonthlyByDayOfMonth",e[e.MonthlyByDayOfWeek=3]="MonthlyByDayOfWeek",e[e.Yearly=4]="Yearly"}(an||(an={}));var sn=function(e,t){return e.locations.filter((function(e){return e.id===t}))[0]},ln=function(e,t){return e.locations.flatMap((function(e){return e.departments.flatMap((function(e){return e.positions.filter((function(e){return e.id===t}))}))}))[0]},un=function(e,t){var n=Object(de.a)(e),a=Object(de.a)(t);return!!Object(cn.a)(n,a)||Object(be.a)(a,n)};function dn(e,t){return!(t.ScheduleEventId<=0)&&(e.role===a.Employee?t.EmployeeId!==e.employeeId||(t.EventStatusId!==Te.Request||t.EventTypeId===Se.Cover):e.role!==a.BusinessAdmin&&e.role!==a.LocationAdmin&&!tt.isAdminAuthorizedFor(e,t.LocationId,t.DepartmentId,x.CanEditSchedules))}function mn(e,t){return Object(v.a)({},hn,{isFromEventInfo:!0,eventStatus:t.EventStatusId,eventType:t.EventTypeId,eventStart:t.EventStart,eventEnd:t.EventEnd,notes:t.Notes,isClockedIn:t.IsClockedIn,isConfirmed:t.IsConfirmed,scheduleEventId:t.ScheduleEventId,position:tt.getSelectedPositionWithLocId(e.locations,t.LocationId,t.PositionId),employee:{id:t.EmployeeId,name:t.FirstName+" "+t.LastName},eventBreaks:t.EventBreaks})}function pn(e,t){var n=gn(t),a={isFromEventInfo:!1,scheduleEventId:t.ScheduleEventId,locationId:t.LocationId,isUpdating:!1,eventType:t.EventTypeId,eventStatus:t.EventStatusId,isConfirmed:void 0!==t.ConfirmedBy&&null!==t.ConfirmedBy,position:{location:sn(e,t.LocationId),position:ln(e,t.PositionId)},employee:{id:t.EmployeeId,name:t.FirstName+" "+t.LastName},eventStart:t.EventStart,eventEnd:n?_e(new Date):t.EventEnd,tag:{id:t.TagId?t.TagId:-1,name:""},eventBreaks:t.EventBreaks,isClockedIn:n,valid:!0,validEventStartEnd:!0,validEmployee:!0,validTag:!0,validEventTypeStatus:!0,validClockoutValue:!0,absentName:t.AbsentName,absentId:t.AbsentId,absentTimeMinutes:null!==t.AbsentTimeMinutes&&void 0!==t.AbsentTimeMinutes?t.AbsentTimeMinutes:null,notes:t.Notes,clockoutValue:t.ClockOutValue,isReadonly:dn(e,t),recurrenceId:t.EventRecurrenceId,recurrenceStart:t.EventRecurrenceStart,recurrenceEnd:t.EventRecurrenceEnd,recurrenceType:t.RepeatType,repeatInterval:t.RepeatInterval,repeatWeekdays:t.RepeatWeekdays,validRecurrenceStartEnd:!0,validRepeatInterval:!0,validRepeatWeekdays:!0,transferToEmployeeId:null,transferFromScheduleEventId:t.EventTransfer_ScheduleEventId_From,transferToScheduleEventId:t.EventTransfer_ScheduleEventId_To};return null===a.transferFromScheduleEventId&&null===a.transferToScheduleEventId||a.eventStatus!==Te.Approved||a.eventType!==Se.Shift&&a.eventType!==Se.Cover||!tt.isAdminForThisEvent(a,e)||(a.isReadonly=!0),a}var fn,vn=function(e,t,n){if(!n)return!0;if(!t.ClockOutValueLabel||0===t.ClockOutValueLabel.length)return!1;return/^\d*(\.\d{0,2})?$/.test(n)},En=function(e){return e.validEventStartEnd&&e.validEmployee&&e.validTag&&e.validEventTypeStatus&&e.validClockoutValue&&e.validRecurrenceStartEnd&&e.validRepeatInterval&&e.validRepeatWeekdays},hn={isFromEventInfo:!1,scheduleEventId:-1,locationId:0,isUpdating:!1,eventType:Se.Shift,eventStatus:Te.Approved,isConfirmed:!1,position:{location:{},position:{}},employee:{id:-1,name:"SELECT EMPLOYEE"},eventStart:Fe(_e(Object($t.a)(Object(Xt.a)(new Date,0),8))),eventEnd:Fe(_e(Object($t.a)(Object(Xt.a)(new Date,0),17))),tag:{id:-1,name:"SELECT TAG"},eventBreaks:[],isClockedIn:!1,valid:!0,validEventStartEnd:!0,validEmployee:!0,validTag:!0,validEventTypeStatus:!0,validClockoutValue:!0,validRecurrenceStartEnd:!0,validRepeatInterval:!0,validRepeatWeekdays:!0,absentId:void 0,absentName:void 0,absentTimeMinutes:null,notes:"",clockoutValue:void 0,isReadonly:!1,transferToEmployeeId:null,transferFromScheduleEventId:null,transferToScheduleEventId:null},gn=function(e){return Object(de.a)(e.EventEnd)>new Date(2199,1,1)},bn=function(e,t){switch(console.log("REDUCER: ACTION =",t.type,"   Current State Emp =",e.employee.id),t.type){case"BEGIN-UPDATE":var n=t.ev;return pn(t.auth,n);case"CANCEL":return hn;case"POSITION-UPDATED":var a=t.selectedPosition;return Object(v.a)({},e,{position:a});case"CREATE-EVENT":var r=t.auth.locations[0];return Object(v.a)({},hn,{employee:{id:t.auth.employeeId,name:t.auth.fullName},position:{location:r,position:r.departments[0].positions[0]},scheduleEventId:0});case"SET-READONLY":return Object(v.a)({},e,{isReadonly:t.isReadonly});case"TYPESTATUS-UPDATED":var o=e.isClockedIn&&t.eventType===Se.Clock&&t.eventStatus===Te.Approved,i=Object(v.a)({},e,{eventType:t.eventType,eventStatus:t.eventStatus,absentId:t.absentId,absentTimeMinutes:t.absentTimeMinutes,isClockedIn:o,validEventTypeStatus:!(t.absentId&&null===t.absentTimeMinutes)});return i.valid=En(i),i;case"CLOCKOUTVALUE-UPDATED":var c=Object(v.a)({},e,{clockoutValue:t.clockoutValue,validClockoutValue:vn(0,t.locSettings,t.clockoutValue)});return c.valid=En(c),c;case"EMPLOYEE-UPDATED":var s=Object(v.a)({},e,{employee:t.employee,validEmployee:t.employee.id>0});return s.valid=En(s),s;case"START-UPDATED":var l=Object(v.a)({},e,{eventStart:t.eventStart,validEventStartEnd:un(t.eventStart,e.eventEnd)});return l.valid=En(l),l;case"END-UPDATED":var u=Object(v.a)({},e,{eventEnd:t.eventEnd,validEventStartEnd:un(e.eventStart,t.eventEnd)});return u.valid=En(u),u;case"EVENTBREAKS-UPDATED":return Object(v.a)({},e,{eventBreaks:t.breaks});case"TAG-UPDATED":var d=Object(v.a)({},e,{tag:t.tag,validTag:!0});return d.valid=En(d),d;case"CONFIRM-UPDATED":var m=Object(v.a)({},e,{isConfirmed:t.isConfirmed});return m.valid=En(m),m;case"NOTES-UPDATED":return Object(v.a)({},e,{notes:t.notes});case"ISCLOCKEDIN-UPDATED":var p=Object(v.a)({},e,{isClockedIn:t.isClockedIn});if(t.isClockedIn){var f=Fe(_e(new Date));p.eventEnd=f}return p.valid=En(p),p;case"TRANSFERTO-EMPLOYEE-UPDATED":var E=Object(v.a)({},e,{transferToEmployeeId:t.transferToEmployeeId});return null!==t.transferToEmployeeId&&(E.eventStatus=Te.Approved),E.valid=En(E),E;case"REPEATING-UPDATED":var h=Object(v.a)({},e,{recurrenceStart:t.recurrenceStart,recurrenceEnd:t.recurrenceEnd,recurrenceType:t.recurrenceType,repeatInterval:t.repeatInterval,repeatWeekdays:t.repeatWeekDays});return h.recurrenceStart&&(h.repeatInterval===an.Weekly?h.validRepeatWeekdays=null!==h.repeatWeekdays&&void 0!==h.repeatWeekdays&&h.repeatWeekdays.length>0:(h.repeatWeekdays=void 0,h.validRepeatWeekdays=!0),h.recurrenceEnd?h.validRecurrenceStartEnd=Object(ht.a)(Object(de.a)(h.recurrenceStart),Object(de.a)(h.recurrenceEnd)):h.validRecurrenceStartEnd=!1,h.validRepeatInterval=null!==h.repeatInterval&&void 0!==h.repeatInterval&&h.repeatInterval>0),h.valid=En(h),h;default:return console.error("ERROR in editorValueReducer, could not find action for "+t.type),e}},yn=function(){var e=Object(g.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="api/v1/employee/schedule-events/cover-request/undo?scheduleEventId=".concat(n),e.next=3,X.put(t,a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),On=function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o,i,c){var s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v1/employee/schedule-events/cover-request/submit",s={ScheduleEventId:n,LocationId:a,BusinessId:r,BroadcastCoverRequestMessage:o,CoverMessage:i,DirectToEmployeeId:c},e.next=4,X.put(t,"api/v1/employee/schedule-events/cover-request/submit",s);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o,i,c){return e.apply(this,arguments)}}(),In=function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o,i){var c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v2/requests/shift-request/submit",c={ScheduleEventId:n,LocationId:a,BusinessId:r,BroadcastCoverRequestMessage:o,CoverMessage:i},e.next=4,X.put(t,"api/v2/requests/shift-request/submit",c);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o,i){return e.apply(this,arguments)}}(),Sn=function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o,i){var c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v1/employee/schedule-events/delete",c={LocationId:n,ScheduleEventId:a,EventTypeId:r,EventStatusId:o,RecUpdateType:i},e.next=4,X.post(t,"api/v1/employee/schedule-events/delete",c);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o,i){return e.apply(this,arguments)}}(),kn={approveShiftRequest:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v2/requests/shift-request/approve",a={msgId:n},e.next=4,X.post(t,"api/v2/requests/shift-request/approve",a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),undoCoverRequest:yn,createCoverRequest:On,makeShiftRequest:In,removeShiftRequest:Sn,deleteEvent:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o,i){var c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v1/employee/schedule-events/delete",c={LocationId:n,ScheduleEventId:a,EventTypeId:r,EventStatusId:o,RecUpdateType:i},e.next=4,X.post(t,"api/v1/employee/schedule-events/delete",c);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o,i){return e.apply(this,arguments)}}(),getCoverRequestListItems:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v2/requests/transfers/to-list",r={scheduleEventId:n,directCoverList:a},e.next=4,X.post(t,"api/v2/requests/transfers/to-list",r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),transferCoverToEmployee:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v2/requests/transfers/transfer",r={transferToEmployeeId:n,coverRequestEventId:a},e.next=4,X.post(t,"api/v2/requests/transfers/transfer",r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),undoCoverApproved:function(){var e=Object(g.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"api/v2/requests/undo-cover",a={scheduleEventId:n},e.next=4,X.post(t,"api/v2/requests/undo-cover",a);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},jn=function(e){var t,n,a=e.editorValues,r=e.update;return i.a.createElement("div",null,i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Notes")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.M,{className:"textarea",placeholder:"Enter event note",maxlength:120,spellcheck:!0,rows:4,value:a.notes,disabled:a.isReadonly||a.isConfirmed,onIonChange:function(e){return(t=e.detail.value)||(t=""),void(t!==a.notes&&r({type:"NOTES-UPDATED",notes:t}));var t}}))),i.a.createElement("div",{className:"character-counter"},null!==(t=null===(n=a.notes)||void 0===n?void 0:n.length)&&void 0!==t?t:0,"/120"))},Cn=function(e){var t=e.auth,n=e.editorValues,a=e.update,r=Object(o.useState)(!1),c=Object(p.a)(r,2),s=c[0],l=c[1],u=Object(o.useState)(null),m=Object(p.a)(u,2),f=m[0],v=m[1];Object(o.useEffect)((function(){if(!(0===n.locationId||f&&n.locationId===f.LocationId)&&t&&t.locations&&0!==t.locations.length&&n.locationId){var e=tt.getLocSettingsForLocationId(t,n.locationId);v(e)}}),[n.locationId,t]),Object(o.useEffect)((function(){f&&l(void 0!==f.ClockOutValueLabel&&null!==f.ClockOutValueLabel&&f.ClockOutValueLabel.length>0&&n.eventType===Se.Clock&&!n.isClockedIn)}),[n.eventType,n.isClockedIn,f]);return s&&null!==f?i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},f.ClockOutValueLabel)),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.n,{className:"input-textbox",placeholder:"Enter value",disabled:n.isReadonly||n.isConfirmed,value:n.clockoutValue,onIonChange:function(e){return null===(t=e.detail.value)&&(t=void 0),void(t!==n.clockoutValue&&a({type:"CLOCKOUTVALUE-UPDATED",locSettings:f,clockoutValue:t}));var t}}))):i.a.createElement("div",null)},Tn=n(229),Dn=function(e){var t=e.locSettings,n=e.editorValues,a=e.update,r=Object(o.useState)([!1,!1,!1,!1,!1,!1,!1]),c=Object(p.a)(r,2),s=c[0],l=c[1];if(Object(o.useEffect)((function(){if(n.repeatWeekdays){for(var e=[!1,!1,!1,!1,!1,!1,!1],t=0;t<n.repeatWeekdays.length;t++)e[parseInt(n.repeatWeekdays[t])]=!0;l(e)}else l([!1,!1,!1,!1,!1,!1,!1])}),[n.repeatWeekdays]),null===t)return i.a.createElement("div",null);var u=qe(new Date,t.DayWeekStartsOn,t.DayStartTime);return i.a.createElement("div",{className:"weeklist-container"},[0,1,2,3,4,5,6].map((function(e){var t=Object(he.a)(u,e),r=Object(Tn.a)(t);return i.a.createElement("span",{key:e,className:"day"},i.a.createElement(d.f,{className:"day-checkbox",disabled:n.isReadonly,onClick:function(){return function(e){var t=s.slice();t[e]=!s[e],l(t);for(var r="",o=0;o<t.length;o++)t[o]&&(r+=o);a({type:"REPEATING-UPDATED",repeatWeekDays:r,repeatInterval:n.repeatInterval,recurrenceType:n.recurrenceType,recurrenceEnd:n.recurrenceEnd,recurrenceStart:n.recurrenceStart})}(r)},checked:s[r]}),i.a.createElement("span",{className:"day-abbr"},Object(pe.a)(t,"EE").substr(0,2)))})))},An=function(e){var t=e.auth,n=e.editorValues,a=e.update,r=Object(o.useState)(null),c=Object(p.a)(r,2),s=c[0],l=c[1],u=Object(o.useState)(!1),m=Object(p.a)(u,2),v=m[0],E=m[1],h=Object(o.useState)(!1),g=Object(p.a)(h,2),b=g[0],y=g[1];return Object(o.useEffect)((function(){-1!==n.scheduleEventId&&(n.locationId>0?l(tt.getLocSettingsForLocationId(t,n.locationId)):0===n.locationId&&l(t.locations[0].settings))}),[n.locationId,n.scheduleEventId]),Object(o.useEffect)((function(){-1!==n.scheduleEventId&&E(n.eventType===Se.Shift||n.eventType===Se.Unavailable)}),[n.eventType,n.scheduleEventId]),Object(o.useEffect)((function(){v&&-1!==n.scheduleEventId&&n.recurrenceStart&&y(!0)}),[b,v,n.recurrenceStart,n.scheduleEventId]),v?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"(R)epeats")),i.a.createElement(d.g,{size:"2"},i.a.createElement(d.f,{checked:b,onClick:function(){a(b?{type:"REPEATING-UPDATED",repeatWeekDays:void 0,repeatInterval:void 0,recurrenceType:void 0,recurrenceEnd:void 0,recurrenceStart:void 0}:{type:"REPEATING-UPDATED",repeatWeekDays:void 0,repeatInterval:1,recurrenceType:an.Weekly,recurrenceEnd:void 0,recurrenceStart:_e(new Date)}),y(!b)},disabled:n.isReadonly||n.isConfirmed}))),b&&i.a.createElement(i.a.Fragment,null,i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"1"},i.a.createElement(d.m,{icon:f.i,mode:"md"})),i.a.createElement(d.g,{size:"5"},i.a.createElement(d.i,{mode:"ios",value:n.recurrenceStart,className:"select",displayFormat:"M/D/YY, DDD",pickerFormat:"MMM DD YYYY",disabled:n.isReadonly||n.isConfirmed,min:"2005-01-01",max:"2030-01-01",onIonChange:function(e){var t;t=e.detail.value,a(t?{type:"REPEATING-UPDATED",repeatWeekDays:n.repeatWeekdays,repeatInterval:n.repeatInterval,recurrenceType:n.recurrenceType,recurrenceEnd:n.recurrenceEnd,recurrenceStart:t}:{type:"REPEATING-UPDATED",repeatWeekDays:n.repeatWeekdays,repeatInterval:n.repeatInterval,recurrenceType:n.recurrenceType,recurrenceEnd:n.recurrenceEnd,recurrenceStart:void 0})}})),i.a.createElement(d.g,{size:"1"},i.a.createElement(d.m,{icon:f.i,mode:"md",style:{textAlign:"right"}})),i.a.createElement(d.g,{size:"5"},i.a.createElement(d.i,{mode:"ios",value:n.recurrenceEnd,className:"select",displayFormat:"M/D/YY, DDD",pickerFormat:"MMM DD YYYY",disabled:n.isReadonly||n.isConfirmed,min:"2005-01-01",max:"2030-01-01",onIonChange:function(e){var t;t=e.detail.value,a(t?{type:"REPEATING-UPDATED",repeatWeekDays:n.repeatWeekdays,repeatInterval:n.repeatInterval,recurrenceType:n.recurrenceType,recurrenceEnd:t,recurrenceStart:n.recurrenceStart}:{type:"REPEATING-UPDATED",repeatWeekDays:n.repeatWeekdays,repeatInterval:n.repeatInterval,recurrenceType:n.recurrenceType,recurrenceEnd:void 0,recurrenceStart:n.recurrenceStart})}}))),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"1"},i.a.createElement(d.m,{icon:f.v,mode:"md"})),i.a.createElement(d.g,{size:"5"},i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",className:"select",value:n.recurrenceType,disabled:n.isReadonly||n.isConfirmed,onIonChange:function(e){var t;t=e.detail.value,a(t?{type:"REPEATING-UPDATED",repeatWeekDays:n.repeatWeekdays,repeatInterval:n.repeatInterval,recurrenceType:parseInt(t),recurrenceEnd:n.recurrenceEnd,recurrenceStart:n.recurrenceStart}:{type:"REPEATING-UPDATED",repeatWeekDays:n.repeatWeekdays,repeatInterval:n.repeatInterval,recurrenceType:void 0,recurrenceEnd:n.recurrenceEnd,recurrenceStart:n.recurrenceStart})}},i.a.createElement(d.F,{value:an.Weekly},"Weekly"),i.a.createElement(d.F,{value:an.MonthlyByDayOfMonth},"Monthly (Day of Month)"),i.a.createElement(d.F,{value:an.MonthlyByDayOfWeek},"Monthly (Day of Week)"))),i.a.createElement(d.g,{size:"1"},"#"),i.a.createElement(d.g,{size:"5"},i.a.createElement(d.n,{className:"input-textbox",disabled:n.isReadonly||n.isConfirmed,value:n.repeatInterval?n.repeatInterval.toString():void 0,onIonChange:function(e){return t=e.detail.value,void a(t?{type:"REPEATING-UPDATED",repeatWeekDays:n.repeatWeekdays,repeatInterval:parseInt(t),recurrenceType:n.recurrenceType,recurrenceEnd:n.recurrenceEnd,recurrenceStart:n.recurrenceStart}:{type:"REPEATING-UPDATED",repeatWeekDays:n.repeatWeekdays,repeatInterval:void 0,recurrenceType:n.recurrenceType,recurrenceEnd:n.recurrenceEnd,recurrenceStart:n.recurrenceStart});var t}}))),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12"},i.a.createElement(Dn,{locSettings:s,editorValues:n,update:a}))))):i.a.createElement("span",null)};!function(e){e[e.UpdateSingleEvent=0]="UpdateSingleEvent",e[e.UpdateEntireSeries=1]="UpdateEntireSeries",e[e.UpdateSeriesForward=2]="UpdateSeriesForward"}(fn||(fn={}));var Nn,wn=function(e){var t=e.onSelect,n=e.updateType;if("NO"===n)return i.a.createElement("div",null);var a=function(e){t(e)},r="UPDATE"===n?"Update Repeating":"Delete Repeating";return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{mode:"ios"},i.a.createElement(d.Q,null,i.a.createElement(d.N,null,r))),i.a.createElement(d.h,null,i.a.createElement(d.k,null,i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12"},i.a.createElement(d.d,{expand:"block",color:"danger",className:"apply-button",onClick:function(){return a(fn.UpdateSingleEvent)}},"This event"))),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12"},i.a.createElement(d.d,{expand:"block",color:"danger",className:"apply-button",onClick:function(){return a(fn.UpdateEntireSeries)}},"Entire series"))),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12"},i.a.createElement(d.d,{expand:"block",color:"danger",className:"apply-button",onClick:function(){return a(fn.UpdateSeriesForward)}},"This event forward"))))),i.a.createElement(d.j,null,i.a.createElement(d.d,{expand:"block",className:"cancel-button",onClick:function(){return a(null)}},"Cancel")))},xn=function(e){var t=e.onCancel,n=e.onOk,a=e.editorValues,r=e.eventRequestType,c=e.buttonText,s=Object(o.useContext)(re).user,l=Object(o.useContext)(rt).auth,u=Object(o.useState)(""),m=Object(p.a)(u,2),v=m[0],E=m[1],h=Object(o.useState)(null),g=Object(p.a)(h,2),b=g[0],y=g[1],O=Object(o.useState)(null),I=Object(p.a)(O,2),S=I[0],k=I[1],j=tt.getLocSettingsForLocationId(l,a.locationId);Object(o.useEffect)((function(){r===Nn.CreateCoverRequest&&a.scheduleEventId>0&&kn.getCoverRequestListItems(s,a.scheduleEventId,!0).then((function(e){k(e),e&&e.length>0&&y(e[0].value)}))}),[a.scheduleEventId,r]);return r===Nn.None?i.a.createElement(i.a.Fragment,null):i.a.createElement(i.a.Fragment,null,i.a.createElement(d.h,null,i.a.createElement(d.l,{mode:"ios"},i.a.createElement(d.Q,null,i.a.createElement(d.N,null,c),i.a.createElement(d.e,{slot:"end"},i.a.createElement(d.d,{onClick:t},i.a.createElement(d.m,{icon:f.n,mode:"ios",slot:"icon-only"}))))),i.a.createElement(d.k,null,i.a.createElement(d.B,{hidden:!j.EnableDirectCoverRequest||r!==Nn.CreateCoverRequest},i.a.createElement(d.g,{className:"label",size:"3"},"To"),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.E,{className:"select",value:b,onIonChange:function(e){y(parseInt(e.detail.value))}},S&&S.map((function(e){return i.a.createElement(d.F,{key:e.value,value:e.value,disabled:e.disabled},e.text)}))))),i.a.createElement(d.B,{hidden:r===Nn.CreateCoverRequest},i.a.createElement(d.g,{size:"12"},r===Nn.UndoCoverRequest&&i.a.createElement("div",{className:"usage-message"},"This will remove your Cover-Request, setting the event to Shift-Approved."),r===Nn.ApproveShiftRequest&&i.a.createElement("div",{className:"usage-message"},"This will approve the Shift-Request from ",a.employee.name),r===Nn.CreateShiftRequest&&i.a.createElement("div",{className:"usage-message"},"This will create a Shift-Request to be approved by an admin."),r===Nn.DeleteRequest&&i.a.createElement("div",{className:"usage-message"},"This will delete your Request."))),i.a.createElement(d.B,{hidden:r!==Nn.CreateCoverRequest},i.a.createElement(d.g,{className:"label",size:"3"},"Notes"),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.M,{className:"select",maxlength:200,rows:4,value:v,onIonChange:function(e){E(e.detail.value)}}))),i.a.createElement(d.B,null,i.a.createElement(d.g,{className:"label",size:"3"}),i.a.createElement(d.g,{size:"9",className:"error-message"},i.a.createElement("div",null))))),i.a.createElement(d.j,null,i.a.createElement(d.d,{expand:"block",color:"secondary",onClick:function(){n(b,null!==v&&void 0!==v?v:"",!1)}},"OK")))};!function(e){e[e.None=0]="None",e[e.UndoCoverRequest=1]="UndoCoverRequest",e[e.CreateShiftRequest=2]="CreateShiftRequest",e[e.DeleteRequest=3]="DeleteRequest",e[e.CreateCoverRequest=4]="CreateCoverRequest",e[e.ApproveShiftRequest=5]="ApproveShiftRequest",e[e.UndoCover=6]="UndoCover"}(Nn||(Nn={}));var Mn=function(e){var t=e.auth,n=e.cancelEditModal,a=e.editorValues,r=e.messageId,c=Object(o.useContext)(re).user,s=Object(o.useState)(!1),l=Object(p.a)(s,2),u=l[0],m=l[1],f=ie(),v=He("Please wait..."),E=function(e,t){var n=tt.isAdminForThisEvent(e,t);if(e.scheduleEventId<=0)return Nn.None;if((null!==e.transferToScheduleEventId||null!==e.transferFromScheduleEventId)&&e.eventStatus===Te.Approved&&(e.eventType===Se.Cover||e.eventType===Se.Shift)&&n)return Nn.UndoCover;if(e.eventType===Se.Cover&&e.eventStatus===Te.Request)return e.employee.id===t.employeeId?n?Nn.None:Nn.UndoCoverRequest:tt.hasPosition(t,e.position.position.id)?Nn.CreateShiftRequest:Nn.None;if(e.eventType===Se.Shift&&e.eventStatus===Te.Request){if(n)return Nn.ApproveShiftRequest;if(e.employee.id===t.employeeId)return Nn.DeleteRequest}return e.eventType===Se.Shift&&e.eventStatus===Te.Approved&&e.employee.id===t.employeeId?Nn.CreateCoverRequest:Nn.None}(a,t),h=function(e,t){var n=tt.isAdminForThisEvent(e,t);if(e.eventStatus===Te.Approved&&(e.eventType===Se.Cover||e.eventType===Se.Shift)&&(null!==e.transferFromScheduleEventId||null!==e.transferToScheduleEventId)&&n)return"Undo Cover-Approved";if(e.eventType===Se.Shift&&e.eventStatus===Te.Approved)return"Create Cover-Request";if(e.eventType===Se.Shift&&e.eventStatus===Te.Request){if(n)return"Approve Shift-Request";if(e.employee.id===t.employeeId)return"Delete Shift-Request"}return e.eventType===Se.Cover&&e.eventStatus===Te.Request?e.employee.id===t.employeeId?"Undo Cover-Request":"Make Shift-Request":"UNKNOWN"}(a,t),g=function(e){m(!1),n(e)};return tt.isAuthItemsValid(t)&&E!==Nn.None?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.d,{className:"apply-button",expand:"block",onClick:function(){m(!0)}},h),i.a.createElement(d.w,{isOpen:u,cssClass:"mini-modal event-request-modal",onDidDismiss:function(){return m(!1)}},i.a.createElement(xn,{onCancel:function(){m(!1)},onOk:function(e,t,n){switch(v.setShowLoading(!0),E){case Nn.CreateCoverRequest:kn.createCoverRequest(c,a.scheduleEventId,a.locationId,0,n,t,e).then((function(){v.setShowLoading(!1),g("Cover-Request Created")}));break;case Nn.CreateShiftRequest:kn.makeShiftRequest(c,a.scheduleEventId,a.locationId,0,n,t).then((function(e){v.setShowLoading(!1),e.error?f.showAlert("Shift-Request Failed",e.message,(function(){})):g(e.message)}));break;case Nn.DeleteRequest:kn.removeShiftRequest(c,a.locationId,a.scheduleEventId,a.eventType,a.eventStatus,void 0).then((function(){v.setShowLoading(!1),g("Shift-Request Removed")}));break;case Nn.UndoCoverRequest:kn.undoCoverRequest(c,a.scheduleEventId).then((function(){v.setShowLoading(!1),g("Removed Cover-Request")}));break;case Nn.ApproveShiftRequest:if(null===r||void 0===r)break;kn.approveShiftRequest(c,r).then((function(e){v.setShowLoading(!1),e.error?f.showAlert("Could not approve",e.message,(function(){})):g("Approved")}));break;case Nn.UndoCover:kn.undoCoverApproved(c,a.scheduleEventId).then((function(e){v.setShowLoading(!1),e.error?f.showAlert("Could not undo Cover",e.message,(function(){})):g("Cover Undone")}))}},editorValues:a,eventRequestType:E,buttonText:h}),f.alertBoxJsx,v.showLoadingJsx)):i.a.createElement(i.a.Fragment,null)},Pn=function(e){var t=e.editorValues,n=e.update,a=Object(o.useContext)(re).user,r=Object(o.useState)([]),c=Object(p.a)(r,2),s=c[0],l=c[1];return Object(o.useEffect)((function(){t.scheduleEventId<=0||!a.isLoggedin||kn.getCoverRequestListItems(a,t.scheduleEventId,!1).then((function(e){l(e)}))}),[t.scheduleEventId,a]),t.eventType===Se.Cover&&t.eventStatus===Te.Request||null!==t.transferToEmployeeId?i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,{className:"label"},"Transfer To")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.E,{mode:"ios",className:"select",placeholder:"None",interface:"action-sheet",disabled:t.isReadonly||t.isConfirmed,value:t.transferToEmployeeId,onIonChange:function(e){var a;void 0!==(a=e.detail.value)&&a!==t.transferToEmployeeId&&n({type:"TRANSFERTO-EMPLOYEE-UPDATED",transferToEmployeeId:a})}},s.map((function(e){return i.a.createElement(d.F,{key:e.value,value:0===e.value?null:e.value,disabled:e.disabled},e.text)}))))):i.a.createElement(i.a.Fragment,null)};var Rn=function(e){var t=e.auth,n=e.scheduleEventId,a=e.onDismissModal,r=e.onCancelModal,c=e.isOpen,s=e.initialEvent,l=He("Please wait..."),u=ie(),m=i.a.useContext(re).user,v=Object(o.useReducer)(bn,s),E=Object(p.a)(v,2),h=E[0],g=E[1],b=Object(o.useState)(null),y=Object(p.a)(b,2),O=y[0],I=y[1],S=Object(o.useState)(null),k=Object(p.a)(S,2),j=k[0],C=k[1],T=Object(o.useState)("NO"),D=Object(p.a)(T,2),A=D[0],N=D[1],w=Object(o.useState)("NONE"),x=Object(p.a)(w,2),M=x[0],P=x[1],R=null!==n,L=Ot(),F="New Event",U="CREATE";R&&(F="Edit Event",U="UPDATE"),Object(o.useEffect)((function(){c&&t&&t.locations&&0!==t.locations.length&&(!n||null!==O&&n===O.ScheduleEventId?(null!==O&&I(null),g({type:"CREATE-EVENT",auth:t})):(l.setShowLoading(!0),G("edit_event_get_scheduleevent",{user:m.username,scheduleEventId:n}),pt.getScheduleEvent(m,n).then((function(e){l.setShowLoading(!1),e?(!function(e){if(e.EventStart=Fe(e.EventStart),e.EventEnd=Fe(e.EventEnd),e.EventBreaks)for(var t=0;t<e.EventBreaks.length;t++)e.EventBreaks[t].BreakStart=Fe(e.EventBreaks[t].BreakStart),e.EventBreaks[t].BreakEnd&&Fe(e.EventBreaks[t].BreakEnd)}(e),I(e),g({type:"BEGIN-UPDATE",ev:e,auth:t})):u.showAlert("No Event","The event may have been removed or you no longer have access",q)}))))}),[n,m,c,t]),Object(o.useEffect)((function(){null!==j&&"NONE"!==M&&("CREATEUPDATE"===M?B():V(null!==h.recurrenceId&&void 0!==h.recurrenceId))}),[j,M]);var B=function(){var e=0===h.scheduleEventId?pt.createScheduleEvent:pt.updateScheduleEvent,t=0===h.scheduleEventId?"edit_event_create":"edit_event_update",r=0===h.scheduleEventId?"Event Created":"Event Updated";e(m,h,j).then((function(e){e.error?u.showAlert("Cannot update",e.message,(function(){})):(G(t,{user:m.username,scheduleEventId:n}),null!==h.transferToEmployeeId&&h.scheduleEventId>0?kn.transferCoverToEmployee(m,h.transferToEmployeeId,h.scheduleEventId).then((function(t){t.error?u.showAlert("Cannot transfer",e.message,(function(){})):a("Transferred")})):a(r))}))},V=function(e){var t=function(){pt.deleteScheduleEvent(m,h.scheduleEventId,j).then((function(e){e.error?u.showAlert("Cannot delete",e.message,(function(){a("Could not delete event")})):(G("edit_event_delete",{user:m.username,scheduleEventId:n}),a("Deleted Event"))}))};e?t():L.showDialog("Delete event?","",[{text:"Delete",color:"danger",value:1}],(function(e){1===e&&t()}))},z=function(e){N("NO"),C(e),null===e&&P("NONE")},q=function(){g({type:"CANCEL"}),Object(Z.a)().push("/tabs/schedule"),r()};return c&&t&&t.locations&&0!==t.locations.length?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,null,i.a.createElement(d.e,{slot:"start"},i.a.createElement(d.d,{onClick:q},i.a.createElement(d.m,{icon:f.c,mode:"md",slot:"icon-only"}))),i.a.createElement(d.N,null,F))),i.a.createElement(d.h,{class:"outer-content"},i.a.createElement(d.k,null,i.a.createElement(Yt,{editorValues:h,update:g,auth:t}),i.a.createElement(d.B,null,i.a.createElement(rn,{auth:t,editorValues:h,update:g,onEmployeeUpdated:function(){var e=!h.isConfirmed;pt.updateConfirmedScheduleEvent(m,h.scheduleEventId,e).then((function(t){t.error?u.showAlert("confirm",t.message,(function(){})):a(e?"Confirmed":"Unconfirmed")}))}}),i.a.createElement(on,{auth:t,editorValues:h,update:g})),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12"},i.a.createElement("div",{style:{width:"100%",borderBottom:"1px solid #ddd"}}))),i.a.createElement(Gt,{auth:t,editorValues:h,update:g}),i.a.createElement(Jt,{auth:t,editorValues:h,update:g}),i.a.createElement(Ht,{auth:t,editorValues:h,update:g}),i.a.createElement(An,{auth:t,editorValues:h,update:g}),i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12"},i.a.createElement("div",{style:{width:"100%",borderBottom:"1px solid #ddd"}}))),i.a.createElement(tn,{auth:t,editorValues:h,update:g}),i.a.createElement(nn,{auth:t,editorValues:h,update:g}),i.a.createElement(Pn,{auth:t,editorValues:h,update:g}),i.a.createElement(Cn,{auth:t,editorValues:h,update:g}),i.a.createElement(jn,{auth:t,editorValues:h,update:g})),u.alertBoxJsx,L.dialogBoxJsx,l.showLoadingJsx,i.a.createElement(d.w,{isOpen:"NO"!==A,onDidDismiss:function(){z(null)},cssClass:"mini-modal recurrence-update-modal"},i.a.createElement(wn,{onSelect:z,updateType:A}))),i.a.createElement(d.j,null,h.isReadonly&&i.a.createElement(Mn,{auth:t,update:g,cancelEditModal:function(e){return a(e)},editorValues:h}),i.a.createElement(d.d,{className:"apply-button",expand:"block",onClick:function(){P("CREATEUPDATE"),h.recurrenceId?null!==j?B():N("UPDATE"):B()},disabled:!h.valid,hidden:h.isReadonly},U),i.a.createElement(d.d,{className:"delete-button",expand:"block",onClick:function(){P("DELETE"),h.recurrenceId?null!==j?V(!0):N("DELETE"):V(null!==h.recurrenceId&&void 0!==h.recurrenceId)},hidden:h.isReadonly||h.scheduleEventId<=0},"DELETE"))):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,"Loading"),u.alertBoxJsx)},Ln=n(19),Fn=n.n(Ln),Un=function(e){var t=e.threeRows;return i.a.createElement("button",{className:"card"},i.a.createElement("div",{className:"card-first-col"},i.a.createElement("div",{className:"day-name"},i.a.createElement(Fn.a,null)," "),i.a.createElement("div",{className:"day-number"},i.a.createElement(Fn.a,null))),i.a.createElement("div",{style:{padding:"3px"}},i.a.createElement(Fn.a,{width:5,height:45})),i.a.createElement("div",{className:"card-second-col"},i.a.createElement("div",{className:"time-row"},i.a.createElement("span",null,i.a.createElement(Fn.a,{width:150,height:9}),"\xa0\xa0"),i.a.createElement(Fn.a,null)),t&&i.a.createElement("div",null,i.a.createElement(Fn.a,{width:80,height:10})),i.a.createElement("div",{className:"dept-position-row"},i.a.createElement(Fn.a,{width:150,height:10}),"\xa0\xa0")))};function Bn(e,t,n){var a=Object(o.useRef)();Object(o.useEffect)((function(){a.current=e}),[e]),Object(o.useEffect)((function(){if(null!==n){var e=setInterval((function(){a.current&&t&&a.current()}),n);return function(){return clearInterval(e)}}}),[n,t])}var Vn=[],zn=[];function qn(e,t){return!!t.positionIds.includes(e.PositionId)&&((void 0===t.tagId||-1===t.tagId||t.tagId===e.TagId)&&xe(t.eventTypeId,t.eventStatusId,e.EventTypeId,e.EventStatusId))}function Wn(e,t,n){if(-1===t.DepartmentId){if(!n.positionIds.map((function(t){return tt.getLocationIdFromPositionid(e,t)})).includes(t.LocationId))return!1}else if(t.DepartmentId>0&&!n.positionIds.map((function(t){var n;return null===(n=tt.getDepartmentFromPositionId(e,t))||void 0===n?void 0:n.id})).includes(t.DepartmentId))return!1;return!0}var _n,Yn=function(e){var t=e.match,n=Object(o.useRef)(null),a=i.a.useContext(re).user,r=i.a.useContext(rt),c=r.auth,s=r.refreshAuth,l=ue(),u=Vt((function(e){vt(c,lt,e)})),m=c&&c.locations&&c.locations.length>0?qe(Object(ut.a)(new Date),c.locations[0].settings.DayWeekStartsOn,c.locations[0].settings.DayStartTime):qe(Object(ut.a)(new Date),"Monday",""),E=Object(o.useState)(Vn),h=Object(p.a)(E,2),g=h[0],b=h[1],y=Object(o.useState)(zn),O=Object(p.a)(y,2),I=O[0],S=O[1],k=Object(o.useState)(Vn),j=Object(p.a)(k,2),C=j[0],T=j[1],D=Object(o.useState)(zn),A=Object(p.a)(D,2),N=A[0],w=A[1],x=Object(o.useState)([]),M=Object(p.a)(x,2),P=M[0],R=M[1],L=Object(o.useState)(Vn),F=Object(p.a)(L,2),U=F[0],B=F[1],V=Object(o.useState)(zn),z=Object(p.a)(V,2),q=z[0],_=z[1],Y=Object(o.useState)(Vn),G=Object(p.a)(Y,2),J=G[0],H=G[1],K=Object(o.useState)(zn),Q=Object(p.a)(K,2),X=Q[0],$=Q[1],Z=Object(o.useState)([]),ee=Object(p.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(o.useState)(Vn),oe=Object(p.a)(ae,2),ie=oe[0],ce=oe[1],se=Object(o.useState)(zn),le=Object(p.a)(se,2),de=le[0],me=le[1],pe=Object(o.useState)(Vn),fe=Object(p.a)(pe,2),ve=fe[0],Ee=fe[1],ge=Object(o.useState)(zn),be=Object(p.a)(ge,2),ye=be[0],Oe=be[1],Ie=Object(o.useState)([]),Se=Object(p.a)(Ie,2),ke=Se[0],je=Se[1],Ce=Object(o.useState)(!0),Ae=Object(p.a)(Ce,2),Ne=Ae[0],we=Ae[1],Me=Object(o.useState)(!1),Pe=Object(p.a)(Me,2),Re=Pe[0],Le=Pe[1],Fe=Object(o.useState)("my"),Ue=Object(p.a)(Fe,2),Be=Ue[0],Ve=Ue[1],ze=Object(o.useState)(!1),We=Object(p.a)(ze,2),_e=We[0],Ye=We[1],Ge=Object(o.useState)(!1),Je=Object(p.a)(Ge,2),He=Je[0],Ke=Je[1],Qe=Object(o.useState)(null),Xe=Object(p.a)(Qe,2),$e=Xe[0],Ze=Xe[1],et=Object(o.useState)(hn),nt=Object(p.a)(et,2),at=nt[0],ot=nt[1],it=Ut.getFilter(c),ct=Object(o.useState)({tagId:it.tagId,positionIds:it.positionIds,dnLocIds:it.dnLocIds,settingsLocId:it.settingsLocId,eventTypeId:it.eventTypeId,eventStatusId:it.eventStatusId,start:m,end:Object(he.a)(m,7),filterByEmployee:!1,view:mt.schedule}),st=Object(p.a)(ct,2),lt=st[0],dt=st[1];Object(d.W)((function(){Le(!0)})),Object(d.X)((function(){Le(!1)})),Bn((function(){s(!1,a).then((function(e){e&&vt(e,lt)}))}),Re&&!He&&!_e,W(a).refreshScheduleTimer),Object(o.useEffect)((function(){a.isLoggedin&&void 0!==lt&&(we(!0),console.log("getScheduleEvents: from useEffect"),vt(c,lt))}),[a.isLoggedin]),Object(o.useEffect)((function(){t.params.scheduleEventId&&(Ze(parseInt(t.params.scheduleEventId)),Ke(!0))}),[t.params.scheduleEventId]);var ft=Object(o.useCallback)((function(e){Ze(e.ScheduleEventId),ot(mn(c,e)),Ke(!0)}),[c.locations]);if(!tt.isAuthItemsValid(c))return console.log("auth items not valid yet"),i.a.createElement("div",null);var vt=function(e,t,n){var r=Ut.getDefaultFilter(e,t),o=Object(v.a)({},r,{start:t.start,end:t.end,filterByEmployee:!1,eventTypeId:De.All,eventStatusId:De.All});pt.getScheduleEventsByFilter(a,o).then((function(a){we(!1),n&&n.detail.complete();var r=function(e,t,n){return e.filter((function(e){return xe(n.eventTypeId,n.eventStatusId,e.EventTypeId,e.EventStatusId)&&e.EmployeeId===t.employeeId}))}(a.events,e,o);b(r),S(a.dailyNotes),T(r.filter((function(e){return qn(e,t)})));var i=a.dailyNotes.filter((function(n){return Wn(e,n,t)}));w(i),R([a.totalTimeForEmployee]);var c=a.events.filter((function(e){return e.EventStatusId===Te.Request}));B(c),_([]),H(c.filter((function(e){return qn(e,Object(v.a)({},t,{eventStatusId:Te.Request,eventTypeId:De.All}))}))),$([]),ne(a.hoursPerDay);var s=function(e,t){return e.filter((function(e){return xe(t.eventTypeId,t.eventStatusId,e.EventTypeId,e.EventStatusId)}))}(a.events,o);ce(s),me(a.dailyNotes),Ee(s.filter((function(e){return qn(e,t)}))),Oe(i),je(a.hoursPerDay)}))},ht=function(e){Ve(e)},gt=function(e){e&&e.length>0&&l.showToast(e),console.log("getScheduleEvents: from forceRefresh"),vt(c,lt)};return i.a.createElement(d.x,{id:"schedule-page"},i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,{mode:"md"},i.a.createElement(d.e,{slot:"start"},i.a.createElement(d.u,null)),i.a.createElement(d.N,{slot:"start"},"Schedule"),i.a.createElement(d.e,{slot:"end"},i.a.createElement(d.d,{onClick:function(){Ze(null),Ke(!0)}},i.a.createElement(d.m,{icon:f.a,mode:"md",slot:"icon-only"})),i.a.createElement(d.d,{onClick:function(){return Ye(!0)}},i.a.createElement("div",{className:Ut.isFilterApplied(c,lt)?"filter-applied":"filter-not-applied"},"\xb7"),i.a.createElement(d.m,{icon:f.o,mode:"ios",slot:"icon-only"}))))),i.a.createElement(d.C,{mode:"md",value:Be},i.a.createElement(d.D,{mode:"md",value:"my",onClick:function(){return ht("my")}},"MY"),i.a.createElement(d.D,{mode:"md",value:"requests",onClick:function(){return ht("requests")}},"REQUESTS"),i.a.createElement(d.D,{mode:"md",value:"all",onClick:function(){return ht("all")}},"ALL")),i.a.createElement(Et,{startDate:qe(lt.start,c.locations[0].settings.DayWeekStartsOn,""),setStartDate:function(e){if(e!==lt.start){var t=Object(v.a)({},lt,{start:e,end:Object(he.a)(e,7)});dt(t),we(!0),console.log("getScheduleEvents: setStartDate"),vt(c,t)}},onWeekdayClick:function(e){n.current.scrollToDate(e)}}),i.a.createElement(d.h,null,u.ionicRefresherJsx,!Ne&&"my"===Be&&0===(null===g||void 0===g?void 0:g.length)&&i.a.createElement(Nt,null),!Ne&&"my"===Be&&(null===g||void 0===g?void 0:g.length)>0&&i.a.createElement(xt,{events:C,listType:Be,notes:N,hoursPerDay:P,auth:c,onEdit:ft,onForceRefresh:gt,ref:n,weekStart:lt.start}),!Ne&&"requests"===Be&&0===U.length&&i.a.createElement(Nt,null),!Ne&&"requests"===Be&&U.length>0&&i.a.createElement(xt,{events:J,listType:Be,notes:X,hoursPerDay:te,auth:c,onEdit:ft,onForceRefresh:gt,ref:n,weekStart:lt.start}),!Ne&&"all"===Be&&0===(null===ie||void 0===ie?void 0:ie.length)&&i.a.createElement(Nt,null),!Ne&&"all"===Be&&(null===ie||void 0===ie?void 0:ie.length)>0&&i.a.createElement(xt,{events:ve,listType:Be,notes:ye,hoursPerDay:ke,auth:c,onEdit:ft,onForceRefresh:gt,ref:n,weekStart:lt.start}),Ne&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{style:{marginTop:"10px"}}),i.a.createElement(Fn.a,{height:24,width:220}),i.a.createElement("br",null),i.a.createElement(Un,{threeRows:"my"!==Be}),i.a.createElement(Un,{threeRows:"my"!==Be}),i.a.createElement(Un,{threeRows:"my"!==Be}))),l.simpleToastJsx,i.a.createElement(d.w,{isOpen:_e,onDidDismiss:function(){return Ye(!1)}},i.a.createElement(Bt,{filter:lt,auth:c,onDismissModal:function(e,t){dt(e),t?(l.showToast("Filter applied"),Ut.putFilter(e),T(g.filter((function(t){return qn(t,e)}))),w(I.filter((function(t){return Wn(c,t,e)}))),H(U.filter((function(t){return qn(t,Object(v.a)({},e,{eventStatusId:Te.Request,eventTypeId:De.All}))}))),$(q.filter((function(t){return Wn(c,t,e)}))),Ee(ie.filter((function(t){return qn(t,e)}))),Oe(de.filter((function(t){return Wn(c,t,e)})))):(Ut.clear(),T(g),w(I),H(U),$(q),Ee(ie),Oe(de)),Ye(!1)},isOpen:_e,onCancelModal:function(){return Ye(!1)}})),i.a.createElement(d.w,{isOpen:He,onDidDismiss:function(){return Ke(!1)}},i.a.createElement(Rn,{isOpen:He,auth:c,onCancelModal:function(){return Ke(!1)},onDismissModal:function(e){return function(e){e&&l.showToast(e),console.log("getScheduleEvents: onEventUpdated"),vt(c,lt),Ke(!1)}(e)},scheduleEventId:$e,initialEvent:at})))};!function(e){e[e.MatchingShift=1]="MatchingShift",e[e.AnyShift=2]="AnyShift",e[e.NoShift=3]="NoShift"}(_n||(_n={}));var Gn,Jn,Hn=function(e){var t=e.auth,n=e.onDismissModal,a=e.tcData,r=Object(o.useState)([]),c=Object(p.a)(r,2),s=c[0],l=c[1],u={key:"Cancel",name:"",breakType:P.UnscheduledUnpaid};return Object(o.useEffect)((function(){if(0!==t.locations.length&&a.ClockedInScheduleEvent){var e=t.locations.filter((function(e){return e.id===a.ClockedInScheduleEvent.LocationId}))[0].settings,n=[];switch(a.ScheduleEventsForClockIn.length>0&&a.ScheduleEventsForClockIn[0].EventBreaks.map((function(e){return n.push({key:e.BreakStart,name:ze(e),breakType:P.Scheduled})})),e.UnscheduledBreakOptions){case M.Both:n.push({key:"UnScheduledUnpaid",name:"Unscheduled",breakType:P.UnscheduledUnpaid}),n.push({key:"UnScheduledPaid",name:"Unscheduled $",breakType:P.UnscheduledPaid});break;case M.Paid:n.push({key:"UnScheduledPaid",name:"Unscheduled $",breakType:P.UnscheduledPaid});break;case M.Unpaid:n.push({key:"UnScheduledUnpaid",name:"Unscheduled",breakType:P.UnscheduledUnpaid})}l(n)}}),[a,t]),i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{mode:"ios"},i.a.createElement(d.Q,null,i.a.createElement(d.N,null,"Choose Break"),i.a.createElement(d.e,{slot:"end"},i.a.createElement(d.d,{onClick:function(){return n(u)}},i.a.createElement(d.m,{icon:f.n,mode:"ios",slot:"icon-only"}))))),i.a.createElement(d.h,{class:"outer-content"},s.map((function(e){return i.a.createElement(d.d,{className:"apply-button",expand:"block",key:e.key,color:"secondary",onClick:function(){n(e)}},e.name)}))))},Kn={getTimeClockSettings:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.get(t,"api/v1/employee/timeclock/?lat=".concat(n,"&lng=").concat(a));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),clockIn:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o){var i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="/api/v2/employee/timeclock/clockin/".concat(n,"/").concat(a,"?lat=").concat(r,"&lng=").concat(o),e.next=3,X.post(t,i,{});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o){return e.apply(this,arguments)}}(),clockOut:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r){var o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={ClockOutValue:r,TimeClockBreak:null,BreakStart:null},e.next=3,X.post(t,"/api/v2/employee/timeclock/clockout?lat=".concat(n,"&lng=").concat(a),o);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),switchPositionOrTag:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o,i){var c,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c="/api/v2/employee/timeclock/switch/".concat(n,"/").concat(a,"?lat=").concat(r,"&lng=").concat(o),s={ClockOutValue:i,TimeClockBreak:null,BreakStart:null},e.next=4,X.post(t,c,s);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o,i){return e.apply(this,arguments)}}(),startBreak:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o,i,c){var s,l;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="/api/v2/employee/timeclock/startbreak?lat=".concat(o,"&lng=").concat(i),l={clockEventId:n.ScheduleEventId,shiftEventId:a?a.ScheduleEventId:null,shiftBreakStart:c,breakType:r},e.next=4,X.post(t,s,l);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o,i,c){return e.apply(this,arguments)}}(),endBreak:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o){var i,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a?a.ScheduleEventId:"",c=null!==a?"/api/v2/employee/timeclock/endbreak/".concat(n.ScheduleEventId,"/").concat(i,"?lat=").concat(r,"&lng=").concat(o):"/api/v2/employee/timeclock/endbreak/".concat(n.ScheduleEventId,"/-1?lat=").concat(r,"&lng=").concat(o),e.next=4,X.post(t,c,{});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o){return e.apply(this,arguments)}}(),getGeoLocations:function(){var e=Object(g.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/api/v2/employee/timeclock/geolocations",e.next=3,X.get(t,"/api/v2/employee/timeclock/geolocations");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};!function(e){e[e.Success=0]="Success",e[e.BreakAlreadyExists=1]="BreakAlreadyExists",e[e.AlreadyOnBreak=2]="AlreadyOnBreak",e[e.ErrorInsertingBreak=3]="ErrorInsertingBreak",e[e.UserNotAtSpecifiedLocation=4]="UserNotAtSpecifiedLocation",e[e.EventDoesNotMatchCurrentUser=5]="EventDoesNotMatchCurrentUser",e[e.InvalidUnscheduledBreak=6]="InvalidUnscheduledBreak"}(Gn||(Gn={})),function(e){e[e.Success=0]="Success",e[e.CannotEndRestrictedBreakEarly=1]="CannotEndRestrictedBreakEarly",e[e.ErrorUpdatingEventBreak=2]="ErrorUpdatingEventBreak",e[e.UserNotAtSpecifiedLocation=3]="UserNotAtSpecifiedLocation",e[e.EventDoesNotMatchCurrentUser=4]="EventDoesNotMatchCurrentUser",e[e.BreakNoLongerExists=5]="BreakNoLongerExists"}(Jn||(Jn={}));var Qn=function(e){var t=e.onCancel,n=e.onOk,a=e.locSettings,r=Object(o.useState)(void 0),c=Object(p.a)(r,2),s=c[0],l=c[1];return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{mode:"ios"},i.a.createElement(d.Q,null,i.a.createElement(d.N,null,"Clock Out"),i.a.createElement(d.e,{slot:"end"},i.a.createElement(d.d,{onClick:t},i.a.createElement(d.m,{icon:f.n,mode:"ios",slot:"icon-only"}))))),i.a.createElement(d.h,null,i.a.createElement(d.k,null,i.a.createElement(d.B,null,i.a.createElement(d.g,{className:"label",size:"5"},a.ClockOutValueLabel),i.a.createElement(d.g,{size:"7"},i.a.createElement(d.n,{placeholder:"Enter value",type:"number",className:"input",autoCorrect:"off",clearInput:!0,value:null===s||void 0===s?void 0:s.toString(),onIonChange:function(e){var t;(t=e.detail.value)?l(parseFloat(t)):void 0!==s&&l(void 0)}}))))),i.a.createElement(d.j,null,i.a.createElement(d.d,{expand:"block",onClick:function(){n(s)},className:"clockout-button"},"CLOCK OUT")))},Xn=function(e){var t=e.tcData,n=e.locSettings,a=e.selectedPosId,r=e.selectedTagId,c=e.onSwitch,s=Object(o.useState)(!0),l=Object(p.a)(s,2),u=l[0],m=l[1],f=i.a.createElement("span",null);return Object(o.useEffect)((function(){if(t.UserClockedIn){var e=t.ClockedInScheduleEvent.PositionId,n=t.ClockedInScheduleEvent.TagId;n||(n=-1),m(e===a&&n===r)}}),[t.UserClockedIn,t.ClockedInScheduleEvent,a,r]),(n.ClockInWithDifferentTag||n.EnablePositionChangeForEmployeePosition)&&t.UserClockedIn?i.a.createElement(d.d,{className:"ion-no-margin",disabled:u,color:"secondary",expand:"block",onClick:c},"SWITCH"):f};function $n(e,t,n){if(!e||!t||0===n.length)return"";if(!google||!google.maps||!google.maps.geometry||!google.maps.geometry.spherical||!google.maps.geometry.spherical.computeDistanceBetween)return"";for(var a=new google.maps.LatLng(e,t),r=null,o=999999999,i=0;i<n.length;i++){var c=n[i];if(c.lat&&c.lng){var s=new google.maps.LatLng(c.lat,c.lng),l=3.28084*google.maps.geometry.spherical.computeDistanceBetween(a,s)-c.proximity;l<o&&(o=l,r=c)}}if(999999999===o)return"";if(o<0)return"At "+r.locationName;var u=189394e-9*o;return u>.1?"".concat(Math.round(10*(u+Number.EPSILON))/10," mi to ").concat(r.locationName):"".concat(Math.round(o)," ft to ").concat(r.locationName)}function Zn(e){return null!==e&&(void 0!==e.coords.latitude&&void 0!==e.coords.longitude)}var ea=function(e){var t=e.pos,n=Object(o.useRef)(null),a=Object(o.useRef)(),r=Object(o.useRef)(),c=i.a.useContext(re).user,s=Object(o.useState)(""),l=Object(p.a)(s,2),u=l[0],m=l[1],v=Object(o.useState)([]),E=Object(p.a)(v,2),h=E[0],g=E[1],b=Object(o.useState)(!1),y=Object(p.a)(b,2),O=y[0],I=y[1];return Object(o.useEffect)((function(){if(null!==n.current&&Zn(t))if(void 0===a.current)a.current=new google.maps.Map(n.current,{center:{lat:t.coords.latitude,lng:t.coords.longitude},zoom:16,disableDefaultUI:!0,fullscreenControl:!1}),function(){Zn(t)&&(r.current=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.25,radius:6.5,center:{lat:t.coords.latitude,lng:t.coords.longitude},map:a.current}));Kn.getGeoLocations(c).then((function(e){g(e),e.forEach((function(e){var t=new google.maps.InfoWindow({content:"<h5>".concat(e.addr,"</h5>")});if(e.lat&&e.lng){var n=new google.maps.LatLng(e.lat,e.lng),r=new google.maps.Marker({position:n,map:a.current,title:e.addr});new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.5,strokeWeight:1,fillColor:"#DD0000",fillOpacity:.2,radius:.3048*e.proximity,center:n,map:a.current}),r.addListener("click",(function(){t.open(a.current,r)}))}})),Zn(t)&&m($n(t.coords.latitude,t.coords.longitude,e))}))}(),google.maps.event.addListenerOnce(a.current,"idle",(function(){n.current&&n.current.classList.add("show-map")}));else{if(a.current&&Zn(t)){var e=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);a.current.setCenter(e),r.current&&r.current.setMap(null),r.current=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.25,radius:6.5,center:e,map:a.current})}m($n(t.coords.latitude,t.coords.longitude,h))}}),[t,google,google.maps]),i.a.createElement(i.a.Fragment,null,i.a.createElement(d.d,{className:"map-button",onClick:function(){null!==t&&(I(!O),m($n(t.coords.latitude,t.coords.longitude,h)))}},u,i.a.createElement(d.m,{id:"show-map-button",icon:O?f.d:f.f})),i.a.createElement("div",{id:"map-container",hidden:!O},i.a.createElement("div",{ref:n,className:"map-canvas"})))};var ta=function(){var e=Object(o.useState)(!1),t=Object(p.a)(e,2),n=t[0],a=t[1],r=Object(o.useState)({message:"",onCancel:function(){},onYes:function(){}}),c=Object(p.a)(r,2),s=c[0],l=c[1];return{showDialog:function(e,t,n){l({message:e,onYes:t,onCancel:n}),a(!0)},dialogJsx:i.a.createElement(d.b,{mode:"ios",isOpen:n,onDidDismiss:function(){a(!1)},message:s.message,buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:s.onCancel},{text:"Yes",handler:s.onYes}]})}},na={enableHighAccuracy:!0,maximumAge:1e3};var aa=function(e){var t=e.updateCallback,n=e.isShowing,a=i.a.useContext(re).user,r=i.a.useContext(rt).auth,c=Object(o.useState)(""),s=Object(p.a)(c,2),l=s[0],u=s[1],d=Object(o.useState)(null),m=Object(p.a)(d,2),f=m[0],v=m[1],E=ta(),h=ue();return Object(o.useEffect)((function(){var e;tt.requiresGeolocation(r.locations)&&(n?u(function(e){var t=function(t){if(t&&t.coords){var n=!1;if(null===f)n=!0;else if(function(){var e=!(void 0===google||void 0===google.maps||void 0===google.maps.geometry||void 0===google.maps.geometry.spherical||void 0===google.maps.geometry.spherical.computeDistanceBetween||void 0===google.maps.LatLng);return e||console.log("WARNING: google maps not yet loaded"),e}()){var r=new google.maps.LatLng(f.coords.latitude,f.coords.longitude),o=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);n=3.28084*google.maps.geometry.spherical.computeDistanceBetween(r,o)>W(a).minimumFeetForGeolocationUpdate}else n=!0;n&&(console.log("GEO: position changed"),v(t),e(t.coords.latitude,t.coords.longitude))}},n=function(t){console.log("GEO: Could not get geolocation, error code "+t.code),1===t.code&&e()},r="";if(_.settings.hasCapacitor&&T.a.isPluginAvailable("Geolocation")){console.log("GEO: Using Cap plugin to watch position");try{r=T.b.watchPosition(na,t),T.b.getCurrentPosition(na).then((function(e){t(e)}))}catch(o){n({code:1})}}else{if(!navigator||!navigator.geolocation)return console.log("GEO: Location unavailable via cap/nav"),"";console.log("GEO: Using browser API"),r=navigator.geolocation.watchPosition(t,n,na),navigator.geolocation.getCurrentPosition((function(e){t(e)}))}return console.log("GEO: start watching, watchId "+r),r}(t)):(""!==(e=l)&&(_.settings.hasCapacitor&&T.a.isPluginAvailable("Geolocation")?T.b.clearWatch({id:e}).then((function(){console.log("GEO: cleared watchId ".concat(e," from Capacitor plugin"))})):navigator&&navigator.geolocation&&(navigator.geolocation.clearWatch(e),console.log("GEO: cleared watchId ".concat(e," from browser API")))),v(null),u("")))}),[n,a.isLoggedin]),i.a.createElement(i.a.Fragment,null,r&&r.locations&&r.locations.length>0&&tt.requiresGeolocation(r.locations)&&i.a.createElement(ea,{pos:f}),E.dialogJsx,h.simpleToastJsx)},ra=function(e){var t=e.onUpdate,n=e.refreshToggle,a=i.a.useContext(re).user,r=i.a.useContext(rt).auth,c=Object(o.useState)([]),s=Object(p.a)(c,2),l=s[0],u=s[1],m=Object(o.useState)(0),E=Object(p.a)(m,2),h=E[0],g=E[1],b=Object(o.useRef)(0),y=Object(o.useState)(!1),O=Object(p.a)(y,2),I=O[0],S=O[1],k=Object(o.useState)([]),j=Object(p.a)(k,2),C=j[0],T=j[1],D=Object(o.useState)(null),A=Object(p.a)(D,2),N=A[0],w=A[1],x=Object(o.useRef)(null),R=Object(o.useState)("START BREAK"),L=Object(p.a)(R,2),F=L[0],U=L[1],B=Object(o.useState)({}),V=Object(p.a)(B,2),z=V[0],q=V[1],_=Object(o.useState)(!1),Y=Object(p.a)(_,2),G=Y[0],J=Y[1],H=Object(o.useState)(!1),K=Object(p.a)(H,2),Q=K[0],X=K[1],$=Object(o.useState)("Please wait..."),Z=Object(p.a)($,2),ee=Z[0],te=Z[1],ne=Object(o.useState)({show:!1,header:"Alert",message:""}),ae=Object(p.a)(ne,2),oe=ae[0],ie=ae[1],ce=Object(o.useState)(null),se=Object(p.a)(ce,2),le=se[0],me=se[1],fe=Object(o.useState)(!1),ve=Object(p.a)(fe,2),Ee=ve[0],he=ve[1],ge=Object(o.useState)(!1),be=Object(p.a)(ge,2),ye=be[0],Oe=be[1],Ie=Object(o.useState)(!1),Se=Object(p.a)(Ie,2),ke=Se[0],je=Se[1],Ce=ue(),Te=Object(o.useState)(void 0),De=Object(p.a)(Te,2),Ae=De[0],Ne=De[1],we=Object(o.useState)(void 0),xe=Object(p.a)(we,2),Me=xe[0],Pe=xe[1];Object(d.W)((function(){je(!0)})),Object(d.X)((function(){je(!1)})),Object(o.useEffect)((function(){ye!==n&&Oe(n),Re(Ae,Me)}),[n]),Object(o.useEffect)((function(){if(le&&r&&r.locations&&0!==r.locations.length&&le.ShowTimeClock){var e,t=Rt.unique(le.PositionsToClockInto.map((function(e){return e.LocationId}))),n=Rt.unique(le.PositionsToClockInto.map((function(e){return e.DepartmentId})));e=t.length>1?le.PositionsToClockInto.map((function(e){return{id:e.PositionId,name:e.PositionNameWithLocAndDeptAbbreviation}})):n.length>1?le.PositionsToClockInto.map((function(e){return{id:e.PositionId,name:e.PositionNameWithDeptAbbreviation}})):le.PositionsToClockInto.map((function(e){return{id:e.PositionId,name:e.PositionName}}));var a=h;0===a&&(le.UserClockedIn?(a=le.ClockedInScheduleEvent.PositionId,g(a)):le.ScheduleEventsForClockIn&&le.ScheduleEventsForClockIn.length>0?(a=le.ScheduleEventsForClockIn[0].PositionId,g(a)):e.length>0?(a=e[0].id,g(a)):a=0);var o=le.UserClockedIn?le.ClockedInScheduleEvent.LocationId:0!==a?r.locations.filter((function(e){return e.departments.flatMap((function(e){return e.positions.flatMap((function(e){return e.id===a}))}))}))[0].id:r.locations[0].id,i=r.locations.filter((function(e){return e.id===o}))[0].settings;q(i),i.EnableEnhancedBreakManagement&&(i.UnscheduledBreakOptions!==M.None||le.ClockedInScheduleEvent.EventBreaks&&le.ClockedInScheduleEvent.EventBreaks.length>0)?U(le.UserClockedIn&&le.CurrentEventBreak?"END BREAK":"START BREAK"):U("NONE"),u(e),Le(a)}}),[r,le,Ae,Me]),Bn((function(){Re(Ae,Me)}),ke,W(a).refreshTimeclockSettingsTimer);var Re=function(e,t){Kn.getTimeClockSettings(a,e,t).then((function(e){me(e)}))},Le=function(e){if(!le)return-1;var t=le.UserClockedIn?le.ClockedInScheduleEvent.LocationId:r.locations.filter((function(t){return t.departments.flatMap((function(t){return t.positions.flatMap((function(t){return t.id===e}))}))}))[0].id;if(!(r.locations.filter((function(e){return e.id===t}))[0].settings.ClockInWithDifferentTag&&le.TagsPerPosition[e]&&le.TagsPerPosition[e].length>1))return S(!1),-1;S(!0);var n=le.TagsPerPosition[e].map((function(e){return{id:e.TagId,name:e.TagName}}));n.unshift({id:-1,name:"NONE"}),T(n);var a=-1;return le.UserClockedIn?a=le.ClockedInScheduleEvent.TagId?le.ClockedInScheduleEvent.TagId:(le.ClockedInScheduleEvent.TagId,-1):le.TagsPerPosition[e]&&le.TagsPerPosition[e].length>0&&(a=le.ScheduleEventsForClockIn&&le.ScheduleEventsForClockIn[0]&&le.ScheduleEventsForClockIn[0].TagId?le.ScheduleEventsForClockIn[0].TagId:-1),w(a),a},Fe=function(e,t){ie({show:!0,header:e,message:t})},Ue=function(e){Ee&&he(!1),te("Clocking Out..."),X(!0),Kn.clockOut(a,Ae,Me,e).then((function(e){X(!1),0===e.ClockOutResponseCode?(Ce.showToast("Clocked out at "+Object(pe.a)(Object(de.a)(e.ClockOutEvent.EventEnd),"h:mmaaa")),t(),Re(Ae,Me)):Fe("Could not Clock Out","Unable to Clock out, ".concat(e.Message))}))};return r&&le?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.k,{className:"clock-controls"},Ce.simpleToastJsx,i.a.createElement(d.s,{isOpen:Q,onDidDismiss:function(){return X(!1)},spinner:"dots",message:ee}),tt.requiresGeolocation(r.locations)&&i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12"},i.a.createElement(aa,{updateCallback:function(e,t){Ae!==e&&Ne(e),Me!==t&&Pe(t),Re(e,t)},isShowing:ke}))),le.PositionsToClockInto&&le.PositionsToClockInto.length>1&&i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,null,"Position")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.E,{className:"select",mode:"ios",interface:"action-sheet",onIonChange:function(e){var t;(t=e.detail.value)!==h&&t!==b.current&&(g(t),Le(t))},disabled:!((le.UserClockedIn&&le.UserMayClockOut||!le.UserClockedIn&&le.UserMayClockIn)&&z.ClockInRequirement!==_n.MatchingShift),value:h},l.map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.name)}))))),I&&i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(d.p,null,"~Tag")),i.a.createElement(d.g,{size:"9"},i.a.createElement(d.E,{className:"select",mode:"ios",interface:"action-sheet",onIonChange:function(e){var t;(t=e.detail.value)!==N&&t!==x.current&&w(t)},disabled:!((le.UserClockedIn&&le.UserMayClockOut||!le.UserClockedIn&&le.UserMayClockIn)&&z.ClockInRequirement!==_n.MatchingShift),value:N},C.map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.name)}))))),(le.PositionsToClockInto&&le.PositionsToClockInto.length>1||I)&&i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12",className:"ion-no-margin"},i.a.createElement(Xn,{tcData:le,locSettings:z,selectedPosId:h,selectedTagId:N,onSwitch:function(){te("Switching..."),X(!0),Kn.switchPositionOrTag(a,h,N,Ae,Me).then((function(e){X(!1),e.AllowedToSwitchPositions||e.AllowedToSwitchTags?(Ce.showToast("Switched"),t(),Re(Ae,Me)):Fe("Could not switch","".concat(e.ClockInMessage," ").concat(e.ClockOutMessage))}))}}))),!le.UserClockedIn&&i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12",className:"ion-no-margin"},i.a.createElement(d.d,{className:"clockin-button",onClick:function(){te("Clocking in..."),X(!0),Kn.clockIn(a,h,N,Ae,Me).then((function(e){X(!1),0===e.ClockInResponseCode?(Ce.showToast("Clocked in at "+Object(pe.a)(Object(de.a)(e.ClockInEvent.EventStart),"h:mmaaa")),t(),Re(Ae,Me)):Fe("Could not Clock In","Unable to Clock in, ".concat(e.Message))}))},disabled:!le.UserMayClockIn},i.a.createElement(d.m,{mode:"md",icon:f.w})," CLOCK IN"))),le.UserClockedIn&&i.a.createElement(d.B,null,i.a.createElement(d.g,{className:"clockout-button-container"},i.a.createElement(d.d,{className:"clockout-button",disabled:!le.UserMayClockOut,expand:"block",onClick:function(){z.ClockOutValueLabel?he(!0):Ue()}},i.a.createElement(d.m,{mode:"md",icon:f.w})," CLOCK OUT"),"NONE"!==F&&i.a.createElement(d.d,{onClick:function(){if("NONE"!==F&&le)return"END BREAK"===F?(te("Ending Break..."),X(!0),void Kn.endBreak(a,le.ClockedInScheduleEvent,le.ScheduleEventsForClockIn.length>0?le.ScheduleEventsForClockIn[0]:null,Ae,Me).then((function(e){X(!1),e.EndBreakResponseCode===Jn.Success?(Ce.showToast("Ended break at ".concat(Object(pe.a)(Object(de.a)(e.BreakEnd),"h:mmaaa"))),t(),Re(Ae,Me)):Fe("Did not come off break",e.Message)}))):void(z.UnscheduledBreakOptions!==M.None||le.ClockedInScheduleEvent.EventBreaks&&le.ClockedInScheduleEvent.EventBreaks.length>0?J(!0):Fe("No implemented","Not implemented in ClockPanel.tsx for this scenario"))},expand:"block",className:"break-button",disabled:!le.UserMayClockOut},i.a.createElement(d.m,{icon:f.h}),F)))),i.a.createElement(d.w,{isOpen:G,cssClass:"mini-modal break-selector-modal"},i.a.createElement(Hn,{auth:r,tcData:le,onDismissModal:function(e){return n=e,void(le&&(J(!1),"Cancel"!==n.key&&(te("Starting Break..."),X(!0),Kn.startBreak(a,le.ClockedInScheduleEvent,le.ScheduleEventsForClockIn[0],n.breakType,Ae,Me,n.breakType===P.Scheduled?n.key:void 0).then((function(e){X(!1),e.StartBreakResponseCode===Gn.Success?(Ce.showToast("Break started at "+Object(pe.a)(Object(de.a)(e.BreakStart),"h:mmaaa")),t(),Re(Ae,Me)):Fe("Could not start break","Unable to start break, ".concat(e.Message))})))));var n}})),i.a.createElement(d.w,{cssClass:"mini-modal clockout-modal",isOpen:Ee,onDidDismiss:function(){he(!1)}},i.a.createElement(Qn,{onCancel:function(){he(!1)},onOk:Ue,locSettings:z})),i.a.createElement(d.b,{isOpen:oe.show,onDidDismiss:function(){return ie(Object(v.a)({},oe,{show:!1}))},header:oe.header,message:oe.message,buttons:["OK"]})):i.a.createElement("div",null,"Loading...")};var oa=function(e){var t,n,a=e.startDate,r=e.endDate,o=e.onNextPayPeriod,c=e.onPrevPayPeriod,s=null===a||null===r?"":(n=r,(t=a)&&n?t.getMonth()!==n.getMonth()?Object(pe.a)(t,"MMM d").toUpperCase()+" - "+Object(pe.a)(Object(he.a)(n,-1),"MMM d").toUpperCase():Object(pe.a)(t,"MMM d").toUpperCase()+" - "+Object(pe.a)(Object(he.a)(n,-1),"d"):" ");return i.a.createElement("div",{className:"chooser"},i.a.createElement("div",{className:"top"},i.a.createElement("button",{onClick:c,className:"arrow",key:-1},i.a.createElement(d.m,{mode:"ios",icon:f.b})),i.a.createElement("div",{className:"month-year-container"},i.a.createElement("div",{className:"datetime-picker-container"},i.a.createElement("div",{className:"datetime-picker"},s))),i.a.createElement("button",{onClick:o,className:"arrow",key:7},i.a.createElement(d.m,{mode:"ios",icon:f.e}))))},ia={getPayPeriodDateForEmployee:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=_e(a),e.next=3,X.get(t,"api/v2/payroll/get/"+n+"/"+r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()};function ca(e,t){return function(e,t){if("00:00:00"===t.ActualTime)return e.TimeFormat===N.HoursMinutes?"00:00":Ye(0,e.TimeFormatDigits,e.TimeFormatDecimals);if(e.TimeFormat===N.HoursMinutes){var n=t.ActualTime.split(":");if(3!==n.length)return t.ActualTime;if(n[0].includes(".")){var a=n[0].split("."),r=24*parseInt(a[0])+parseInt(a[1]);return"".concat(r,":").concat(n[1])}var o=parseInt(n[0]);return"".concat(o,":").concat(n[1])}return Ye(t.ActualHours,e.TimeFormatDigits,e.TimeFormatDecimals)}(e,t)}var sa=function(e){var t=e.time,n=e.locSettings,a=e.fontColor;if(null===t)return i.a.createElement("span",null," -- ");var r=0===t.ActualHours?"#ddd":a;return i.a.createElement("span",{style:{color:r}},ca(n,t))};var la=function(e){var t,n=e.onClose,a=e.data,r=e.locSettings,c=Object(o.useContext)(rt).auth;return a?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{mode:"ios"},i.a.createElement(d.Q,null,i.a.createElement(d.N,null,(t=Object(de.a)(a.date),Object(pe.a)(t,"EEE MMM d, yyyy").toUpperCase())),i.a.createElement(d.e,{slot:"end"},i.a.createElement(d.d,{onClick:n},i.a.createElement(d.m,{icon:f.n,mode:"ios",slot:"icon-only"}))))),i.a.createElement(d.h,null,i.a.createElement(d.k,null,a.regular.ActualHours>0&&i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"7"},"Regular"),i.a.createElement(d.g,{size:"5"},i.a.createElement(sa,{time:a.regular,locSettings:r,fontColor:"black"}))),a.dailyOvertime.ActualHours>0&&i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"7"},"Daily Overtime"),i.a.createElement(d.g,{size:"5"},i.a.createElement(sa,{time:a.dailyOvertime,locSettings:r,fontColor:"red"}))),a.weeklyOvertime.ActualHours>0&&i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"7"},"Weekly Overtime"),i.a.createElement(d.g,{size:"5"},i.a.createElement(sa,{time:a.weeklyOvertime,locSettings:r,fontColor:"red"}))),a.special.ActualHours>0&&i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"7"},"Special Dates"),i.a.createElement(d.g,{size:"5"},i.a.createElement(sa,{time:a.special,locSettings:r,fontColor:"black"}))),a.timePerAbsent&&a.timePerAbsent.map((function(e){return i.a.createElement(d.B,{key:e.absentId},i.a.createElement(d.g,{size:"7"},function(e,t){return e.payrollEvents.filter((function(e){return e.id===t}))[0].name}(c,e.absentId)),i.a.createElement(d.g,{size:"5"},i.a.createElement(sa,{time:e.time,locSettings:r,fontColor:"#AD850C"})))}))))):i.a.createElement("div",null,"loading")};var ua,da=function(e){var t,n=e.payrollRow,a=e.colsToDisplay,r=e.colSize,c=Object(o.useContext)(rt).auth,s=tt.getLocSettingsForLocationId(c,c.locations[0].id),l=Object(o.useState)(!1),u=Object(p.a)(l,2),m=u[0],f=u[1];return null===n?i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"3"},i.a.createElement(Fn.a,{width:50})),i.a.createElement(d.g,{size:"3"},i.a.createElement(Fn.a,{width:50})),i.a.createElement(d.g,{size:"3"},i.a.createElement(Fn.a,{width:50})),i.a.createElement(d.g,{size:"3"},i.a.createElement(Fn.a,{width:50}))):i.a.createElement(i.a.Fragment,null,i.a.createElement(d.B,null,i.a.createElement(d.g,{size:r},i.a.createElement("button",{className:"payperiod-list-buttons",onClick:function(){return f(!0)}},(t=n.date,Object(pe.a)(Object(de.a)(t),"EEE d")))),i.a.createElement(d.g,{size:r,color:"secondary",hidden:(a&ua.Regular)!==ua.Regular},i.a.createElement(sa,{time:null===n||void 0===n?void 0:n.regular,locSettings:s,fontColor:"black"})),i.a.createElement(d.g,{size:r,hidden:(a&ua.DailyOvertime)!==ua.DailyOvertime},i.a.createElement(sa,{time:null===n||void 0===n?void 0:n.dailyOvertime,locSettings:s,fontColor:"red"})),i.a.createElement(d.g,{size:r,hidden:(a&ua.WeeklyOvertime)!==ua.WeeklyOvertime},i.a.createElement(sa,{time:null===n||void 0===n?void 0:n.weeklyOvertime,locSettings:s,fontColor:"red"})),i.a.createElement(d.g,{size:r,hidden:(a&ua.Special)!==ua.Special},i.a.createElement(sa,{time:null===n||void 0===n?void 0:n.special,locSettings:s,fontColor:"black"})),i.a.createElement(d.g,{size:r,hidden:(a&ua.Absent)!==ua.Absent},i.a.createElement(sa,{time:null===n||void 0===n?void 0:n.absent,locSettings:s,fontColor:"black"}))),i.a.createElement(d.w,{cssClass:"mini-modal detail-modal",isOpen:m,onDidDismiss:function(){return f(!1)}},i.a.createElement(la,{onClose:function(){return f(!1)},locSettings:s,data:n})))};!function(e){e[e.None=0]="None",e[e.Regular=1]="Regular",e[e.DailyOvertime=2]="DailyOvertime",e[e.WeeklyOvertime=4]="WeeklyOvertime",e[e.Special=8]="Special",e[e.Absent=16]="Absent",e[e.All=31]="All"}(ua||(ua={}));var ma=function(e){var t=e.payrollData,n=Object(o.useContext)(rt).auth,a=tt.getLocSettingsForLocationId(n,n.locations[0].id),r=Object(o.useState)(ua.None),c=Object(p.a)(r,2),s=c[0],l=c[1],u=Object(o.useState)("3"),m=Object(p.a)(u,2),f=m[0],v=m[1];return Object(o.useEffect)((function(){if(t){var e=function(e){var t=ua.Regular,n=2;return e.totalDailyOvertime.ActualHours>0&&(t|=ua.DailyOvertime,n++),e.totalWeeklyOvertime.ActualHours>0&&(t|=ua.WeeklyOvertime,n++),e.totalSpecial.ActualHours>0&&(t|=ua.Special,n++),e.totalAbsent.ActualHours>0&&(t|=ua.Absent,n++),{cols:t,count:n}}(t),n=e.count,a=e.cols;l(a),v(n>=5?"2":"3")}}),[t]),null===t?i.a.createElement("div",{className:"grid-container"},i.a.createElement(d.k,{class:"ion-text-end"},i.a.createElement(d.B,{className:"list-header",class:"ion-text-center"},i.a.createElement(d.g,{size:"3"},i.a.createElement(Fn.a,{width:60})),i.a.createElement(d.g,{size:"3"},i.a.createElement(Fn.a,{width:60})),i.a.createElement(d.g,{size:"3"},i.a.createElement(Fn.a,{width:60})),i.a.createElement(d.g,{size:"3"},i.a.createElement(Fn.a,{width:60}))),[1,2,3,4,5,6,7,8,9,10].map((function(e){return i.a.createElement(da,{payrollRow:null,colSize:"3",colsToDisplay:ua.None,key:e})})))):i.a.createElement("div",{className:"grid-container"},i.a.createElement(d.k,{class:"ion-text-end"},i.a.createElement(d.B,{className:"list-header",class:"ion-text-center"},i.a.createElement(d.g,{size:f},"DATE"),i.a.createElement(d.g,{size:f,hidden:(s&ua.Regular)!==ua.Regular},"REG"),i.a.createElement(d.g,{size:f,hidden:(s&ua.DailyOvertime)!==ua.DailyOvertime},"DAILY OT"),i.a.createElement(d.g,{size:f,hidden:(s&ua.WeeklyOvertime)!==ua.WeeklyOvertime},"WKLY OT"),i.a.createElement(d.g,{size:f,hidden:(s&ua.Special)!==ua.Special},"SPECIAL"),i.a.createElement(d.g,{size:f,hidden:(s&ua.Absent)!==ua.Absent},"ABSENT")),null===t||void 0===t?void 0:t.list.map((function(e){return i.a.createElement(da,{key:e.date,payrollRow:e,colsToDisplay:s,colSize:f})})),i.a.createElement(d.B,{className:"list-footer"},i.a.createElement(d.g,{size:f},"TOTAL"),i.a.createElement(d.g,{size:f,hidden:(s&ua.Regular)!==ua.Regular},i.a.createElement(sa,{time:null===t||void 0===t?void 0:t.totalRegular,locSettings:a,fontColor:"black"})),i.a.createElement(d.g,{size:f,hidden:(s&ua.DailyOvertime)!==ua.DailyOvertime},i.a.createElement(sa,{time:null===t||void 0===t?void 0:t.totalDailyOvertime,locSettings:a,fontColor:"red"})),i.a.createElement(d.g,{size:f,hidden:(s&ua.WeeklyOvertime)!==ua.WeeklyOvertime},i.a.createElement(sa,{time:null===t||void 0===t?void 0:t.totalWeeklyOvertime,locSettings:a,fontColor:"red"})),i.a.createElement(d.g,{size:f,hidden:(s&ua.Special)!==ua.Special},i.a.createElement(sa,{time:null===t||void 0===t?void 0:t.totalSpecial,locSettings:a,fontColor:"black"})),i.a.createElement(d.g,{size:f,hidden:(s&ua.Absent)!==ua.Absent},i.a.createElement(sa,{time:null===t||void 0===t?void 0:t.totalAbsent,locSettings:a,fontColor:"black"})))))},pa=function(e){var t=e.date,n=i.a.useContext(re).user,a=i.a.useContext(rt).auth,r=Object(o.useState)(null),c=Object(p.a)(r,2),s=c[0],l=c[1],u=Object(o.useState)(null),m=Object(p.a)(u,2),f=m[0],v=m[1],E=Object(o.useState)(null),h=Object(p.a)(E,2),g=h[0],b=h[1],y=Object(o.useState)(null),O=Object(p.a)(y,2),I=O[0],S=O[1],k=ie(),j=Vt((function(e){C(e)}));function C(e){ia.getPayPeriodDateForEmployee(n,a.locations[0].id,s).then((function(t){t.error?k.showAlert("Error","Could not retrieve Payroll data: "+t.message,(function(){})):(v(Object(de.a)(t.start)),b(Object(de.a)(t.end)),S(t),e&&e.detail.complete())}))}Object(o.useEffect)((function(){var e=t;null===t&&(e=new Date),l(e)}),[t]),Object(o.useEffect)((function(){null!=s&&C()}),[s]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(oa,{startDate:f,endDate:g,onNextPayPeriod:function(){l(Object(he.a)(g,1))},onPrevPayPeriod:function(){l(Object(he.a)(f,-1))}}),i.a.createElement(d.h,null,j.ionicRefresherJsx,a&&a.locations&&a.locations.length>0&&i.a.createElement(ma,{payrollData:I}),k.alertBoxJsx))},fa=n(230);var va=function(e){var t=e.refreshToggle,n=e.onUpdate,a=Object(o.useState)([]),r=Object(p.a)(a,2),c=r[0],s=r[1],l=Object(o.useState)([]),u=Object(p.a)(l,2),m=u[0],f=u[1],v=Object(o.useState)([]),E=Object(p.a)(v,2),h=E[0],g=E[1],b=ue(),y=Vt((function(e){Y(e)})),O=i.a.useContext(re).user,I=ie(),S=Object(o.useState)(!1),k=Object(p.a)(S,2),j=k[0],C=k[1],T=Object(o.useState)(null),D=Object(p.a)(T,2),A=D[0],N=D[1],w=Object(o.useState)(hn),x=Object(p.a)(w,2),M=x[0],P=x[1],R=Object(o.useState)(!1),L=Object(p.a)(R,2),F=L[0],U=L[1],B=Object(o.useState)(!1),V=Object(p.a)(B,2),z=V[0],q=V[1],_=Object(o.useContext)(rt).auth;Object(d.W)((function(){q(!0)})),Object(d.X)((function(){q(!1)}));Bn((function(){Y()}),z&&!j,W(O).refreshScheduleTimer);function Y(e){try{var t=function(e){for(var t=tt.getPositionIdsForEmployee(e),n=[],a=0;a<t.length;a++){var r=tt.getLocationIdFromPositionid(e,t[a]);n.includes(r)||n.push(r)}var o=tt.getLocSettingsForLocationId(e,n[0]),i=We(new Date,o),c=Object(fa.a)(i,24);return{settingsLocId:n[0],positionIds:t,start:i,end:c,filterByEmployee:!0,dnLocIds:n,tagId:void 0,eventTypeId:De.All,eventStatusId:De.All,view:mt.clock}}(_);pt.getScheduleEventsByFilter(O,t).then((function(t){U(!1),e&&e.detail.complete(),n(),s(t.events),f(t.dailyNotes),g(t.hoursPerDay)}))}catch(e){console.log("Error in ClockTodayTab.getData: "+e.message)}}Object(o.useEffect)((function(){O&&O.isLoggedin&&(U(!0),Y(void 0))}),[t]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.h,null,y.ionicRefresherJsx,F&&(m&&m.length>0||c&&c.length>0)&&i.a.createElement(d.G,{className:"center",name:"dots"}),F&&(0===m.length||0===c.length)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Un,{threeRows:!1}),i.a.createElement(Un,{threeRows:!1})),!F&&i.a.createElement(xt,{events:c,listType:"today",notes:m,hoursPerDay:h,auth:_,onEdit:function(e){N(e.ScheduleEventId),P(mn(_,e)),C(!0)},onForceRefresh:function(e){e&&e.length>0&&b.showToast(e),Y()},weekStart:new Date})),b.simpleToastJsx,i.a.createElement(d.w,{isOpen:j,onDidDismiss:function(){return C(!1)}},i.a.createElement(Rn,{isOpen:j,auth:_,onCancelModal:function(){return C(!1)},onDismissModal:function(){return Y(void 0),void C(!1)},scheduleEventId:A,initialEvent:M})),I.alertBoxJsx)},Ea=function(){var e=Object(o.useState)("today"),t=Object(p.a)(e,2),n=t[0],a=t[1],r=Object(o.useState)(!1),c=Object(p.a)(r,2),s=c[0],l=c[1],u=Object(o.useState)(!1),m=Object(p.a)(u,2),f=m[0],v=m[1];return i.a.createElement(d.x,null,i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,{mode:"md"},i.a.createElement(d.e,{slot:"start"},i.a.createElement(d.u,null)),i.a.createElement(d.N,{slot:"start"},"Clock"))),i.a.createElement(d.C,{mode:"md",onIonChange:function(e){return t=e.detail.value,void a(t);var t}},i.a.createElement(d.D,{mode:"md",value:"today"},"TODAY"),i.a.createElement(d.D,{mode:"md",value:"pay-periods"},"PAY PERIOD")),"today"===n&&i.a.createElement(va,{refreshToggle:s,onUpdate:function(){console.log("onTodayPanelUpdate"),v(!f)}}),"pay-periods"===n&&i.a.createElement(pa,{date:null}),i.a.createElement(d.j,null,"today"===n&&i.a.createElement(ra,{refreshToggle:f,onUpdate:function(){l(!s)}})))},ha=function(e){var t=e.message,n=e.onMessageClick;if(!t)return i.a.createElement("div",null);var a=t.isViewed?"normal":"bold";return i.a.createElement("button",{className:"message",onClick:n},i.a.createElement("div",{className:"top-line"},i.a.createElement("span",{className:"subject",style:{fontWeight:a}},t.isPinned&&i.a.createElement(d.m,{icon:f.g,style:{color:"gray"}}),t.subject),i.a.createElement("span",{className:"time"},function(e){var t=Object(de.a)(e),n=new Date;return Object(me.a)(t)?Object(pe.a)(t,"h:mmaaa").replace("M",""):Object(fe.a)(n,t)<7?Object(pe.a)(t,"EEE"):Object(ve.a)(t,n)?Object(pe.a)(t,"MMM d"):Object(pe.a)(t,"M/d/yyyy")}(t.deliveryDateTime)," ")),i.a.createElement("div",{className:"bottom-line"},t.previewLine))},ga=function(e){var t=e.onDismissModal,n=e.onCancelModal,a=e.filterData,r=Object(o.useState)({msgTypeIds:a.msgTypes?a.msgTypes.map((function(e){return e.messageTypeId})):[],employeeId:-1}),c=Object(p.a)(r,2),s=c[0],l=c[1],u=Object(o.useState)(!1),m=Object(p.a)(u,2),E=m[0],h=m[1];return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,null,i.a.createElement(d.e,{slot:"start"},i.a.createElement(d.d,{onClick:function(){n()}},i.a.createElement(d.m,{icon:f.c,slot:"icon-only"}))),i.a.createElement(d.N,null,"Filter"),i.a.createElement(d.e,{slot:"end"},i.a.createElement(d.d,{onClick:function(){l({msgTypeIds:a.msgTypes.map((function(e){return e.messageTypeId})),employeeId:-1}),h(!1)}},"RESET")))),i.a.createElement(d.h,{class:"outer-content"},i.a.createElement(d.o,null,i.a.createElement(d.p,null,"From"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:s.employeeId,onIonChange:function(e){l(Object(v.a)({},s,{employeeId:e.detail.value})),h(!0)}},i.a.createElement(d.F,{key:-1,value:-1},"EVERYONE"),a&&a.employees&&a.employees.map((function(e){return i.a.createElement(d.F,{key:e.employeeId,value:e.employeeId},e.name)})))),i.a.createElement(d.o,{lines:"none"},i.a.createElement(d.p,null,"Message Types")),a.msgTypes&&i.a.createElement(ce,{list:a.msgTypes.map((function(e){return{id:e.messageTypeId,name:e.name,description:""}})),selected:a.msgTypes.filter((function(e){return s.msgTypeIds.includes(e.messageTypeId)})).map((function(e){return{id:e.messageTypeId,name:e.name,description:""}})),selectionChanged:function(e){l(Object(v.a)({},s,{msgTypeIds:e.map((function(e){return e.id}))})),h(!0)}})),i.a.createElement(d.j,null,i.a.createElement(d.d,{className:"apply-button",expand:"block",onClick:function(){t(s)},disabled:!E},"APPLY FILTER")))},ba=new U;[{id:1,typeName:"CoverRequestMessage",description:"Cover-Request"},{id:2,typeName:"CoverApprovedMessage",description:"Cover-Approved"},{id:3,typeName:"DirectCoverRequestMessage",description:"Direct Cover-Request"},{id:5,typeName:"ShiftRequestMessage",description:"Shift-Request"},{id:6,typeName:"ShiftRequestDeniedMessage",description:"Shift-Denied"},{id:10,typeName:"ShiftRequestReceivedMessage",description:"Shift-Request Received"},{id:20,typeName:"NoClockInAlertMessage",description:"No Clock In Alert"},{id:21,typeName:"NoClockOutAlertMessage",description:"No Clock Out Alert"},{id:22,typeName:"LateClockInMessage",description:"Late Clock In Alert"},{id:23,typeName:"EarlyClockOutAlertMessage",description:"Early Clock Out Alert"},{id:50,typeName:"ScheduleEventUpdatedMessage",description:"Schedule Event Updated"},{id:60,typeName:"PublishedScheduleUpdatedMessage",description:"Published Schedule Updated"},{id:80,typeName:"PasswordRecoveryMessage",description:"Password Recovery"},{id:81,typeName:"VerifyCellPhoneMessage",description:"Verify Cell Phone"},{id:82,typeName:"VerifyCellPhoneCompleteMessage",description:"Verify Cell Phone Completed"},{id:83,typeName:"VerifyEmailMessage",description:"Verify Email"},{id:100,typeName:"CustomMessage",description:"Custom Messages"},{id:101,typeName:"WeeklyScheduleForEmployeeMessage",description:"Employee Weekly Schedule"},{id:555,typeName:"WelcomeMessage",description:"Welcome"},{id:603,typeName:"UpdatePaymentInformationMessage",description:"Update Payment Information"},{id:700,typeName:"UpgradeSubscriptionMessage",description:"Upgrade Subscription (to Orbital)"},{id:701,typeName:"FailedSignupMessage",description:"Failed Signup"},{id:702,typeName:"GenericErrorMessage",description:"Error Message"},{id:704,typeName:"SignupMessage",description:"Signup Completed"},{id:705,typeName:"DatesOutOfSyncMessage",description:"Dates Out of Sync"},{id:708,typeName:"CancelSubscriptionMessage",description:"Canceled Subscription  "}].map((function(e){return ba.add(""+e.id,e)}));var ya={getUserMessage:function(){var e=Object(g.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.get(t,"api/v2/employee/messages/"+n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),getUserMessages:function(){var e=Object(g.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.get(t,"api/v2/employee/messages");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getReadCount:function(){var e=Object(g.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.get(t,"api/v1/employee/messages/"+n+"/readCount");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),setIsPinned:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.post(t,"api/v1/employee/messages/"+n+"/togglePin",{isPinned:a});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),setIsViewed:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.post(t,"api/v1/employee/messages/"+n+"/toggleView",{isViewed:a});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),deleteMessage:function(){var e=Object(g.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.del(t,"api/v1/employee/messages/"+n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),getUnreadCount:function(){var e=Object(g.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLoggedin){e.next=2;break}return e.abrupt("return",0);case 2:return e.next=4,X.get(t,"api/v2/employee/messages/unreadCount");case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),sendMessage:function(){var e=Object(g.a)(h.a.mark((function e(t,n,a,r,o){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.post(t,"api/v2/employee/messages/send",{locId:n,channel:a,empIds:r,text:o});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,a,r,o){return e.apply(this,arguments)}}()},Oa=i.a.createContext({unreadMessagesCount:0,unreadMessageCountWhenViewed:0,refreshCount:function(){},messagesViewed:function(){},hasNewMessages:!1});function Ia(e){localStorage.setItem("unreadMessageCountWhenViewed",e.toString())}var Sa=function(e){var t=Object(o.useContext)(re).user,n=Object(o.useState)({unreadMessagesCount:0,unreadMessageCountWhenViewed:0}),a=Object(p.a)(n,2),r=a[0],c=a[1];function s(){t.isLoggedin&&ya.getUnreadCount(t).then((function(e){var t=r.unreadMessageCountWhenViewed;(0===t&&(t=function(){var e=localStorage.getItem("unreadMessageCountWhenViewed");return null!==e?parseInt(e):0}()),e<t&&Ia(t=e),e!==r.unreadMessagesCount||t!==r.unreadMessageCountWhenViewed)&&c({unreadMessageCountWhenViewed:t,unreadMessagesCount:e})}))}return Object(o.useEffect)((function(){t.isLoggedin&&s()}),[t.isLoggedin]),Bn((function(){s()}),!0,W(t).checkUnreadMessageCountTimer),i.a.createElement(Oa.Provider,{value:{refreshCount:function(){s()},messagesViewed:function(){var e=r.unreadMessagesCount;e!==r.unreadMessageCountWhenViewed&&(c(Object(v.a)({},r,{unreadMessageCountWhenViewed:e})),Ia(e))},unreadMessagesCount:r.unreadMessagesCount,unreadMessageCountWhenViewed:r.unreadMessageCountWhenViewed,hasNewMessages:r.unreadMessagesCount>r.unreadMessageCountWhenViewed}},e.children)},ka=function(e){var t=e.message,n=e.onCloseModal,a=e.updateMessages,r=ie(),c=ta(),s=i.a.useContext(re).user,l=i.a.useContext(rt).auth,u=Object(o.useState)(null),m=Object(p.a)(u,2),v=m[0],E=m[1],h=Object(o.useState)(null),g=Object(p.a)(h,2),b=g[0],y=g[1],O=Object(o.useState)(null),I=Object(p.a)(O,2),S=I[0],k=I[1],j=Object(o.useState)(!1),C=Object(p.a)(j,2),T=C[0],D=C[1],A=Object(o.useContext)(Oa).refreshCount;Object(o.useEffect)((function(){t&&(t.scheduleEventId?pt.getScheduleEvent(s,t.scheduleEventId).then((function(e){e&&E(e)})):v&&(E(null),k(null)),ya.getReadCount(s,t.messageId).then((function(e){y(e)})),t.isViewed||ya.setIsViewed(s,t.messageId,!0).then((function(){a({type:"UPDATE-VIEWED",msgId:t.messageId,isViewed:!0})})),D(t.isPinned))}),[null===t||void 0===t?void 0:t.messageId]);var N,w=function(e){(null===t||void 0===t?void 0:t.isViewed)||A(),n(e)};return t&&l&&l.locations&&0!==l.locations.length?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,null,i.a.createElement(d.e,{slot:"start"},i.a.createElement(d.d,{onClick:function(){w(null)}},i.a.createElement(d.m,{icon:f.c,mode:"md",slot:"icon-only"}))),i.a.createElement(d.e,{slot:"end"},i.a.createElement(d.d,{onClick:function(){!function(){var e=!T;ya.setIsPinned(s,t.messageId,e).then((function(){D(e),a({type:"UPDATE-PINNED",msgId:t.messageId,isPinned:e})}))}()}},i.a.createElement(d.m,{icon:f.g,style:T?{color:"black"}:{color:"lightgray"}})),i.a.createElement(d.d,{onClick:function(){c.showDialog("Delete this message?",(function(){ya.deleteMessage(s,t.messageId).then((function(){a({type:"DELETE",msgId:t.messageId}),w("Message Deleted")}))}),(function(){}))}},i.a.createElement(d.m,{icon:f.y}))))),i.a.createElement(d.h,{class:"outer-contentMessage"},i.a.createElement(d.k,null,i.a.createElement(d.B,{class:"messageIonRow-header"},i.a.createElement(d.g,{class:"messageHeaderSubject",size:"12"},t.subject),i.a.createElement(d.g,{class:"messageHeaderDetails",size:"12"},"From: ",t.fromEmployeeFirstName," ",t.fromEmployeeLastName),i.a.createElement(d.g,{class:"messageHeaderDetails",size:"9"},(N=t.deliveryDateTime,Object(pe.a)(Object(de.a)(N),"M/d EEE h:mmaa").replace("M",""))),i.a.createElement(d.g,{class:"readCounter",size:"3"},null!==b&&i.a.createElement("span",null,b," Read"))),i.a.createElement("div",null),i.a.createElement(d.B,{class:"messageIonRow-content"},i.a.createElement(d.g,{class:"messageBlock",size:"12"},i.a.createElement("div",{dangerouslySetInnerHTML:{__html:null===t||void 0===t?void 0:t.messageText}}))),null!==S&&i.a.createElement(d.B,null,i.a.createElement(d.g,{size:"12"},S))),r.alertBoxJsx,c.dialogJsx),i.a.createElement(d.j,null,null!==v&&i.a.createElement(Mn,{auth:l,update:function(){},cancelEditModal:w,editorValues:pn(l,v),messageId:t.messageId}))):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,"Loading"),r.alertBoxJsx)};function ja(e,t){var n=tt.getLocationFromLocationId(e,t);if(null===n)throw new Error("Can't find location");return{location:n,department:null,position:null}}var Ca=function(e){var t,n=e.currentPosition,r=e.onPositionUpdate,c=Object(o.useContext)(rt).auth,s=Object(o.useState)(n),l=Object(p.a)(s,2),u=l[0],m=l[1],f=function(e){if(void 0!==e){var t=function(e,t,n){if(null===n)return ja(e,t.location.id);var a=t.location.departments.filter((function(e){return e.id===n}))[0];return{location:t.location,department:a,position:null}}(c,u,e);m(t),r(t)}};return c&&c.locations&&0!==c.locations.length?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Location"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:u.location.id,onIonChange:function(e){return function(e){if(e){var t=ja(c,e);m(t),r(t)}}(e.detail.value)}},c.locations.filter((function(e){return function(e,t){return e.role===a.LocationAdmin||e.role===a.BusinessAdmin||e.role!==a.Employee&&void 0!==t.departments.find((function(e){return e.isDeptAdmin}))}(c,e)})).map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.name)})))),i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Department"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:null===u.department?null:u.department.id,onIonChange:function(e){return f(e.detail.value)}},i.a.createElement(d.F,{key:-1,value:null},"All Departments"),u.location.departments&&u.location.departments.filter((function(e){return tt.isDeptAdmin(c,e.id)})).map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.name)})))),i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Position"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:null===u.position?null:u.position.id,onIonChange:function(e){return function(e){if(void 0!==e){var t=function(e,t,n){if(null===n)return{location:t.location,department:t.department,position:null};var a=t.department.positions.filter((function(e){return e.id===n}))[0];return{location:t.location,department:t.department,position:a}}(0,u,e);m(t),r(t)}}(e.detail.value)}},i.a.createElement(d.F,{key:-1,value:null},"All Positions"),(t=u,null!==t.department?t.department.positions:t.location.departments.flatMap((function(e){return e.positions}))).map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},null===u.department?tt.getDepartmentFromPositionId(c,e.id).abbr+"/"+e.name:e.name)}))))):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,"Loading"))},Ta=i.a.createElement(d.m,{icon:f.s}),Da=i.a.createElement(d.m,{icon:f.u}),Aa=i.a.createElement(d.m,{icon:f.t});function Na(e,t){switch(t){case-1:return e.hasEmail||e.hasText||e.hasPush;case 1:return e.hasEmail;case 2:return e.hasText;case 3:return e.hasPush;default:return!1}}var wa=function(e){var t=e.onCancel,n=e.onOk,a=e.employeeList,r=e.selectedEmployeeList,c=e.channel,s=Object(o.useState)([]),l=Object(p.a)(s,2),u=l[0],m=l[1],E=Object(o.useState)(!1),h=Object(p.a)(E,2),g=h[0],b=h[1];return Object(o.useEffect)((function(){var e=a.map((function(e){return{id:e.id,name:e.name,hasEmail:e.hasEmail,hasText:e.hasText,hasPush:e.hasPush,isChecked:r.some((function(t){return t.id===e.id}))}}));m(e)}),[a,r]),i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{mode:"ios"},i.a.createElement(d.Q,null,i.a.createElement(d.N,null,"Employees"),i.a.createElement(d.e,{slot:"end"},i.a.createElement(d.d,{onClick:t},i.a.createElement(d.m,{icon:f.n,mode:"ios",slot:"icon-only"}))))),i.a.createElement(d.h,null,i.a.createElement(d.k,null,i.a.createElement(d.B,{key:-1},i.a.createElement(d.g,{size:"3"},i.a.createElement(d.f,{className:"checkbox",checked:g,onClick:function(){var e=!g,t=u.map((function(t){return Na(t,c)?Object(v.a)({},t,{isChecked:e}):Object(v.a)({},t,{isChecked:!1})}));m(t),b(e)}})),i.a.createElement(d.g,{className:"label",size:"6"},"Select All"),i.a.createElement(d.g,{size:"1"},Ta),i.a.createElement(d.g,{size:"1"},Da),i.a.createElement(d.g,{size:"1"},Aa)),u.map((function(e){return i.a.createElement(d.B,{key:e.id},i.a.createElement(d.g,{size:"3"},i.a.createElement(d.f,{className:"checkbox",checked:e.isChecked,disabled:!Na(e,c),onClick:function(){!function(e){var t=0,n=u.map((function(n){return Na(n,c)?n.isChecked?n.id===e?Object(v.a)({},n,{isChecked:!1}):(t++,Object(v.a)({},n,{isChecked:Na(n,c)})):n.id===e?(t++,Object(v.a)({},n,{isChecked:Na(n,c)})):Object(v.a)({},n,{isChecked:!1}):Object(v.a)({},n,{isChecked:!1})})),r=a.filter((function(e){return Na(e,c)})).length;b(t===r),m(n)}(e.id)}})),i.a.createElement(d.g,{className:"label",size:"6"},e.name),i.a.createElement(d.g,{size:"1"},e.hasEmail&&Ta),i.a.createElement(d.g,{size:"1"},e.hasText&&Da),i.a.createElement(d.g,{size:"1"},e.hasText&&Aa))})))),i.a.createElement(d.j,null,i.a.createElement(d.d,{expand:"block",color:"secondary",onClick:function(){n(u.filter((function(e){return e.isChecked})))}},"OK")))},xa=[{id:-1,text:"All Channels"},{id:1,text:"Email"},{id:2,text:"Text"},{id:3,text:"Push Notification"}];var Ma=function(e){var t=e.onUpdate,n=Object(o.useContext)(re).user,r=Object(o.useContext)(rt).auth,c=Object(o.useState)("All"),s=Object(p.a)(c,2),l=s[0],u=s[1],m=Object(o.useState)(function(e){for(var t=0;t<e.locations.length;t++){var n=e.locations[t];if(n.adminAllDepts)return{location:n,department:null,position:null};for(var a=0;a<n.departments.length;a++){var r=n.departments[a];if(r.isDeptAdmin)return{location:n,department:r,position:null}}}throw new Error("Could not find a department where this user could send messages")}(r)),f=Object(p.a)(m,2),v=f[0],E=f[1],h=Object(o.useState)(-1),g=Object(p.a)(h,2),b=g[0],y=g[1],O=Object(o.useState)([]),I=Object(p.a)(O,2),S=I[0],k=I[1],j=Object(o.useState)([]),C=Object(p.a)(j,2),T=C[0],D=C[1],A=Object(o.useState)(!1),N=Object(p.a)(A,2),w=N[0],x=N[1],M=He("Retreiving employee list");function P(e,t,a,r,o){M.setShowLoading(!0),Je.getEmployeeListForCommunication(n,e,t,a,r,o).then((function(e){D(e)})).finally((function(){M.setShowLoading(!1)}))}var R;return Object(o.useEffect)((function(){r.locations&&r.locations.length>0&&P(r.locations[0].id,-1,-1,0,"All")}),[r.locations]),r&&r.locations&&0!==r.locations.length?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Role"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:l,onIonChange:function(e){var t;(t=e.detail.value)!==l&&(u(t),k([]),P(v.location.id,null===v.department?-1:v.department.id,null===v.position?-1:v.position.id,b,t))}},i.a.createElement(d.F,{value:"All",key:-1},"All"),i.a.createElement(d.F,{value:a.BusinessAdmin,key:2},"Business Admin"),i.a.createElement(d.F,{value:a.LocationAdmin,key:3},"Location Admin"),i.a.createElement(d.F,{value:a.Admin,key:4},"Admin"),i.a.createElement(d.F,{value:a.Employee,key:5},"Employee"))),i.a.createElement(Ca,{currentPosition:v,onPositionUpdate:function(e){E(e),k([]),P(e.location.id,null===e.department?-1:e.department.id,null===e.position?-1:e.position.id,b,l)}}),i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Send To"),i.a.createElement(d.E,{mode:"ios",interface:"action-sheet",value:b,onIonChange:function(e){var t;null!==(t=e.detail.value)&&void 0!==t&&t!==b&&(k([]),y(t))}},xa.map((function(e){return i.a.createElement(d.F,{key:e.id,value:e.id},e.text)})))),i.a.createElement(d.o,null,i.a.createElement(d.p,null,"Employees (",T.filter((function(e){return Na(e,b)})).length," ","/ ",T.length,")"),i.a.createElement(d.d,{className:"button-selectEmployees-messages",onClick:function(){return x(!0)}},0===(R=S).length?"None Selected":1===R.length?R[0].name:"".concat(R.length," Selected"))),M.showLoadingJsx,i.a.createElement(d.w,{mode:"ios",cssClass:"mini-modal add-break-modal",onDidDismiss:function(){return x(!1)},isOpen:w},i.a.createElement(wa,{channel:b,onCancel:function(){x(!1)},onOk:function(e){k(e),x(!1),t(e,v.location.id,b)},employeeList:T,selectedEmployeeList:S}))):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,"Loading"))},Pa=function(e){var t=e.onCloseModal,n=e.isOpen,a=Object(o.useContext)(re).user,r=Object(o.useContext)(rt).auth,c=Object(o.useState)(""),s=Object(p.a)(c,2),l=s[0],u=s[1],m=Object(o.useState)([]),v=Object(p.a)(m,2),E=v[0],h=v[1],g=Object(o.useState)(0),b=Object(p.a)(g,2),y=b[0],O=b[1],I=Object(o.useState)(0),S=Object(p.a)(I,2),k=S[0],j=S[1],C=He("Sending"),T=ie();return n&&r&&r.locations&&0!==r.locations.length?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,null,i.a.createElement(d.e,{slot:"start"},i.a.createElement(d.d,{onClick:function(){return t("")}},i.a.createElement(d.m,{icon:f.c,slot:"icon-only"}))),i.a.createElement(d.N,null,"New Message"))),i.a.createElement(d.h,{class:"edit-daily-modal-content"},i.a.createElement(d.r,null,i.a.createElement(Ma,{onUpdate:function(e,t,n){h(e.map((function(e){return e.id}))),t!==y&&O(t),n!==k&&j(n)}}),i.a.createElement(d.o,{lines:"none"},i.a.createElement(d.M,{value:l,placeholder:"Enter message",spellcheck:!0,wrap:"hard",autoGrow:!0,debounce:250,onIonChange:function(e){var t;null!==(t=e.detail.value)&&void 0!==t&&t!==l&&u(t)}}))),C.showLoadingJsx),i.a.createElement(d.j,null,i.a.createElement(d.d,{className:"apply-button",expand:"block",onClick:function(){C.setShowLoading(!0),ya.sendMessage(a,y,k,E,l).then((function(e){C.setShowLoading(!1),e.error?T.showAlert("Could not send","Could not send message. "+e.message,(function(){})):1===E.length?t("Message sent"):t("Messages sent")}))},disabled:0===E.length||0===l.length||C.showLoading},"Send"))):i.a.createElement("div",null,"Loading")},Ra=[],La=function(e,t){switch(console.log("REDUCER: ACTION =",t.type),t.type){case"LOADED-FROM-API":return t.data;case"CLEAR":return[];case"UPDATE-PINNED":return e.map((function(e){return e.messageId===t.msgId?Object(v.a)({},e,{isPinned:t.isPinned}):e}));case"UPDATE-VIEWED":return e.map((function(e){return e.messageId===t.msgId?Object(v.a)({},e,{isViewed:t.isViewed}):e}));case"DELETE":return e.filter((function(e){return e.messageId!==t.msgId}))}},Fa=function(e){var t=e.match,n=e.history,a=i.a.useContext(re).user,r=i.a.useContext(rt),c=r.auth,s=r.refreshAuth,l=i.a.useContext(Oa),u=l.unreadMessagesCount,m=l.messagesViewed;Object(d.U)((function(){m()}),[m]),Object(d.V)((function(){m()}),[m]),Object(o.useEffect)((function(){c&&c.locations&&0!==c.locations.length||s(!1,a)}),[c]);var v=Vt((function(e){K(e)})),E=Object(o.useState)(!1),h=Object(p.a)(E,2),g=h[0],b=h[1],y=Object(o.useState)(!0),O=Object(p.a)(y,2),I=O[0],S=O[1],k=Object(o.useReducer)(La,[]),j=Object(p.a)(k,2),C=j[0],T=j[1],D=Object(o.useState)(Ra),A=Object(p.a)(D,2),N=A[0],w=A[1],x=Object(o.useState)({}),M=Object(p.a)(x,2),P=M[0],R=M[1],L=Object(o.useState)({}),F=Object(p.a)(L,2),U=F[0],B=F[1],V=Object(o.useState)(null),z=Object(p.a)(V,2),q=z[0],W=z[1],_=ue(),Y=Object(o.useState)(!1),G=Object(p.a)(Y,2),J=G[0],H=G[1];Object(o.useEffect)((function(){if(a&&a.isLoggedin&&c&&c.locations&&c.locations.length>0)return K(void 0)}),[a.isLoggedin,u,c]),Object(o.useEffect)((function(){Q(U,C)}),[C]),Object(o.useEffect)((function(){t.params.messageId&&null===q&&ya.getUserMessage(a,parseInt(t.params.messageId)).then((function(e){e||(_.showToast("The requested message has been removed"),n.push("/tabs/messages/")),W(e)}))}),[t.params.messageId]);var K=function(e){var t=!0;return 0===C.length&&!1===I&&S(!0),ya.getUserMessages(a).then((function(n){t&&(T({type:"LOADED-FROM-API",data:n}),Q(U,n),S(!1),e&&e.detail.complete())})),function(){t=!1}},Q=function(e,t){e&&e.msgTypeIds?-1!==e.employeeId?e.msgTypeIds.length>0?w(t.filter((function(t){return t.fromEmployeeId===e.employeeId&&Rt.contains(e.msgTypeIds,t.messageTypeId)}))):w(t.filter((function(t){return t.fromEmployeeId===e.employeeId}))):e.msgTypeIds.length>0?(console.log(e.msgTypeIds),w(t.filter((function(t){return Rt.contains(e.msgTypeIds,t.messageTypeId)})))):w(t):w(t)};return i.a.createElement(d.x,null,i.a.createElement(d.l,{className:"ion-no-border"},i.a.createElement(d.Q,{mode:"md"},i.a.createElement(d.e,{slot:"start"},i.a.createElement(d.u,null)),i.a.createElement(d.N,{slot:"start"},"Messages"),i.a.createElement(d.e,{slot:"end"},i.a.createElement(d.d,{hidden:void 0===c.locations.find((function(e){return e.departments.find((function(e){return tt.isDeptAdmin(c,e.id)}))})),onClick:function(){H(!0)}},i.a.createElement(d.m,{icon:f.a,mode:"md",slot:"icon-only"})),i.a.createElement(d.d,{onClick:function(){var e=Rt.uniqueObject(C.map((function(e){return{employeeId:e.fromEmployeeId,name:e.fromEmployeeFirstName+" "+e.fromEmployeeLastName}})),(function(e,t){return e.employeeId===t.employeeId})),t=Rt.uniqueObject(C.map((function(e){return{messageTypeId:e.messageTypeId,name:ba.item(String(e.messageTypeId)).description}})),(function(e,t){return e.messageTypeId===t.messageTypeId}));R({msgTypes:t,employees:e}),b(!0)}},i.a.createElement(d.m,{icon:f.o,mode:"ios",slot:"icon-only"}))))),i.a.createElement(d.h,{className:"outer-content"},v.ionicRefresherJsx,I&&i.a.createElement(i.a.Fragment,null,[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21].map((function(e){return i.a.createElement("div",{key:e,style:{margin:"10px 8px"}},i.a.createElement(Fn.a,{width:360,height:45}))}))),!I&&0===N.length&&i.a.createElement("div",{className:"no-messagesOrEvents-text"},"No Messages"),i.a.createElement("div",{className:"message-list"},!I&&N.length>0&&N.filter((function(e){return e.isPinned})).map((function(e){return i.a.createElement(ha,{key:e.messageId,message:e,onMessageClick:function(){return W(e)}})}))),i.a.createElement("div",{className:"message-list"},!I&&N.length>0&&N.filter((function(e){return!e.isPinned})).map((function(e){return i.a.createElement(ha,{key:e.messageId,message:e,onMessageClick:function(){return W(e)}})})))),i.a.createElement(d.w,{isOpen:g},i.a.createElement(ga,{filterData:P,onDismissModal:function(e){B(e),Q(e,C),b(!1)},onCancelModal:function(){return b(!1)}})),i.a.createElement(d.w,{isOpen:null!==q},i.a.createElement(ka,{message:q,updateMessages:T,onCloseModal:function(e){W(null),e&&_.showToast(e)}})),i.a.createElement(d.w,{isOpen:J},i.a.createElement(Pa,{onCloseModal:function(e){H(!1),null!==e&&e.length>0&&_.showToast(e),setTimeout((function(){K()}),4e3)},isOpen:J})),_.simpleToastJsx)},Ua=function(){var e=Object(o.useContext)(Oa),t=e.unreadMessagesCount,n=e.hasNewMessages;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:n?"hasMessages":"noMessages"},t),i.a.createElement(d.m,{icon:f.l}),i.a.createElement(d.p,null,"Messages"))},Ba=function(){var e=Object(o.useContext)(rt).auth;return i.a.createElement(d.K,null,i.a.createElement(d.A,null,i.a.createElement(l.b,{exact:!0,path:"/tabs",to:"/tabs/schedule"}),i.a.createElement(l.c,{path:"/tabs/schedule/:scheduleEventId",render:function(e){return i.a.createElement(Yn,e)}}),i.a.createElement(l.c,{path:"/tabs/schedule",render:function(e){return i.a.createElement(Yn,e)},exact:!0}),i.a.createElement(l.c,{path:"/tabs/messages/:messageId",render:function(e){return i.a.createElement(Fa,e)}}),i.a.createElement(l.c,{path:"/tabs/messages",render:function(e){return i.a.createElement(Fa,e)},exact:!0}),i.a.createElement(l.c,{path:"/tabs/clock",render:function(){return i.a.createElement(Ea,null)},exact:!0})),i.a.createElement(d.I,{slot:"bottom"},i.a.createElement(d.J,{key:"1",tab:"schedule",href:"/tabs/schedule"},i.a.createElement(d.m,{icon:f.j}),i.a.createElement(d.p,null,"Schedule")),i.a.createElement(d.J,{hidden:!e.timeClock,key:"2",tab:"clock",href:"/tabs/clock"},i.a.createElement(d.m,{icon:f.x}),i.a.createElement(d.p,null,"Clock")),i.a.createElement(d.J,{key:"3",tab:"map",href:"/tabs/messages"},i.a.createElement(Ua,null))))},Va=function(){var e=i.a.useContext(re).user;return e.loading?i.a.createElement("div",null):e.isLoggedin?i.a.createElement(Ba,null):i.a.createElement(l.b,{to:"/login"})},za=function(e){var t=e.history,n=i.a.useContext(re),a=n.user,r=n.logout,o=i.a.useContext(rt).clearAuth;return Object(d.U)((function(){Promise.all([o(),r()]).then((function(){localStorage.clear(),G("logout",{user:a.username}),console.log("logged out (".concat(a.username,")")),setTimeout((function(){t.push("/login",{direction:"none"}),t.goForward()}),250)}))})),i.a.createElement(d.x,{id:"logout-page"},i.a.createElement(d.h,{className:"login-content"},i.a.createElement("div",{className:"login-logo"},i.a.createElement("img",{className:"logo",src:"assets/img/OS Logo - 4pt Rounded _ 2 Tone Orange.svg",alt:"Orbital Shift Logo"})),i.a.createElement(d.r,{className:"form-list"},i.a.createElement("div",{className:"item"},i.a.createElement("div",{className:"label"},"User")))))},qa=n(74),Wa=function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(d.h,{id:"splash"},i.a.createElement("div",{className:"login-logo"},i.a.createElement("img",{className:"logo",src:"assets/img/OS Logo - 4pt Rounded _ 2 Tone Orange.svg",alt:"Orbital Shift Logo"})),i.a.createElement(d.s,{isOpen:!0,spinner:"dots",message:"Loading...",showBackdrop:!1,duration:0}),i.a.createElement("footer",null,_.settings.appVersionString," (",_.settings.buildDate,")")))},_a=function(){var e,t=Object(o.useContext)(re).user,n=Object(o.useContext)(rt),a=n.auth,r=n.refreshAuth;return Object(o.useEffect)((function(){_.settings.hasCapacitor&&qa.a.lock(qa.a.ORIENTATIONS.PORTRAIT).then((function(){console.log("screen locked to portrait")})),console.log("firebase initialized"),D.initializeApp(Y),G("app_render",{vers:_.settings.appVersionString,platform:_.settings.platform})}),[]),Object(o.useEffect)((function(){t.isLoggedin&&!tt.isAuthItemsValid(a)&&r(!1,t)}),[t.isLoggedin,a,r,t]),e=t.isLoggedin?t.isLoggedin&&tt.isAuthItemsValid(a)?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.c,{path:"/tabs",render:function(e){return i.a.createElement(Va,e)}}),i.a.createElement(l.c,{path:"/",exact:!0},i.a.createElement(l.b,{to:"/tabs/schedule"}))):i.a.createElement(Wa,null):i.a.createElement(i.a.Fragment,null,i.a.createElement(l.c,{path:"/tabs",render:function(e){return i.a.createElement(Va,e)}}),i.a.createElement(l.c,{path:"/",exact:!0},i.a.createElement(l.b,{to:"/tabs/schedule"}))),i.a.createElement(d.c,null,i.a.createElement(m.a,null,i.a.createElement(m.a,null,i.a.createElement(d.H,{contentId:"main"},i.a.createElement(Qe,null),i.a.createElement(d.A,{id:"main"},i.a.createElement(l.c,{path:"/login",render:function(e){return i.a.createElement(lt,e)}}),i.a.createElement(l.c,{path:"/logout",render:function(e){return i.a.createElement(za,e)}}),e)))))},Ya=function(){return i.a.createElement(u.a,null,i.a.createElement(oe,null,i.a.createElement(ct,null,i.a.createElement(Sa,null,i.a.createElement(_a,null)))))};s.a.render(i.a.createElement(Ya,null),document.getElementById("root"))},9:function(e,t,n){}},[[104,7,51]]]);
//# sourceMappingURL=main.c298bd15.chunk.js.map