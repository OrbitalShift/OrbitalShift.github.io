{"version":3,"sources":["../node_modules/@ionic/core/dist/esm-es5 lazy /^/.*/.entry/.js$/ include: /.entry/.js$/ exclude: /.system/.entry/.js$/ groupOptions: {} namespace object","../node_modules/@ionic/react/node_modules/ionicons/dist/esm-es5 lazy /^/.*/.entry/.js$/ include: /.entry/.js$/ exclude: /.system/.entry/.js$/ groupOptions: {} namespace object","orbital-interfaces/authorized-items.ts","data/dbStore.ts","util/KeyedCollection.ts","api/environment.ts","util/logger.ts","api/OrbitalApiHelper.ts","enums/DeviceOperatingSystem.ts","api/PushNotificationsAPI.ts","util/push-notifications-controller.ts","context/ApplicationUserContext.tsx","hooks/useDialogBox.tsx","components/ToggleListEx.tsx","components/NotificationSettingsModal.tsx","hooks/useSimpleToast.tsx","enums/EventType.ts","enums/EventStatus.ts","enums/EventGroup.ts","util/scheduleevent-helper.ts","util/time-helper.ts","api/EmployeesAPI.ts","hooks/useShowLoading.tsx","components/SubmitFeedbackModal.tsx","components/Menu.tsx","api/UserAPI.ts","util/authitems-helper.ts","context/AuthorizedItemsContext.tsx","pages/Login.tsx","api/ScheduleEventsAPI.ts","orbital-interfaces/EventFilter.ts","components/EditEvent/EditEventAuthorization.ts","components/SchedulePageComponents/WeekChooser.tsx","components/SchedulePageComponents/EventCard.tsx","hooks/useOrbitalDialogBox.tsx","components/SchedulePageComponents/DailyNoteDepartmentSelector.tsx","api/DailyNotesAPI.ts","components/SchedulePageComponents/EditDailyNoteModal.tsx","components/SchedulePageComponents/DailyNoteCard.tsx","components/SchedulePageComponents/AddDailyNoteButton.tsx","components/SchedulePageComponents/NoEventsToShow.tsx","components/SchedulePageComponents/EventListSection.tsx","components/SchedulePageComponents/EventList.tsx","util/event-helper.ts","util/array-helper.ts","data/filterStore.ts","components/SchedulePageComponents/ScheduleFilterModal.tsx","hooks/useIonicRefresher.tsx","components/EditEvent/editor/EventTypeStatusEditor.tsx","components/EditEvent/editor/EventPositionEditor.tsx","components/EditEvent/editor/EventEmployeeEditor.tsx","components/EditEvent/editor/EventStartEndEditor.tsx","components/EditEvent/editor/AddBreakModal.tsx","components/EditEvent/editor/EventBreakEditor.tsx","components/EditEvent/editor/EventTagEditor.tsx","components/EditEvent/editor/EventConfirmEditor.tsx","enums/RecurrenceType.ts","components/EditEvent/editor/EventIsClockedInEditor.tsx","components/EditEvent/EditEventModalState.ts","enums/RecurrenceUpdateType.ts","components/EditEvent/editor/EventNotesEditor.tsx","components/EditEvent/editor/EventClockoutValueEditor.tsx","api/RequestsAPI.ts","components/EditEvent/editor/EventRequestModal.tsx","components/EditEvent/editor/EventRequestEditor.tsx","components/EditEvent/editor/WeekdayList.tsx","components/EditEvent/editor/RecurringEventSection.tsx","components/EditEvent/RecurrenceUpdateTypeSelector.tsx","components/EditEvent/EditEventModal.tsx","components/SchedulePageComponents/EventCardSkeleton.tsx","hooks/useInterval.ts","pages/SchedulePage.tsx","enums/ClockInRequirement.ts","components/ClockPageComponents/BreakSelectorModal.tsx","enums/StartBreakResponseCode.ts","enums/EndBreakResponseCode.ts","api/TimeClockAPI.ts","components/ClockPageComponents/ClockoutModal.tsx","components/ClockPageComponents/SwitchPositionOrTagButton.tsx","components/ClockPageComponents/Map.tsx","hooks/useYesOrCancelDialogBox.tsx","components/ClockPageComponents/GeoLocationComponent.tsx","components/ClockPageComponents/ClockPanel.tsx","components/ClockPageComponents/PayrollPeriodChooser.tsx","api/PayrollPeriodAPI.ts","components/ClockPageComponents/PayrollOrbitalTimeItem.tsx","components/ClockPageComponents/PayrollDetailModal.tsx","components/ClockPageComponents/PayrollDetailRow.tsx","components/ClockPageComponents/PayrollDetailList.tsx","components/ClockPageComponents/PayrollPeriodsTab.tsx","components/ClockPageComponents/ClockTodayTab.tsx","pages/ClockPage.tsx","components/MessagesPageComponents/MessageItem.tsx","components/MessagesPageComponents/MessagesFilterModal.tsx","orbital-interfaces/MessageTypes.ts","api/MessageAPI.ts","context/MessagesContext.tsx","components/MessagesPageComponents/ViewMessageModal.tsx","components/MessagesPageComponents/create/PositionSelector.tsx","components/MessagesPageComponents/create/EmployeeSelectorModal.tsx","components/MessagesPageComponents/create/EmployeesSelector.tsx","components/MessagesPageComponents/create/CreateMessageModal.tsx","pages/MessagesPage.tsx","pages/MessagesTabButton.tsx","pages/MainTabs.tsx","components/AuthGate.tsx","pages/Logout.tsx","components/SplashComponent.tsx","App.tsx","index.tsx"],"names":["map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","keys","Object","module","exports","Role","SubscriptionType","getKeyStore","openDB","upgrade","db","createObjectStore","putUserState","state","a","put","getUserState","get","getAccessToken","access_token","undefined","putAuthItems","auth","getAuthItems","authItems","getSubscriptionTypeName","subscripionType","None","Standard","Premium","Enterprise","TimeFormat","ClockOutValueType","AdminAuthorization","UnscheduledBreakOptions","BreakType","EmployeeSort","Employee","KeyedCollection","items","_count","key","this","hasOwnProperty","value","val","keySet","prop","push","values","defaults","constants","checkUnreadMessageCountTimer","refreshScheduleTimer","refreshTimeclockSettingsTimer","maxStaleAuthItemsInMinutes","minimumFeetForGeolocationUpdate","name","url","envTypes","environments","et","add","settings","env","versionName","versionCode","revisionHash","buildDate","appVersionString","hasCapacitor","isPlatform","platform","getConstants","user","isLoggedin","item","environment","getApiUrl","endpoint","getUserAndEnvironmentFromInput","input","length","username","envKey","toLowerCase","substring","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","log","eventName","eventParams","firebase","logEvent","setFirebaseUserProperties","setUserId","setUserProperties","userRole","role","subscriptionType","businessName","userName","version","DeviceOperatingSystem","post","baseUrl","data","console","fetch","method","body","JSON","stringify","headers","Authorization","AppVersion","response","contentType","indexOf","json","results","appVersion","error","putData","dataString","options","del","subscribe","token","operatingSystem","iOS","Android","apiHelper","TokenId","OperatingSystem","unsubscribe","getTypesSelectedByUser","putTypes","typeIds","listTypes","PushNotifications","Plugins","pushEnabled","showMessage","history","createBrowserHistory","forceRefresh","register","addListener","pushApi","notification","MessageId","title","goForward","messageId","INITIAL_APPLICATION_USER","darkMode","loading","isPushEnabled","INITIAL_APPLICATION_USER_CONTEXT","logout","userLoggedIn","u","at","ApplicationUserContext","React","createContext","ApplicationUserContextProvider","props","useState","userState","internalSetUserState","useEffect","mounted","all","newState","PushController","enabled","currentState","latitude","longitude","requestedGeoPermission","refusedGeoPermission","Provider","children","useDialogBox","isOpen","setIsOpen","header","message","onDismiss","alertData","setAlertData","showAlert","alertBoxJsx","onDidDismiss","buttons","ToggleListEx","list","selected","selectionChanged","isItemChecked","i","lines","mode","checked","onClick","slice","onAllChanged","toggle","n","includes","newList","newlist","filter","r","itemToggle","NotificationSettingsModal","onDismissModal","useContext","notifications","setNotifications","selectedNotifications","setSelectedNotifications","isSubscribed","responses","className","slot","icon","arrowBackOutline","class","newSelected","useSimpleToast","EventType","toastData","setToastData","showToast","simpleToastJsx","position","duration","eventTypeIdList","getEventTypeIdName","eventType","idName","find","EventStatus","eventStatusIdList","getEventStatusIdName","eventStatus","EventGroup","onClockEventEnd","Date","isShiftTypeEvent","Shift","Approved","Cover","Request","RequestDenied","isAbsentExpenseEvent","Absent","eventMatchesFilter","eventTypeFilter","eventStatusFilter","DontWork","Unavailable","Vacation","isDontWorkEvent","All","Scheduled","ClockAndSched","Clock","isTimeClockEvent","noEndTime","isScheduleEvent","ev","BusinessId","convertTimeWithoutTimeZoneToLocalTime","dtStr","localTimeZone","Intl","DateTimeFormat","resolvedOptions","timeZone","newDate","toDate","tzFormat","getDurationFromTimeSpan","timespan","hrs","min","tok","split","hrTok","parseInt","getDurationString","minutes","str","Math","floor","getEventInformationStartEnd","end","start","format","parseISO","EventStart","replace","IsClockedIn","EventTypeId","EventStatusId","isAfter","EventEnd","isClockedIn","getEventBreakStartEndString","brk","BreakStart","BreakEnd","getWeekStart","date","weekStartsOn","dayStart","dayStartMinutes","setHours","counter","addDays","getTodayStartForLocation","locSettings","tmpDate","valueOf","DayStartTime","setMinutes","getSeconds","getMilliseconds","needPreviousDate","isSameDay","startDate","formatDateTimeAsMvcString","d","getFullYear","padZeroes","getMonth","getDate","getHours","getMinutes","formatDecimal","num","digits","decimals","Number","toFixed","toString","negative","s","substr","max","digitCount","getEmployeesByLocationIdPositionIdAndActiveDateRange","locId","posId","sort","getEmployeeListForCommunication","depId","channel","submitFeedback","msg","os","useShowLoading","showLoading","setShowLoading","showLoadingJsx","spinner","SubmitFeedbackModal","setMessage","placeholder","maxlength","rows","spellcheck","wrap","debounce","onIonChange","detail","expand","employeeApi","res","succeeded","disabled","Menu","disableMenu","dlg","showNotificationsModal","setShowNotificationsModal","showSubmitFeedbackModal","setShowSubmitFeedbackModal","toast","type","contentId","toUpperCase","auto-hide","button","mail","routerLink","routerDirection","logOut","submitted","authenticateUser","password","error_description","loggedIn","err","getAuthorizedItems","result","getLocationFromLocationId","locationId","locations","l","adminAuth","loc","curLoc","j","departments","positions","p","positionId","foundDepartment","flatMap","hasPosition","departmentId","CanEditSchedules","Admin","dept","BusinessAdmin","LocationAdmin","isDeptAdmin","location","adminAllDepts","department","locPosId","depPosId","posPosId","RequireGeoLocation","INITIAL_AUTHORIZED_ITEMS","businessId","employeeId","firstOrNickName","firstName","nickName","middleName","lastName","fullName","timeClock","payrollEvents","tags","lastRefresh","INITIAL_AUTHITEMS_CONTEXT","refreshAuth","force","newUser","clearAuth","authLoading","AuthorizedItemsContext","empty","authFromStore","authHelper","differenceInMinutes","UserAPI","authFromApi","AuthorizedItemsContextProvider","internalSetAuth","setLoading","newAuth","validate","Login","setUsername","setPassword","usernameErrors","passwordErrors","loginEnabled","setLoginEnabled","login","envUser","direction","catch","useIonViewWillEnter","src","alt","onChange","newUsername","target","color","newPassword","fixIsoStringForMvc","ds","EventFilterView","getScheduleEvent","scheduleEventId","getScheduleEventsByFilter","filterToSend","getDailyNotesByFilter","updateScheduleEvent","eventValues","recurrenceUpdateType","isConfirmed","employee","eventStart","eventEnd","tagId","tag","eventBreaks","breakStart","breakDuration","clockOutValue","clockoutValue","absentTime","absentTimeMinutes","notes","sendMessage","recurrenceId","recurrenceStart","recurrenceEnd","recurrenceType","repeatInterval","repeatWeekdays","createScheduleEvent","sceduleEventId","deleteScheduleEvent","updateConfirmedScheduleEvent","confirm","EventEditEnum","initialEventFilter","settingsLocId","dnLocIds","filterByEmployee","positionIds","eventTypeId","eventStatusId","view","schedule","initialStoredEventFilter","WeekChooser","setStartDate","onWeekdayClick","dateRef","useRef","onDateChanged","current","arrowBack","displayFormat","pickerFormat","toISOString","caretDown","arrowForward","thisDate","isTodayClass","isToday","style","outline","getEventEditAuthorization","eventEmployeeId","eventLocationId","eventDepartmentId","eventPositionId","eventConfirmed","retVal","buttonText","enableConfirm","isReadonly","text","usage","endOfEvent","now","afterEnd","employeeEvent","CanEditOwnClockEvents","CanEditEmployeeClockEvents","CreateCoverRequest","DeleteShiftRequest","UndoCoverRequest","Delete","CreateShiftRequest","colorMap","1","2","3","4","6","7","statusTimeColor","EventCard","event","multiLocation","showEmployeeName","onEdit","displayNameStyle","display","eventStartDate","multiDepartment","posDisplay","AbbreviatedLocationName","AbbreviatedDepartmentName","PositionName","eventTypeBorder","borderLeft","timeColor","eventEditAuth","EmployeeId","LocationId","DepartmentId","PositionId","IsConfirmed","onUserClick","time","getDurationStringFromTimeSpan","Time","EventDuration","FirstName","LastName","Tag","useOrbitalDialogBox","selection","dialogData","setDialogData","onButtonClick","showDialog","dialogOptions","dialogBoxJsx","cssClass","opt","size","DailyNoteDepartmentSelector","currentDepartment","onDepartmentUpdate","selectedDepartment","setSelectedDepartment","selectedDepartmentId","interface","newSelection","updateLocation","updateDepartment","dep","updateDailyNote","dailyNoteId","insertDailyNote","deleteDailyNote","getDailyNote","EditDailyNoteModal","onCloseModal","note","initialDate","originalNote","setOriginalNote","dialog","selectedRole","setSelectedRole","curDep","getFirstAvailableDepartment","Notes","noteText","setNoteText","noteCharCountRef","selectedDate","setSelectedDate","isMounted","fetchDailyNote","notesApi","DailyNoteId","right","left","newStart","updateBackend","isClosing","newRole","dateStr","onDateSelected","newText","onForceRefresh","noteDate","deptName","DepartmentName","showEditModal","setShowEditModal","newNoteClicked","AddDailyNoteButton","canAddNote","toastMessage","NoEventsToShow","EventListSection","forwardRef","ref","events","showEmployeeNames","dailyNotesAddButtonDate","headerRef","createRef","useImperativeHandle","scrollIntoView","behavior","block","inline","setTimeout","focus","tabIndex","DailyNoteCard","ScheduleEventId","EventList","hoursPerDay","listType","weekStart","segments","getSegmentsForRequests","locationSettings","DayWeekStartsOn","notesStart","isBefore","weekEnd","h","reduce","prev","cur","getSegmentsForMy","todayStart","totalDuration","durationString","segmentDate","getSegmentsForToday","containsKey","thisDatesNotes","getSegmentsForAll","scrollToDate","dateName","segkeys","curSeg","segmentRef","references","dayOffset","segName","segRef","seg","refLookup","thisRef","showTotalDuration","getEventTypeOptions","eventTypeOptions","unshift","ShowUnavailableEventType","ShowVacationEventType","ShowAbsentEventType","peTypes","p2l","pe","startsWith","some","p1","p2","concat","arrayHelper","areEqual","a1","a2","contains","arr","containsAny","arr1","arr2","unique","newArr","uniqueObject","filt","found","getDefaultFilter","tagIsEqual","tagId1","tagId2","filterStore","getFilter","localStorage","getItem","parse","putFilter","storedFilter","setItem","isFilterApplied","defaultFilter","clear","removeItem","ScheduleFilterModal","onCancelModal","locIds","depIds","posIds","newLocId","newDepId","getInitialSelectionsByFilter","initialLocIds","initialDepIds","initialPosIds","myFilter","setMyFilter","showCustomEventTypes","setShowCustomEventTypes","eventGroup","setEventGroup","eventTypeList","setEventTypeList","locationIds","setLocationIds","departmentIds","setDepartmentIds","setPositionIds","isDirty","setIsDirty","onEventGroupSelect","f","group","Custom","multiple","deptIds","abbr","pos","selectedPositionIds","returnedFilter","filterApplied","useIonicRefresher","doRefresh","ionRefresherRef","ionicRefresherJsx","onIonRefresh","pullingIcon","pullingText","refreshingSpinner","refreshingText","getSelectedEventTypeId","absentId","getPayrollEventIdNames","b","getEventTypes","eventTypes","showClockEventType","getEventStatuses","EventTypeStatusEditor","editorValues","update","absentHoursPlaceholderText","setAbsentHoursPlaceholderText","setLocSettings","absentTimeString","setAbsentTimeString","isFromEventInfo","eventStatuses","es","HoursMinutes","hours","TimeFormatDigits","TimeFormatDecimals","getTimeStringFromMinutes","newLocSettings","onAbsentTimeChange","test","round","parseFloat","getMinutesFromTimeString","newEventType","newAbsentMinutes","onEventTypeChange","newEventStatus","onIonBlur","EventPositionEditor","positionList","setPositionList","posIdRef","isMultiLoc","isMultiDep","createPositionList","selectedPosition","updatePosition","EventEmployeeEditor","employeeList","setEmployeeList","empIdRef","getEmployees","justEmployee","employeeAPI","employees","emp","EventStartEndEditor","minuteValues","newEventStart","newEventEnd","hasOverlap","breaks","startA","endA","startB","addMinutes","endB","AddBreakModal","onCancel","onAdd","currentBreaks","endDate","setEndDate","isRestricted","setIsRestricted","isPaid","setIsPaid","errorMessage","setErrorMessage","isValid","setIsValid","alert","close","newStartDate","onStartUpdate","newEnd","newEndDate","onEndUpdate","EventBreakEditor","breakList","setBreakList","showBreakModal","setShowBreakModal","getBreakStartEnd","IsPaidBreak","logoUsd","IsRestricted","lockClosed","showRestricted","newBreakList","onDeleteBreak","trash","borderBottom","width","EventTagEditor","selectedTagId","setSelectedTagId","tagList","setTagList","t","tagIds","onUpdateTag","RecurrenceType","EventConfirmEditor","onEmployeeUpdated","shouldShowConfirmed","shouldShowButton","checkmark","EventIsClockedInEditor","setIsClockedIn","showIsClockedIn","setShowIsClockedIn","getLocationById","getPositionById","getValidStartEnd","startStr","endStr","isEqual","getEditorValuesFromEventInformation","INITIAL_EDITOR_VAUES","EventBreaks","RecurrenceUpdateType","isClockoutValueValid","ClockOutValueLabel","isAllValid","v","validEventStartEnd","validEmployee","validTag","validEventTypeStatus","validClockoutValue","validRecurrenceStartEnd","validRepeatInterval","validRepeatWeekdays","isUpdating","valid","absentName","editorValueReducer","action","getIsClockedIn","ConfirmedBy","TagId","AbsentName","AbsentId","AbsentTimeMinutes","ClockOutValue","EventRecurrenceId","EventRecurrenceStart","EventRecurrenceEnd","RepeatType","RepeatInterval","RepeatWeekdays","clockedInOnTypeStatusUpdate","newTypeStatusState","newClockoutValueState","newStartState","newEndState","newTagState","newConfirmState","newClockedInState","newRepeatState","repeatWeekDays","Weekly","EventNotesEditor","newNote","EventClockoutValueEditor","isVisible","setIsVisible","newValue","undoCoverRequest","createCoverRequest","broadCastMessage","coverMessage","toEmployeeId","BroadcastCoverRequestMessage","CoverMessage","DirectToEmployeeId","makeShiftRequest","removeShiftRequest","recUpdateType","RecUpdateType","deleteEvent","getCoverRequestListItems","isDirectCoverList","directCoverList","EventRequestModal","onOk","setNotes","selectedEmployeeId","setSelectedEmployeeId","coverList","setCoverList","requestAPI","hidden","EnableDirectCoverRequest","cover","EventRequestEditor","cancelEditModal","showRequestModal","setShowRequestModal","onComplete","reqApi","WeekdayList","checkList","setCheckList","dayOfWeek","getDay","newCheckState","onCheckboxChecked","RecurringEventSection","isChecked","setIsChecked","calendar","textAlign","refresh","MonthlyByDayOfMonth","MonthlyByDayOfWeek","RecurrenceUpdateTypeSelector","onSelect","updateType","choice","titleText","UpdateSingleEvent","UpdateEntireSeries","UpdateSeriesForward","EditEventModal","initialEvent","useReducer","updateEditorValues","scheduleEvent","setScheduleEvent","setRecurrenceUpdateType","showRecurrenceUpdateTypeSelector","setShowRecurrenceUpdateTypeSelector","buttonClicked","setButtonClicked","isEditing","scheduleEventApi","se","fixDatesForIPhone","createOrUpdate","apiCall","skipPrompt","goDelete","onRecurrenceUpdateTypeSelect","confirmed","setUsageText","EventCardSkeleton","threeRows","padding","height","useInterval","callback","isRunning","delay","savedProps","setInterval","clearInterval","initialEvents","initialDailyNotes","eventPassesFilter","dailyNotePassesFilter","dn","pid","ClockInRequirement","SchedulePage","match","eventListRef","refresher","getScheduleEvents","startOfDay","myScheduleEvents","setMyScheduleEvents","myDailyNotes","setMyDailyNotes","myFilteredScheduleEvents","setMyFilteredScheduleEvents","myFilteredDailyNotes","setMyFilteredDailyNotes","myTotalTime","setMyTotalTime","requestScheduleEvents","setRequestScheduleEvents","requestDailyNotes","setRequestDailyNotes","requestFilteredScheduleEvents","setRequestFilteredScheduleEvents","requestFilteredDailyNotes","setRequestFilteredDailyNotes","requestHoursPerDay","setRequestHoursPerDay","allScheduleEvents","setAllScheduleEvents","allDailyNotes","setAllDailyNotes","allFilteredScheduleEvents","setAllFilteredScheduleEvents","allFilteredDailyNotes","setAllFilteredDailyNotes","allHoursPerDay","setAllHoursPerDay","isShowing","setIsShowing","segment","setSegment","showFilterModal","setShowFilterModal","showEventModal","setShowEventModal","editEventId","setEditEventId","initialEditEvent","setInitialEditEvent","setEventEditAuth","setFilter","useIonViewWillLeave","params","onEventClick","useCallback","newEventEditAuth","apiFilter","ScheduleEventsAPI","complete","mySE","getMyScheduleEvents","dailyNotes","filteredDailyNotes","totalTimeForEmployee","requestSE","allSE","getAllScheduleEvents","onSegmentChange","segmentName","hasPositionFound","k","getEventNewAuthorization","funnel","newFilter","marginTop","onEventUpdated","StartBreakResponseCode","EndBreakResponseCode","BreakSelectionModal","tcData","cancelOption","breakType","UnscheduledUnpaid","ClockedInScheduleEvent","ScheduleEventsForClockIn","Both","UnscheduledPaid","Paid","Unpaid","getTimeClockSettings","lat","lng","clockIn","clockOut","clockoutDataModel","TimeClockBreak","switchPositionOrTag","startBreak","clockEvent","shiftEvent","breakStartOptions","clockEventId","shiftEventId","shiftBreakStart","endBreak","getGeoLocations","ClockoutModal","setClockoutValue","autoCorrect","clearInput","SwitchPositionOrTagButton","selectedPosId","onSwitch","setDisabled","hiddenJsx","UserClockedIn","curPosId","curTagId","ClockInWithDifferentTag","EnablePositionChangeForEmployeePosition","calculateNearestLocationMessage","google","maps","geometry","spherical","computeDistanceBetween","userPos","LatLng","closestLocation","minDistance","locPos","distance","proximity","locationName","miles","EPSILON","validPos","coords","Map","mapEle","userCircle","geoLocations","setGeoLocations","showMap","setShowMap","center","zoom","disableDefaultUI","fullscreenControl","Circle","strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","radius","timeclockApi","clockLocations","forEach","markerData","infoWindow","InfoWindow","content","addr","marker","Marker","open","addMarkers","addListenerOnce","classList","setCenter","setMap","arrowDownCircle","arrowUpCircle","useYesOrCancelDialogBox","onYes","dialogJsx","handler","geoPositionOptions","enableHighAccuracy","maximumAge","GeoLocationComponent","updateCallback","watchPositionId","setWatchPositionId","currentPosition","setCurrentPosition","yesCancelDlg","watchId","watchPositionCallBack","positionChanged","loaded","isGoogleMapsLoaded","oldPos","newPos","errCallback","Capacitor","isPluginAvailable","Geolocation","watchPosition","getCurrentPosition","navigator","geolocation","startWatchPosition","clearWatch","ClockPanel","onUpdate","refreshToggle","posList","setPosList","setSelectedPosId","positionRef","tagSwitchingEnabled","setTagSwitchingEnabled","tagRef","breakSetting","setBreakSetting","showBreakSelectorModal","setShowBreakSelectorModal","loadingMessage","setLoadingMessage","show","showAlertData","setShowAlertData","setTCData","showClockoutModal","setShowClockoutModal","setRefresh","setLat","setLng","updateTimeClockData","ShowTimeClock","plist","uniqueLocationIds","PositionsToClockInto","uniqueDeptIds","PositionNameWithLocAndDeptAbbreviation","PositionNameWithDeptAbbreviation","curLocId","EnableEnhancedBreakManagement","CurrentEventBreak","setTags","curLat","curLng","timeClockApi","currentPositionId","TagsPerPosition","TagName","clockout","ClockOutResponseCode","ClockOutEvent","Message","newLat","newLng","newVal","UserMayClockOut","UserMayClockIn","MatchingShift","AllowedToSwitchPositions","AllowedToSwitchTags","ClockInMessage","ClockOutMessage","ClockInResponseCode","ClockInEvent","Success","cafe","BreakSelectorModal","PayrollPeriodChooser","onNextPayPeriod","onPrevPayPeriod","payPeriodDateText","getPayPeriodDateForEmployee","getHoursString","locsettings","ActualTime","dayHourTok","ActualHours","getTimeStringFromOrbitalTime","PayrollOrbitalTimeItem","fontColor","displayColor","PayrollDetailModal","onClose","regular","dailyOvertime","weeklyOvertime","special","timePerAbsent","hpa","getAbsentName","ColumnEnum","PayrollDetailRow","payrollRow","colsToDisplay","colSize","showDetailModal","setShowDetailModal","Regular","DailyOvertime","WeeklyOvertime","Special","absent","PayrollDetailList","payrollData","setColsToDisplay","setColSize","cols","count","totalDailyOvertime","totalWeeklyOvertime","totalSpecial","totalAbsent","getColumnsToDisplay","x","row","totalRegular","PayrollPeriodsTab","currentDate","setCurrentDate","setPayrollData","getData","PayrollPeriodAPI","ClockTodayTab","scheduleEvents","setScheduleEvents","setDailyNotes","setHoursPerDay","isLoading","setIsLoading","addHours","clock","createTodayFilter","ClockPage","setRefreshToggle","refreshTimeClockToggle","setRefreshTimeClockToggle","MessageItem","onMessageClick","fontWeightForSubject","isViewed","fontWeight","isPinned","bookmark","subject","differenceInDays","isSameYear","messageDateString","deliveryDateTime","previewLine","MessagesFilterModal","filterData","msgTypeIds","msgTypes","mt","messageTypeId","filterResult","setFilterResult","description","messageTypes","typeName","getUserMessage","msgId","getUserMessages","getReadCount","setIsPinned","setIsViewed","deleteMessage","getUnreadCount","empIds","MessagesContext","unreadMessagesCount","unreadMessageCountWhenViewed","refreshCount","messagesViewed","hasNewMessages","putCountIntoStorage","cnt","MessagesContextProvider","messagesState","internalSetMessagesState","messagesApi","newUnreadCount","newUnreadMessageCountWhenViewed","fromStorageCount","getCountFromStorage","newViewCount","ViewMessagetModal","updateMessages","readCount","setReadCount","usageText","pinned","setPinned","scheduleEventAPI","messageAPI","newReadCount","newPinValue","onPinnedClick","fromEmployeeFirstName","fromEmployeeLastName","dangerouslySetInnerHTML","__html","messageText","setPositionForLocation","PositionSelector","sel","onPositionUpdate","setSelectedPosition","setPositionForDepartment","isAdminAtLocation","setPositionForPosition","emailIcon","textIcon","phonePortrait","pushIcon","isEmployeeEnabled","hasEmail","hasText","hasPush","EmployeeSelectorModal","selectedEmployeeList","setList","isAllChecked","setIsAllChecked","empId","checkCount","allCheckCount","onEmployeeChecked","messageChannels","EmployeesSelector","getFirstAvailablePosition","selectedChannel","setSelectedChannel","selectedEmployees","setSelectedEmployees","showEmployeeModal","setShowEmployeeModal","fetchEmployees","finally","selList","posEx","newChannelId","newEmployeeList","CreateMessageModal","setMessageText","employeeIds","setEmployeeIds","setLocationId","setChannel","sendingMessage","newEmpList","newChannel","autoGrow","messageApi","initialMessages","messagesReducer","m","MessagesPage","useIonViewDidEnter","useIonViewDidLeave","refreshMessages","isLoadingMessages","setIsLoadingMessages","messages","filteredMessages","setFilteredMessages","setFilterData","viewMessage","setViewMessage","showCreateMessage","setShowCreateMessage","filterMessages","msgs","fromEmployeeId","y","String","margin","updatedFilter","MessagesTabButton","chatbubblesOutline","MainTabs","exact","path","to","render","routeProps","tab","href","calendarOutline","timeOutline","AuthGate","Logout","SplashComponent","showBackdrop","MyApp","authGate","ScreenOrientation","lock","ORIENTATIONS","PORTRAIT","vers","App","ReactDOM","document","getElementById"],"mappings":"6JAAA,IAAIA,EAAM,CACT,kCAAmC,CAClC,IACA,IAED,iCAAkC,CACjC,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,8BAA+B,CAC9B,IACA,GAED,6BAA8B,CAC7B,IACA,GAED,iCAAkC,CACjC,IACA,IAED,gCAAiC,CAChC,IACA,IAED,8BAA+B,CAC9B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,8BAA+B,CAC9B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,8BAA+B,CAC9B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,gCAAiC,CAChC,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,qBAAsB,CACrB,IACA,IAED,uCAAwC,CACvC,IACA,IAED,sCAAuC,CACtC,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,mCAAoC,CACnC,IACA,IAED,kCAAmC,CAClC,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,kCAAmC,CAClC,IACA,IAED,iCAAkC,CACjC,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,iCAAkC,CACjC,IACA,IAED,gCAAiC,CAChC,IACA,IAED,+BAAg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","file":"static/js/main.3c3ff42e.chunk.js","sourcesContent":["var map = {\n\t\"./ion-action-sheet-ios.entry.js\": [\n\t\t135,\n\t\t67\n\t],\n\t\"./ion-action-sheet-md.entry.js\": [\n\t\t136,\n\t\t68\n\t],\n\t\"./ion-alert-ios.entry.js\": [\n\t\t137,\n\t\t59\n\t],\n\t\"./ion-alert-md.entry.js\": [\n\t\t138,\n\t\t60\n\t],\n\t\"./ion-app_8-ios.entry.js\": [\n\t\t139,\n\t\t53\n\t],\n\t\"./ion-app_8-md.entry.js\": [\n\t\t140,\n\t\t54\n\t],\n\t\"./ion-avatar_3-ios.entry.js\": [\n\t\t141,\n\t\t8\n\t],\n\t\"./ion-avatar_3-md.entry.js\": [\n\t\t142,\n\t\t9\n\t],\n\t\"./ion-back-button-ios.entry.js\": [\n\t\t143,\n\t\t10\n\t],\n\t\"./ion-back-button-md.entry.js\": [\n\t\t144,\n\t\t11\n\t],\n\t\"./ion-backdrop-ios.entry.js\": [\n\t\t145,\n\t\t12\n\t],\n\t\"./ion-backdrop-md.entry.js\": [\n\t\t146,\n\t\t13\n\t],\n\t\"./ion-button_2-ios.entry.js\": [\n\t\t147,\n\t\t69\n\t],\n\t\"./ion-button_2-md.entry.js\": [\n\t\t148,\n\t\t70\n\t],\n\t\"./ion-card_5-ios.entry.js\": [\n\t\t149,\n\t\t14\n\t],\n\t\"./ion-card_5-md.entry.js\": [\n\t\t150,\n\t\t15\n\t],\n\t\"./ion-checkbox-ios.entry.js\": [\n\t\t151,\n\t\t16\n\t],\n\t\"./ion-checkbox-md.entry.js\": [\n\t\t152,\n\t\t17\n\t],\n\t\"./ion-chip-ios.entry.js\": [\n\t\t153,\n\t\t18\n\t],\n\t\"./ion-chip-md.entry.js\": [\n\t\t154,\n\t\t19\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t155,\n\t\t20\n\t],\n\t\"./ion-datetime_3-ios.entry.js\": [\n\t\t156,\n\t\t57\n\t],\n\t\"./ion-datetime_3-md.entry.js\": [\n\t\t157,\n\t\t58\n\t],\n\t\"./ion-fab_3-ios.entry.js\": [\n\t\t158,\n\t\t21\n\t],\n\t\"./ion-fab_3-md.entry.js\": [\n\t\t159,\n\t\t22\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t160,\n\t\t23\n\t],\n\t\"./ion-infinite-scroll_2-ios.entry.js\": [\n\t\t161,\n\t\t24\n\t],\n\t\"./ion-infinite-scroll_2-md.entry.js\": [\n\t\t162,\n\t\t25\n\t],\n\t\"./ion-input-ios.entry.js\": [\n\t\t163,\n\t\t26\n\t],\n\t\"./ion-input-md.entry.js\": [\n\t\t164,\n\t\t27\n\t],\n\t\"./ion-item-option_3-ios.entry.js\": [\n\t\t165,\n\t\t71\n\t],\n\t\"./ion-item-option_3-md.entry.js\": [\n\t\t166,\n\t\t72\n\t],\n\t\"./ion-item_8-ios.entry.js\": [\n\t\t167,\n\t\t73\n\t],\n\t\"./ion-item_8-md.entry.js\": [\n\t\t168,\n\t\t74\n\t],\n\t\"./ion-loading-ios.entry.js\": [\n\t\t169,\n\t\t28\n\t],\n\t\"./ion-loading-md.entry.js\": [\n\t\t170,\n\t\t29\n\t],\n\t\"./ion-menu_3-ios.entry.js\": [\n\t\t171,\n\t\t75\n\t],\n\t\"./ion-menu_3-md.entry.js\": [\n\t\t172,\n\t\t76\n\t],\n\t\"./ion-modal-ios.entry.js\": [\n\t\t173,\n\t\t55\n\t],\n\t\"./ion-modal-md.entry.js\": [\n\t\t174,\n\t\t56\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t175,\n\t\t66\n\t],\n\t\"./ion-popover-ios.entry.js\": [\n\t\t176,\n\t\t30\n\t],\n\t\"./ion-popover-md.entry.js\": [\n\t\t177,\n\t\t31\n\t],\n\t\"./ion-progress-bar-ios.entry.js\": [\n\t\t178,\n\t\t32\n\t],\n\t\"./ion-progress-bar-md.entry.js\": [\n\t\t179,\n\t\t33\n\t],\n\t\"./ion-radio_2-ios.entry.js\": [\n\t\t180,\n\t\t34\n\t],\n\t\"./ion-radio_2-md.entry.js\": [\n\t\t181,\n\t\t35\n\t],\n\t\"./ion-range-ios.entry.js\": [\n\t\t182,\n\t\t77\n\t],\n\t\"./ion-range-md.entry.js\": [\n\t\t183,\n\t\t78\n\t],\n\t\"./ion-refresher_2-ios.entry.js\": [\n\t\t184,\n\t\t61\n\t],\n\t\"./ion-refresher_2-md.entry.js\": [\n\t\t185,\n\t\t62\n\t],\n\t\"./ion-reorder_2-ios.entry.js\": [\n\t\t186,\n\t\t36\n\t],\n\t\"./ion-reorder_2-md.entry.js\": [\n\t\t187,\n\t\t37\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t188,\n\t\t38\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t189,\n\t\t79\n\t],\n\t\"./ion-searchbar-ios.entry.js\": [\n\t\t190,\n\t\t80\n\t],\n\t\"./ion-searchbar-md.entry.js\": [\n\t\t191,\n\t\t81\n\t],\n\t\"./ion-segment_2-ios.entry.js\": [\n\t\t192,\n\t\t82\n\t],\n\t\"./ion-segment_2-md.entry.js\": [\n\t\t193,\n\t\t83\n\t],\n\t\"./ion-select_3-ios.entry.js\": [\n\t\t194,\n\t\t84\n\t],\n\t\"./ion-select_3-md.entry.js\": [\n\t\t195,\n\t\t85\n\t],\n\t\"./ion-slide_2-ios.entry.js\": [\n\t\t196,\n\t\t86\n\t],\n\t\"./ion-slide_2-md.entry.js\": [\n\t\t197,\n\t\t87\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t198,\n\t\t39\n\t],\n\t\"./ion-split-pane-ios.entry.js\": [\n\t\t199,\n\t\t40\n\t],\n\t\"./ion-split-pane-md.entry.js\": [\n\t\t200,\n\t\t41\n\t],\n\t\"./ion-tab-bar_2-ios.entry.js\": [\n\t\t201,\n\t\t42\n\t],\n\t\"./ion-tab-bar_2-md.entry.js\": [\n\t\t202,\n\t\t43\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t203,\n\t\t44\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t204,\n\t\t45\n\t],\n\t\"./ion-textarea-ios.entry.js\": [\n\t\t205,\n\t\t46\n\t],\n\t\"./ion-textarea-md.entry.js\": [\n\t\t206,\n\t\t47\n\t],\n\t\"./ion-toast-ios.entry.js\": [\n\t\t207,\n\t\t63\n\t],\n\t\"./ion-toast-md.entry.js\": [\n\t\t208,\n\t\t64\n\t],\n\t\"./ion-toggle-ios.entry.js\": [\n\t\t209,\n\t\t48\n\t],\n\t\"./ion-toggle-md.entry.js\": [\n\t\t210,\n\t\t49\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t211,\n\t\t50\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 110;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./ion-icon.entry.js\": [\n\t\t215,\n\t\t90\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 112;\nmodule.exports = webpackAsyncContext;","import { ClockInRequirement } from \"../enums/ClockInRequirement\";\r\nimport { EventInformation } from \"./TEC\";\r\nimport { DailyNotes } from \"./DailyNotes\";\r\n\r\nexport interface HomePageDataGet {\r\n  auth: AuthorizedItems;\r\n  currentEvents: EventInformation[];\r\n  nextEvent?: EventInformation;\r\n  dailyNotes: DailyNotes[];\r\n}\r\n\r\nexport enum Role {\r\n  Employee = \"Employee\",\r\n  Admin = \"Admin\",\r\n  LocationAdmin = \"Location Admin\",\r\n  BusinessAdmin = \"Business Admin\",\r\n  Orbital = \"Orbital\",\r\n}\r\n\r\nexport enum SubscriptionType {\r\n  None = -1,\r\n  Standard = 0,\r\n  Premium = 1,\r\n  Enterprise = 2,\r\n}\r\n\r\nexport function getSubscriptionTypeName(subscripionType: SubscriptionType): string {\r\n  switch (subscripionType) {\r\n    case SubscriptionType.None:\r\n      return \"None\";\r\n    case SubscriptionType.Standard:\r\n      return \"Standard\";\r\n    case SubscriptionType.Premium:\r\n      return \"Premium\";\r\n    case SubscriptionType.Enterprise:\r\n      return \"Enterprise\";\r\n    default:\r\n      return \"Unknown\";\r\n  }\r\n}\r\n\r\n\r\nexport const initialHomePageData: HomePageDataGet = {\r\n  auth: {\r\n    businessId: 0,\r\n    businessName: \"\",\r\n    subscriptionType: SubscriptionType.None,\r\n    locations: [],\r\n    tags: [],\r\n    payrollEvents: [],\r\n    employeeId: 0,\r\n    firstOrNickName: \"\",\r\n    firstName:  \"\",\r\n    nickName: \"\",\r\n    middleName: \"\",\r\n    lastName: \"\",\r\n    fullName: \"\",\r\n    timeClock: false,\r\n    loading: false,\r\n    role: Role.Employee,\r\n    lastRefresh: undefined,\r\n  },\r\n  currentEvents: [],\r\n  nextEvent: undefined,\r\n  dailyNotes: [],\r\n};\r\n\r\nexport enum TimeFormat {\r\n  HoursMinutes = 0, // 05:59\r\n  HoursAndDecimals = 1, // 5.99\r\n}\r\n\r\nexport enum ClockOutValueType {\r\n  Unit = 1,\r\n  Money = 2,\r\n}\r\n\r\nexport enum AdminAuthorization {\r\n  None = 0,\r\n  CanViewWages = 1,\r\n  CanEditPublishedTo = 2,\r\n  CanEditTemplates = 4,\r\n  CanEditSchedules = 8,\r\n  CanEditEmployeeClockEvents = 16,\r\n  CanEditOwnClockEvents = 32,\r\n  CanEditUserAccounts = 64,\r\n}\r\n\r\nexport interface AuthorizedItems {\r\n  subscriptionType: SubscriptionType;\r\n  businessId: number;\r\n  businessName: string;\r\n  employeeId: number;\r\n  firstOrNickName: string;\r\n  firstName: string;\r\n  nickName: string;\r\n  middleName: string;\r\n  lastName: string;\r\n  fullName: string;\r\n  timeClock: boolean;\r\n  role: Role;\r\n  loading: boolean;\r\n  locations: AuthorizedLocation[];\r\n  tags: AuthorizedTag[];\r\n  payrollEvents: AuthorizedPayrollEvent[];\r\n  lastRefresh: Date | undefined;\r\n}\r\n\r\nexport interface AuthorizedLocation {\r\n  id: number;\r\n  name: string;\r\n  abbr: string;\r\n  adminAllDepts: boolean;\r\n  departments: AuthorizedDepartment[];\r\n  settings: LocationSettings;\r\n}\r\n\r\nexport interface AuthorizedDepartment {\r\n  id: number;\r\n  name: string;\r\n  abbr: string;\r\n  isDeptAdmin: boolean;\r\n  adminAuth: AdminAuthorization;\r\n  positions: AuthorizedPosition[];\r\n}\r\n\r\nexport interface AuthorizedTag {\r\n  id: number;\r\n  name: string;\r\n  locId: number;\r\n  positionIds: number[];\r\n}\r\n\r\nexport interface AuthorizedPosition {\r\n  id: number;\r\n  name: string;\r\n  hasPosition: boolean;\r\n  tagsIds: number[];\r\n  payrollEventIds: number[];\r\n}\r\n\r\nexport interface AuthorizedPayrollEvent {\r\n  id: number;\r\n  name: string;\r\n  positionIds: number[];\r\n}\r\n\r\nexport enum UnscheduledBreakOptions {\r\n  Both = 0,\r\n  Unpaid = 1,\r\n  Paid = 2,\r\n  None = 3,\r\n}\r\n\r\nexport enum BreakType {\r\n  UnscheduledUnpaid = 0,\r\n  UnscheduledPaid = 1,\r\n  Scheduled = 2,\r\n}\r\n\r\nexport enum EmployeeSort {\r\n  FirstName = 1,\r\n  LastName = 2,\r\n  EmploymentStart = 3,\r\n  EarliestEventStart = 4,\r\n}\r\n\r\nexport interface LocationSettings {\r\n  LocationId: number;\r\n  DayStartTime: any;\r\n  DayWeekStartsOn: string;\r\n  EmployeeRequestWindowStart: number;\r\n  EmployeeRequestWindowEnd: number;\r\n  EmployeeDaysToShowSchedule: number;\r\n  RequestPanelDisplayDays: number;\r\n  EmployeesShowShiftEventType: boolean;\r\n  ShowUnavailableEventType: boolean;\r\n  ShowVacationEventType: boolean;\r\n  ShowAbsentEventType: boolean;\r\n  ShowSpecialDates: boolean;\r\n  AllowEmployeesToDeleteUnavailableAndVacationApproved: boolean;\r\n  EmployeesOnlyViewOwnPositions: boolean;\r\n  EmployeesOnlyViewOwnDepartments: boolean;\r\n  EnableLegacyBreak: boolean;\r\n  EnableLegacyBreakStart: boolean;\r\n  DefaultBreakDuration: any;\r\n  DefaultBreakStartTime: any;\r\n  ShowTimeClockBreak: boolean;\r\n  EnableEnhancedBreakManagement: boolean;\r\n  TimeZoneOffset: number;\r\n  OtherEmployeesViewableTypeAndStatus: any;\r\n  NotesPanel: number;\r\n  ClockOutValueLabel: string;\r\n  ClockOutValueType: ClockOutValueType;\r\n  EnableEventConfirm: boolean;\r\n  TimeFormat: TimeFormat;\r\n  TimeFormatDigits: number;\r\n  TimeFormatDecimals: number;\r\n  LockDate: any;\r\n  HideScheduleEventsInPast: boolean;\r\n  NewEventDefaultStartTime: any;\r\n  NewEventDefaultEndTime: any;\r\n  EnableAutoAdjustingDateTimes: any;\r\n  GenericEmployeeIdName: string;\r\n  GenericEmployeeId2Name: string;\r\n  GenericEmployeeId3Name: string;\r\n  GenericEmployeePerPositionIdName: string;\r\n  GenericEmployeePerPositionId2Name: string;\r\n  GenericEmployeePerPositionId3Name: string;\r\n  GenericPositionIdName: string;\r\n  GenericPositionId2Name: string;\r\n  GenericPositionId3Name: string;\r\n  GenericDepartmentIdName: string;\r\n  GenericDepartmentId2Name: string;\r\n  GenericDepartmentId3Name: string;\r\n  GenericLocationIdName: string;\r\n  GenericLocationId2Name: string;\r\n  GenericLocationId3Name: string;\r\n  CalculatedSchedulePublishedTo: any;\r\n  RequireGeoLocation: boolean;\r\n  RequireIPAddress: boolean;\r\n  EnablePTO: boolean;\r\n  ClockInWithDifferentTag: boolean;\r\n  UnscheduledBreakOptions: UnscheduledBreakOptions;\r\n  ClockInRequirement: ClockInRequirement;\r\n  EmployeeSort: EmployeeSort;\r\n  EnableDirectCoverRequest: boolean;\r\n  EnablePositionChangeForEmployeePosition: boolean;\r\n}\r\n","import { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport { AuthorizedItems } from \"../orbital-interfaces/authorized-items\";\r\nimport { openDB, DBSchema, IDBPDatabase } from \"idb\";\r\n\r\nconst DB_NAME = \"osKeyStore\";\r\nconst DB_VERSION = 1;\r\n\r\ninterface OSKeyStore extends DBSchema {\r\n  userStore: {\r\n    key: \"user\";\r\n    value: ApplicationUser;\r\n  };\r\n  authItems: {\r\n    key: \"authItems\";\r\n    value: AuthorizedItems;\r\n  };\r\n}\r\n\r\n// -----------------------------------------------------------------------------------------\r\nconst getKeyStore = (): Promise<IDBPDatabase<OSKeyStore>> => {\r\n  return openDB<OSKeyStore>(DB_NAME, DB_VERSION, {\r\n    upgrade(db) {\r\n      db.createObjectStore(\"userStore\");\r\n      db.createObjectStore(\"authItems\");\r\n    },\r\n  });\r\n};\r\n\r\n// -----------------------------------------------------------------------------------------\r\nconst putUserState = async (state: ApplicationUser) => {\r\n  const db = await getKeyStore();\r\n  await db.put(\"userStore\", state, \"user\");\r\n};\r\n\r\n// -----------------------------------------------------------------------------------------\r\nconst getUserState = async (): Promise<ApplicationUser | undefined> => {\r\n  const db = await getKeyStore();\r\n  return await db.get(\"userStore\", \"user\");\r\n};\r\n\r\n// -----------------------------------------------------------------------------------------\r\nconst getAccessToken = async (): Promise<string | undefined> => {\r\n  const db = await getKeyStore();\r\n  return await db.get(\"userStore\", \"user\").then((state) => {\r\n    return state ? state.access_token : undefined;\r\n  });\r\n};\r\n\r\n// -----------------------------------------------------------------------------------------\r\nconst putAuthItems = async (auth: AuthorizedItems) => {\r\n  const db = await getKeyStore();\r\n  await db.put(\"authItems\", auth, \"authItems\");\r\n};\r\n\r\nconst getAuthItems = async () => {\r\n  const db = await getKeyStore();\r\n  const authItems = await db.get(\"authItems\", \"authItems\");\r\n  return authItems;\r\n};\r\n\r\nexport default {\r\n  getKeyStore,\r\n  putUserState,\r\n  getUserState,\r\n  getAccessToken,\r\n  putAuthItems,\r\n  getAuthItems,\r\n};\r\n","export interface IKeyedCollection<T> {\r\n  add(key: string, value: T): void;\r\n  containsKey(key: string): boolean;\r\n  count(): number;\r\n  item(key: string): T;\r\n  keys(): string[];\r\n  remove(key: string): T;\r\n  values(): T[];\r\n}\r\n\r\nexport class KeyedCollection<T> implements IKeyedCollection<T> {\r\n  private items: { [index: string]: T } = {};\r\n\r\n  private _count: number = 0;\r\n\r\n  public containsKey(key: string): boolean {\r\n    return this.items.hasOwnProperty(key);\r\n  }\r\n\r\n  public count(): number {\r\n    return this._count;\r\n  }\r\n\r\n  public add(key: string, value: T) {\r\n    if (!this.items.hasOwnProperty(key)) this._count++;\r\n\r\n    this.items[key] = value;\r\n  }\r\n\r\n  public remove(key: string): T {\r\n    const val = this.items[key];\r\n    delete this.items[key];\r\n    this._count--;\r\n    return val;\r\n  }\r\n\r\n  public item(key: string): T {\r\n    return this.items[key];\r\n  }\r\n\r\n  public keys(): string[] {\r\n    const keySet: string[] = [];\r\n\r\n    for (const prop in this.items) {\r\n      if (this.items.hasOwnProperty(prop)) {\r\n        keySet.push(prop);\r\n      }\r\n    }\r\n\r\n    return keySet;\r\n  }\r\n\r\n  public values(): T[] {\r\n    const values: T[] = [];\r\n\r\n    for (const prop in this.items) {\r\n      if (this.items.hasOwnProperty(prop)) {\r\n        values.push(this.items[prop]);\r\n      }\r\n    }\r\n\r\n    return values;\r\n  }\r\n}\r\n","import { KeyedCollection } from \"../util/KeyedCollection\";\r\nimport { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport { isPlatform } from \"@ionic/react\";\r\n\r\nexport interface Constants {\r\n  checkUnreadMessageCountTimer: number;\r\n  refreshScheduleTimer: number;\r\n  refreshTimeclockSettingsTimer: number;\r\n  maxStaleAuthItemsInMinutes: number;\r\n  minimumFeetForGeolocationUpdate: number\r\n}\r\n\r\nexport interface EnvironmentType {\r\n  constants: Constants;\r\n  key: string;\r\n  name: string;\r\n  url: string;\r\n}\r\n\r\nconst defaults: EnvironmentType = {\r\n  constants: {\r\n    checkUnreadMessageCountTimer: 30 * 1000, // how often to get just the unread messages\r\n    refreshScheduleTimer: 60 * 1000, // how often to refresh events on Schedule/Clock Page\r\n    refreshTimeclockSettingsTimer: 15 * 1000, // how often to get timclock settings on clock panel\r\n    maxStaleAuthItemsInMinutes: 15, // minutes before we force auth items to refresh from api\r\n    minimumFeetForGeolocationUpdate: 15.0, // how many feet before we consider it a position update\r\n  },\r\n\r\n  key: \"prod\",\r\n  name: \"\",\r\n  url: \"\",\r\n};\r\n\r\nconst envTypes: EnvironmentType[] = [\r\n  {\r\n    ...defaults,\r\n    key: \"prod\",\r\n    name: \"Production\",\r\n    url: \"https://api.orbitalshift.com/\",\r\n  },\r\n  {\r\n    ...defaults,\r\n    key: \"sbx\",\r\n    name: \"Sandbox\",\r\n    url: \"https://sandboxapi.orbitalshift.com/\",\r\n  },\r\n  { ...defaults, key: \"loc\", name: \"Local\", url: \"http://localhost:54825/\" },\r\n  {\r\n    ...defaults,\r\n    key: \"emu\",\r\n    name: \"Local (Emu)\",\r\n    url: \"http://10.0.2.2:54825/\",\r\n  },\r\n  {\r\n    ...defaults,\r\n    key: \"tst\",\r\n    name: \"TestServer\",\r\n    url: \"http://TestServer:8000/\",\r\n  },\r\n];\r\n\r\nconst environments = new KeyedCollection<EnvironmentType>();\r\nenvTypes.map((et) => environments.add(et.key, et));\r\n\r\n// ------------------------------------------------------------------------------------------------\r\n// NOTE: versionName, versionCode, and revisionHash should be set to _REPLACE_XXXXX_XXX_ strings\r\n//       that get replaced when 'build' is run from the command line.\r\n//       See OSROOT/_buildenv/BuildModule/CommandLineFunctions.psm1\r\nconst settings = {\r\n  env: environments,\r\n  versionName: \"2.0.0\",\r\n  versionCode: \"6141\",\r\n  revisionHash: \"271dfc3\",\r\n  buildDate: \"Fri 05/15/2020 11:39A\",\r\n  // eslint-disable-next-line max-len\r\n  appVersionString: `2.0.0.6141 (271dfc3)`,\r\n  hasCapacitor: isPlatform(\"capacitor\"),\r\n  platform: isPlatform(\"ios\")\r\n    ? \"ios\"\r\n    : isPlatform(\"android\")\r\n    ? \"android\"\r\n    : \"other\",\r\n};\r\n\r\n// ------------------------------------------------------------------------------------------------\r\nconst getApiUrl = (user: ApplicationUser, endpoint: string): string => {\r\n  return settings.env.item(user.environment).url + endpoint;\r\n};\r\n\r\n// ------------------------------------------------------------------------------------------------\r\nconst getUserAndEnvironmentFromInput = (\r\n  input: string\r\n): { username: string; env: EnvironmentType } => {\r\n  if (input.length < 4) {\r\n    return { username: input, env: settings.env.item(\"prod\") };\r\n  }\r\n\r\n  const envKey = input.toLowerCase().substring(0, 4);\r\n  const username = input.substring(4);\r\n  switch (envKey) {\r\n    case \"sbx \":\r\n      return { username, env: settings.env.item(\"sbx\") };\r\n    case \"loc \":\r\n      return { username, env: settings.env.item(\"loc\") };\r\n    case \"emu \":\r\n      return { username, env: settings.env.item(\"emu\") };\r\n    case \"tst \":\r\n      return { username, env: settings.env.item(\"tst\") };\r\n    default:\r\n      return { username: input, env: settings.env.item(\"prod\") };\r\n  }\r\n};\r\n\r\n// ------------------------------------------------------------------------------------------------\r\nexport const getConstants = (user: ApplicationUser): Constants => {\r\n  if (!user.isLoggedin) {\r\n    return defaults.constants;\r\n  }\r\n\r\n  return settings.env.item(user.environment).constants;\r\n};\r\n\r\nexport default {\r\n  settings,\r\n  getApiUrl,\r\n  getUserAndEnvironmentFromInput,\r\n};\r\n","import * as firebase from \"firebase/app\";\r\nimport \"firebase/analytics\";\r\nimport {ApplicationUser} from \"../context/ApplicationUserContext\";\r\nimport {AuthorizedItems, getSubscriptionTypeName} from \"../orbital-interfaces/authorized-items\";\r\nimport env from \"../api/environment\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyAS526InuG-53VGKi5SA780Mh0YwHkhMDE\",\r\n  authDomain: \"orbital-shift-team-dashboard.firebaseapp.com\",\r\n  databaseURL: \"https://orbital-shift-team-dashboard.firebaseio.com\",\r\n  projectId: \"orbital-shift-team-dashboard\",\r\n  storageBucket: \"orbital-shift-team-dashboard.appspot.com\",\r\n  messagingSenderId: \"475985033328\",\r\n  appId: \"1:475985033328:web:77740655a89e28de035cb5\",\r\n  measurementId: \"G-TGE8788D28\",\r\n};\r\n\r\n// ------------------------------------------------------------------------------------------------\r\nexport function initialize() {\r\n  console.log(\"firebase initialized\");\r\n  firebase.initializeApp(firebaseConfig);\r\n}\r\n\r\n// ------------------------------------------------------------------------------------------------\r\nexport function log(eventName: string, eventParams?: any) {\r\n  firebase.analytics().logEvent(eventName, eventParams);\r\n}\r\n\r\n// ------------------------------------------------------------------------------------------------\r\nexport function setFirebaseUserProperties(user: ApplicationUser, auth: AuthorizedItems) {\r\n  if (user.isLoggedin) {\r\n    const environment = env.settings.env.item(user.environment);\r\n    if (user.username !== undefined) {\r\n      firebase.analytics().setUserId(user.username);\r\n    }\r\n\r\n    firebase.analytics().setUserProperties({\r\n      userRole: auth.role,\r\n      subscriptionType: getSubscriptionTypeName(auth.subscriptionType),\r\n      businessName: auth.businessName,\r\n      userName: user.username,\r\n      version: env.settings.appVersionString,\r\n      environment: environment.name\r\n    });\r\n  }\r\n}\r\n","import { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport env from \"./environment\";\r\nimport { log } from \"../util/logger\";\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst post = async (user: ApplicationUser, baseUrl: string, data?: any) => {\r\n  const url = env.getApiUrl(user, baseUrl);\r\n  console.log(\"API: \" + baseUrl);\r\n\r\n  try {\r\n    const response = await fetch(url, {\r\n      method: \"POST\",\r\n      body: JSON.stringify(data),\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${user.access_token}`,\r\n        AppVersion: env.settings.appVersionString,\r\n      },\r\n    });\r\n\r\n    const contentType = response.headers.get(\"content-type\");\r\n    if (contentType && contentType.indexOf(\"application/json\") !== -1) {\r\n      const results = await response.json();\r\n      log(\"api_succeeded\", {\r\n        method: \"POST\",\r\n        baseUrl,\r\n        username: user.username,\r\n      });\r\n      return results;\r\n    }\r\n\r\n    log(\"api_succeeded\", { method: \"POST\", baseUrl, username: user.username });\r\n  } catch (err) {\r\n    log(\"api_err\", {\r\n      method: \"POST\",\r\n      baseUrl,\r\n      username: user?.username,\r\n      ...data,\r\n      appVersion: env.settings.appVersionString,\r\n    });\r\n    console.error(\"Error calling post against url, \" + baseUrl + \": \" + err);\r\n    throw err;\r\n  }\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst putData = async (user: ApplicationUser, baseUrl: string, data: any) => {\r\n  const url = env.getApiUrl(user, baseUrl);\r\n  console.log(\"API: \" + baseUrl);\r\n\r\n  try {\r\n    const dataString = JSON.stringify(data);\r\n\r\n    const response = await fetch(url, {\r\n      method: \"PUT\",\r\n      body: dataString,\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${user.access_token}`,\r\n        AppVersion: env.settings.appVersionString,\r\n      },\r\n    });\r\n\r\n    const results = await response.json();\r\n    log(\"api_succeeded\", { method: \"PUT\", baseUrl, username: user.username });\r\n    return results;\r\n  } catch (err) {\r\n    log(\"api_err\", {\r\n      method: \"PUT\",\r\n      baseUrl,\r\n      username: user?.username,\r\n      ...data,\r\n      appVersion: env.settings.appVersionString,\r\n    });\r\n    console.error(\"Error calling putData against url, \" + baseUrl + \": \" + err);\r\n    throw err;\r\n  }\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst get = async (user: ApplicationUser, baseUrl: string, data?: any) => {\r\n  const url = env.getApiUrl(user, baseUrl);\r\n  console.log(\"API: \" + baseUrl);\r\n\r\n  try {\r\n    const options = {\r\n      method: \"GET\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${user.access_token}`,\r\n        AppVersion: env.settings.appVersionString,\r\n      },\r\n      body: null as null | string,\r\n    };\r\n\r\n    if (data) {\r\n      options.body = JSON.stringify(data);\r\n    }\r\n\r\n    const response = await fetch(url, options);\r\n    const results = await response.json();\r\n    log(\"api_succeeded\", { method: \"GET\", baseUrl, username: user.username });\r\n    return results;\r\n  } catch (err) {\r\n    log(\"api_err\", {\r\n      method: \"GET\",\r\n      baseUrl,\r\n      username: user?.username,\r\n      appVersion: env.settings.appVersionString,\r\n    });\r\n    console.error(\"Error calling get against url, \" + baseUrl + \": \" + err);\r\n    throw err;\r\n  }\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst put = async (user: ApplicationUser, baseUrl: string, data?: any) => {\r\n  const url = env.getApiUrl(user, baseUrl);\r\n  console.log(\"API: \" + baseUrl);\r\n\r\n  const options = {\r\n    method: \"PUT\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${user.access_token}`,\r\n      AppVersion: env.settings.appVersionString,\r\n    },\r\n  } as any;\r\n\r\n  if (data) {\r\n    options.body = JSON.stringify(data!);\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(url, options);\r\n    const contentType = response.headers.get(\"content-type\");\r\n    if (contentType && contentType.indexOf(\"application/json\") !== -1) {\r\n      const results = await response.json();\r\n      log(\"api_succeeded\", { method: \"PUT\", baseUrl, username: user.username });\r\n      return results;\r\n    }\r\n\r\n    log(\"api_succeeded\", { method: \"PUT\", baseUrl, username: user.username });\r\n  } catch (err) {\r\n    log(\"api_err\", {\r\n      method: \"PUT\",\r\n      baseUrl,\r\n      username: user?.username,\r\n      ...data,\r\n      appVersion: env.settings.appVersionString,\r\n    });\r\n    console.error(\"Error calling put against url, \" + baseUrl + \": \" + err);\r\n    throw err;\r\n  }\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst del = async (user: ApplicationUser, baseUrl: string, data?: any) => {\r\n  const url = env.getApiUrl(user, baseUrl);\r\n  console.log(\"API: \" + baseUrl);\r\n\r\n  const options = {\r\n    method: \"DELETE\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${user.access_token}`,\r\n      AppVersion: env.settings.appVersionString,\r\n    },\r\n  } as any;\r\n\r\n  if (data) {\r\n    options.body = JSON.stringify(data!);\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(url, options);\r\n    const contentType = response.headers.get(\"content-type\");\r\n    if (contentType && contentType.indexOf(\"application/json\") !== -1) {\r\n      log(\"api_succeeded\", {\r\n        method: \"DELETE\",\r\n        baseUrl,\r\n        username: user.username,\r\n      });\r\n      return await response.json();\r\n    }\r\n\r\n    log(\"api_succeeded\", {\r\n      method: \"DELETE\",\r\n      baseUrl,\r\n      username: user.username,\r\n    });\r\n    return;\r\n  } catch (err) {\r\n    log(\"api_err\", {\r\n      method: \"DELETE\",\r\n      baseUrl,\r\n      username: user?.username,\r\n      ...data,\r\n      appVersion: env.settings.appVersionString,\r\n    });\r\n    console.error(\"Error calling delete against url, \" + baseUrl + \": \" + err);\r\n    throw err;\r\n  }\r\n};\r\n\r\nexport default {\r\n  get,\r\n  post,\r\n  put,\r\n  putData,\r\n  del,\r\n};\r\n","export enum DeviceOperatingSystem {\r\n  iOS = 1,\r\n  Android = 2,\r\n}\r\n","import { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport apiHelper from \"./OrbitalApiHelper\";\r\nimport { DeviceOperatingSystem } from \"../enums/DeviceOperatingSystem\";\r\nimport { NotificationTypeModel } from \"../orbital-interfaces/NotificationTypeModel\";\r\nimport env from \"./environment\";\r\nimport { log } from \"../util/logger\";\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst subscribe = async (user: ApplicationUser, token: string) => {\r\n  const url = `api/v1/employee/notifications/subscribe`;\r\n  const operatingSystem =\r\n    env.settings.platform === \"ios\"\r\n      ? DeviceOperatingSystem.iOS\r\n      : DeviceOperatingSystem.Android;\r\n\r\n  log(\"pushNotifications_subscribeCalled\", {\r\n    token,\r\n    operatingSystem,\r\n    username: user.username,\r\n    access_token: user.access_token,\r\n  });\r\n\r\n  return await apiHelper.putData(user, url, {\r\n    TokenId: token,\r\n    OperatingSystem: operatingSystem,\r\n  });\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst unsubscribe = async (user: ApplicationUser, token: string) => {\r\n  const url = `api/v1/employee/notifications/unsubscribe`;\r\n  const operatingSystem =\r\n    env.settings.platform === \"ios\"\r\n      ? DeviceOperatingSystem.iOS\r\n      : DeviceOperatingSystem.Android;\r\n\r\n  return await apiHelper.putData(user, url, {\r\n    TokenId: token,\r\n    OperatingSystem: operatingSystem,\r\n  });\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getTypesSelectedByUser = async (user: ApplicationUser) => {\r\n  const url = `api/v1/employee/notifications/types`;\r\n  return (await apiHelper.get(user, url)) as NotificationTypeModel[];\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst putTypes = async (user: ApplicationUser, typeIds: number[]) => {\r\n  const url = `api/v1/employee/notifications/types`;\r\n  const data = {\r\n    ids: typeIds,\r\n  };\r\n\r\n  return (await apiHelper.put(user, url, data)) as void;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst listTypes = async (user: ApplicationUser) => {\r\n  const url = `api/v1/employee/notifications/list-types`;\r\n\r\n  // NOTE: the API no longer really uses passed-in data since the\r\n  // \"Communications rewrite\"\r\n\r\n  return (await apiHelper.get(user, url)) as NotificationTypeModel[];\r\n};\r\n\r\nexport default {\r\n  subscribe,\r\n  unsubscribe,\r\n  getTypesSelectedByUser,\r\n  putTypes,\r\n  listTypes,\r\n};\r\n","import {\r\n  Plugins,\r\n  PushNotification,\r\n  PushNotificationToken,\r\n  PushNotificationActionPerformed,\r\n} from \"@capacitor/core\";\r\nimport { log } from \"./logger\";\r\nimport env from \"../api/environment\";\r\nimport pushApi from \"../api/PushNotificationsAPI\";\r\nimport { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport { createBrowserHistory } from \"history\";\r\n\r\nconst { PushNotifications } = Plugins;\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst register = (\r\n  user: ApplicationUser,\r\n  pushEnabled: (enabled: boolean) => void,\r\n  showMessage: (msg: string) => void\r\n) => {\r\n  const history = createBrowserHistory({ forceRefresh: true });\r\n\r\n  if (!env.settings.hasCapacitor) {\r\n    // TODO: web push instead of capacitor\r\n    return;\r\n  }\r\n\r\n  PushNotifications.register().then(() => {\r\n    console.log(\"PushNotificationController: register called and returned\");\r\n  });\r\n\r\n  // On succcess, we should be able to receive notifications\r\n  PushNotifications.addListener(\r\n    \"registration\",\r\n    (token: PushNotificationToken) => {\r\n      pushApi.subscribe(user, token.value);\r\n      pushEnabled(true);\r\n      showMessage(\"Push registration success, token: \" + token.value);\r\n      log(\"pushNotifications_registered\", {\r\n        token: token.value,\r\n        platform: env.settings.platform,\r\n      });\r\n    }\r\n  );\r\n\r\n  // Some issue with your setup and push will not work\r\n  PushNotifications.addListener(\"registrationError\", (error: any) => {\r\n    showMessage(\"Error on registration: \" + JSON.stringify(error));\r\n    log(\"pushNotifications_registrationError\", {\r\n      error,\r\n      platform: env.settings.platform,\r\n    });\r\n  });\r\n\r\n  // Show us the notification payload if the app is open on our device\r\n  PushNotifications.addListener(\r\n    \"pushNotificationReceived\",\r\n    (notification: PushNotification) => {\r\n      if (notification) {\r\n        if (notification.data && notification.data.MessageId) {\r\n          showMessage(\r\n            \"NOTIFICATION: \" +\r\n              notification.title +\r\n              \": \" +\r\n              notification.body +\r\n              \" id:\" +\r\n              notification.data.MessageId\r\n          );\r\n          history.push(\"/tabs/messages/\" + notification.data.MessageId);\r\n          history.goForward();\r\n        } else {\r\n          showMessage(\r\n            \"NOTIFICATION: \" +\r\n              notification.title +\r\n              \": \" +\r\n              notification.body +\r\n              \" (no id)\"\r\n          );\r\n        }\r\n\r\n        log(\"pushNotifications_receivedWhenOpen\", {\r\n          title: notification.title,\r\n          body: notification.body,\r\n          messageId: notification.data.MessageId ?? -123,\r\n        });\r\n      }\r\n\r\n      /*\r\n      let notif = this.state.notifications;\r\n      notif.push({ id: notification.id, title: notification.title, body: notification.body })\r\n      this.setState({\r\n        notifications: notif\r\n      })\r\n      */\r\n    }\r\n  );\r\n\r\n  // Method called when tapping on a notification\r\n  PushNotifications.addListener(\r\n    \"pushNotificationActionPerformed\",\r\n    (notification: PushNotificationActionPerformed) => {\r\n      if (\r\n        notification.notification.data &&\r\n        notification.notification.data.MessageId\r\n      ) {\r\n        showMessage(\r\n          \"TAPPED ON NOTIFICATION: \" +\r\n            notification.notification.title +\r\n            \": \" +\r\n            notification.notification.body +\r\n            \" id:\" +\r\n            notification.notification.data.MessageId\r\n        );\r\n        history.push(\r\n          \"/tabs/messages/\" + notification.notification.data.MessageId\r\n        );\r\n        history.goForward();\r\n      } else {\r\n        showMessage(\r\n          \"TAPPED ON NOTIFICATION: \" +\r\n            notification.notification.title +\r\n            \": \" +\r\n            notification.notification.body +\r\n            \" (no id)\"\r\n        );\r\n      }\r\n\r\n      log(\"pushNotifications_actionPerformed\", {\r\n        title: notification.notification.title,\r\n        body: notification.notification.body,\r\n        messageId: notification.notification.data.MessageId ?? -123,\r\n      });\r\n    }\r\n  );\r\n};\r\n\r\nexport default {\r\n  register,\r\n};\r\n","/* eslint-disable */\r\nimport React, { useState, useEffect } from \"react\";\r\nimport db from \"../data/dbStore\";\r\nimport PushController from \"../util/push-notifications-controller\";\r\nimport env from \"../api/environment\";\r\n\r\nexport interface ApplicationUser {\r\n  isLoggedin: boolean;\r\n  access_token?: string;\r\n  username: string;\r\n  darkMode: boolean;\r\n  loading: boolean;\r\n  environment: string;\r\n  isPushEnabled: boolean;\r\n}\r\n\r\nexport interface IApplicationUserContext {\r\n  user: ApplicationUser;\r\n  logout: () => Promise<void>;\r\n  userLoggedIn: (\r\n    username: string,\r\n    access_token: string,\r\n    environment: string\r\n  ) => Promise<ApplicationUser>;\r\n  pushEnabled: (enabled: boolean) => void;\r\n}\r\n\r\nconst INITIAL_APPLICATION_USER: ApplicationUser = {\r\n  isLoggedin: false,\r\n  access_token: undefined,\r\n  username: \"\",\r\n  darkMode: false,\r\n  loading: true,\r\n  environment: \"prod\",\r\n  isPushEnabled: false,\r\n};\r\n\r\nconst INITIAL_APPLICATION_USER_CONTEXT = {\r\n  user: INITIAL_APPLICATION_USER,\r\n  logout: async () => {},\r\n  userLoggedIn: (u: string, at: string, e: string) => {\r\n    return new Promise<ApplicationUser>(() => {\r\n      return INITIAL_APPLICATION_USER;\r\n    });\r\n  },\r\n  pushEnabled: (e: boolean) => {},\r\n};\r\n\r\nexport const ApplicationUserContext = React.createContext<\r\n  IApplicationUserContext\r\n>(INITIAL_APPLICATION_USER_CONTEXT);\r\n\r\nexport const ApplicationUserContextProvider = (props: any) => {\r\n  const [userState, internalSetUserState] = useState({\r\n    ...INITIAL_APPLICATION_USER,\r\n  });\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    Promise.all([db.getUserState()]).then((response) => {\r\n      if (mounted) {\r\n        const newState = response[0];\r\n        if (newState) {\r\n          internalSetUserState({ ...newState, loading: false });\r\n        } else {\r\n          internalSetUserState({ ...userState, loading: false });\r\n        }\r\n      }\r\n    });\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n\r\n    // eslint-disable-next-line\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      userState &&\r\n      !userState.isPushEnabled &&\r\n      userState.access_token &&\r\n      userState.access_token.length > 0 &&\r\n      env.settings.platform !== \"other\"\r\n    ) {\r\n      PushController.register(userState, pushEnabled, () => {});\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [userState.isPushEnabled, userState.access_token]);\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  const pushEnabled = (enabled: boolean) => {\r\n    internalSetUserState({ ...userState, isPushEnabled: enabled });\r\n  };\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  const userLoggedIn = async (\r\n    username: string,\r\n    access_token: string,\r\n    environment: string\r\n  ): Promise<ApplicationUser> => {\r\n    const currentState = await db.getUserState();\r\n    const newState = {\r\n      username,\r\n      access_token,\r\n      environment,\r\n      isLoggedin: true,\r\n      darkMode: currentState\r\n        ? currentState.darkMode\r\n        : INITIAL_APPLICATION_USER.darkMode,\r\n      loading: false,\r\n      isPushEnabled: false,\r\n    };\r\n\r\n    await db.putUserState(newState);\r\n    internalSetUserState(newState);\r\n    return newState;\r\n  };\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  const logout = async () => {\r\n    const newState = {\r\n      ...userState,\r\n      isLoggedin: false,\r\n      access_token: undefined,\r\n      latitude: undefined,\r\n      longitude: undefined,\r\n      isPushEnabled: false,\r\n      requestedGeoPermission: false,\r\n      refusedGeoPermission: false,\r\n    };\r\n    internalSetUserState(newState);\r\n    await db.putUserState(newState);\r\n  };\r\n\r\n  return (\r\n    <ApplicationUserContext.Provider\r\n      value={{\r\n        user: userState,\r\n        userLoggedIn,\r\n        logout,\r\n        pushEnabled,\r\n      }}\r\n    >\r\n      {props.children}\r\n    </ApplicationUserContext.Provider>\r\n  );\r\n};\r\n","import { IonAlert } from \"@ionic/react\";\r\nimport React, { useState } from \"react\";\r\n\r\nfunction useDialogBox() {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [alertData, setAlertData] = useState({\r\n    header: \"\",\r\n    message: \"\",\r\n    onDismiss: () => {},\r\n  });\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const showAlert = (\r\n    header: string,\r\n    message: string,\r\n    onDismiss: () => void\r\n  ) => {\r\n    setAlertData({\r\n      header,\r\n      message,\r\n      onDismiss,\r\n    });\r\n\r\n    setIsOpen(true);\r\n  };\r\n\r\n  const alertBoxJsx = (\r\n    <IonAlert\r\n      isOpen={isOpen}\r\n      onDidDismiss={() => {\r\n        setIsOpen(false);\r\n        alertData.onDismiss();\r\n      }}\r\n      header={alertData.header}\r\n      message={alertData.message}\r\n      buttons={[\"OK\"]}\r\n    />\r\n  );\r\n\r\n  return {\r\n    showAlert,\r\n    alertBoxJsx,\r\n  };\r\n}\r\n\r\nexport default useDialogBox;\r\n","import React from \"react\";\r\nimport { IonItem, IonToggle, IonList, IonLabel } from \"@ionic/react\";\r\nimport { NotificationTypeModel } from \"../orbital-interfaces/NotificationTypeModel\";\r\n\r\ninterface ToggleListExProps {\r\n  list: NotificationTypeModel[] | null;\r\n  selected: NotificationTypeModel[] | null;\r\n  selectionChanged(newSelected: NotificationTypeModel[] | null): void;\r\n}\r\n\r\nconst ToggleListEx: React.FC<ToggleListExProps> = ({\r\n  list,\r\n  selected,\r\n  selectionChanged,\r\n}: ToggleListExProps) => {\r\n  // ----------------------------------------------------------------------------------------------\r\n  const isItemChecked = (id: number) => {\r\n    if (!selected || selected.length === 0) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < selected.length; i++) {\r\n      if (selected[i].id === id) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  };\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  const onAllChanged = () => {\r\n    const checked = list?.length !== selected?.length;\r\n\r\n    if (list?.length === selected?.length) {\r\n      if (checked) {\r\n        return;\r\n      }\r\n\r\n      const newSelected = [] as NotificationTypeModel[];\r\n      selectionChanged(newSelected);\r\n    } else {\r\n      if (!checked) {\r\n        return;\r\n      }\r\n\r\n      selectionChanged(list ? list.slice() : null);\r\n    }\r\n  };\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  const itemToggle = (item: NotificationTypeModel) => {\r\n    if (selected === null) {\r\n      return;\r\n    }\r\n\r\n    const checked = !selected.map((n) => n.id).includes(item.id);\r\n\r\n    if (checked) {\r\n      const newList = selected.slice();\r\n      newList.push(item);\r\n      selectionChanged(newList);\r\n    } else {\r\n      const newlist = selected.filter((r) => r.id !== item.id);\r\n      selectionChanged(newlist);\r\n    }\r\n  };\r\n\r\n  if (!list) {\r\n    return <div>Loading...</div>;\r\n  }\r\n\r\n  return (\r\n    <IonItem lines=\"none\">\r\n      <IonList>\r\n        <IonItem lines=\"none\" key={-1}>\r\n          <IonToggle\r\n            mode=\"md\"\r\n            key={-1}\r\n            checked={list?.length === selected?.length}\r\n            onClick={() => onAllChanged()}\r\n          />\r\n          <IonLabel>SELECT ALL</IonLabel>\r\n        </IonItem>\r\n        {list &&\r\n          list.map((toggle) => (\r\n            <IonItem lines=\"none\" key={toggle.id}>\r\n              <IonToggle\r\n                mode=\"md\"\r\n                key={toggle.id}\r\n                onClick={() => {\r\n                  itemToggle(toggle);\r\n                }}\r\n                checked={isItemChecked(toggle.id)}\r\n              />\r\n              <IonLabel>{toggle.name}</IonLabel>\r\n            </IonItem>\r\n          ))}\r\n      </IonList>\r\n    </IonItem>\r\n  );\r\n};\r\n\r\nexport default ToggleListEx;\r\n","import React, { useContext, useEffect, useState } from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonButtons,\r\n  IonIcon,\r\n  IonContent,\r\n  IonFooter,\r\n  IonHeader,\r\n  IonTitle,\r\n  IonToolbar,\r\n} from \"@ionic/react\";\r\nimport { arrowBackOutline } from \"ionicons/icons\";\r\nimport ToggleListEx from \"../components/ToggleListEx\";\r\nimport pushApi from \"../api/PushNotificationsAPI\";\r\nimport { ApplicationUserContext } from \"../context/ApplicationUserContext\";\r\nimport { NotificationTypeModel } from \"../orbital-interfaces/NotificationTypeModel\";\r\n\r\ninterface NotificationSettingsModalProps {\r\n  onDismissModal: () => void;\r\n  isOpen: boolean;\r\n}\r\n\r\nconst NotificationSettingsModal: React.FC<NotificationSettingsModalProps> = ({\r\n  onDismissModal,\r\n  isOpen,\r\n}: NotificationSettingsModalProps) => {\r\n  const { user } = useContext(ApplicationUserContext);\r\n  const [notifications, setNotifications] = useState(\r\n    null as NotificationTypeModel[] | null\r\n  );\r\n  const [selectedNotifications, setSelectedNotifications] = useState(\r\n    null as NotificationTypeModel[] | null\r\n  );\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      setSelectedNotifications(null);\r\n      setNotifications(null);\r\n      return;\r\n    }\r\n\r\n    let isSubscribed = true;\r\n\r\n    Promise.all([\r\n      pushApi.getTypesSelectedByUser(user),\r\n      pushApi.listTypes(user),\r\n    ]).then((responses) => {\r\n      if (!isSubscribed) {\r\n        return;\r\n      }\r\n\r\n      setSelectedNotifications(responses[0]);\r\n      setNotifications(responses[1]);\r\n    });\r\n\r\n    return () => {\r\n      isSubscribed = false;\r\n    };\r\n  }, [isOpen, user]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onCancel = () => {\r\n    onDismissModal();\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onSelectionChanged = (newSelected: NotificationTypeModel[]) => {\r\n    const ids = newSelected.map((n) => n.id);\r\n    pushApi.putTypes(user, ids).then(() => {\r\n      setSelectedNotifications(newSelected);\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <IonHeader className=\"ion-no-border\">\r\n        <IonToolbar>\r\n          <IonButtons slot=\"start\">\r\n            <IonButton onClick={onCancel}>\r\n              <IonIcon icon={arrowBackOutline} mode=\"md\" slot=\"icon-only\" />\r\n            </IonButton>\r\n          </IonButtons>\r\n          <IonTitle>Notifications</IonTitle>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n\r\n      <IonContent class=\"outer-content\">\r\n        <ToggleListEx\r\n          list={notifications}\r\n          selected={selectedNotifications}\r\n          selectionChanged={onSelectionChanged}\r\n        />\r\n      </IonContent>\r\n\r\n      <IonFooter>\r\n        <IonToolbar />\r\n      </IonFooter>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default NotificationSettingsModal;\r\n","import { IonToast } from \"@ionic/react\";\nimport React, { useState } from \"react\";\n\nfunction useSimpleToast() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [toastData, setToastData] = useState({ message: \"\" });\n\n  const showToast = (message: string) => {\n    setToastData({\n      message,\n    });\n\n    setIsOpen(true);\n  };\n\n  const simpleToastJsx = (\n    <IonToast\n      isOpen={isOpen}\n      onDidDismiss={() => setIsOpen(false)}\n      position=\"top\"\n      message={toastData.message}\n      duration={1500}\n    />\n  );\n\n  return {\n    showToast,\n    simpleToastJsx,\n  };\n}\n\nexport default useSimpleToast;\n","import {IdName} from \"../orbital-interfaces/IdName\";\r\n\r\nenum EventType {\r\n  Shift = 1,\r\n  Unavailable = 2,\r\n  Vacation = 3,\r\n  Cover = 4,\r\n  Clock = 6,\r\n  Absent = 7,\r\n}\r\n\r\nexport const eventTypeIdList = [\r\n  { id: 1, name: \"Shift\"},\r\n  { id: 2, name: \"Unavailable\"},\r\n  { id: 3, name: \"Vacation\"},\r\n  { id: 4, name: \"Cover\"},\r\n  { id: 6, name: \"Clock\"},\r\n  { id: 7, name: \"Absent\"}\r\n] as IdName[];\r\n\r\nexport function getEventTypeIdName(eventType: EventType): IdName {\r\n  const idName =  eventTypeIdList.find(et => et.id === eventType);\r\n  if (idName === undefined) {\r\n    throw new Error(\"getEventTypeIdList: Unknown event type: \" + eventType);\r\n  }\r\n\r\n  return idName;\r\n}\r\n\r\n\r\nexport default EventType;\r\n","import {IdName} from \"../orbital-interfaces/IdName\";\r\n\r\nenum EventStatus {\r\n  Approved = 1,\r\n  Request = 2,\r\n  RequestDenied = 4,\r\n}\r\n\r\nexport const eventStatusIdList = [\r\n  { id: 1, name: \"Approved\"},\r\n  { id: 2, name: \"Request\"},\r\n  { id: 4, name: \"Request Denied\"},\r\n] as IdName[];\r\n\r\n\r\nexport function getEventStatusIdName(eventStatus: EventStatus): IdName {\r\n  const idName =  eventStatusIdList.find(et => et.id === eventStatus);\r\n  if (idName === undefined) {\r\n    throw new Error(\"getEventStatusIdName: Unknown event status: \" + eventStatus);\r\n  }\r\n\r\n  return idName;\r\n}\r\n\r\nexport default EventStatus;\r\n","enum EventGroup {\r\n  All = -1,\r\n  Scheduled = -2,\r\n  DontWork = -3,\r\n  ClockAndSched = -6,\r\n  Custom = 0,\r\n}\r\n\r\nexport default EventGroup;\r\n","import EventType from \"../enums/EventType\";\r\nimport EventStatus from \"../enums/EventStatus\";\r\nimport EventGroup from \"../enums/EventGroup\";\r\nimport {ScheduleEvent} from \"../orbital-interfaces/ScheduleEvent\";\r\nimport {isAfter} from \"date-fns\";\r\n\r\nconst onClockEventEnd = new Date(9000, 1, 1);\r\n\r\n// ---------------------------------------------------------------------------------\r\nexport function isClockedIn(ev: ScheduleEvent) {\r\n  return (\r\n    ev.EventTypeId === EventType.Clock &&\r\n    ev.EventStatusId === EventStatus.Approved &&\r\n    isAfter(ev.EventEnd, onClockEventEnd)\r\n  );\r\n}\r\n\r\n\r\n/*\r\n * Code below in this file was based on ScheduleEventHelper.cs in OrbitalShift.BLL.dll\r\n */\r\n\r\n// ---------------------------------------------------------------------------------\r\nfunction isShiftTypeEvent(\r\n  eventType: EventType,\r\n  eventStatus: EventStatus\r\n): boolean {\r\n  return (\r\n    (eventType === EventType.Shift && eventStatus === EventStatus.Approved) ||\r\n    (eventType === EventType.Cover && eventStatus === EventStatus.Request) ||\r\n    (eventType === EventType.Cover && eventStatus === EventStatus.RequestDenied)\r\n  );\r\n}\r\n\r\n// ---------------------------------------------------------------------------------\r\nfunction isAbsentExpenseEvent(\r\n  eventType: EventType,\r\n  eventStatus: EventStatus\r\n): boolean {\r\n  return eventType === EventType.Absent && eventStatus === EventStatus.Approved;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------\r\nfunction isTimeClockEvent(\r\n  eventType: EventType,\r\n  eventStatus: EventStatus\r\n): boolean {\r\n  return (\r\n    isShiftTypeEvent(eventType, eventStatus) ||\r\n    (eventType === EventType.Clock && eventStatus === EventStatus.Approved)\r\n  );\r\n}\r\n\r\nfunction isDontWorkEvent(eventType: EventType, eventStatus: EventStatus): boolean {\r\n  return (\r\n    (eventType === EventType.Unavailable && eventStatus === EventStatus.Approved) ||\r\n    (eventType === EventType.Vacation && eventStatus === EventStatus.Approved) ||\r\n    (eventType === EventType.Absent && eventStatus === EventStatus.Approved) ||\r\n    (eventType === EventType.Cover && eventStatus === EventStatus.Approved)\r\n  );\r\n}\r\n\r\n// ---------------------------------------------------------------------------------\r\nexport function eventMatchesFilter(\r\n  eventTypeFilter: EventType | EventGroup,\r\n  eventStatusFilter: EventStatus | EventGroup,\r\n  eventType: EventType,\r\n  eventStatus: EventStatus\r\n): boolean {\r\n  if (eventTypeFilter === EventGroup.DontWork && eventStatusFilter === EventGroup.DontWork) {\r\n    return isDontWorkEvent(eventType, eventStatus);\r\n  }\r\n\r\n\r\n  if (eventTypeFilter > 0 && eventStatusFilter > 0) {\r\n    if (eventTypeFilter === eventType && eventStatusFilter === eventStatus) {\r\n      return true;\r\n    }\r\n  } else if (eventTypeFilter > 0 && eventStatusFilter === EventGroup.All) {\r\n    if (eventTypeFilter === eventType) {\r\n      return true;\r\n    }\r\n  } else if (\r\n    eventTypeFilter === EventGroup.All &&\r\n    eventStatusFilter === eventStatus\r\n  ) {\r\n    if (eventStatusFilter === eventStatus) {\r\n      return true;\r\n    }\r\n  } else if (\r\n    eventTypeFilter === EventGroup.Scheduled &&\r\n    eventStatusFilter === EventGroup.Scheduled\r\n  ) {\r\n    return (\r\n      isShiftTypeEvent(eventType, eventStatus) ||\r\n      isAbsentExpenseEvent(eventType, eventStatus)\r\n    );\r\n  } else if (\r\n    eventTypeFilter === EventGroup.ClockAndSched &&\r\n    eventStatusFilter === EventGroup.ClockAndSched\r\n  ) {\r\n    return (\r\n      isTimeClockEvent(eventType, eventStatus) ||\r\n      isAbsentExpenseEvent(eventType, eventStatus)\r\n    );\r\n  } else {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n","import { EventBreak } from \"../orbital-interfaces/EventBreak\";\r\nimport { EventInformation } from \"../orbital-interfaces/TEC\";\r\nimport { ScheduleEvent } from \"../orbital-interfaces/ScheduleEvent\";\r\nimport {\r\n  addDays,\r\n  differenceInDays,\r\n  differenceInMinutes,\r\n  format,\r\n  isAfter, isSameDay,\r\n  isSameYear,\r\n  isToday,\r\n  parseISO,\r\n} from \"date-fns\";\r\nimport {\r\n  LocationSettings,\r\n  TimeFormat,\r\n} from \"../orbital-interfaces/authorized-items\";\r\nimport { OrbitalTime } from \"../orbital-interfaces/OrbitalTime\";\r\nimport {isClockedIn} from \"./scheduleevent-helper\";\r\nimport {toDate, format as tzFormat} from \"date-fns-tz\";\r\n\r\nconst noEndTime = new Date(9000, 1, 1);\r\n\r\nfunction isScheduleEvent(ev: EventInformation | ScheduleEvent): ev is ScheduleEvent {\r\n  return (ev as ScheduleEvent).BusinessId !== undefined;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function convertTimeWithoutTimeZoneToLocalTime(dtStr: string): string {\r\n  const localTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n  const newDate = toDate(dtStr, { timeZone: localTimeZone});\r\n  const dateOnlyStr = tzFormat(newDate,'yyyy-MM-dd', { timeZone: localTimeZone});\r\n  const timeOnlyStr = tzFormat(newDate,'HH:mm:ssXXX', { timeZone: localTimeZone});\r\n  return dateOnlyStr + \"T\" + timeOnlyStr;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getDurationFromTimeSpan(timespan: string) {\r\n  if (!timespan) {\r\n    return 0;\r\n  }\r\n\r\n  const tok = timespan.split(\":\");\r\n  let hrs: number;\r\n  let min: number;\r\n  if (tok[0].indexOf(\".\") >= 0) {\r\n    const hrTok = tok[0].split(\".\");\r\n    hrs = 24 * parseInt(hrTok[0]) + parseInt(hrTok[1]);\r\n    min = parseInt(tok[1]);\r\n  } else {\r\n    hrs = parseInt(tok[0]);\r\n    min = parseInt(tok[1]);\r\n  }\r\n\r\n  return hrs * 60 + min;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function messageDateString(time: string) {\r\n  const date = parseISO(time);\r\n  const now = new Date();\r\n\r\n  if (isToday(date)) {\r\n    return format(date, \"h:mmaaa\").replace(\"M\", \"\");\r\n  } else if (differenceInDays(now, date) < 7) {\r\n    return format(date, \"EEE\");\r\n  } else if (isSameYear(date, now)) {\r\n    return format(date, \"MMM d\");\r\n  } else {\r\n    return format(date, \"M/d/yyyy\");\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getTimeStringFromMinutes(\r\n  locSettings: LocationSettings,\r\n  min: number | null\r\n) {\r\n  if (locSettings.TimeFormat === TimeFormat.HoursMinutes) {\r\n    if (min === null) {\r\n      return \"00:00\";\r\n    }\r\n\r\n    const hours = Math.floor(min / 60);\r\n    const minutes = min % 60;\r\n\r\n    return `${padZeroes(hours, 2)}:${padZeroes(minutes, 2)}`;\r\n  } else {\r\n    if (min === null) {\r\n      return \"0\";\r\n    }\r\n\r\n    return formatDecimal(\r\n      min / 60,\r\n      locSettings.TimeFormatDigits,\r\n      locSettings.TimeFormatDecimals\r\n    );\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getTimeStringFromOrbitalTime(\r\n  locSettings: LocationSettings,\r\n  time: OrbitalTime\r\n) {\r\n  if (time.ActualTime === \"00:00:00\") {\r\n    return locSettings.TimeFormat === TimeFormat.HoursMinutes\r\n      ? \"00:00\"\r\n      : formatDecimal(\r\n          0,\r\n          locSettings.TimeFormatDigits,\r\n          locSettings.TimeFormatDecimals\r\n        );\r\n  }\r\n\r\n  if (locSettings.TimeFormat === TimeFormat.HoursMinutes) {\r\n    const tok = time.ActualTime.split(\":\");\r\n    if (tok.length !== 3) {\r\n      return time.ActualTime;\r\n    }\r\n\r\n    if (tok[0].includes(\".\")) {\r\n      const dayHourTok = tok[0].split(\".\");\r\n      const hours = 24 * parseInt(dayHourTok[0]) + parseInt(dayHourTok[1]);\r\n      return `${hours}:${tok[1]}`;\r\n    } else {\r\n      const hours = parseInt(tok[0]);\r\n      return `${hours}:${tok[1]}`;\r\n    }\r\n  } else {\r\n    return formatDecimal(\r\n      time.ActualHours,\r\n      locSettings.TimeFormatDigits,\r\n      locSettings.TimeFormatDecimals\r\n    );\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getMinutesFromTimeString(\r\n  locSettings: LocationSettings,\r\n  str: string\r\n) {\r\n  if (!str || str.length === 0) {\r\n    return 0;\r\n  }\r\n\r\n  if (locSettings.TimeFormat === TimeFormat.HoursMinutes) {\r\n    const hourMinRegEx = /^\\d*(:\\d{2})?$/;\r\n    if (!hourMinRegEx.test(str)) {\r\n      return 0;\r\n    }\r\n\r\n    if (str[0] === \":\") {\r\n      return parseInt(str.substring(1));\r\n    }\r\n\r\n    const tok = str.split(\":\");\r\n    if (tok.length === 1) {\r\n      return parseInt(str) * 60;\r\n    }\r\n\r\n    return parseInt(tok[0]) * 60 + parseInt(tok[1]);\r\n  } else {\r\n    const decimalRegex = /^\\d+(.\\d*)?$/;\r\n    if (!decimalRegex.test(str)) {\r\n      return 0;\r\n    }\r\n\r\n    return Math.round(parseFloat(str) * 60.0);\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getDurationStringFromTimeSpan(timespan: string) {\r\n  if (!timespan) {\r\n    return \"(0m)\";\r\n  }\r\n  const tok = timespan.split(\":\");\r\n  let hrs: number;\r\n  let min: number;\r\n  if (tok[0].indexOf(\".\") >= 0) {\r\n    const hrTok = tok[0].split(\".\");\r\n    hrs = 24 * parseInt(hrTok[0]) + parseInt(hrTok[1]);\r\n    min = parseInt(tok[1]);\r\n  } else {\r\n    hrs = parseInt(tok[0]);\r\n    min = parseInt(tok[1]);\r\n  }\r\n\r\n  return hrs > 0 ? `(${hrs}h ${min}m)` : `(${min}m)`;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getDurationString(minutes: number): string {\r\n  if (minutes < 60) {\r\n    return `(${minutes}m)`;\r\n  }\r\n\r\n  const str = `(${Math.floor(minutes / 60)}h`;\r\n  return minutes % 60 === 0 ? str + \")\" : str + ` ${minutes % 60}m)`;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getDurationFromScheduleEvent(\r\n  ev: EventInformation | ScheduleEvent\r\n): number {\r\n  if ((ev as EventInformation).Data) {\r\n    return getDurationFromTimeSpan(\r\n      (ev as EventInformation).Data!.HourlyValue.Time.ActualTime\r\n    );\r\n  }\r\n\r\n  const getDiff = (start: string, end?: string) => {\r\n    const startDate = parseISO(start);\r\n    let endDate = end ? parseISO(end) : new Date();\r\n    if (endDate > noEndTime) {\r\n      endDate = new Date();\r\n    }\r\n    return differenceInMinutes(endDate, startDate);\r\n  };\r\n\r\n  let totalMinutes = getDiff(ev.EventStart, ev.EventEnd);\r\n  if (ev.EventBreaks) {\r\n    ev.EventBreaks.map(\r\n      (b) => (totalMinutes -= getDiff(b.BreakStart, b.BreakEnd))\r\n    );\r\n  }\r\n\r\n  return totalMinutes;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getDuration(ev: EventInformation): number {\r\n  const getDiff = (start: string, end?: string) => {\r\n    const startDate = parseISO(start);\r\n    let endDate = end ? parseISO(end) : new Date();\r\n    if (endDate > noEndTime) {\r\n      endDate = new Date();\r\n    }\r\n    return differenceInMinutes(endDate, startDate);\r\n  };\r\n\r\n  let totalMinutes = getDiff(ev.EventStart, ev.EventEnd);\r\n  if (ev.EventBreaks) {\r\n    ev.EventBreaks.map(\r\n      (b) => (totalMinutes -= getDiff(b.BreakStart, b.BreakEnd))\r\n    );\r\n  }\r\n\r\n  return totalMinutes;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getTotalDuration(events: EventInformation[]) {\r\n  let totalMinutes = 0;\r\n  events.map((ev) => (totalMinutes += getDuration(ev)));\r\n  return totalMinutes;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getTotalDurationFromScheduleEvent(events: ScheduleEvent[]) {\r\n  let totalMinutes = 0;\r\n  events.map((ev) => (totalMinutes += getDurationFromScheduleEvent(ev)));\r\n  return totalMinutes;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getDateString(date: Date): string {\r\n  return format(date, \"EEE MMM d, yyyy\").toUpperCase();\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getStartTime(ev: EventInformation | ScheduleEvent) {\r\n  return format(parseISO(ev.EventStart), \"h:mmaaa\").replace(\"M\", \"\");\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getMessageDeliveryTimeString(dateStr: string) {\r\n  return format(parseISO(dateStr), \"M/d EEE h:mmaa\").replace(\"M\", \"\");\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getBreakStartTime(brk: EventBreak) {\r\n  return format(parseISO(brk.BreakStart), \"h:mmaaa\").replace(\"M\", \"\");\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getEventStartEnd(ev: EventInformation | ScheduleEvent) {\r\n  const start = format(parseISO(ev.EventStart), \"h:mmaaa\").replace(\"M\", \"\");\r\n  const end = format(parseISO(ev.EventEnd), \"h:mmaaa\").replace(\"M\", \"\");\r\n\r\n  return `${start} - ${end}`;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getBreakStartEnd(brk: EventBreak) {\r\n  const start = format(parseISO(brk.BreakStart), \"h:mmaaa\").replace(\"M\", \"\");\r\n\r\n  if (!brk.BreakEnd || brk.BreakEnd > noEndTime) {\r\n    return start;\r\n  }\r\n\r\n  const end = format(parseISO(brk.BreakEnd), \"h:mmaaa\").replace(\"M\", \"\");\r\n  return `${start} - ${end}`;\r\n}\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getEventInformationStartEnd(\r\n  ev: EventInformation | ScheduleEvent\r\n) {\r\n  const start = format(parseISO(ev.EventStart), \"h:mmaaa\").replace(\"M\", \"\");\r\n  let end: string;\r\n\r\n  if (!isScheduleEvent(ev) && ev.IsClockedIn) {\r\n    end = format(new Date(),\"h:mmaaa\").replace(\"M\", \"\");\r\n  } else  if (isScheduleEvent(ev) && isClockedIn(ev)) {\r\n    end = format(new Date(), \"h:mmaaa\").replace(\"M\", \"\");\r\n  } else {\r\n    end = format(parseISO(ev.EventEnd), \"h:mmaaa\").replace(\"M\", \"\");\r\n  }\r\n\r\n  return `${start} - ${end}`;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getEventBreakStartEndString(brk: EventBreak): string {\r\n  const start = format(parseISO(brk.BreakStart), \"h:mmaa\").replace(\"M\", \"\");\r\n  const end = brk.BreakEnd\r\n    ? format(parseISO(brk.BreakEnd), \"h:mmaa\").replace(\"M\", \"\")\r\n    : format(new Date(), \"h:mmaa\").replace(\"M\", \"\");\r\n\r\n  return `${start} - ${end}`;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getDateOnlyFromISOString(str: string) {\r\n  const date = parseISO(str);\r\n  const dateOnlyStr = format(date, \"yyyy-MM-dd\");\r\n  return parseISO(dateOnlyStr);\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getWeekStart(\r\n  date: Date,\r\n  weekStartsOn: string,\r\n  dayStart: string\r\n): Date {\r\n  const dayStartMinutes =\r\n    !dayStart || dayStart.indexOf(\"T\") < 0\r\n      ? 0\r\n      : getDurationFromTimeSpan(dayStart.split(\"T\")[1]);\r\n\r\n  let newDate = date;\r\n  newDate.setHours(0, dayStartMinutes, 0, 0);\r\n\r\n  let counter = 0;\r\n  while (format(newDate, \"EEEE\") !== weekStartsOn && counter < 20) {\r\n    newDate = addDays(newDate, -1);\r\n    counter++;\r\n  }\r\n\r\n  if (counter > 15) {\r\n    console.error(\r\n      `Could not calculate week start based on date ${date}` +\r\n        `and weekStartsOn \"${weekStartsOn}\"`\r\n    );\r\n  }\r\n\r\n  return newDate;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\n// For the date/time passed in (usually new Date() to get \"now\"), this function returns the\r\n// start of the time as specified by the DayStartTime in location settings.  If, for example,\r\n// it is 2 am on January 5th, and loc settings has DayStartTime set to 4:00am, then\r\n// this function would return January 4th at 4:00am, instead of January 5th.\r\nexport function getTodayStartForLocation(date: Date, locSettings: LocationSettings): Date {\r\n  const tmpDate = new Date(date.valueOf());\r\n  const dayStartMinutes = getDayStartMinutes(locSettings.DayStartTime);\r\n  tmpDate.setMinutes(-1*dayStartMinutes, tmpDate.getSeconds(), tmpDate.getMilliseconds());\r\n  const needPreviousDate = !isSameDay(tmpDate, date);\r\n\r\n  const startDate = new Date(date.valueOf());\r\n  if (needPreviousDate) {\r\n    startDate.setHours(-24, dayStartMinutes, 0, 0);\r\n  } else {\r\n    startDate.setHours(0, dayStartMinutes, 0, 0);\r\n  }\r\n\r\n  return startDate;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getDayStartMinutes(dayStartLocSetting: string) {\r\n  const tok = dayStartLocSetting.split(\"T\");\r\n  return getDurationFromTimeSpan(tok[1]);\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function getTimeDiff(dateStr: string) {\r\n  const now = new Date();\r\n  const dateTime = parseISO(dateStr);\r\n  let minutes = isAfter(now, dateTime)\r\n    ? differenceInMinutes(now, dateTime)\r\n    : differenceInMinutes(dateTime, now);\r\n\r\n  const hours = parseInt(\"\" + minutes / 60, 10);\r\n  minutes = minutes - hours * 60;\r\n  return `${formatDecimal(hours, 2, 0)}:${formatDecimal(minutes, 2, 0)}`;\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function formatDateTimeAsMvcString(d: Date) {\r\n  return (\r\n    \"\" +\r\n    d.getFullYear() +\r\n    \"-\" +\r\n    padZeroes(d.getMonth() + 1, 2) +\r\n    \"-\" +\r\n    padZeroes(d.getDate(), 2) +\r\n    \"T\" +\r\n    padZeroes(d.getHours(), 2) +\r\n    \":\" +\r\n    padZeroes(d.getMinutes(), 2) +\r\n    \":00\"\r\n  );\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nexport function formatDecimal(num: number, digits: number, decimals: number) {\r\n  let val = Number(num).toFixed(decimals).toString();\r\n\r\n  let negative = \"\";\r\n  if (val.indexOf(\"-\") === 0) {\r\n    val = val.substring(1);\r\n    negative = \"-\";\r\n  }\r\n\r\n  const s = \"0000000000\" + val;\r\n  const decPos = val.indexOf(\".\");\r\n  if (decPos === -1) {\r\n    return negative + s.substr(s.length - Math.max(val.length, digits));\r\n  } else {\r\n    return (\r\n      negative +\r\n      s.substr(s.length - Math.max(val.length, digits + decimals + 1))\r\n    );\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------------------------\r\nfunction padZeroes(val: any, digitCount: number) {\r\n  const s = \"0000000000\" + val;\r\n  return s.substr(s.length - digitCount);\r\n}\r\n","import { EmployeeSort } from \"../orbital-interfaces/authorized-items\";\r\nimport { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport { formatDateTimeAsMvcString } from \"../util/time-helper\";\r\nimport apiHelper from \"./OrbitalApiHelper\";\r\nimport { IdName } from \"../orbital-interfaces/IdName\";\r\nimport env from \"./environment\";\r\nimport {ApiResult} from \"./DailyNotesAPI\";\r\n\r\nexport interface EmployeeCommunication {\r\n  id: number;\r\n  name: string;\r\n  hasEmail: boolean;\r\n  hasText: boolean;\r\n  hasPush: boolean;\r\n  isChecked: boolean;\r\n}\r\n\r\n// -----------------------------------------------------------------------------\r\nconst getEmployeesByLocationIdPositionIdAndActiveDateRange = async (\r\n  user: ApplicationUser,\r\n  locId: number,\r\n  posId: number,\r\n  start: Date,\r\n  end: Date,\r\n  sort: EmployeeSort\r\n) => {\r\n  const data = {\r\n    locId,\r\n    posId,\r\n    start: formatDateTimeAsMvcString(start),\r\n    end: formatDateTimeAsMvcString(end),\r\n    sort,\r\n  };\r\n\r\n  return (await apiHelper.post(\r\n    user,\r\n    \"api/v2/employees/at-position\",\r\n    data\r\n  )) as IdName[];\r\n};\r\n\r\n// -----------------------------------------------------------------------------\r\nconst getEmployeeListForCommunication = async (\r\n  user: ApplicationUser,\r\n  locId: number,\r\n  depId: number,\r\n  posId: number,\r\n  channel: number,\r\n  role: string\r\n) => {\r\n  return (await apiHelper.post(\r\n    user,\r\n    \"api/v2/employees/get-communication-list\",\r\n    {\r\n      locId,\r\n      depId,\r\n      posId,\r\n      channel,\r\n      role,\r\n    }\r\n  )) as EmployeeCommunication[];\r\n};\r\n\r\n// -----------------------------------------------------------------------------\r\nconst submitFeedback = async (user: ApplicationUser, msg: string) => {\r\n  const data = {\r\n    version: env.settings.appVersionString,\r\n    buildDate: env.settings.buildDate,\r\n    environment: env.settings.env.item(user.environment).name,\r\n    os: env.settings.platform,\r\n    msg\r\n  }\r\n\r\n  return (await apiHelper.post(\r\n    user,\r\n    \"/api/v2/employees/submit-feedback\",\r\n    data)) as ApiResult;\r\n};\r\n\r\nexport default {\r\n  getEmployeesByLocationIdPositionIdAndActiveDateRange,\r\n  getEmployeeListForCommunication,\r\n  submitFeedback\r\n};\r\n","import { IonLoading } from \"@ionic/react\";\r\nimport React, { useState } from \"react\";\r\n\r\nexport function useShowLoading(message: string) {\r\n  const [showLoading, setShowLoading] = useState(false);\r\n  const showLoadingJsx = (\r\n    <IonLoading\r\n      isOpen={showLoading}\r\n      onDidDismiss={() => setShowLoading(false)}\r\n      spinner=\"dots\"\r\n      message={message}\r\n      duration={10000}\r\n    />\r\n  );\r\n\r\n  return {\r\n    showLoading,\r\n    setShowLoading,\r\n    showLoadingJsx,\r\n  };\r\n}\r\n","import React, { useContext, useState } from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonButtons,\r\n  IonIcon,\r\n  IonContent,\r\n  IonFooter,\r\n  IonHeader,\r\n  IonTitle,\r\n  IonToolbar, IonList, IonItem, IonTextarea,\r\n} from \"@ionic/react\";\r\nimport { arrowBackOutline } from \"ionicons/icons\";\r\nimport { ApplicationUserContext } from \"../context/ApplicationUserContext\";\r\nimport employeeApi from \"../api/EmployeesAPI\";\r\nimport {log} from \"../util/logger\";\r\nimport {useShowLoading} from \"../hooks/useShowLoading\";\r\n\r\ninterface SubmitFeedbackModalProps {\r\n  onDismissModal: (submitted: boolean) => void;\r\n  isOpen: boolean;\r\n}\r\n\r\n// -------------------------------------------------------------------------------------------\r\n//\r\n// -------------------------------------------------------------------------------------------\r\nconst SubmitFeedbackModal: React.FC<SubmitFeedbackModalProps> = ({\r\n  onDismissModal,\r\n}: SubmitFeedbackModalProps) => {\r\n\r\n  const { user } = useContext(ApplicationUserContext);\r\n  const [message, setMessage] = useState(\"\" as string | null | undefined);\r\n  const loading = useShowLoading(\"Submitting your message...\");\r\n\r\n  // -------------------------------------------------------------------------------------------\r\n  function onSubmitClick() {\r\n    if (message !== null && message !== undefined) {\r\n      loading.setShowLoading(true);\r\n      employeeApi.submitFeedback(user, message).then(res => {\r\n        log(\"submit-feedback\", { succeeded: !res.error});\r\n        loading.setShowLoading(false);\r\n        onDismissModal(true);\r\n      });\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IonHeader className=\"ion-no-border\">\r\n        <IonToolbar>\r\n          <IonButtons slot=\"start\">\r\n            <IonButton onClick={() => {onDismissModal(false)}}>\r\n              <IonIcon icon={arrowBackOutline} mode=\"md\" slot=\"icon-only\" />\r\n            </IonButton>\r\n          </IonButtons>\r\n          <IonTitle>Submit Ticket</IonTitle>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n\r\n      <IonContent class=\"outer-content\">\r\n        <IonList>\r\n          <IonItem>\r\n            <IonTextarea\r\n              value={message}\r\n              placeholder={\"Please enter your message here\"}\r\n              maxlength={180}\r\n              rows={20}\r\n              spellcheck={true}\r\n              wrap=\"hard\"\r\n              debounce={50}\r\n              onIonChange={(e) => {\r\n                setMessage(e.detail.value);\r\n              }}\r\n\r\n            />\r\n          </IonItem>\r\n\r\n        </IonList>\r\n        {loading.showLoadingJsx}\r\n\r\n      </IonContent>\r\n\r\n      <IonFooter>\r\n        <IonButton\r\n          className=\"apply-button\"\r\n          expand=\"block\"\r\n          onClick={onSubmitClick}\r\n          disabled={\r\n            message === null || message === undefined || message.length === 0\r\n          }\r\n        >\r\n          Submit\r\n        </IonButton>\r\n      </IonFooter>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SubmitFeedbackModal;\r\n","import {\r\n  IonContent,\r\n  IonHeader,\r\n  IonIcon,\r\n  IonItem,\r\n  IonLabel,\r\n  IonList,\r\n  IonMenu,\r\n  IonModal,\r\n  IonMenuToggle,\r\n  IonTitle,\r\n  IonToolbar,\r\n  IonFooter,\r\n} from \"@ionic/react\";\r\nimport { notifications, mail, logOut } from \"ionicons/icons\";\r\nimport React, { useState } from \"react\";\r\nimport \"../global-styles.scss\";\r\nimport { ApplicationUserContext } from \"../context/ApplicationUserContext\";\r\nimport env from \"../api/environment\";\r\nimport useDialogBox from \"../hooks/useDialogBox\";\r\nimport NotificationSettingsModal from \"./NotificationSettingsModal\";\r\nimport useSimpleToast from \"../hooks/useSimpleToast\";\r\nimport SubmitFeedbackModal from \"./SubmitFeedbackModal\";\r\n\r\nconst Menu: React.FC = () => {\r\n  const [disableMenu] = useState(false);\r\n  const { user } = React.useContext(ApplicationUserContext);\r\n  const environment = env.settings.env.item(user.environment);\r\n  const userName =\r\n    environment.key !== \"prod\" ? user.username!.substr(4) : user.username!;\r\n  const dlg = useDialogBox();\r\n  const [showNotificationsModal, setShowNotificationsModal] = useState(false);\r\n  const [showSubmitFeedbackModal, setShowSubmitFeedbackModal] = useState(false);\r\n  const toast = useSimpleToast();\r\n\r\n  function onCloseSubmitFeedbackModal(submitted: boolean) {\r\n    setShowSubmitFeedbackModal(false);\r\n    if (submitted) {\r\n      toast.showToast(\"Submitted, thank you!\");\r\n    }\r\n  }\r\n\r\n  /* tslint:disable:jsx-no-lambda */\r\n  return (\r\n    <IonMenu type=\"overlay\" disabled={disableMenu} contentId=\"main\">\r\n      <IonHeader className=\"ion-no-border\">\r\n        <IonToolbar>\r\n          <IonTitle>Menu</IonTitle>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n      <IonContent className=\"outer-content\">\r\n        {environment.key !== \"prod\" && (\r\n          <div className=\"username-header\">\r\n            {userName.toUpperCase()} ({environment.name.toUpperCase()})\r\n          </div>\r\n        )}\r\n        {environment.key === \"prod\" && <div className=\"username-header\">User {userName}</div>}\r\n        <IonList>\r\n          {/* <IonMenuToggle auto-hide=\"false\">\r\n            <IonItem button={true} >\r\n              <IonLabel>Settings</IonLabel>\r\n              <IonIcon slot=\"end\" icon={settings} />\r\n            </IonItem>\r\n          </IonMenuToggle> */}\r\n\r\n          <IonMenuToggle auto-hide=\"false\">\r\n            <IonItem\r\n              button={true}\r\n              onClick={() => {\r\n                setShowNotificationsModal(true);\r\n              }}\r\n            >\r\n              <IonLabel>Notifications</IonLabel>\r\n              <IonIcon slot=\"end\" icon={notifications} />\r\n            </IonItem>\r\n          </IonMenuToggle>\r\n          <IonMenuToggle auto-hide=\"false\">\r\n            <IonItem button={true} onClick={() => {setShowSubmitFeedbackModal(true)}}>\r\n              <IonLabel>Submit a Ticket</IonLabel>\r\n              <IonIcon slot=\"end\" icon={mail} />\r\n            </IonItem>\r\n          </IonMenuToggle>\r\n          <IonMenuToggle auto-hide=\"false\">\r\n            <IonItem button={true} routerLink=\"/logout\" routerDirection=\"none\">\r\n              <IonIcon slot=\"end\" icon={logOut} />\r\n              <IonLabel>Logout</IonLabel>\r\n            </IonItem>\r\n          </IonMenuToggle>\r\n        </IonList>\r\n        {dlg.alertBoxJsx}\r\n        {toast.simpleToastJsx}\r\n      </IonContent>\r\n      <IonFooter>\r\n        <div className=\"debug-info\">\r\n          Capacitor: {env.settings.hasCapacitor ? \"Yes\" : \"No\"}\r\n          <br />\r\n          Build Date: {env.settings.buildDate}\r\n          <br />\r\n          Version: {env.settings.appVersionString}\r\n        </div>\r\n      </IonFooter>\r\n\r\n      <IonModal isOpen={showNotificationsModal}>\r\n        <NotificationSettingsModal\r\n          onDismissModal={() => {\r\n            setShowNotificationsModal(false);\r\n          }}\r\n          isOpen={showNotificationsModal}\r\n        />\r\n      </IonModal>\r\n\r\n      <IonModal isOpen={showSubmitFeedbackModal}>\r\n        <SubmitFeedbackModal\r\n          onDismissModal={onCloseSubmitFeedbackModal}\r\n          isOpen={showSubmitFeedbackModal}\r\n        />\r\n      </IonModal>\r\n    </IonMenu>\r\n  );\r\n};\r\n\r\nexport default Menu;\r\n","/* eslint camelcase: 0 */\r\nimport {\r\n  AuthorizedItems,\r\n} from \"../orbital-interfaces/authorized-items\";\r\nimport { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport env from \"./environment\";\r\nimport apiHelper from \"./OrbitalApiHelper\";\r\n\r\ninterface AccessTokenResponse {\r\n  access_token: string;\r\n  token_type: string;\r\n  expires_in: number;\r\n  error?: string;\r\n  error_description?: string;\r\n  [\".issued\"]: string;\r\n  [\".expires\"]: string;\r\n}\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst authenticateUser = async (\r\n  username: string,\r\n  password: string,\r\n  environment: string\r\n) => {\r\n  console.log(\r\n    `Authenticating against ${env.settings.env.item(environment).name} (${\r\n      env.settings.env.item(environment).url\r\n    })`\r\n  );\r\n  const url = env.settings.env.item(environment).url + \"token\";\r\n  const body = `grant_type=password&username=${username}&password=${password}`;\r\n  try {\r\n    const response = await fetch(url, {\r\n      method: \"POST\",\r\n      body: body,\r\n    });\r\n\r\n    const json = (await response.json()) as AccessTokenResponse;\r\n    if (json.error || json.error_description) {\r\n      return {\r\n        loggedIn: false,\r\n        error: json.error_description,\r\n        access_token: \"\",\r\n      };\r\n    }\r\n\r\n    return { loggedIn: true, access_token: json.access_token };\r\n  } catch (err) {\r\n    console.error(\"Error returned from authentication request: \" + err);\r\n    return {\r\n      loggedIn: false,\r\n      err,\r\n      error: \"Error attempting to log in\",\r\n      access_token: \"\",\r\n    };\r\n  }\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getAuthorizedItems = async (user: ApplicationUser) => {\r\n  const result = (await apiHelper.get(\r\n    user,\r\n    \"api/v3/home/get-auth\"\r\n  )) as AuthorizedItems;\r\n  return result;\r\n};\r\n\r\nexport default {\r\n  authenticateUser,\r\n  getAuthorizedItems,\r\n};\r\n","import {\r\n  AdminAuthorization,\r\n  AuthorizedDepartment,\r\n  AuthorizedItems,\r\n  AuthorizedLocation,\r\n  AuthorizedPosition,\r\n  Role,\r\n} from \"../orbital-interfaces/authorized-items\";\r\nimport EventType from \"../enums/EventType\";\r\nimport EventStatus from \"../enums/EventStatus\";\r\n\r\nexport interface PositionEx {\r\n  location: AuthorizedLocation;\r\n  department: AuthorizedDepartment | null;\r\n  position: AuthorizedPosition | null;\r\n}\r\n\r\nexport interface SelectedPosition {\r\n  location: AuthorizedLocation;\r\n  position: AuthorizedPosition;\r\n}\r\n\r\nexport interface SelectedDepartment {\r\n  location: AuthorizedLocation;\r\n  department: AuthorizedDepartment | null;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getLocSettingsForLocationId = (\r\n  auth: AuthorizedItems,\r\n  locationId: number\r\n) => {\r\n  if (!auth || !auth.locations || auth.locations.length === 0) {\r\n    throw new Error(\r\n      \"getLocSettingsForLocationId: called with invalid auth parameter\"\r\n    );\r\n  }\r\n\r\n  if (locationId === 0) {\r\n    return auth.locations[0].settings;\r\n  }\r\n\r\n  return auth.locations.filter((loc) => loc.id === locationId)[0].settings;\r\n};\r\n\r\nconst getLocationIdFromPositionid = (auth: AuthorizedItems, posId: number): number => {\r\n  for (let i = 0; i < auth.locations.length; i++) {\r\n    const curLoc = auth.locations[i];\r\n    for (let j = 0; j < curLoc.departments.length; j++) {\r\n      const pos = curLoc.departments[j].positions.find(p => p.id === posId);\r\n      if (pos !== undefined) {\r\n        return curLoc.id;\r\n      }\r\n    }\r\n  }\r\n\r\n  throw new Error(\"getLocationIdFromPositionId: Could not find a location that had positionid \" + posId);\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getLocationFromLocationId = (\r\n  auth: AuthorizedItems,\r\n  locationId: number\r\n) => {\r\n  if (!auth || !auth.locations || auth.locations.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  if (locationId <= 0) {\r\n    return null;\r\n  }\r\n\r\n  return auth.locations.filter((l) => l.id === locationId)[0];\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\n// Returns true if the user can edit their own events (they have a position within one of\r\n// the admin's editable departments)\r\nconst canEditNonPositionEvents = (\r\n  auth: AuthorizedItems,\r\n  departmentId: number\r\n): boolean => {\r\n  const dept = auth.locations.flatMap((l) =>\r\n    l.departments.filter((d) => d.id === departmentId)\r\n  )[0];\r\n  if (\r\n    (dept.adminAuth & AdminAuthorization.CanEditSchedules) !==\r\n    AdminAuthorization.CanEditSchedules\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  return dept.positions.filter((p) => p.hasPosition).length > 0;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getPositionIdsForEmployee = (auth: AuthorizedItems): number[] => {\r\n  return auth.locations.flatMap((l) =>\r\n    l.departments.flatMap((d) =>\r\n      d.positions.filter((p) => p.hasPosition).map((p) => p.id)\r\n    )\r\n  );\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getDepartmentFromPositionId = (\r\n  auth: AuthorizedItems,\r\n  positionId: number\r\n) => {\r\n  if (!auth || !auth.locations || auth.locations.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  if (positionId <= 0) {\r\n    return null;\r\n  }\r\n\r\n  let foundDepartment = null as AuthorizedDepartment | null;\r\n  auth.locations.flatMap((l) =>\r\n    l.departments.map((d) => {\r\n      const foundPosition = d.positions.filter((p) => p.id === positionId);\r\n      if (foundPosition.length === 1) {\r\n        foundDepartment = d;\r\n        return d;\r\n      }\r\n\r\n      return null;\r\n    })\r\n  );\r\n\r\n  return foundDepartment;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\n// Returns true if the Admin can edit schedules for the passed-in department\r\nconst canEditSchedules = (\r\n  auth: AuthorizedItems,\r\n  locationId: number,\r\n  departmentId: number\r\n) => {\r\n  return (\r\n    (auth.locations\r\n      .filter((l) => l.id === locationId)[0]\r\n      .departments.filter((d) => d.id === departmentId)[0].adminAuth &\r\n      AdminAuthorization.CanEditSchedules) ===\r\n    AdminAuthorization.CanEditSchedules\r\n  );\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\n// Returns true if the event type is a type that is associated to a position (e.g.,\r\n// not an unavailable)\r\nconst isPositionSpecificEvent = (eventType: EventType) => {\r\n  return (\r\n    eventType === EventType.Shift ||\r\n    eventType === EventType.Cover ||\r\n    eventType === EventType.Clock ||\r\n    eventType === EventType.Absent\r\n  );\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\n// Returns true if 1) the user is an Admin and 2) they have a position in the passed-in department\r\nconst adminIsInDepartment = (auth: AuthorizedItems, departmentId: number) => {\r\n  if (auth.role !== Role.Admin) {\r\n    return false;\r\n  }\r\n\r\n  const dept = auth.locations.flatMap((l) =>\r\n    l.departments.filter((d) => d.id === departmentId)\r\n  )[0];\r\n  return dept.positions.filter((p) => p.hasPosition).length > 0;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getAdminAuthorizationForDepartment = (\r\n  auth: AuthorizedItems,\r\n  departmentId: number\r\n) => {\r\n  return auth.locations.flatMap((l) =>\r\n    l.departments.filter((d) => d.id === departmentId)\r\n  )[0].adminAuth;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst hasPosition = (auth: AuthorizedItems, positionId: number) => {\r\n  return (\r\n    auth.locations.flatMap((l) =>\r\n      l.departments.flatMap((d) =>\r\n        d.positions.filter((p) => p.hasPosition && p.id === positionId)\r\n      )\r\n    ).length > 0\r\n  );\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getSelectedDepartment = (\r\n  auth: AuthorizedItems,\r\n  locId: number,\r\n  depId: number\r\n): SelectedDepartment => {\r\n  const location = getLocationFromLocationId(auth, locId);\r\n  if (location === null) {\r\n    throw new Error(\r\n      `getSelectedDepartment: Could not find locationId \"${locId}\"`\r\n    );\r\n  }\r\n\r\n  if (depId === -1) {\r\n    return {\r\n      location,\r\n      department: null,\r\n    } as SelectedDepartment;\r\n  }\r\n\r\n  const department = location.departments.filter((d) => d.id === depId)[0];\r\n  return { location, department } as SelectedDepartment;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getSelectedPositionWithLocId = (\r\n  loc: AuthorizedLocation[],\r\n  locId: number,\r\n  posId: number\r\n) => {\r\n  const location = loc.filter((l) => l.id === locId)[0];\r\n  const position = location.departments.flatMap((d) =>\r\n    d.positions.filter((p) => p.id === posId)\r\n  )[0];\r\n  return { location, position };\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getSelectedPosition = (loc: AuthorizedLocation[], posId: number) => {\r\n  for (let locPosId = 0; locPosId < loc.length; locPosId++) {\r\n    for (\r\n      let depPosId = 0;\r\n      depPosId < loc[locPosId].departments.length;\r\n      depPosId++\r\n    ) {\r\n      for (\r\n        let posPosId = 0;\r\n        posPosId < loc[locPosId].departments[depPosId].positions.length;\r\n        posPosId++\r\n      ) {\r\n        if (\r\n          loc[locPosId].departments[depPosId].positions[posPosId].id === posId\r\n        ) {\r\n          return {\r\n            location: loc[locPosId],\r\n            position: loc[locPosId].departments[depPosId].positions[posPosId],\r\n          };\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    location: {} as AuthorizedLocation,\r\n    position: {} as AuthorizedPosition,\r\n  };\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst requiresGeolocation = (locations: AuthorizedLocation[]): boolean => {\r\n  for (let i = 0; i < locations.length; i++) {\r\n    if (locations[i].settings.RequireGeoLocation) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst isAdminForAllDepts = (auth: AuthorizedItems, locationId: number) => {\r\n  if (auth.role === Role.BusinessAdmin || auth.role === Role.LocationAdmin) {\r\n    return true;\r\n  }\r\n\r\n  if (auth.role === Role.Employee) {\r\n    return false;\r\n  }\r\n\r\n  const location = getLocationFromLocationId(auth, locationId);\r\n  return location?.adminAllDepts === true;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst isDeptAdmin = (auth: AuthorizedItems, departmentId: number): boolean => {\r\n  if (!auth || !auth.locations || auth.locations.length === 0) {\r\n    return false;\r\n  }\r\n\r\n  if (auth.role === Role.Employee) {\r\n    return false;\r\n  }\r\n\r\n  if (auth.role === Role.BusinessAdmin || auth.role === Role.LocationAdmin) {\r\n    return true;\r\n  }\r\n\r\n  const dept = auth.locations.flatMap((l) =>\r\n    l.departments.filter((d) => d.id === departmentId)\r\n  )[0];\r\n\r\n  return dept.isDeptAdmin;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst adminCan = (adminAuth: AdminAuthorization, value: AdminAuthorization) => {\r\n  return (adminAuth & value) === value;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst isAdminAuthorizedFor = (\r\n  auth: AuthorizedItems,\r\n  locationId: number,\r\n  departmentId: number,\r\n  adminAuth: AdminAuthorization\r\n): boolean => {\r\n  if (!auth || !auth.locations || auth.locations.length === 0) {\r\n    return false;\r\n  }\r\n\r\n  if (auth.role === Role.Employee) {\r\n    return false;\r\n  }\r\n\r\n  if (auth.role === Role.LocationAdmin || auth.role === Role.BusinessAdmin) {\r\n    return true;\r\n  }\r\n\r\n  if (departmentId === -1) {\r\n    const location = getLocationFromLocationId(auth, locationId);\r\n    return location?.adminAllDepts === true;\r\n  }\r\n\r\n  const dept = auth.locations.flatMap((l) =>\r\n    l.departments.filter((d) => d.id === departmentId)\r\n  )[0];\r\n\r\n  return (dept.adminAuth & adminAuth) === adminAuth;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getAdminDetpartments = (\r\n  auth: AuthorizedItems\r\n): AuthorizedDepartment[] => {\r\n  if (!auth || !auth.locations || auth.locations.length > 0) {\r\n    return [];\r\n  }\r\n\r\n  if (auth.role === Role.Employee) {\r\n    return [];\r\n  }\r\n\r\n  if (auth.role === Role.BusinessAdmin || auth.role === Role.LocationAdmin) {\r\n    return auth.locations.flatMap((l) => l.departments);\r\n  }\r\n\r\n  if (auth.role === Role.Admin) {\r\n    return auth.locations\r\n      .flatMap((l) => l.departments)\r\n      .filter((d) => d.isDeptAdmin);\r\n  }\r\n\r\n  return [];\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst isShiftTypeEvent = (eventType: EventType, eventStatus: EventStatus) => {\r\n  return (\r\n    (eventType === EventType.Shift && eventStatus === EventStatus.Approved) ||\r\n    (eventType === EventType.Cover && eventStatus === EventStatus.Request) ||\r\n    (eventType === EventType.Cover && eventStatus === EventStatus.RequestDenied)\r\n  );\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst isAuthItemsValid = (auth: AuthorizedItems | null | undefined): boolean => {\r\n  return auth !== null &&\r\n    auth !== undefined &&\r\n    auth!.locations !== undefined &&\r\n    auth!.locations !== null &&\r\n    auth!.locations.length > 0;\r\n};\r\n\r\nexport default {\r\n  adminCan,\r\n  getLocSettingsForLocationId,\r\n  getLocationFromLocationId,\r\n  getLocationIdFromPositionid,\r\n  getDepartmentFromPositionId,\r\n  getPositionIdsForEmployee,\r\n  isPositionSpecificEvent,\r\n  canEditSchedules,\r\n  getAdminAuthorizationForDepartment,\r\n  adminIsInDepartment,\r\n  canEditNonPositionEvents,\r\n  hasPosition,\r\n  isAuthItemsValid,\r\n  isShiftTypeEvent,\r\n  isDeptAdmin,\r\n  isAdminForAllDepts,\r\n  isAdminAuthorizedFor,\r\n  getSelectedDepartment,\r\n  getSelectedPositionWithLocId,\r\n  getSelectedPosition,\r\n  getAdminDetpartments,\r\n  requiresGeolocation,\r\n};\r\n","/* eslint-disable */\r\nimport React, {useState} from \"react\";\r\nimport {AuthorizedItems, Role, SubscriptionType} from \"../orbital-interfaces/authorized-items\";\r\nimport db from \"../data/dbStore\";\r\nimport UserAPI from \"../api/UserAPI\";\r\nimport {ApplicationUser,} from \"./ApplicationUserContext\";\r\nimport {log, setFirebaseUserProperties} from \"../util/logger\";\r\nimport {differenceInMinutes} from \"date-fns\";\r\nimport {getConstants} from \"../api/environment\";\r\nimport authHelper from \"../util/authitems-helper\";\r\n\r\nexport interface IAuthorizedItemsContext {\r\n  auth: AuthorizedItems;\r\n  refreshAuth: (\r\n    force: boolean,\r\n    newUser: ApplicationUser\r\n  ) => Promise<AuthorizedItems | null>;\r\n  clearAuth: () => Promise<void>;\r\n  authLoading: boolean;\r\n}\r\n\r\nconst INITIAL_AUTHORIZED_ITEMS: AuthorizedItems = {\r\n  subscriptionType: SubscriptionType.None,\r\n  businessId: 0,\r\n  businessName: \"\",\r\n  employeeId: 0,\r\n  firstOrNickName: \"\",\r\n  firstName:  \"\",\r\n  nickName: \"\",\r\n  middleName: \"\",\r\n  lastName: \"\",\r\n  fullName: \"\",\r\n  timeClock: false,\r\n  role: Role.Employee,\r\n  locations: [],\r\n  loading: false,\r\n  payrollEvents: [],\r\n  tags: [],\r\n  lastRefresh: undefined,\r\n};\r\n\r\nconst INITIAL_AUTHITEMS_CONTEXT = {\r\n  auth: INITIAL_AUTHORIZED_ITEMS,\r\n  refreshAuth: (force: boolean, newUser: ApplicationUser) => {\r\n    return new Promise<AuthorizedItems | null>(() => {});\r\n  },\r\n  clearAuth: async () => {},\r\n  authLoading: false,\r\n};\r\n\r\nexport const AuthorizedItemsContext = React.createContext<\r\n  IAuthorizedItemsContext\r\n>(INITIAL_AUTHITEMS_CONTEXT);\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nasync function getAuthItems(user: ApplicationUser, force: boolean): Promise<AuthorizedItems | null> {\r\n  if (!user.isLoggedin) {\r\n    const empty = { ...INITIAL_AUTHORIZED_ITEMS };\r\n    await db.putAuthItems(empty).then(() => {\r\n      log(\"indexdb_authitems_cleared\");\r\n    });\r\n\r\n    return empty;\r\n  }\r\n\r\n  if (!force) {\r\n    const authFromStore = await db.getAuthItems();\r\n\r\n    // if the auth in the IndexDB store had valid locations/data and\r\n    // the data wasn't 'stale' (older than our max number of minutes it can be old),\r\n    // then just return what was in the IndexDB\r\n    if (\r\n      authHelper.isAuthItemsValid(authFromStore) &&\r\n      authFromStore!.lastRefresh !== undefined &&\r\n      differenceInMinutes(new Date(), authFromStore!.lastRefresh) <\r\n        getConstants(user).maxStaleAuthItemsInMinutes\r\n    ) {\r\n      setFirebaseUserProperties(user, authFromStore!);\r\n      return authFromStore!;\r\n    }\r\n  }\r\n\r\n  const authFromApi = await UserAPI.getAuthorizedItems(user);\r\n  if (\r\n    authFromApi &&\r\n    authFromApi.locations &&\r\n    authFromApi.locations.length > 0\r\n  ) {\r\n    await db.putAuthItems({ ...authFromApi, lastRefresh: new Date() });\r\n    log(\"indexdb_authitems_put\", { employeeId: authFromApi.employeeId });\r\n    setFirebaseUserProperties(user, authFromApi);\r\n    return authFromApi;\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\n// ----------------------------------------------------------------------------------------------\r\n//\r\n// ----------------------------------------------------------------------------------------------\r\nexport const AuthorizedItemsContextProvider = (props: any) => {\r\n  const [auth, internalSetAuth] = useState({ ...INITIAL_AUTHORIZED_ITEMS });\r\n  const [authLoading, setLoading] = useState(false);\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  const refreshAuth = async (force: boolean, newUser: ApplicationUser) => {\r\n    setLoading(true);\r\n\r\n    if (!newUser.isLoggedin) {\r\n      const empty = { ...INITIAL_AUTHORIZED_ITEMS };\r\n      internalSetAuth(empty);\r\n      db.putAuthItems(empty).then(() => {\r\n        log(\"indexdb_authitems_cleared\");\r\n      });\r\n\r\n      setLoading(false);\r\n    }\r\n\r\n    // If we're not being asked to force a refresh from the API, and we already have\r\n    // auth data, and the the last refresh was less than the max time we're allowed to\r\n    // have 'stale' auth items, just return what we have\r\n    if (\r\n      !force &&\r\n      auth.employeeId > 0 &&\r\n      auth.lastRefresh !== undefined &&\r\n      differenceInMinutes(new Date(), auth.lastRefresh) <\r\n        getConstants(newUser).maxStaleAuthItemsInMinutes\r\n    ) {\r\n      return auth;\r\n    }\r\n\r\n    const newAuth = await getAuthItems(newUser, force);\r\n    setLoading(false);\r\n    if (newAuth) {\r\n      internalSetAuth(newAuth);\r\n    }\r\n\r\n    return newAuth;\r\n  };\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  const clearAuth = async (): Promise<void> => {\r\n    internalSetAuth(INITIAL_AUTHORIZED_ITEMS);\r\n    return await db.putAuthItems(INITIAL_AUTHORIZED_ITEMS);\r\n  };\r\n\r\n  return (\r\n    <AuthorizedItemsContext.Provider\r\n      value={{\r\n        auth,\r\n        refreshAuth,\r\n        clearAuth,\r\n        authLoading,\r\n      }}\r\n    >\r\n      {props.children}\r\n    </AuthorizedItemsContext.Provider>\r\n  );\r\n};\r\n// ---------------------------------------------------------------------------------------------\r\n","import React, { useState} from \"react\";\r\nimport {\r\n  IonContent,\r\n  IonPage,\r\n  IonRow,\r\n  IonCol,\r\n  IonButton,\r\n  IonList,\r\n  IonText,\r\n  IonLoading,\r\n  useIonViewWillEnter,\r\n} from \"@ionic/react\";\r\n// import \"./Login.scss\";\r\nimport \"../global-styles.scss\";\r\nimport UserAPI from \"../api/UserAPI\";\r\nimport { RouteComponentProps } from \"react-router\";\r\nimport useDialogBox from \"../hooks/useDialogBox\";\r\nimport { ApplicationUserContext } from \"../context/ApplicationUserContext\";\r\nimport env from \"../api/environment\";\r\nimport { log } from \"../util/logger\";\r\nimport { AuthorizedItemsContext } from \"../context/AuthorizedItemsContext\";\r\n\r\ninterface LoginProps extends RouteComponentProps {}\r\n\r\nfunction validate(username: string, password: string): boolean {\r\n  return username.length > 0 && password.length > 5;\r\n}\r\n\r\nconst Login: React.FC<LoginProps> = ({ history }: LoginProps) => {\r\n  const { alertBoxJsx, showAlert } = useDialogBox();\r\n  const { user, userLoggedIn, logout } = React.useContext(ApplicationUserContext);\r\n  const { refreshAuth } = React.useContext(AuthorizedItemsContext);\r\n  const [showLoading, setShowLoading] = useState(false);\r\n  const [username, setUsername] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [usernameErrors] = useState(\"\");\r\n  const [passwordErrors] = useState(\"\");\r\n  const [loginEnabled, setLoginEnabled] = useState(false);\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  const onUsernameChange = (newUsername: string) => {\r\n    setUsername(newUsername);\r\n    setLoginEnabled(validate(newUsername, password));\r\n  };\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  const onPasswordChange = (newPassword: string) => {\r\n    setPassword(newPassword);\r\n    setLoginEnabled(validate(username, newPassword));\r\n  };\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  const login = async () => {\r\n    if (!username || !password) {\r\n      return;\r\n    }\r\n\r\n    const envUser = env.getUserAndEnvironmentFromInput(username);\r\n    setShowLoading(true);\r\n    UserAPI.authenticateUser(\r\n      envUser.username,\r\n      password,\r\n      envUser.env.key\r\n    ).then(response => {\r\n      if (!response.loggedIn) {\r\n        setShowLoading(false);\r\n        log(\"login_failure\", {\r\n          username: envUser.username,\r\n          appVersion: env.settings.appVersionString,\r\n          environment: envUser.env.name,\r\n        });\r\n        const msg = response.error ? response.error : \"Could not log in\";\r\n        showAlert(\"Failed to log in\", msg, () => {\r\n          setPassword(\"\");\r\n          setLoginEnabled(false);\r\n        });\r\n\r\n        return;\r\n      }\r\n\r\n      // user is logged in, get auth-item data;\r\n      userLoggedIn(username, response.access_token, envUser.env.key).then(newUser => {\r\n        refreshAuth(true, newUser).then(() => {\r\n          log(\"login\", {\r\n            username: envUser.username,\r\n            appVersion: env.settings.appVersionString,\r\n            environment: envUser.env.name,\r\n          });\r\n\r\n          console.log(`logged in to ${envUser.env.name}: ${envUser.username}`);\r\n          history.push(\"/tabs/schedule\", { direction: \"none\" });\r\n          history.goForward();\r\n          setShowLoading(false);\r\n        }).catch(() => {\r\n          setShowLoading(false);\r\n          showAlert(\"Failed to log in\", \"Could not retreive user data\", () => {\r\n            logout();\r\n          })\r\n        });\r\n      }).catch(() => {\r\n        setShowLoading(false);\r\n        showAlert(\"Failed to log in\", \"Could not set access token\", () => {\r\n          logout();\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n/*\r\n\r\n  const oldlogin = async () => {\r\n    if (username && password) {\r\n      const envUser = env.getUserAndEnvironmentFromInput(username);\r\n      setShowLoading(true);\r\n      const response = await UserAPI.authenticateUser(\r\n        envUser.username,\r\n        password,\r\n        envUser.env.key\r\n      );\r\n      if (response.loggedIn) {\r\n        const newUser = await userLoggedIn(\r\n          username,\r\n          response.access_token,\r\n          envUser.env.key\r\n        );\r\n        await refreshAuth(true, newUser);\r\n        log(\"login\", {\r\n          username: envUser.username,\r\n          appVersion: env.settings.appVersionString,\r\n          environment: envUser.env.name,\r\n        });\r\n        console.log(`logged in to ${envUser.env.name}: ${envUser.username}`);\r\n        history.push(\"/tabs/schedule\", { direction: \"none\" });\r\n        history.goForward();\r\n        setShowLoading(false);\r\n      } else {\r\n        setShowLoading(false);\r\n        log(\"login_failure\", {\r\n          username: envUser.username,\r\n          appVersion: env.settings.appVersionString,\r\n          environment: envUser.env.name,\r\n        });\r\n        const msg = response.error ? response.error : \"Could not log in\";\r\n        showAlert(\"Failed to log in\", msg, () => {\r\n          setPassword(\"\");\r\n          setLoginEnabled(false);\r\n        });\r\n      }\r\n    }\r\n  };\r\n*/\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  useIonViewWillEnter(() => {\r\n    if (user.isLoggedin) {\r\n      history.push(\"/tabs/schedule\", { direction: \"forward\" });\r\n      history.goForward();\r\n    }\r\n  });\r\n\r\n  return (\r\n    <IonPage id=\"login-page\">\r\n      <IonContent className=\"login-content\">\r\n        <div className=\"login-logo\">\r\n          <img\r\n            className=\"logo\"\r\n            src=\"assets/img/OS Logo - 4pt Rounded _ 2 Tone Orange.svg\"\r\n            alt=\"Orbital Shift Logo\"\r\n          />\r\n        </div>\r\n\r\n        <IonLoading\r\n          isOpen={showLoading}\r\n          onDidDismiss={() => setShowLoading(false)}\r\n          spinner=\"dots\"\r\n          message={\"Logging in...\"}\r\n          duration={0}\r\n        />\r\n\r\n        {alertBoxJsx}\r\n\r\n        <IonList className=\"form-list\">\r\n          <div className=\"item\">\r\n            <div className=\"label\">User</div>\r\n            <div className=\"field-container\">\r\n              <input\r\n                className=\"input\"\r\n                id=\"username\"\r\n                name=\"username\"\r\n                type=\"text\"\r\n                value={username}\r\n                onChange={(e) => {\r\n                  onUsernameChange(e.target.value);\r\n                }}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {usernameErrors.length > 0 && (\r\n            <IonText color=\"light\">\r\n              <p className=\"ion-padding-start\">{usernameErrors}</p>\r\n            </IonText>\r\n          )}\r\n\r\n          <div className=\"item\">\r\n            <div className=\"label\">Password</div>\r\n            <div className=\"field-container\">\r\n              <input\r\n                className=\"input\"\r\n                id=\"password\"\r\n                name=\"password\"\r\n                type=\"password\"\r\n                value={password}\r\n                onChange={(e) => {\r\n                  onPasswordChange(e.target.value);\r\n                }}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {passwordErrors.length > 0 && (\r\n            <IonText color=\"light\">\r\n              <p className=\"ion-padding-start\">{passwordErrors}</p>\r\n            </IonText>\r\n          )}\r\n        </IonList>\r\n\r\n        <IonRow>\r\n          <IonCol>\r\n            <IonButton\r\n              className=\"login-button\"\r\n              type=\"submit\"\r\n              onClick={login}\r\n              expand=\"block\"\r\n              disabled={!loginEnabled}\r\n            >\r\n              LOG IN\r\n            </IonButton>\r\n          </IonCol>\r\n        </IonRow>\r\n      </IonContent>\r\n    </IonPage>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n","/* eslint camelcase: 0 */\r\nimport { ScheduleEvent } from \"../orbital-interfaces/ScheduleEvent\";\r\nimport { EditorValues } from \"../components/EditEvent/EditEventModalState\";\r\nimport { TECGetData } from \"../orbital-interfaces/TEC\";\r\nimport { EventFilter } from \"../orbital-interfaces/EventFilter\";\r\nimport { DailyNotes } from \"../orbital-interfaces/DailyNotes\";\r\nimport { DailyNotesFilter } from \"../orbital-interfaces/DailyNotesFilter\";\r\nimport { formatDateTimeAsMvcString } from \"../util/time-helper\";\r\nimport { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport apiHelper from \"./OrbitalApiHelper\";\r\nimport { RecurrenceUpdateType } from \"../enums/RecurrenceUpdateType\";\r\n\r\ninterface ErrorResponse {\r\n  error: boolean;\r\n  message: string;\r\n}\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getScheduleEvent = async (\r\n  user: ApplicationUser,\r\n  scheduleEventId: number\r\n): Promise<ScheduleEvent | null> => {\r\n  const result = await apiHelper.get(\r\n    user,\r\n    \"api/v2/employee/schedule-events/get/\" + scheduleEventId\r\n  );\r\n\r\n  if (result.error) {\r\n    return null;\r\n  }\r\n\r\n  return result as ScheduleEvent;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getScheduleEventsByFilter = async (\r\n  user: ApplicationUser,\r\n  filter: EventFilter\r\n) => {\r\n  const filterToSend = {\r\n    ...filter,\r\n    start: formatDateTimeAsMvcString(filter.start),\r\n    end: formatDateTimeAsMvcString(filter.end),\r\n  };\r\n\r\n  console.log(\"start: \" + filterToSend.start + \", end: \" + filterToSend.end);\r\n\r\n  return (await apiHelper.post(\r\n    user,\r\n    \"api/v2/employee/schedule-events/filter\",\r\n    filterToSend\r\n  )) as TECGetData;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getDailyNotesByFilter = async (\r\n  user: ApplicationUser,\r\n  filter: DailyNotesFilter\r\n) => {\r\n  const filterToSend = {\r\n    start: formatDateTimeAsMvcString(filter.start),\r\n    end: formatDateTimeAsMvcString(filter.end),\r\n    ...filter,\r\n  };\r\n\r\n  return (await apiHelper.post(\r\n    user,\r\n    \"api/v2/daily-notes/filter\",\r\n    filterToSend\r\n  )) as DailyNotes[];\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nfunction fixIsoStringForMvc(ds: string): string {\r\n  if (ds.length > 19) {\r\n    const result = ds.slice(0, 19);\r\n    return result;\r\n  }\r\n\r\n  return ds;\r\n}\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst updateScheduleEvent = async (\r\n  user: ApplicationUser,\r\n  eventValues: EditorValues,\r\n  recurrenceUpdateType: RecurrenceUpdateType | null\r\n) => {\r\n  const data = {\r\n    scheduleEventId: eventValues.scheduleEventId,\r\n    eventType: eventValues.eventType,\r\n    eventStatus: eventValues.eventStatus,\r\n    isConfirmed: eventValues.isConfirmed,\r\n    positionId: eventValues.position.position.id,\r\n    employeeId: eventValues.employee.id,\r\n    eventStart: fixIsoStringForMvc(eventValues.eventStart),\r\n    eventEnd: fixIsoStringForMvc(eventValues.eventEnd),\r\n    tagId: eventValues.tag?.id,\r\n    eventBreaks: eventValues.eventBreaks,\r\n    isClockedIn: eventValues.isClockedIn,\r\n    breakStart: null,\r\n    breakDuration: null,\r\n    clockOutValue: eventValues.clockoutValue,\r\n    absentTime: eventValues.absentTimeMinutes,\r\n    notes: eventValues.notes,\r\n    sendMessage: false,\r\n    recurrenceId: eventValues.recurrenceId,\r\n    recurrenceStart: eventValues.recurrenceStart,\r\n    recurrenceEnd: eventValues.recurrenceEnd,\r\n    recurrenceType: eventValues.recurrenceType,\r\n    repeatInterval: eventValues.repeatInterval,\r\n    repeatWeekdays: eventValues.repeatWeekdays,\r\n    recurrenceUpdateType,\r\n  };\r\n\r\n  return (await apiHelper.post(\r\n    user,\r\n    \"api/v2/employee/schedule-events/update\",\r\n    data\r\n  )) as ErrorResponse;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst createScheduleEvent = async (\r\n  user: ApplicationUser,\r\n  eventValues: EditorValues,\r\n  recurrenceUpdateType: RecurrenceUpdateType | null\r\n) => {\r\n  const data = {\r\n    sceduleEventId: 0,\r\n    eventType: eventValues.eventType,\r\n    eventStatus: eventValues.eventStatus,\r\n    isConfirmed: eventValues.isConfirmed,\r\n    positionId: eventValues.position.position.id,\r\n    employeeId: eventValues.employee.id,\r\n    eventStart: fixIsoStringForMvc(eventValues.eventStart),\r\n    eventEnd: fixIsoStringForMvc(eventValues.eventEnd),\r\n    tagId: eventValues.tag?.id,\r\n    eventBreaks: eventValues.eventBreaks,\r\n    isClockedIn: eventValues.isClockedIn,\r\n    breakStart: null,\r\n    breakDuration: null,\r\n    clockOutValue: eventValues.clockoutValue,\r\n    absentTime: eventValues.absentTimeMinutes,\r\n    notes: eventValues.notes,\r\n    sendMessage: false,\r\n    recurrenceId: eventValues.recurrenceId,\r\n    recurrenceStart: eventValues.recurrenceStart,\r\n    recurrenceEnd: eventValues.recurrenceEnd,\r\n    recurrenceType: eventValues.recurrenceType,\r\n    repeatInterval: eventValues.repeatInterval,\r\n    repeatWeekdays: eventValues.repeatWeekdays,\r\n    recurrenceUpdateType,\r\n  };\r\n\r\n  return (await apiHelper.post(\r\n    user,\r\n    \"api/v2/employee/schedule-events/create\",\r\n    data\r\n  )) as ErrorResponse;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst deleteScheduleEvent = async (\r\n  user: ApplicationUser,\r\n  scheduleEventId: number,\r\n  recurrenceUpdateType: RecurrenceUpdateType | null\r\n) => {\r\n  const data = {\r\n    scheduleEventId,\r\n    recurrenceUpdateType,\r\n    sendMessage: false,\r\n  };\r\n\r\n  return (await apiHelper.post(\r\n    user,\r\n    \"api/v2/employee/schedule-events/delete\",\r\n    data\r\n  )) as ErrorResponse;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst updateConfirmedScheduleEvent = async (\r\n  user: ApplicationUser,\r\n  id: number,\r\n  confirm: boolean\r\n) => {\r\n  const data = {id, confirm};\r\n  return (await apiHelper.post(\r\n    user,\r\n    \"api/v2/employee/schedule-events/confirm\",\r\n    data)) as ErrorResponse;\r\n};\r\n\r\nexport default {\r\n  getScheduleEvent,\r\n  getScheduleEventsByFilter,\r\n  getDailyNotesByFilter,\r\n  updateScheduleEvent,\r\n  createScheduleEvent,\r\n  deleteScheduleEvent,\r\n  updateConfirmedScheduleEvent\r\n};\r\n","\r\nexport enum EventFilterView {\r\n  schedule = 0,\r\n  clock = 1\r\n}\r\n\r\nexport interface EventFilter {\r\n  settingsLocId: number;\r\n  dnLocIds: number[];\r\n  start: Date;\r\n  end: Date;\r\n  filterByEmployee: boolean;\r\n  positionIds: number[];\r\n  eventTypeId: number;\r\n  eventStatusId: number;\r\n  tagId?: number;\r\n  view: EventFilterView;\r\n}\r\n\r\nexport const initialEventFilter: EventFilter = {\r\n  settingsLocId: 0,\r\n  dnLocIds: [],\r\n  start: new Date(),\r\n  end: new Date(),\r\n  filterByEmployee: false,\r\n  positionIds: [],\r\n  eventTypeId: -1,\r\n  eventStatusId: -1,\r\n  tagId: undefined,\r\n  view: EventFilterView.schedule\r\n};\r\n\r\nexport interface StoredEventFilter {\r\n  settingsLocId: number;\r\n  dnLocIds: number[];\r\n  positionIds: number[];\r\n  tagId?: number;\r\n  eventTypeId: number;\r\n  eventStatusId: number;\r\n}\r\n\r\nexport const initialStoredEventFilter: StoredEventFilter = {\r\n  settingsLocId: 0,\r\n  dnLocIds: [] as number[],\r\n  positionIds: [] as number[],\r\n  tagId: undefined as number | undefined,\r\n  eventTypeId: -1,\r\n  eventStatusId: -1\r\n};\r\n\r\n","import EventType from \"../../enums/EventType\";\r\nimport EventStatus from \"../../enums/EventStatus\";\r\nimport {\r\n  AdminAuthorization,\r\n  AuthorizedItems,\r\n  Role,\r\n} from \"../../orbital-interfaces/authorized-items\";\r\nimport { isAfter, parseISO } from \"date-fns\";\r\nimport authHelper from \"../../util/authitems-helper\";\r\n\r\nexport enum EventEditEnum {\r\n  None,\r\n  UndoCoverRequest,\r\n  CreateShiftRequest,\r\n  DeleteShiftRequest,\r\n  CreateCoverRequest,\r\n  Delete,\r\n}\r\n\r\nexport interface Option {\r\n  value: number;\r\n  text: string;\r\n}\r\n\r\nexport interface EventEditAuthorization {\r\n  buttonText: string;\r\n  enableConfirm: boolean;\r\n  isReadonly: boolean;\r\n  text: string;\r\n  usage: EventEditEnum;\r\n}\r\n\r\nexport const getEventNewAuthorization = (\r\n  auth: AuthorizedItems\r\n): EventEditAuthorization | null => {\r\n\r\n  // Unsure why eslint is not detecting that location, department,\r\n  // and position are actually being used, here; disabling for that\r\n  // reason.\r\n\r\n  // eslint-disable-next-line\r\n  let location = auth.locations[0];\r\n  // eslint-disable-next-line\r\n  let dept = auth.locations[0].departments[0];\r\n  // eslint-disable-next-line\r\n  let position = auth.locations[0].departments[0].positions[0];\r\n  let hasPositionFound = false;\r\n  for (let i = 0; i < auth.locations.length && !hasPositionFound; i++) {\r\n    for (\r\n      let j = 0;\r\n      j < auth.locations[i].departments.length && !hasPositionFound;\r\n      j++\r\n    ) {\r\n      for (\r\n        let k = 0;\r\n        k < auth.locations[i].departments[j].positions.length &&\r\n        !hasPositionFound;\r\n        k++\r\n      ) {\r\n        if (auth.locations[i].departments[j].positions[k].hasPosition) {\r\n          location = auth.locations[i];\r\n          dept = auth.locations[i].departments[j];\r\n          position = auth.locations[i].departments[j].positions[k];\r\n          hasPositionFound = true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    buttonText: \"\",\r\n    enableConfirm: true,\r\n    isReadonly: false,\r\n    text: \"\",\r\n    usage: EventEditEnum.None,\r\n  } as EventEditAuthorization;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nexport const getEventEditAuthorization = (\r\n  eventType: EventType,\r\n  eventStatus: EventStatus,\r\n  eventEmployeeId: number,\r\n  eventStart: string,\r\n  eventEnd: string,\r\n  eventLocationId: number,\r\n  eventDepartmentId: number,\r\n  eventPositionId: number,\r\n  eventConfirmed: boolean,\r\n  auth: AuthorizedItems\r\n): EventEditAuthorization | null => {\r\n\r\n  const retVal = {\r\n    buttonText: \"\",\r\n    enableConfirm: true,\r\n    isReadonly: false,\r\n    text: \"\",\r\n    usage: EventEditEnum.None,\r\n  } as EventEditAuthorization;\r\n\r\n  if (auth.role === Role.BusinessAdmin) {\r\n    return retVal;\r\n  }\r\n\r\n  if (auth.role === Role.LocationAdmin) {\r\n    if (authHelper.isPositionSpecificEvent(eventType)) {\r\n      if (auth.locations.filter((l) => l.id === eventLocationId).length === 0) {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    return retVal;\r\n  }\r\n\r\n  const endOfEvent = parseISO(eventEnd);\r\n  const now = new Date();\r\n  const afterEnd = isAfter(now, endOfEvent);\r\n  let employeeEvent = false;\r\n  const adminAuth = authHelper.getAdminAuthorizationForDepartment(\r\n    auth,\r\n    eventDepartmentId\r\n  );\r\n\r\n  // If the user is in the Admin role\r\n  if (auth.role === Role.Admin) {\r\n    if (eventEmployeeId === auth.employeeId) {\r\n      if (eventType === EventType.Clock) {\r\n        if (\r\n          (adminAuth & AdminAuthorization.CanEditOwnClockEvents) ===\r\n          AdminAuthorization.CanEditOwnClockEvents\r\n        ) {\r\n          return retVal;\r\n        } else {\r\n          return null;\r\n        }\r\n      }\r\n\r\n      if (\r\n        (adminAuth & AdminAuthorization.CanEditSchedules) ===\r\n        AdminAuthorization.CanEditSchedules\r\n      ) {\r\n        return retVal;\r\n      }\r\n\r\n      employeeEvent = true;\r\n    } else {\r\n      // Not the user's event, someone else's\r\n\r\n      if (eventType === EventType.Clock) {\r\n        if (\r\n          (adminAuth & AdminAuthorization.CanEditEmployeeClockEvents) ===\r\n          AdminAuthorization.CanEditEmployeeClockEvents\r\n        ) {\r\n          return retVal;\r\n        } else {\r\n          return null;\r\n        }\r\n      }\r\n\r\n      if (\r\n        authHelper.canEditSchedules(auth, eventLocationId, eventDepartmentId)\r\n      ) {\r\n        return retVal;\r\n      } else {\r\n        // If the admin has a position in the selected department\r\n        if (authHelper.adminIsInDepartment(auth, eventDepartmentId)) {\r\n          // Treat the admin as an employee for event editing\r\n          employeeEvent = true;\r\n        } else {\r\n          // disable editing\r\n          return null;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (auth.role === Role.Employee || employeeEvent) {\r\n    if (eventEmployeeId === auth.employeeId) {\r\n      if (afterEnd) {\r\n        return null;\r\n      }\r\n\r\n      if (eventType === EventType.Clock) {\r\n        return null;\r\n      }\r\n\r\n      if (eventType === EventType.Shift) {\r\n        if (eventStatus === EventStatus.Approved) {\r\n          return {\r\n            ...retVal,\r\n            buttonText: \"Create Cover-Request\",\r\n            isReadonly: true,\r\n            usage: EventEditEnum.CreateCoverRequest,\r\n          };\r\n        }\r\n\r\n        if (eventStatus === EventStatus.Request) {\r\n          return {\r\n            ...retVal,\r\n            buttonText: \"Undo Shift-Request\",\r\n            enableConfirm: false,\r\n            isReadonly: true,\r\n            text: \"Click OK to remove your Shift-Request\",\r\n            usage: EventEditEnum.DeleteShiftRequest,\r\n          };\r\n        }\r\n\r\n        // else Shift Request-Denied\r\n        return null;\r\n      }\r\n\r\n      if (eventType === EventType.Cover) {\r\n        if (eventStatus === EventStatus.Request) {\r\n          return {\r\n            ...retVal,\r\n            buttonText: \"Undo Cover-Request\",\r\n            enableConfirm: true,\r\n            isReadonly: true,\r\n            usage: EventEditEnum.UndoCoverRequest,\r\n          };\r\n        }\r\n\r\n        return null; // Cover Request-Denied\r\n      }\r\n\r\n      if (\r\n        !authHelper.isPositionSpecificEvent(eventType) &&\r\n        authHelper.canEditNonPositionEvents(auth, eventDepartmentId)\r\n      ) {\r\n        return {\r\n          ...retVal,\r\n          buttonText: \"Delete Request\",\r\n          enableConfirm: false,\r\n          isReadonly: true,\r\n          text: \"Click OK to delete this event\",\r\n          usage: EventEditEnum.Delete,\r\n        };\r\n      }\r\n\r\n      return null;\r\n    }\r\n\r\n    // This is someone else's event being viewed by an Employee\r\n    if (eventType === EventType.Cover && eventStatus === EventStatus.Request) {\r\n      return {\r\n        ...retVal,\r\n        buttonText: \"Make Shift-Request\",\r\n        enableConfirm: false,\r\n        isReadonly: true,\r\n        text: \"\",\r\n        usage: EventEditEnum.CreateShiftRequest,\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\n","import React, { useRef } from \"react\";\r\nimport \"../../global-styles.scss\";\r\nimport { IonIcon, IonDatetime } from \"@ionic/react\";\r\nimport { arrowBack, arrowForward, caretDown } from \"ionicons/icons\";\r\nimport { addDays, format, isSameDay, isToday, parseISO } from \"date-fns\";\r\n\r\ninterface WeekChooserProps {\r\n  startDate: Date;\r\n  setStartDate: (date: Date) => void;\r\n  onWeekdayClick: (date: Date) => void;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst WeekChooser: React.FC<WeekChooserProps> = ({\r\n  startDate,\r\n  setStartDate,\r\n  onWeekdayClick,\r\n}: WeekChooserProps) => {\r\n  const dateRef = useRef(startDate);\r\n\r\n  const onDateChanged = (newDate: Date) => {\r\n    if (!isSameDay(newDate, dateRef.current)) {\r\n      dateRef.current = newDate;\r\n      setStartDate(newDate);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"chooser\">\r\n      <div className=\"top\">\r\n        <button\r\n          onClick={() => onDateChanged(addDays(startDate, -7))}\r\n          className=\"arrow\"\r\n          key={-1}\r\n        >\r\n          <IonIcon mode=\"ios\" icon={arrowBack} />\r\n        </button>\r\n\r\n        <div className=\"month-year-container\">\r\n          <div className=\"datetime-picker-container\">\r\n            <IonDatetime\r\n              mode=\"ios\"\r\n              className=\"datetime-picker\"\r\n              displayFormat=\"MMM YYYY\"\r\n              pickerFormat=\"MMM D YYYY\"\r\n              min=\"2005-01-01\"\r\n              max=\"2030-01-01\"\r\n              value={startDate.toISOString()}\r\n              onIonChange={(e) => {\r\n                onDateChanged(parseISO(e.detail.value!));\r\n              }}\r\n            />\r\n            <IonIcon mode=\"md\" icon={caretDown} />\r\n          </div>\r\n        </div>\r\n\r\n        <button\r\n          onClick={() => onDateChanged(addDays(startDate, 7))}\r\n          className=\"arrow\"\r\n          key={7}\r\n        >\r\n          <IonIcon mode=\"ios\" icon={arrowForward} />\r\n        </button>\r\n      </div>\r\n      <div className=\"weekday-list\">\r\n        {[0, 1, 2, 3, 4, 5, 6].map((num: number) => {\r\n          const thisDate = addDays(startDate, num);\r\n          const isTodayClass = isToday(thisDate) ? \"today\" : \"not-today\";\r\n          return (\r\n            <button\r\n              key={num}\r\n              className=\"weekday-button\"\r\n              style={{ outline: \"none\" }}\r\n              onClick={() => {\r\n                onWeekdayClick(thisDate);\r\n              }}\r\n            >\r\n              <div>\r\n                <div className=\"weekday-abbr\">{format(thisDate, \"EEE\")}</div>\r\n                <div className={isTodayClass} />\r\n                <div className=\"weekday-num\">{format(thisDate, \"d\")}</div>\r\n              </div>\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default WeekChooser;\r\n","import React, { CSSProperties, useContext } from \"react\";\r\nimport {\r\n  getDurationStringFromTimeSpan,\r\n  getEventInformationStartEnd,\r\n} from \"../../util/time-helper\";\r\n// import \"./EventCard.scss\";\r\nimport \"../../global-styles.scss\";\r\nimport { AuthorizedLocation } from \"../../orbital-interfaces/authorized-items\";\r\nimport { format, parseISO } from \"date-fns\";\r\nimport { EventInformation } from \"../../orbital-interfaces/TEC\";\r\nimport { time } from \"ionicons/icons\";\r\nimport { IonIcon } from \"@ionic/react\";\r\nimport {\r\n  getEventEditAuthorization,\r\n  EventEditAuthorization,\r\n} from \"../EditEvent/EditEventAuthorization\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\nimport EventType from \"../../enums/EventType\";\r\n\r\ninterface EventCardProps {\r\n  event: EventInformation;\r\n  location: AuthorizedLocation;\r\n  multiLocation: boolean;\r\n  showEmployeeName: boolean;\r\n  onEdit: (ev: EventInformation, eventEditAuth: EventEditAuthorization) => void;\r\n}\r\n\r\nconst colorMap: any = {\r\n  1: \"#9CBA6A\",\r\n  2: \"#BFBFBF\",\r\n  3: \"#FFAD00\",\r\n  4: \"#C41A26\",\r\n  6: \"#677A46\",\r\n  7: \"#FFAD00\",\r\n};\r\n\r\nconst statusTimeColor: any = {\r\n  1: { color: \"black\" },\r\n  2: { color: \"#C41A26\" },\r\n  4: { color: \"#BCBCBC\" },\r\n};\r\n\r\nconst EventCard: React.FC<EventCardProps> = ({\r\n  location,\r\n  event,\r\n  multiLocation,\r\n  showEmployeeName,\r\n  onEdit,\r\n}: EventCardProps) => {\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n  const displayNameStyle: CSSProperties = showEmployeeName\r\n    ? { display: \"inline-block\" }\r\n    : { display: \"none\" };\r\n\r\n  const eventStartDate = parseISO(event.EventStart);\r\n  const multiDepartment = multiLocation\r\n    ? true\r\n    : location.departments.filter((d) =>\r\n        d.positions.filter((p) => p.hasPosition)\r\n      ).length > 1;\r\n\r\n  let posDisplay = \"\";\r\n  if (multiLocation && event.AbbreviatedLocationName) {\r\n    posDisplay = event.AbbreviatedLocationName + \"/\";\r\n  }\r\n\r\n  if (multiDepartment && event.AbbreviatedDepartmentName) {\r\n    posDisplay += event.AbbreviatedDepartmentName + \"/\";\r\n  }\r\n\r\n  posDisplay += event.PositionName;\r\n\r\n  const eventTypeBorder = {\r\n    borderLeft: `7px solid ${colorMap[event.EventTypeId]} `,\r\n  };\r\n\r\n  const timeColor: CSSProperties = statusTimeColor[event.EventStatusId];\r\n\r\n  const onUserClick = () => {\r\n    const eventEditAuth = getEventEditAuthorization(\r\n      event.EventTypeId,\r\n      event.EventStatusId,\r\n      event.EmployeeId,\r\n      event.EventStart,\r\n      event.EventEnd,\r\n      event.LocationId,\r\n      event.DepartmentId!,\r\n      event.PositionId,\r\n      event.IsConfirmed,\r\n      auth\r\n    );\r\n    if (eventEditAuth === null) {\r\n      return;\r\n    }\r\n\r\n    onEdit(event, eventEditAuth);\r\n  };\r\n\r\n  return (\r\n    <button\r\n      className=\"card\"\r\n      onClick={() => {\r\n        onUserClick();\r\n      }}\r\n    >\r\n      <div className=\"card-first-col\">\r\n        <div className=\"day-name\">{format(eventStartDate, \"EEE\")} </div>\r\n        <div className=\"day-number\">{format(eventStartDate, \"d\")}</div>\r\n      </div>\r\n      <div className=\"card-second-col\" style={eventTypeBorder}>\r\n        <div className=\"time-row\">\r\n          {event.IsClockedIn && <IonIcon icon={time} />}\r\n          <span style={timeColor}>\r\n            {getEventInformationStartEnd(event)}&nbsp;&nbsp;\r\n          </span>\r\n          {getDurationStringFromTimeSpan(\r\n            event.EventTypeId === EventType.Absent\r\n              ? event.Time\r\n              : event.EventDuration\r\n          )}\r\n        </div>\r\n        <div className=\"name-row\" style={displayNameStyle}>\r\n          {event.FirstName} {event.LastName}\r\n        </div>\r\n        <div className=\"dept-position-row\">\r\n          {posDisplay}&nbsp;&nbsp;\r\n          {event.Tag && `~${event.Tag}`}\r\n        </div>\r\n      </div>\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default EventCard;\r\n","import {\r\n  IonButton,\r\n  IonCol,\r\n  IonContent,\r\n  IonGrid,\r\n  IonHeader,\r\n  IonModal,\r\n  IonRow,\r\n  IonTitle,\r\n  IonToolbar,\r\n} from \"@ionic/react\";\r\nimport React, { useState } from \"react\";\r\n// import \"./useOrbitalDialogBox.scss\";\r\nimport \"../global-styles.scss\";\r\n\r\nexport interface DialogOptions {\r\n  value: number;\r\n  text: string;\r\n  color: string;\r\n}\r\n\r\nfunction useOrbitalDialogBox() {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [dialogData, setDialogData] = useState({\r\n    header: \"\",\r\n    message: \"\",\r\n    options: [] as DialogOptions[],\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    onDismiss: (selection: number | null) => {},\r\n  });\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const showDialog = (\r\n    header: string,\r\n    message: string,\r\n    dialogOptions: DialogOptions[],\r\n    onDismiss: (selection: number | null) => void\r\n  ) => {\r\n    setDialogData({\r\n      header,\r\n      message,\r\n      options: dialogOptions,\r\n      onDismiss,\r\n    });\r\n\r\n    setIsOpen(true);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onButtonClick = (selection: number | null) => {\r\n    setIsOpen(false);\r\n    dialogData.onDismiss(selection);\r\n  };\r\n\r\n  const dialogBoxJsx = (\r\n    <IonModal\r\n      isOpen={isOpen}\r\n      cssClass=\"mini-modal orbital-dialog-modal\"\r\n      onDidDismiss={() => onButtonClick(null)}\r\n    >\r\n      <IonContent className=\"modal-content\">\r\n        <IonHeader mode=\"ios\">\r\n          <IonToolbar>\r\n            <IonTitle>{dialogData.header}</IonTitle>\r\n          </IonToolbar>\r\n        </IonHeader>\r\n        <IonGrid>\r\n          {dialogData.options.map((opt) => (\r\n            <IonRow key={opt.value}>\r\n              <IonCol size=\"12\">\r\n                <IonButton\r\n                  expand=\"block\"\r\n                  color={opt.color}\r\n                  className=\"apply-button\"\r\n                  onClick={() => onButtonClick(opt.value)}\r\n                >\r\n                  {opt.text}\r\n                </IonButton>\r\n              </IonCol>\r\n            </IonRow>\r\n          ))}\r\n          <IonRow>\r\n            <IonCol size=\"12\">\r\n              <IonButton\r\n                expand=\"block\"\r\n                className=\"cancel-button\"\r\n                onClick={() => onButtonClick(null)}\r\n              >\r\n                Cancel\r\n              </IonButton>\r\n            </IonCol>\r\n          </IonRow>\r\n        </IonGrid>\r\n      </IonContent>\r\n    </IonModal>\r\n  );\r\n\r\n  return {\r\n    showDialog,\r\n    dialogBoxJsx,\r\n  };\r\n}\r\n\r\nexport default useOrbitalDialogBox;\r\n","import React, { useContext, useState } from \"react\";\r\nimport { IonItem, IonLabel, IonSelect, IonSelectOption } from \"@ionic/react\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\nimport authHelper, { SelectedDepartment } from \"../../util/authitems-helper\";\r\nimport { AdminAuthorization } from \"../../orbital-interfaces/authorized-items\";\r\n\r\ninterface DailyNoteDepartmentSelectorProps {\r\n  currentDepartment: SelectedDepartment;\r\n  onDepartmentUpdate: (dep: SelectedDepartment) => void;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst DailyNoteDepartmentSelector: React.FC<DailyNoteDepartmentSelectorProps> = ({\r\n  currentDepartment,\r\n  onDepartmentUpdate,\r\n}) => {\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n  const [selectedDepartment, setSelectedDepartment] = useState(\r\n    currentDepartment\r\n  );\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const updateLocation = (locId: number | undefined | null) => {\r\n    if (!locId) {\r\n      return;\r\n    }\r\n\r\n    const newSelection = {\r\n      location: auth.locations.filter((l) => l.id === locId)[0],\r\n      department: null,\r\n    };\r\n\r\n    setSelectedDepartment(newSelection);\r\n    onDepartmentUpdate(newSelection);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const updateDepartment = (depId: number | undefined | null) => {\r\n    if (depId === undefined) {\r\n      return;\r\n    }\r\n\r\n    const newSelection = {\r\n      location: selectedDepartment.location,\r\n      department:\r\n        depId === null\r\n          ? null\r\n          : selectedDepartment.location.departments.filter(\r\n              (d) => d.id === depId\r\n            )[0],\r\n    };\r\n\r\n    setSelectedDepartment(newSelection);\r\n    onDepartmentUpdate(newSelection);\r\n  };\r\n\r\n  if (!auth || !auth.locations || auth.locations.length === 0) {\r\n    return (\r\n      <>\r\n        <div>Loading</div>\r\n      </>\r\n    );\r\n  } else {\r\n    const selectedDepartmentId =\r\n      selectedDepartment.department !== null\r\n        ? selectedDepartment.department.id\r\n        : null;\r\n\r\n    return (\r\n      <>\r\n        <IonItem>\r\n          <IonLabel>Location</IonLabel>\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            interface=\"action-sheet\"\r\n            value={selectedDepartment.location.id}\r\n            onIonChange={(e) => updateLocation(e.detail.value)}\r\n          >\r\n            {auth.locations.map((loc) => (\r\n              <IonSelectOption key={loc.id} value={loc.id}>\r\n                {loc.name}\r\n              </IonSelectOption>\r\n            ))}\r\n          </IonSelect>\r\n        </IonItem>\r\n        <IonItem>\r\n          <IonLabel>Department</IonLabel>\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            interface=\"action-sheet\"\r\n            value={selectedDepartmentId}\r\n            onIonChange={(e) => updateDepartment(e.detail.value)}\r\n          >\r\n            {authHelper.isAdminForAllDepts(\r\n              auth,\r\n              selectedDepartment.location.id\r\n            ) && (\r\n              <IonSelectOption key={-1} value={null}>\r\n                All Departments\r\n              </IonSelectOption>\r\n            )}\r\n            {selectedDepartment.location.departments\r\n              .filter((dep) =>\r\n                authHelper.isAdminAuthorizedFor(\r\n                  auth,\r\n                  selectedDepartment.location.id,\r\n                  dep.id,\r\n                  AdminAuthorization.CanEditSchedules\r\n                )\r\n              )\r\n              .map((dep) => (\r\n                <IonSelectOption key={dep.id} value={dep.id}>\r\n                  {dep.name}\r\n                </IonSelectOption>\r\n              ))}\r\n          </IonSelect>\r\n        </IonItem>\r\n      </>\r\n    );\r\n  }\r\n};\r\n\r\nexport default DailyNoteDepartmentSelector;\r\n","import { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport apiHelper from \"./OrbitalApiHelper\";\r\nimport { formatDateTimeAsMvcString } from \"../util/time-helper\";\r\nimport { DailyNotes } from \"../orbital-interfaces/DailyNotes\";\r\n\r\nexport interface ApiResult {\r\n  error: boolean;\r\n  message: string;\r\n}\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst updateDailyNote = async (\r\n  user: ApplicationUser,\r\n  dailyNoteId: number,\r\n  text: string,\r\n  role: number,\r\n  date: Date\r\n) => {\r\n  const result = (await apiHelper.post(user, \"api/v2/daily-notes/update\", {\r\n    dailyNoteId,\r\n    date: formatDateTimeAsMvcString(date),\r\n    text,\r\n    role,\r\n  })) as ApiResult;\r\n\r\n  return result;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst insertDailyNote = async (\r\n  user: ApplicationUser,\r\n  locId: number,\r\n  depId: number,\r\n  role: number,\r\n  date: Date,\r\n  text: string\r\n) => {\r\n  const result = (await apiHelper.post(user, \"api/v2/daily-notes/insert\", {\r\n    locId,\r\n    depId,\r\n    role,\r\n    date,\r\n    text,\r\n  })) as ApiResult;\r\n\r\n  return result;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst deleteDailyNote = async (user: ApplicationUser, dailyNoteId: number) => {\r\n  const result = (await apiHelper.post(\r\n    user,\r\n    \"api/v2/daily-notes/delete/\" + dailyNoteId\r\n  )) as ApiResult;\r\n\r\n  return result;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getDailyNote = async (\r\n  user: ApplicationUser,\r\n  locId: number,\r\n  depId: number,\r\n  role: number,\r\n  date: Date\r\n): Promise<ApiResult | DailyNotes> => {\r\n  const result = (await apiHelper.post(user, \"api/v2/daily-notes/get\", {\r\n    locId,\r\n    depId,\r\n    role,\r\n    date,\r\n  })) as ApiResult | DailyNotes;\r\n\r\n  return result;\r\n};\r\n\r\nexport default {\r\n  getDailyNote,\r\n  updateDailyNote,\r\n  insertDailyNote,\r\n  deleteDailyNote,\r\n};\r\n","import React, { useContext, useEffect, useRef, useState } from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonButtons,\r\n  IonIcon,\r\n  IonContent,\r\n  IonHeader,\r\n  IonTitle,\r\n  IonToolbar,\r\n  IonList,\r\n  IonItem,\r\n  IonTextarea,\r\n  IonLabel,\r\n  IonSelect,\r\n  IonSelectOption,\r\n  IonDatetime,\r\n} from \"@ionic/react\";\r\nimport { arrowBackOutline } from \"ionicons/icons\";\r\nimport useDialogBox from \"../../hooks/useDialogBox\";\r\nimport useOrbitalDialogBox from \"../../hooks/useOrbitalDialogBox\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\nimport { DailyNotes } from \"../../orbital-interfaces/DailyNotes\";\r\nimport { isSameDay, parseISO } from \"date-fns\";\r\nimport authHelper, { SelectedDepartment } from \"../../util/authitems-helper\";\r\nimport DailyNoteDepartmentSelector from \"./DailyNoteDepartmentSelector\";\r\nimport \"../../global-styles.scss\";\r\nimport notesApi, { ApiResult } from \"../../api/DailyNotesAPI\";\r\nimport { ApplicationUserContext } from \"../../context/ApplicationUserContext\";\r\nimport useSimpleToast from \"../../hooks/useSimpleToast\";\r\nimport {\r\n  AuthorizedItems,\r\n  Role,\r\n} from \"../../orbital-interfaces/authorized-items\";\r\n\r\ninterface EditDailyNoteModalProps {\r\n  onCloseModal: (toastMessage: string) => void;\r\n  isOpen: boolean;\r\n  note: DailyNotes | null;\r\n  initialDate: Date;\r\n  newNoteClicked: boolean;\r\n}\r\n\r\nfunction isDifferentNote(left: DailyNotes | null, right: DailyNotes | null) {\r\n  if (left === null && right !== null) {\r\n    return true;\r\n  }\r\n\r\n  if (left !== null && right === null) {\r\n    return true;\r\n  }\r\n\r\n  if (left === null && right === null) {\r\n    return false;\r\n  }\r\n\r\n  if (left?.Role !== right?.Role) {\r\n    return true;\r\n  }\r\n\r\n  if (left?.DailyNoteId !== right?.DailyNoteId) {\r\n    return true;\r\n  }\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction getFirstAvailableDepartment(\r\n  auth: AuthorizedItems\r\n): SelectedDepartment {\r\n  for (let i = 0; i < auth.locations.length; i++) {\r\n    const curLoc = auth.locations[i];\r\n\r\n    if (curLoc.adminAllDepts) {\r\n      return {\r\n        location: curLoc,\r\n        department: null,\r\n      };\r\n    }\r\n\r\n    for (let j = 0; j < curLoc.departments.length; j++) {\r\n      const curDep = curLoc.departments[j];\r\n\r\n      if (\r\n        auth.role === Role.LocationAdmin ||\r\n        auth.role === Role.BusinessAdmin\r\n      ) {\r\n        return {\r\n          location: curLoc,\r\n          department: curDep,\r\n        };\r\n      }\r\n\r\n      if (curDep.isDeptAdmin) {\r\n        return {\r\n          location: curLoc,\r\n          department: curDep,\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  throw new Error(\"Could not find a department for this user to add a note\");\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst EditDailyNoteModal: React.FC<EditDailyNoteModalProps> = ({\r\n  onCloseModal,\r\n  isOpen,\r\n  note,\r\n  initialDate,\r\n}) => {\r\n  const [originalNote, setOriginalNote] = useState(note);\r\n  const toast = useSimpleToast();\r\n  const dlg = useDialogBox();\r\n  const { user } = useContext(ApplicationUserContext);\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n  const dialog = useOrbitalDialogBox();\r\n  const [selectedRole, setSelectedRole] = useState(\r\n    note !== null ? note.Role : 1\r\n  );\r\n\r\n  const [selectedDepartment, setSelectedDepartment] = useState(\r\n    note !== null\r\n      ? authHelper.getSelectedDepartment(\r\n          auth,\r\n          note.LocationId,\r\n          note.DepartmentId\r\n        )\r\n      : getFirstAvailableDepartment(auth)\r\n  );\r\n\r\n  const [noteText, setNoteText] = useState(note !== null ? note.Notes : \"\");\r\n  const noteCharCountRef = useRef(note !== null ? note.Notes.length : 0);\r\n  const [selectedDate, setSelectedDate] = useState(\r\n    note !== null ? parseISO(note.EventStart) : initialDate\r\n  );\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    if (isOpen) {\r\n      if (originalNote === null && isMounted) {\r\n        fetchDailyNote(selectedDepartment, selectedRole, selectedDate);\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      isMounted = false;\r\n    };\r\n\r\n    // eslint-disable-next-line\r\n  }, [isOpen, originalNote]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const fetchDailyNote = (\r\n    dep: SelectedDepartment,\r\n    role: number,\r\n    date: Date\r\n  ) => {\r\n    notesApi\r\n      .getDailyNote(\r\n        user,\r\n        dep.location.id,\r\n        dep.department === null ? -1 : dep.department.id,\r\n        role,\r\n        date\r\n      )\r\n      .then((res: DailyNotes | ApiResult) => {\r\n        if (\"message\" in res) {\r\n          if (res.error) {\r\n          } else {\r\n            setOriginalNote(null);\r\n          }\r\n        } else {\r\n          if (\r\n            originalNote !== null &&\r\n            originalNote.DailyNoteId === res.DailyNoteId\r\n          ) {\r\n            return;\r\n          }\r\n\r\n          if (isDifferentNote(res, originalNote)) {\r\n            setOriginalNote(res);\r\n          }\r\n\r\n          const newStart = parseISO(res.EventStart);\r\n          if (!isSameDay(newStart, selectedDate)) {\r\n            setSelectedDate(newStart);\r\n          }\r\n\r\n          if (\r\n            res.LocationId !== selectedDepartment.location.id ||\r\n            (res.DepartmentId === -1 &&\r\n              selectedDepartment.department !== null) ||\r\n            (res.DepartmentId !== -1 &&\r\n              selectedDepartment.department === null) ||\r\n            (selectedDepartment.department !== null &&\r\n              res.DepartmentId !== selectedDepartment.department.id)\r\n          ) {\r\n            setSelectedDepartment(\r\n              authHelper.getSelectedDepartment(\r\n                auth,\r\n                res.LocationId,\r\n                res.DepartmentId\r\n              )\r\n            );\r\n          }\r\n\r\n          if (res.Role !== selectedRole) {\r\n            setSelectedRole(res.Role);\r\n          }\r\n\r\n          if (res.Notes !== noteText) {\r\n            setNoteText(res.Notes);\r\n            noteCharCountRef.current = res.Notes.length;\r\n          }\r\n        }\r\n      });\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onCancel = () => {\r\n    if (\r\n      (originalNote === null && noteText != null) ||\r\n      (originalNote !== null && originalNote.Notes !== noteText)\r\n    ) {\r\n      updateBackend(\r\n        selectedDepartment,\r\n        selectedRole,\r\n        selectedDate,\r\n        noteText,\r\n        true\r\n      );\r\n    } else {\r\n      onCloseModal(\"\");\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const updateBackend = (\r\n    dep: SelectedDepartment,\r\n    role: number,\r\n    date: Date,\r\n    text: string,\r\n    isClosing: boolean\r\n  ) => {\r\n    if (\r\n      (originalNote === null && noteText.length === 0) ||\r\n      (originalNote !== null && originalNote.Notes === noteText)\r\n    ) {\r\n      if (isClosing) {\r\n        onCloseModal(\"\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (originalNote !== null) {\r\n      if (text.length === 0) {\r\n        notesApi.deleteDailyNote(user, originalNote.DailyNoteId).then((res) => {\r\n          if (res.error) {\r\n            dlg.showAlert(\"Can't Delete Note\", res.message, () => {});\r\n          } else {\r\n            if (isClosing) {\r\n              onCloseModal(\"Note Deleted\");\r\n            } else {\r\n              toast.showToast(\"Note Deleted\");\r\n            }\r\n          }\r\n        });\r\n      }\r\n      notesApi\r\n        .updateDailyNote(user, originalNote.DailyNoteId, text, role, date)\r\n        .then((res) => {\r\n          if (res.error) {\r\n            dlg.showAlert(\"Can't Update Note\", res.message, () => {});\r\n          } else {\r\n            if (isClosing) {\r\n              onCloseModal(\"Note Updated\");\r\n            } else {\r\n              toast.showToast(\"Note Updated\");\r\n            }\r\n          }\r\n        });\r\n    } else {\r\n      notesApi\r\n        .insertDailyNote(\r\n          user,\r\n          dep.location.id,\r\n          dep.department === null ? -1 : dep.department.id,\r\n          role,\r\n          date,\r\n          text\r\n        )\r\n        .then((res) => {\r\n          if (res.error) {\r\n            dlg.showAlert(\"Can't Add Daily Note\", res.message, () => {});\r\n          } else {\r\n            if (isClosing) {\r\n              onCloseModal(\"Note Added\");\r\n            } else {\r\n              toast.showToast(\"Note Added\");\r\n            }\r\n          }\r\n        });\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onDepartmentUpdate = (dep: SelectedDepartment) => {\r\n    if (\r\n      dep.location.id !== selectedDepartment.location.id ||\r\n      dep.department !== selectedDepartment.department\r\n    ) {\r\n      setSelectedDepartment(dep);\r\n      updateBackend(\r\n        selectedDepartment,\r\n        selectedRole,\r\n        selectedDate,\r\n        noteText,\r\n        false\r\n      );\r\n      fetchDailyNote(dep, selectedRole, selectedDate);\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onRoleUpdate = (newRole: number) => {\r\n    if (newRole !== selectedRole) {\r\n      setSelectedRole(newRole);\r\n      updateBackend(\r\n        selectedDepartment,\r\n        selectedRole,\r\n        selectedDate,\r\n        noteText,\r\n        false\r\n      );\r\n      fetchDailyNote(selectedDepartment, newRole, selectedDate);\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onDateSelected = (dateStr: string | null | undefined) => {\r\n    if (dateStr === null || dateStr === undefined) {\r\n      return;\r\n    }\r\n\r\n    const date = parseISO(dateStr);\r\n    if (date !== selectedDate) {\r\n      setSelectedDate(date);\r\n      updateBackend(\r\n        selectedDepartment,\r\n        selectedRole,\r\n        selectedDate,\r\n        noteText,\r\n        false\r\n      );\r\n      fetchDailyNote(selectedDepartment, selectedRole, date);\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onTextChanged = (newText: string | null | undefined) => {\r\n    if (newText === null || newText === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (newText.length !== noteCharCountRef.current) {\r\n      noteCharCountRef.current = newText.length;\r\n    }\r\n\r\n    if (newText !== noteText) {\r\n      setNoteText(newText);\r\n    }\r\n  };\r\n\r\n  if (!isOpen || !auth || !auth.locations || auth.locations.length === 0) {\r\n    return (\r\n      <>\r\n        <div>Loading</div>\r\n        {dlg.alertBoxJsx}\r\n      </>\r\n    );\r\n  } else {\r\n    return (\r\n      <>\r\n        <IonHeader className=\"ion-no-border\">\r\n          <IonToolbar>\r\n            <IonButtons slot=\"start\">\r\n              <IonButton onClick={onCancel}>\r\n                <IonIcon icon={arrowBackOutline} slot=\"icon-only\" />\r\n              </IonButton>\r\n            </IonButtons>\r\n            <IonTitle>Daily Notes</IonTitle>\r\n          </IonToolbar>\r\n        </IonHeader>\r\n\r\n        <IonContent class=\"edit-daily-modal-content\">\r\n          <IonList>\r\n            <DailyNoteDepartmentSelector\r\n              currentDepartment={selectedDepartment}\r\n              onDepartmentUpdate={onDepartmentUpdate}\r\n            />\r\n\r\n            <IonItem>\r\n              <IonLabel>Viewable By</IonLabel>\r\n              <IonSelect\r\n                mode=\"ios\"\r\n                interface=\"action-sheet\"\r\n                value={selectedRole}\r\n                onIonChange={(e) => {\r\n                  onRoleUpdate(e.detail.value);\r\n                }}\r\n              >\r\n                <IonSelectOption value={1} key={1}>\r\n                  Employees\r\n                </IonSelectOption>\r\n                <IonSelectOption value={2} key={2}>\r\n                  Admins\r\n                </IonSelectOption>\r\n              </IonSelect>\r\n            </IonItem>\r\n            <IonItem>\r\n              <IonLabel>Date</IonLabel>\r\n              <IonDatetime\r\n                mode=\"ios\"\r\n                displayFormat=\"DDD, M/DD/YY\"\r\n                pickerFormat=\"MMM D YYYY\"\r\n                min=\"2005-01-01\"\r\n                max=\"2030-01-01\"\r\n                value={selectedDate.toISOString()}\r\n                onIonChange={(e) => {\r\n                  onDateSelected(e.detail.value);\r\n                }}\r\n              />\r\n            </IonItem>\r\n            <IonItem>\r\n              <IonTextarea\r\n                value={noteText}\r\n                placeholder={\"Enter daily note\"}\r\n                maxlength={180}\r\n                rows={4}\r\n                spellcheck={true}\r\n                wrap=\"hard\"\r\n                debounce={50}\r\n                onIonChange={(e) => {\r\n                  onTextChanged(e.detail.value);\r\n                }}\r\n              />\r\n            </IonItem>\r\n            <div className=\"character-counter\">\r\n              {noteText?.length ?? 0}/180\r\n            </div>\r\n          </IonList>\r\n        </IonContent>\r\n\r\n        {dlg.alertBoxJsx}\r\n        {dialog.dialogBoxJsx}\r\n        {toast.simpleToastJsx}\r\n      </>\r\n    );\r\n  }\r\n};\r\n\r\nexport default EditDailyNoteModal;\r\n","import React, { useContext, useState } from \"react\";\r\n// import \"./DailyNoteCard.scss\";\r\nimport \"../../global-styles.scss\";\r\nimport {\r\n  AdminAuthorization,\r\n  AuthorizedLocation,\r\n  Role,\r\n} from \"../../orbital-interfaces/authorized-items\";\r\nimport { format, parseISO } from \"date-fns\";\r\nimport { DailyNotes } from \"../../orbital-interfaces/DailyNotes\";\r\nimport { IonModal } from \"@ionic/react\";\r\nimport EditDailyNoteModal from \"./EditDailyNoteModal\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\nimport authHelper from \"../../util/authitems-helper\";\r\n\r\ninterface EventCardProps {\r\n  note: DailyNotes;\r\n  location: AuthorizedLocation;\r\n  onForceRefresh: (toastMessage: string) => void;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst EventCard: React.FC<EventCardProps> = ({\r\n  note,\r\n  onForceRefresh,\r\n}: EventCardProps) => {\r\n  const noteDate = parseISO(note.EventStart);\r\n  const deptName = note.DepartmentId === -1 ? \"All Depts\" : note.DepartmentName;\r\n  const [showEditModal, setShowEditModal] = useState(false);\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onClose(toastMessage: string) {\r\n    onForceRefresh(toastMessage);\r\n    setShowEditModal(false);\r\n  }\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onClick() {\r\n    if (auth.role === Role.Employee) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      !authHelper.isAdminAuthorizedFor(\r\n        auth,\r\n        note.LocationId,\r\n        note.DepartmentId,\r\n        AdminAuthorization.CanEditSchedules\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    setShowEditModal(true);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <button className=\"card daily-note\" onClick={onClick}>\r\n        <div className=\"card-first-col\">\r\n          <div className=\"day-name\">{format(noteDate, \"EEE\")} </div>\r\n          <div className=\"day-number\">{format(noteDate, \"d\")}</div>\r\n        </div>\r\n        <div className=\"card-second-col\">\r\n          <div className=\"first-row\">\r\n            {deptName}: {note.Role === 1 ? \"Employees\" : \"Admins\"}\r\n            <br />\r\n            {note.Notes}\r\n          </div>\r\n        </div>\r\n      </button>\r\n\r\n      <IonModal\r\n        isOpen={showEditModal}\r\n        onDidDismiss={() => setShowEditModal(false)}\r\n      >\r\n        <EditDailyNoteModal\r\n          isOpen={showEditModal}\r\n          note={note}\r\n          onCloseModal={(toast) => onClose(toast)}\r\n          initialDate={new Date()}\r\n          newNoteClicked={true}\r\n        />\r\n      </IonModal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EventCard;\r\n","import React, { useContext, useState } from \"react\";\r\nimport { IonModal, IonButton, IonButtons } from \"@ionic/react\";\r\nimport EditDailyNoteModal from \"./EditDailyNoteModal\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\nimport {\r\n  AuthorizedItems,\r\n  Role,\r\n} from \"../../orbital-interfaces/authorized-items\";\r\n\r\ninterface AddDailyNoteButtonProps {\r\n  date: Date;\r\n  onForceRefresh: (toastMessage: string) => void;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction canAddNote(auth: AuthorizedItems) {\r\n  if (auth.role === Role.Employee) {\r\n    return false;\r\n  }\r\n\r\n  if (auth.role === Role.BusinessAdmin || auth.role === Role.LocationAdmin) {\r\n    return true;\r\n  }\r\n\r\n  for (let i = 0; i < auth.locations.length; i++) {\r\n    const curLoc = auth.locations[i];\r\n    if (curLoc.adminAllDepts) {\r\n      return true;\r\n    }\r\n\r\n    for (let j = 0; j < curLoc.departments.length; j++) {\r\n      if (curLoc.departments[j].isDeptAdmin) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst AddDailyNoteButton: React.FC<AddDailyNoteButtonProps> = ({\r\n  date,\r\n  onForceRefresh,\r\n}) => {\r\n  const [showEditModal, setShowEditModal] = useState(false);\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n\r\n  if (!canAddNote(auth)) {\r\n    return <span />;\r\n  }\r\n\r\n  const onClose = (toastMessage: string) => {\r\n    setShowEditModal(false);\r\n    onForceRefresh(toastMessage);\r\n  };\r\n\r\n  return (\r\n    <>\r\n        <IonButton\r\n          mode=\"md\"\r\n          className=\"add-dailynote-button\"\r\n          onClick={() => {\r\n            setShowEditModal(true);\r\n          }}\r\n        >\r\n          + Daily Note\r\n        </IonButton>\r\n\r\n      <IonModal\r\n        isOpen={showEditModal}\r\n        onDidDismiss={() => setShowEditModal(false)}\r\n      >\r\n        <EditDailyNoteModal\r\n          isOpen={showEditModal}\r\n          note={null}\r\n          initialDate={date}\r\n          onCloseModal={(toast) => {\r\n            onClose(toast);\r\n          }}\r\n          newNoteClicked={true}\r\n        />\r\n      </IonModal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AddDailyNoteButton;\r\n","import React from \"react\";\r\n// import \"./NoEventsToShow.scss\";\r\nimport \"../../global-styles.scss\";\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst NoEventsToShow: React.FC = () => {\r\n  return (\r\n    <div>\r\n      <span className=\"no-messagesOrEvents-text\">No Events</span>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NoEventsToShow;\r\n","import React, {forwardRef, Ref, useImperativeHandle} from \"react\";\r\nimport EventCard from \"./EventCard\";\r\nimport DailyNoteCard from \"./DailyNoteCard\";\r\nimport { AuthorizedLocation } from \"../../orbital-interfaces/authorized-items\";\r\nimport \"../../global-styles.scss\";\r\nimport { EventInformation } from \"../../orbital-interfaces/TEC\";\r\nimport { DailyNotes } from \"../../orbital-interfaces/DailyNotes\";\r\nimport { EventEditAuthorization } from \"../EditEvent/EditEventAuthorization\";\r\nimport AddDailyNoteButton from \"./AddDailyNoteButton\";\r\nimport NoEventsToShow from \"./NoEventsToShow\";\r\n\r\ninterface EventListSectionProps {\r\n  locations: AuthorizedLocation[];\r\n  events: EventInformation[];\r\n  notes: DailyNotes[];\r\n  header: string;\r\n  showEmployeeNames: boolean;\r\n  showTotalDuration: boolean;\r\n  onEdit: (ev: EventInformation, eventEditAuth: EventEditAuthorization) => void;\r\n  dailyNotesAddButtonDate: Date | null;\r\n  onForceRefresh: (toastMessage: string) => void;\r\n}\r\n\r\nexport interface EventListSectionRef {\r\n  scrollIntoView: () => void;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\n// eslint-disable-next-line react/display-name\r\nconst EventListSection = forwardRef((props: EventListSectionProps, ref: Ref<EventListSectionRef>) => {\r\n  const {\r\n    locations,\r\n    header,\r\n    events,\r\n    notes,\r\n    showEmployeeNames,\r\n    onEdit,\r\n    dailyNotesAddButtonDate,\r\n    onForceRefresh,\r\n  } = props;\r\n\r\n  const headerRef = React.createRef<HTMLDivElement>();\r\n\r\n  const multiLocation =\r\n    locations.filter((l) =>\r\n      l.departments.filter((d) => d.positions.filter((p) => p.hasPosition))\r\n    ).length > 1;\r\n\r\n  // --------------------------------------------------------------------------\r\n  useImperativeHandle(ref, () => ({\r\n\r\n    scrollIntoView() {\r\n      if (headerRef.current !== null) {\r\n        headerRef.current.scrollIntoView({\r\n          behavior: \"smooth\",\r\n          block: \"start\",\r\n          inline: \"start\"\r\n        });\r\n\r\n        setTimeout(() => {\r\n          if (headerRef.current !== null) {\r\n            headerRef.current!.focus();\r\n          }\r\n        }, 1000);\r\n      }\r\n    }\r\n  }));\r\n\r\n  return (\r\n    <>\r\n      <div tabIndex={0} ref={headerRef}  className=\"event-list-header\">\r\n        {header}\r\n        {dailyNotesAddButtonDate !== null && (\r\n          <AddDailyNoteButton\r\n            onForceRefresh={onForceRefresh}\r\n            date={dailyNotesAddButtonDate!}\r\n          />\r\n        )}\r\n      </div>\r\n      {notes.length === 0 && events.length === 0 && (\r\n        <NoEventsToShow />\r\n      )}\r\n      <div>\r\n        {notes.map((note) => (\r\n          <DailyNoteCard\r\n            onForceRefresh={onForceRefresh}\r\n            key={note.DailyNoteId}\r\n            note={note}\r\n            location={locations.filter((l) => l.id === note.LocationId)[0]}\r\n          />\r\n        ))}\r\n      </div>\r\n      <div>\r\n        {events.map((ev) => (\r\n          <EventCard\r\n            onEdit={onEdit}\r\n            key={ev.ScheduleEventId}\r\n            event={ev}\r\n            location={locations.filter((l) => l.id === ev.LocationId)[0]}\r\n            multiLocation={multiLocation}\r\n            showEmployeeName={showEmployeeNames}\r\n          />\r\n        ))}\r\n      </div>\r\n    </>\r\n  );\r\n});\r\n\r\nexport default EventListSection;\r\n","import React, {forwardRef, MutableRefObject, Ref, useImperativeHandle, useRef} from \"react\";\r\nimport \"../../global-styles.scss\";\r\nimport {\r\n  AuthorizedItems,\r\n  LocationSettings,\r\n} from \"../../orbital-interfaces/authorized-items\";\r\nimport {addDays, format, isBefore, parseISO} from \"date-fns\";\r\nimport { KeyedCollection } from \"../../util/KeyedCollection\";\r\nimport EventListSection, {EventListSectionRef} from \"./EventListSection\";\r\nimport {\r\n  getDurationFromTimeSpan,\r\n  getDurationString, getTodayStartForLocation,\r\n  getWeekStart,\r\n} from \"../../util/time-helper\";\r\nimport { EventInformation, HoursList } from \"../../orbital-interfaces/TEC\";\r\nimport { DailyNotes } from \"../../orbital-interfaces/DailyNotes\";\r\nimport { EventEditAuthorization } from \"../EditEvent/EditEventAuthorization\";\r\n\r\ninterface EventListProps {\r\n  events: EventInformation[];\r\n  notes: DailyNotes[];\r\n  hoursPerDay: HoursList[];\r\n  listType: \"my\" | \"requests\" | \"all\" | \"today\";\r\n  auth: AuthorizedItems;\r\n  onEdit: (ev: EventInformation, eventEditAuth: EventEditAuthorization) => void;\r\n  onForceRefresh: (toastMessage: string) => void;\r\n  weekStart: Date;\r\n}\r\n\r\ninterface SegmentItemList {\r\n  events: EventInformation[];\r\n  notes: DailyNotes[];\r\n  date: Date | null;\r\n  segmentRef?: MutableRefObject<EventListSectionRef | null>;\r\n}\r\n\r\nexport interface EventListRef {\r\n  scrollToDate: (d: Date) => void;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getSegmentsForToday = (\r\n  events: EventInformation[],\r\n  notes: DailyNotes[],\r\n  locationSettings: LocationSettings,\r\n  hoursPerDay: HoursList[],\r\n) => {\r\n  const todayStart = getTodayStartForLocation(new Date(), locationSettings);\r\n\r\n  let totalDuration = 0.0;\r\n  for(let i = 0; i < hoursPerDay.length; i++) {\r\n    totalDuration += getDurationFromTimeSpan(hoursPerDay[i].time);\r\n  }\r\n\r\n  const durationString = (totalDuration > 0.0)\r\n    ? getDurationString(totalDuration)\r\n    : \"\";\r\n\r\n  const header =\r\n    format(todayStart, \"h:mmaaa\").replace(\"M\", \"\") + \" \" +\r\n    format(todayStart, \"MMM d, yyyy\").toUpperCase() + \" \" +\r\n    durationString;\r\n\r\n  const segmentDate = new Date(todayStart.valueOf());\r\n  segmentDate.setHours(0,0,0,0);\r\n\r\n  const segments = new KeyedCollection<SegmentItemList>();\r\n  segments.add(header, { events, notes, date: segmentDate });\r\n  return segments;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getSegmentsForMy = (\r\n  events: EventInformation[],\r\n  notes: DailyNotes[],\r\n  locationSettings: LocationSettings,\r\n  hoursPerDay: HoursList[]\r\n) => {\r\n  const segments = new KeyedCollection<SegmentItemList>();\r\n  if (events.length === 0 && notes.length === 0) {\r\n    return segments;\r\n  }\r\n\r\n  let weekStart = new Date(2199, 1, 1);\r\n  if (events.length > 0) {\r\n    weekStart = getWeekStart(\r\n      parseISO(events[0].EventStart),\r\n      locationSettings.DayWeekStartsOn,\r\n      locationSettings.DayStartTime\r\n    );\r\n  }\r\n\r\n  if (notes.length > 0) {\r\n    const notesStart = getWeekStart(\r\n      parseISO(notes[0].EventStart),\r\n      locationSettings.DayWeekStartsOn,\r\n      locationSettings.DayStartTime\r\n    );\r\n    if (isBefore(notesStart, weekStart)) {\r\n      weekStart = notesStart;\r\n    }\r\n  }\r\n\r\n  const weekEnd = addDays(weekStart, 7);\r\n  const header =\r\n    `${format(weekStart, \"MMM d\")} - ${format(\r\n      weekEnd,\r\n      \"MMM d\"\r\n    )}`.toUpperCase() +\r\n    \" \" +\r\n    getDurationString(\r\n      hoursPerDay\r\n        .map((h) => getDurationFromTimeSpan(h.time))\r\n        .reduce((prev, cur) => prev + cur, 0)\r\n    );\r\n\r\n  segments.add(header, { events, notes, date: weekStart });\r\n  return segments;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getSegmentsForRequests = (\r\n  events: EventInformation[],\r\n  notes: DailyNotes[],\r\n  employeeId: number\r\n) => {\r\n  const segments = new KeyedCollection<SegmentItemList>();\r\n  segments.add(\"MY REQUESTS\", {\r\n    events: events.filter((ev) => ev.EmployeeId === employeeId),\r\n    notes: [],\r\n    date: null,\r\n  });\r\n  segments.add(\"CO-WORKERS\", {\r\n    events: events.filter((ev) => ev.EmployeeId !== employeeId),\r\n    notes: [],\r\n    date: null,\r\n  });\r\n  return segments;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst getSegmentsForAll = (events: EventInformation[], notes: DailyNotes[]) => {\r\n  const segments = new KeyedCollection<SegmentItemList>();\r\n  events.map((ev) => {\r\n    const thisDate = format(\r\n      parseISO(ev.EventStart).setHours(0, 0, 0, 0),\r\n      \"MMM d, yyyy\"\r\n    ).toUpperCase();\r\n    if (!segments.containsKey(thisDate)) {\r\n      const thisDatesNotes = notes.filter(\r\n        (n) =>\r\n          format(\r\n            parseISO(n.EventStart).setHours(0, 0, 0, 0),\r\n            \"MMM d, yyyy\"\r\n          ).toUpperCase() === thisDate\r\n      );\r\n      segments.add(thisDate, {\r\n        notes: thisDatesNotes,\r\n        events: [],\r\n        date: parseISO(ev.EventStart),\r\n      });\r\n    }\r\n\r\n    segments.item(thisDate).events.push(ev);\r\n    return thisDate;\r\n  });\r\n\r\n  return segments;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\n// eslint-disable-next-line react/display-name\r\nconst EventList = forwardRef((props: EventListProps, ref: Ref<EventListRef>) => {\r\n  const {\r\n    events,\r\n    notes,\r\n    hoursPerDay,\r\n    listType,\r\n    auth,\r\n    onEdit,\r\n    onForceRefresh,\r\n    weekStart\r\n  } = props;\r\n\r\n  let segments: KeyedCollection<SegmentItemList> = new KeyedCollection<\r\n    SegmentItemList\r\n    >();\r\n\r\n  switch (listType) {\r\n    case \"requests\":\r\n      segments = getSegmentsForRequests(events, notes, auth.employeeId);\r\n      break;\r\n    case \"my\":\r\n      segments = getSegmentsForMy(\r\n        events,\r\n        notes,\r\n        auth.locations[0].settings,\r\n        hoursPerDay\r\n      );\r\n      break;\r\n    case \"today\":\r\n      segments = getSegmentsForToday(events, notes, auth.locations[0].settings, hoursPerDay);\r\n      break;\r\n    default:\r\n      segments = getSegmentsForAll(events, notes);\r\n      break;\r\n  }\r\n\r\n  // ----------------------------------------------------------------------------\r\n  useImperativeHandle(ref, () => ({\r\n\r\n    scrollToDate(date: Date) {\r\n      const dateName = format(date, \"MMM d, yyyy\").toUpperCase();\r\n      const segkeys = segments.keys();\r\n      for (let i = 0; i < segkeys.length; i++) {\r\n        if (segkeys[i] === dateName) {\r\n          const curSeg = segments.item(segkeys[i]);\r\n          if (curSeg.segmentRef !== undefined &&\r\n            curSeg.segmentRef.current !== null) {\r\n            curSeg.segmentRef.current.scrollIntoView();\r\n\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n  }));\r\n\r\n  // We create a bunch of references, more than we need, so that they can\r\n  // be used if need be with the same number of useRef calls... which is\r\n  // a React requirement\r\n  const references = [-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10].map(dayOffset => {\r\n    const segName = format(\r\n      addDays(weekStart, dayOffset).setHours(0, 0, 0, 0),\r\n      \"MMM d, yyyy\"\r\n    ).toUpperCase();\r\n\r\n    const segRef = useRef(null as EventListSectionRef | null);\r\n\r\n    return { segName, segRef};\r\n  });\r\n\r\n\r\n  return (\r\n    <>\r\n      {segments.keys().map((seg) => {\r\n        const refLookup = references.find(r => seg === r.segName)\r\n        const thisRef = refLookup !== undefined\r\n          ? refLookup.segRef\r\n          : references[0].segRef;\r\n        segments.item(seg).segmentRef = thisRef;\r\n        return (\r\n          <EventListSection\r\n            ref={thisRef}\r\n            onEdit={onEdit}\r\n            key={seg}\r\n            header={seg}\r\n            locations={auth.locations}\r\n            events={segments.item(seg).events}\r\n            notes={segments.item(seg).notes}\r\n            showEmployeeNames={listType === \"all\" || seg === \"CO-WORKERS\"}\r\n            showTotalDuration={listType !== \"requests\"}\r\n            dailyNotesAddButtonDate={segments.item(seg).date}\r\n            onForceRefresh={onForceRefresh}\r\n          />\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n\r\n\r\n\r\n});\r\n\r\nexport default EventList;\r\n","import EventGroup from \"../enums/EventGroup\";\r\nimport { EventFilter } from \"../orbital-interfaces/EventFilter\";\r\nimport { AuthorizedItems } from \"../orbital-interfaces/authorized-items\";\r\nimport EventType from \"../enums/EventType\";\r\n\r\nexport interface EventTypeOption {\r\n  value: number;\r\n  text: string;\r\n  color: string;\r\n}\r\n\r\nexport const getFilterByEventGroup = (\r\n  f: EventFilter,\r\n  group: EventGroup\r\n): EventFilter => {\r\n  return group === EventGroup.Custom\r\n    ? { ...f, eventTypeId: -1, eventStatusId: -1 }\r\n    : { ...f, eventTypeId: group, eventStatusId: group };\r\n};\r\n\r\nexport const getEventTypeOptions = (\r\n  auth: AuthorizedItems,\r\n  filter?: EventFilter\r\n): EventTypeOption[] => {\r\n  if (!auth || !auth.locations || auth.locations.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  const locSettings = auth.locations[0].settings;\r\n\r\n  const eventTypeOptions: EventTypeOption[] = [\r\n    {\r\n      value: EventType.Shift,\r\n      text: \"SHIFT\",\r\n      color: \"green\",\r\n    },\r\n    {\r\n      value: EventType.Cover,\r\n      text: \"COVER\",\r\n      color: \"red\",\r\n    },\r\n  ];\r\n\r\n  if (filter) {\r\n    eventTypeOptions.unshift({ value: -1, text: \"ALL\", color: \"black\" });\r\n  }\r\n\r\n  eventTypeOptions.push({\r\n    value: EventType.Clock,\r\n    text: \"CLOCK\",\r\n    color: \"green\",\r\n  });\r\n\r\n  if (locSettings.ShowUnavailableEventType) {\r\n    eventTypeOptions.push({\r\n      value: EventType.Unavailable,\r\n      text: \"UNAVAILABLE\",\r\n      color: \"yellow\",\r\n    });\r\n  }\r\n\r\n  if (locSettings.ShowVacationEventType) {\r\n    eventTypeOptions.push({\r\n      value: EventType.Vacation,\r\n      text: \"VACATION\",\r\n      color: \"yellow\",\r\n    });\r\n  }\r\n\r\n  if (locSettings.ShowAbsentEventType) {\r\n    const peTypes: EventTypeOption[] = [];\r\n    const p2l: any = {};\r\n    auth.locations.flatMap((l) =>\r\n      l.departments.flatMap((d) => d.positions.map((p) => (p2l[p.id] = l)))\r\n    );\r\n\r\n    auth.payrollEvents.map((pe) => {\r\n      if (!pe.name.startsWith(\"--\")) {\r\n        if (filter) {\r\n          if (\r\n            pe.positionIds.some((id) => filter.positionIds.indexOf(id) >= 0)\r\n          ) {\r\n            peTypes.push({\r\n              value: pe.id,\r\n              text: `${pe.name} (${p2l[pe.positionIds[0]].name})`,\r\n              color: \"yellow\",\r\n            });\r\n          }\r\n        } else {\r\n          peTypes.push({\r\n            value: pe.id,\r\n            text: `${pe.name} (${p2l[pe.positionIds[0]].name})`,\r\n            color: \"yellow\",\r\n          });\r\n        }\r\n\r\n        return pe;\r\n      } else {\r\n        return null;\r\n      }\r\n    });\r\n    peTypes.sort((p1, p2) => {\r\n      return p1.text > p2.text ? 1 : -1;\r\n    });\r\n    return eventTypeOptions.concat(peTypes);\r\n  }\r\n\r\n  return eventTypeOptions;\r\n};\r\n","const arrayHelper = {\r\n  // ------------------------------------------------------------------------------------\r\n  areEqual: <T extends {}>(a1: T[], a2: T[]): boolean => {\r\n    if ((!a1 && a2) || (a1 && !a2)) {\r\n      return false;\r\n    }\r\n\r\n    if (!a1 && !a2) {\r\n      return true;\r\n    }\r\n\r\n    if (a1.length !== a2.length) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < a1.length; i++) {\r\n      if (!arrayHelper.contains(a2, a1[i])) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  },\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  contains: <T extends {}>(arr: T[], val: T): boolean => {\r\n    for (let i = 0; i < arr.length; i++) {\r\n      if (arr[i] === val) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  },\r\n\r\n  containsAny: <T extends {}>(arr1: T[], arr2: T[]): boolean => {\r\n    for (let i = 0; i < arr1.length; i++) {\r\n      if (arr2.includes(arr1[i])) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  },\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  unique: <T extends {}>(arr: T[]): T[] => {\r\n    const newArr: T[] = [];\r\n    // eslint-disable-next-line\r\n    arr.map((item) => {\r\n      if (!arrayHelper.contains(newArr, item)) {\r\n        newArr.push(item);\r\n      }\r\n    });\r\n\r\n    return newArr;\r\n  },\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  uniqueObject: <T extends {}>(\r\n    arr: T[],\r\n    filt: (o: T, n: T) => boolean\r\n  ): T[] => {\r\n    const newArr: T[] = [];\r\n    // eslint-disable-next-line\r\n    arr.map((item) => {\r\n      let found = false;\r\n      for (let i = 0; i < newArr.length; i++) {\r\n        if (filt(newArr[i], item)) {\r\n          found = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (!found) {\r\n        newArr.push(item);\r\n      }\r\n    });\r\n\r\n    return newArr;\r\n  },\r\n};\r\n\r\nexport default arrayHelper;\r\n","import {\r\n  EventFilter,\r\n  StoredEventFilter,\r\n  initialStoredEventFilter,\r\n  initialEventFilter\r\n} from \"../orbital-interfaces/EventFilter\";\r\nimport {AuthorizedItems} from \"../orbital-interfaces/authorized-items\";\r\nimport authHelper from \"../util/authitems-helper\";\r\nimport arrayHelper from \"../util/array-helper\";\r\n\r\nconst FILTER_STORAGE_KEY = \"scheduleEventFilter\";\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction getFilter(auth: AuthorizedItems): StoredEventFilter {\r\n  let filter = {...initialStoredEventFilter};\r\n\r\n  const str = localStorage.getItem(FILTER_STORAGE_KEY);\r\n  if (str !== null) {\r\n    filter = JSON.parse(str) as StoredEventFilter;\r\n  }\r\n\r\n  if (authHelper.isAuthItemsValid(auth)) {\r\n    if (filter.positionIds === undefined || filter.positionIds.length === 0) {\r\n      filter.positionIds = auth.locations.flatMap((l) =>\r\n        l.departments.flatMap((d) =>\r\n          d.positions.map((p) => p.id)));\r\n    }\r\n\r\n    if (filter.dnLocIds === undefined || filter.dnLocIds.length === 0) {\r\n      filter.dnLocIds = auth.locations.map(l => l.id);\r\n    }\r\n\r\n    if (filter.settingsLocId === undefined || filter.settingsLocId === 0) {\r\n      filter.settingsLocId = auth.locations[0].id;\r\n    }\r\n  }\r\n\r\n  return filter;\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction putFilter(filter: EventFilter) {\r\n  const storedFilter: StoredEventFilter= {\r\n    settingsLocId: filter.settingsLocId,\r\n    dnLocIds: filter.dnLocIds,\r\n    positionIds: filter.positionIds,\r\n    tagId: filter.tagId,\r\n    eventStatusId: filter.eventStatusId,\r\n    eventTypeId: filter.eventTypeId\r\n  };\r\n\r\n  localStorage.setItem(FILTER_STORAGE_KEY, JSON.stringify(storedFilter));\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction clear() {\r\n  localStorage.removeItem(FILTER_STORAGE_KEY);\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction getDefaultFilter(auth: AuthorizedItems, filter: EventFilter): EventFilter {\r\n  return {\r\n    ...initialEventFilter,\r\n    start: filter.start,\r\n    end: filter.end,\r\n    tagId: -1,\r\n    positionIds: auth.locations.flatMap((l) =>\r\n      l.departments.flatMap((d) => d.positions.map((p) => p.id))\r\n    ),\r\n    dnLocIds: auth.locations.map((l) => l.id),\r\n    settingsLocId: auth.locations[0].id,\r\n  };\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction tagIsEqual(tagId1: number | undefined, tagId2: number | undefined) {\r\n  return (\r\n    (tagId1 === undefined && tagId2 === -1) ||\r\n    (tagId1 === -1 && tagId2 === undefined) ||\r\n    (tagId1 === tagId2)\r\n  );\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction isFilterApplied(auth: AuthorizedItems, filter: EventFilter): boolean {\r\n  const defaultFilter = getDefaultFilter(auth, filter);\r\n\r\n  const filterApplied = !(\r\n    defaultFilter.eventTypeId === filter.eventTypeId &&\r\n    defaultFilter.eventStatusId === filter.eventStatusId &&\r\n    tagIsEqual(defaultFilter.tagId, filter.tagId) &&\r\n    arrayHelper.areEqual(\r\n      defaultFilter.positionIds,\r\n      filter.positionIds\r\n    )\r\n  );\r\n\r\n  return filterApplied;\r\n}\r\n\r\nexport const filterStore = {\r\n  getFilter,\r\n  putFilter,\r\n  isFilterApplied,\r\n  getDefaultFilter,\r\n  clear,\r\n  tagIsEqual\r\n}\r\n","import React, { useState, useEffect } from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonButtons,\r\n  IonIcon,\r\n  IonContent,\r\n  IonFooter,\r\n  IonHeader,\r\n  IonItem,\r\n  IonLabel,\r\n  IonSelect,\r\n  IonSelectOption,\r\n  IonTitle,\r\n  IonToolbar,\r\n} from \"@ionic/react\";\r\nimport { EventFilter } from \"../../orbital-interfaces/EventFilter\";\r\nimport { arrowBackOutline } from \"ionicons/icons\";\r\nimport \"../../global-styles.scss\";\r\nimport EventGroup from \"../../enums/EventGroup\";\r\nimport {\r\n  getFilterByEventGroup,\r\n  getEventTypeOptions,\r\n} from \"../../util/event-helper\";\r\nimport { AuthorizedItems } from \"../../orbital-interfaces/authorized-items\";\r\nimport { filterStore } from \"../../data/filterStore\";\r\nimport authHelper from \"../../util/authitems-helper\";\r\n\r\ninterface ScheduleFilterModalProps {\r\n  filter: EventFilter;\r\n  auth: AuthorizedItems;\r\n  onDismissModal: (f: EventFilter, filterApplied: boolean) => void;\r\n  onCancelModal: () => void;\r\n  isOpen: boolean;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction getInitialSelectionsByFilter(\r\n  auth: AuthorizedItems,\r\n  filter: EventFilter\r\n) {\r\n  const locIds = [] as string[];\r\n  const depIds = [] as string[];\r\n  const posIds = [] as string[];\r\n\r\n  if (!authHelper.isAuthItemsValid(auth)) {\r\n    return [[] as string[], [] as string[], [] as string[]];\r\n  }\r\n\r\n  auth.locations.map((l) =>\r\n    l.departments.map((d) =>\r\n      d.positions.map((p) => {\r\n        if (filter.positionIds.includes(p.id)) {\r\n          const newLocId = l.id.toString();\r\n          const newDepId = d.id.toString();\r\n          if (!locIds.includes(newLocId)) {\r\n            locIds.push(newLocId);\r\n          }\r\n\r\n          if (!depIds.includes(newDepId)) {\r\n            depIds.push(newDepId);\r\n          }\r\n        }\r\n\r\n        posIds.push(p.id.toString());\r\n\r\n        return p.id;\r\n      })\r\n    )\r\n  );\r\n\r\n  return [locIds, depIds, posIds];\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst ScheduleFilterModal: React.FC<ScheduleFilterModalProps> = ({\r\n  auth,\r\n  filter,\r\n  onDismissModal,\r\n  onCancelModal,\r\n  isOpen,\r\n}: ScheduleFilterModalProps) => {\r\n  const [\r\n    initialLocIds,\r\n    initialDepIds,\r\n    initialPosIds,\r\n  ] = getInitialSelectionsByFilter(auth, filter);\r\n  const [myFilter, setMyFilter] = useState(filter);\r\n  const [showCustomEventTypes, setShowCustomEventTypes] = useState(false);\r\n  const [eventGroup, setEventGroup] = useState(EventGroup.ClockAndSched);\r\n  const [eventTypeList, setEventTypeList] = useState(\r\n    getEventTypeOptions(auth, filter)\r\n  );\r\n  const [locationIds, setLocationIds] = useState(initialLocIds);\r\n  const [departmentIds, setDepartmentIds] = useState(initialDepIds);\r\n  const [positionIds, setPositionIds] = useState(initialPosIds);\r\n  const [isDirty, setIsDirty] = useState(false);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    setMyFilter(filter);\r\n  }, [filter]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setIsDirty(false);\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onReset = () => {\r\n    setShowCustomEventTypes(false);\r\n    setEventGroup(EventGroup.ClockAndSched);\r\n    setEventTypeList(getEventTypeOptions(auth, filter));\r\n    setLocationIds(auth.locations.map((l) => \"\" + l.id));\r\n    setDepartmentIds(\r\n      auth.locations.flatMap((l) => l.departments).map((d) => \"\" + d.id)\r\n    );\r\n\r\n    setPositionIds(\r\n      auth.locations\r\n        .flatMap((l) => l.departments)\r\n        .flatMap((d) => d.positions)\r\n        .map((p) => \"\" + p.id)\r\n    );\r\n\r\n    setMyFilter(filterStore.getDefaultFilter(auth, filter));\r\n    setIsDirty(false);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onEventGroupSelect = (val: EventGroup) => {\r\n    setEventGroup(val);\r\n    setIsDirty(true);\r\n    setMyFilter(getFilterByEventGroup(myFilter, val));\r\n    setShowCustomEventTypes(val === EventGroup.Custom);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onSetLocations = (locIds: string[]) => {\r\n    setLocationIds(locIds);\r\n    setIsDirty(true);\r\n    setDepartmentIds(\r\n      auth.locations\r\n        .filter((l) => locIds.indexOf(l.id.toString()) >= 0)\r\n        .flatMap((l) => l.departments)\r\n        .map((d) => \"\" + d.id)\r\n    );\r\n    setEventTypeList(getEventTypeOptions(auth, myFilter));\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onSetDepartmentIds = (deptIds: string[]) => {\r\n    setDepartmentIds(deptIds);\r\n    setIsDirty(true);\r\n    setPositionIds(\r\n      auth.locations\r\n        .filter((l) => locationIds.indexOf(l.id.toString()) >= 0)\r\n        .flatMap((l) => l.departments)\r\n        .filter((d) => deptIds.includes(d.id.toString()))\r\n        .flatMap((d) => d.positions)\r\n        .map((p) => \"\" + p.id)\r\n    );\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onSetPositionIds = (posIds: string[]) => {\r\n    setPositionIds(posIds);\r\n    setIsDirty(true);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onCloseModal = () => {\r\n    const selectedPositionIds = positionIds.map((p) => parseInt(p));\r\n    const returnedFilter = { ...myFilter, positionIds: selectedPositionIds };\r\n    const filterApplied = filterStore.isFilterApplied(auth, returnedFilter);\r\n    onDismissModal(returnedFilter, filterApplied);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onCancel = () => {\r\n    onCancelModal();\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <IonHeader className=\"ion-no-border\">\r\n        <IonToolbar>\r\n          <IonButtons slot=\"start\">\r\n            <IonButton onClick={onCancel}>\r\n              <IonIcon icon={arrowBackOutline} mode=\"md\" slot=\"icon-only\" />\r\n            </IonButton>\r\n          </IonButtons>\r\n          <IonTitle>Filter</IonTitle>\r\n          <IonButtons slot=\"end\">\r\n            <IonButton onClick={onReset}>RESET</IonButton>\r\n          </IonButtons>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n\r\n      <IonContent class=\"outer-content\">\r\n        <IonItem>\r\n          <IonLabel>Events</IonLabel>\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            interface=\"action-sheet\"\r\n            value={eventGroup}\r\n            onIonChange={(e) => onEventGroupSelect(e.detail.value)}\r\n          >\r\n            <IonSelectOption value={EventGroup.ClockAndSched}>\r\n              Clock + Sched\r\n            </IonSelectOption>\r\n            <IonSelectOption value={EventGroup.Scheduled}>\r\n              Scheduled\r\n            </IonSelectOption>\r\n            <IonSelectOption value={EventGroup.DontWork}>\r\n              Don&apos;t Work\r\n            </IonSelectOption>\r\n            <IonSelectOption value={EventGroup.Custom}>Custom</IonSelectOption>\r\n            <IonSelectOption value={EventGroup.All}>ALL</IonSelectOption>\r\n          </IonSelect>\r\n        </IonItem>\r\n\r\n        {showCustomEventTypes && (\r\n          <IonItem>\r\n            <IonLabel>Type</IonLabel>\r\n            <IonSelect\r\n              mode=\"ios\"\r\n              interface=\"action-sheet\"\r\n              value={myFilter.eventTypeId}\r\n              onIonChange={(e) =>\r\n                setMyFilter({ ...myFilter, eventTypeId: e.detail.value })\r\n              }\r\n            >\r\n              {eventTypeList.map((et) => (\r\n                <IonSelectOption key={et.value} value={et.value}>\r\n                  {et.text}\r\n                </IonSelectOption>\r\n              ))}\r\n            </IonSelect>\r\n          </IonItem>\r\n        )}\r\n\r\n        {showCustomEventTypes && (\r\n          <IonItem>\r\n            <IonLabel>Status</IonLabel>\r\n            <IonSelect\r\n              mode=\"ios\"\r\n              interface=\"action-sheet\"\r\n              value={myFilter.eventStatusId}\r\n              onIonChange={(e) =>\r\n                setMyFilter({ ...myFilter, eventStatusId: e.detail.value })\r\n              }\r\n            >\r\n              <IonSelectOption value={-1}>ALL</IonSelectOption>\r\n              <IonSelectOption value={1}>Approved</IonSelectOption>\r\n              <IonSelectOption value={2}>Request</IonSelectOption>\r\n              <IonSelectOption value={4}>Request Denied</IonSelectOption>\r\n            </IonSelect>\r\n          </IonItem>\r\n        )}\r\n\r\n        <IonItem>\r\n          <IonLabel>Tags</IonLabel>\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            interface=\"action-sheet\"\r\n            value={myFilter.tagId || -1}\r\n            onIonChange={(e) => {\r\n              setMyFilter({ ...myFilter, tagId: e.detail.value });\r\n              setIsDirty(true);\r\n            }}\r\n          >\r\n            <IonSelectOption key={-1} value={-1}>\r\n              ALL\r\n            </IonSelectOption>\r\n            {auth.tags.map((tag) => (\r\n              <IonSelectOption key={tag.id} value={tag.id}>\r\n                ~{tag.name}\r\n              </IonSelectOption>\r\n            ))}\r\n          </IonSelect>\r\n        </IonItem>\r\n\r\n        {auth.locations.length > 1 && (\r\n          <IonItem>\r\n            <IonLabel>Locations</IonLabel>\r\n            <IonSelect\r\n              mode=\"ios\"\r\n              multiple={true}\r\n              onIonChange={(e) => onSetLocations(e.detail.value)}\r\n              value={locationIds}\r\n            >\r\n              {auth.locations.map((loc) => (\r\n                <IonSelectOption key={loc.id} value={loc.id.toString()}>\r\n                  {loc.name}\r\n                </IonSelectOption>\r\n              ))}\r\n            </IonSelect>\r\n          </IonItem>\r\n        )}\r\n\r\n        {auth.locations.flatMap((l) => l.departments).length > 1 && (\r\n          <IonItem>\r\n            <IonLabel>Departments</IonLabel>\r\n            <IonSelect\r\n              mode=\"ios\"\r\n              multiple={true}\r\n              onIonChange={(e) => onSetDepartmentIds(e.detail.value)}\r\n              value={departmentIds}\r\n            >\r\n              {auth.locations\r\n                .filter((l) => locationIds.indexOf(l.id.toString()) >= 0)\r\n                .map((loc) =>\r\n                  loc.departments.map((dept) => (\r\n                    <IonSelectOption key={dept.id} value={dept.id.toString()}>\r\n                      {loc.abbr}/{dept.name}\r\n                    </IonSelectOption>\r\n                  ))\r\n                )}\r\n            </IonSelect>\r\n          </IonItem>\r\n        )}\r\n\r\n        {auth.locations\r\n          .flatMap((l) => l.departments)\r\n          .flatMap((d) => d.positions).length > 1 && (\r\n          <IonItem>\r\n            <IonLabel>Positions</IonLabel>\r\n            <IonSelect\r\n              mode=\"ios\"\r\n              multiple={true}\r\n              onIonChange={(e) => onSetPositionIds(e.detail.value)}\r\n              value={positionIds}\r\n            >\r\n              {auth.locations\r\n                .filter((l) => locationIds.indexOf(l.id.toString()) >= 0)\r\n                .flatMap((l) => l.departments)\r\n                .filter((d) => departmentIds.indexOf(d.id.toString()) >= 0)\r\n                .map((dept) =>\r\n                  dept.positions.map((pos) => (\r\n                    <IonSelectOption key={pos.id} value={pos.id.toString()}>\r\n                      {pos.name}\r\n                    </IonSelectOption>\r\n                  ))\r\n                )}\r\n            </IonSelect>\r\n          </IonItem>\r\n        )}\r\n      </IonContent>\r\n\r\n      <IonFooter>\r\n        <IonButton\r\n          className=\"apply-button\"\r\n          expand=\"block\"\r\n          onClick={onCloseModal}\r\n          disabled={!isDirty}\r\n        >\r\n          APPLY FILTER\r\n        </IonButton>\r\n      </IonFooter>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ScheduleFilterModal;\r\n","import { IonRefresher, IonRefresherContent } from \"@ionic/react\";\r\nimport React, { useRef } from \"react\";\r\nimport { RefresherEventDetail } from \"@ionic/core\";\r\n\r\nfunction useIonicRefresher(\r\n  doRefresh: (event: CustomEvent<RefresherEventDetail>) => void\r\n) {\r\n  const ionRefresherRef = useRef<HTMLIonRefresherElement>(null);\r\n\r\n  // ----------------------------------------------------------------------------------------------\r\n  const ionicRefresherJsx = (\r\n    <IonRefresher slot=\"fixed\" ref={ionRefresherRef} onIonRefresh={doRefresh}>\r\n      <IonRefresherContent\r\n        pullingIcon=\"arrow-dropdown\"\r\n        pullingText=\"Pull down to refresh\"\r\n        refreshingSpinner=\"dots\"\r\n        refreshingText=\"Refreshing...\"\r\n      />\r\n    </IonRefresher>\r\n  );\r\n\r\n  const retVal = { ionicRefresherJsx };\r\n\r\n  return { ...retVal };\r\n}\r\n\r\nexport default useIonicRefresher;\r\n","import React, {useEffect, useState} from \"react\";\r\nimport {IonCol, IonInput, IonLabel, IonRow, IonSelect, IonSelectOption,} from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport {\r\n  AdminAuthorization,\r\n  AuthorizedItems,\r\n  LocationSettings,\r\n  Role,\r\n  TimeFormat,\r\n} from \"../../../orbital-interfaces/authorized-items\";\r\nimport EventType, {getEventTypeIdName} from \"../../../enums/EventType\";\r\nimport EventStatus, {eventStatusIdList, getEventStatusIdName} from \"../../../enums/EventStatus\";\r\nimport {EditorReducerAction, EditorValues} from \"../EditEventModalState\";\r\nimport {getMinutesFromTimeString, getTimeStringFromMinutes,} from \"../../../util/time-helper\";\r\nimport authHelper from \"../../../util/authitems-helper\";\r\nimport {IdName} from \"../../../orbital-interfaces/IdName\";\r\n\r\ninterface EventTypeStatusEditorProps {\r\n  auth: AuthorizedItems;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction getSelectedEventTypeId(ev: EditorValues) {\r\n  if (ev.eventType !== EventType.Absent) {\r\n    return ev.eventType;\r\n  }\r\n\r\n  return ev.absentId;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction showClockEventType(\r\n  auth: AuthorizedItems,\r\n  ev: EditorValues,\r\n  adminAuth: AdminAuthorization)\r\n{\r\n  if (auth.role === Role.BusinessAdmin || auth.role === Role.LocationAdmin) {\r\n    return true;\r\n  }\r\n\r\n  if (auth.role === Role.Employee) {\r\n    return false;\r\n  }\r\n\r\n  if (ev.employee.id === auth.employeeId) {\r\n    return authHelper.adminCan(adminAuth, AdminAuthorization.CanEditOwnClockEvents);\r\n  }\r\n\r\n  return authHelper.adminCan(adminAuth, AdminAuthorization.CanEditEmployeeClockEvents);\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction getPayrollEventIdNames(auth: AuthorizedItems, posId: number) {\r\n  return auth.payrollEvents\r\n    .filter(\r\n      (pe) =>\r\n        pe.positionIds.includes(posId) &&\r\n        !pe.name.startsWith(\"--\")\r\n    )\r\n    .map((pe) => {\r\n      return { id: pe.id, name: pe.name };\r\n    }).sort((a,b) => (a.name > b.name)\r\n      ? 1\r\n      : (b.name > a.name) ? -1 : 0);\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction getEventTypes(auth: AuthorizedItems, ev: EditorValues): IdName[]  {\r\n  if (!authHelper.isAuthItemsValid(auth)) {\r\n    return [] as IdName[];\r\n  }\r\n\r\n  let payrollEvents: IdName[] = [];\r\n  const eventTypes: EventType[] = [];\r\n  const locSettings = ev.position.location.settings;\r\n  const dept = authHelper.getDepartmentFromPositionId(auth, ev.position.position.id);\r\n  if (dept === null) {\r\n    return [] as IdName[];\r\n  }\r\n\r\n  const adminAuth = authHelper.getAdminAuthorizationForDepartment(auth, dept!.id);\r\n\r\n  if (showClockEventType(auth, ev, adminAuth)) {\r\n    eventTypes.push(EventType.Clock);\r\n  }\r\n\r\n  eventTypes.push(EventType.Shift);\r\n\r\n  if (auth.role === Role.BusinessAdmin || auth.role === Role.LocationAdmin ||\r\n      (auth.role === Role.Admin &&\r\n       dept !== undefined &&\r\n       authHelper.isAdminAuthorizedFor(\r\n         auth,\r\n         ev.locationId,\r\n         dept.id,\r\n         AdminAuthorization.CanEditSchedules))) {\r\n\r\n    eventTypes.push(EventType.Cover);\r\n\r\n    if (locSettings.ShowVacationEventType) {\r\n      eventTypes.push(EventType.Vacation);\r\n    }\r\n\r\n    if (locSettings.ShowUnavailableEventType) {\r\n      eventTypes.push(EventType.Unavailable);\r\n    }\r\n\r\n    if (locSettings.ShowAbsentEventType) {\r\n      payrollEvents = getPayrollEventIdNames(auth, ev.position.position.id);\r\n    }\r\n  } else if (auth.role === Role.Admin && dept !== undefined) {\r\n    if (locSettings.ShowVacationEventType) {\r\n      eventTypes.push(EventType.Vacation);\r\n    }\r\n\r\n    if (locSettings.ShowUnavailableEventType) {\r\n      eventTypes.push(EventType.Unavailable);\r\n    }\r\n\r\n    if (locSettings.ShowAbsentEventType) {\r\n      payrollEvents = getPayrollEventIdNames(auth, ev.position.position.id);\r\n    }\r\n  } else {\r\n    if (ev.scheduleEventId > 0) {\r\n      return [getEventTypeIdName(ev.eventType)];\r\n    }\r\n\r\n    if (locSettings.ShowVacationEventType) {\r\n      eventTypes.push(EventType.Vacation);\r\n    }\r\n\r\n    if (locSettings.ShowUnavailableEventType) {\r\n      eventTypes.push(EventType.Unavailable);\r\n    }\r\n\r\n    if (locSettings.ShowAbsentEventType) {\r\n      payrollEvents = getPayrollEventIdNames(auth, ev.position.position.id);\r\n    }\r\n  }\r\n\r\n  const idNames = eventTypes.map(et => {return getEventTypeIdName(et)}) as IdName[];\r\n  return idNames.concat(payrollEvents);\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction getEventStatuses(auth: AuthorizedItems, ev: EditorValues): IdName[] {\r\n  if (!authHelper.isAuthItemsValid(auth)) {\r\n    return [] as IdName[];\r\n  }\r\n\r\n  if (auth.role === Role.Employee) {\r\n    if (ev.scheduleEventId === 0) {\r\n      return [getEventStatusIdName(EventStatus.Request)]\r\n    } else {\r\n      return [getEventStatusIdName(ev.eventStatus)];\r\n    }\r\n  }\r\n\r\n  if (auth.role === Role.LocationAdmin || auth.role === Role.BusinessAdmin) {\r\n    return eventStatusIdList;\r\n  }\r\n\r\n  const dept = authHelper.getDepartmentFromPositionId(auth, ev.position.position.id);\r\n  if (dept === null) {\r\n    return [] as IdName[];\r\n  }\r\n\r\n  if (authHelper.isAdminAuthorizedFor(\r\n    auth,\r\n    ev.locationId,\r\n    dept!.id,\r\n    AdminAuthorization.CanEditSchedules)) {\r\n    return eventStatusIdList;\r\n  }\r\n\r\n  if (ev.scheduleEventId === 0) {\r\n    return [getEventStatusIdName(EventStatus.Request)]\r\n  } else {\r\n    return [getEventStatusIdName(ev.eventStatus)];\r\n  }\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst EventTypeStatusEditor: React.FC<EventTypeStatusEditorProps> = ({\r\n  auth,\r\n  editorValues,\r\n  update,\r\n}: EventTypeStatusEditorProps) => {\r\n  const [absentHoursPlaceholderText, setAbsentHoursPlaceholderText] = useState(\r\n    \"Ex: 00:00\"\r\n  );\r\n  const [locSettings, setLocSettings] = useState(\r\n    null as LocationSettings | null\r\n  );\r\n  const [absentTimeString, setAbsentTimeString] = useState(\r\n    null as string | null\r\n  );\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (editorValues.scheduleEventId === -1) {\r\n      return;\r\n    }\r\n    // If this is an employee and we're creating an event\r\n    if (\r\n      auth.role === Role.Employee &&\r\n      editorValues.scheduleEventId <= 0 &&\r\n      editorValues.eventStatus !== EventStatus.Request\r\n    ) {\r\n      update({\r\n        type: \"TYPESTATUS-UPDATED\",\r\n        eventType: editorValues.eventType,\r\n        eventStatus: EventStatus.Request,\r\n        absentId: editorValues.absentId,\r\n        absentTimeMinutes: editorValues.absentTimeMinutes,\r\n      });\r\n    }\r\n\r\n\r\n    // eslint-disable-next-line\r\n  }, [\r\n    auth,\r\n    editorValues.eventType,\r\n    editorValues.eventStatus,\r\n    editorValues.position,\r\n    editorValues.absentId,\r\n    editorValues.scheduleEventId,\r\n  ]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (editorValues.isFromEventInfo) {\r\n      return; // won't have accurrate data for absents yet\r\n    }\r\n\r\n    const eventTypes = getEventTypes(auth, editorValues);\r\n    if (eventTypes.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const curEventType = eventTypes.find(et => et.id === getSelectedEventTypeId(editorValues));\r\n    if (curEventType === undefined) {\r\n      update({\r\n        type: \"TYPESTATUS-UPDATED\",\r\n        eventType: eventTypes[0].id > 100 ? EventType.Absent : eventTypes[0].id,\r\n        eventStatus: editorValues.eventStatus,\r\n        absentId: eventTypes[0].id > 100 ? eventTypes[0].id : undefined,\r\n        absentTimeMinutes: editorValues.absentTimeMinutes\r\n      });\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [editorValues.employee, editorValues.isFromEventInfo]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    const eventStatuses = getEventStatuses(auth, editorValues);\r\n    const curEventStatus = eventStatuses.find(es => es.id === editorValues.eventStatus);\r\n    if (curEventStatus === undefined) {\r\n      update({\r\n        type: \"TYPESTATUS-UPDATED\",\r\n        eventType: editorValues.eventType,\r\n        eventStatus: eventStatuses[0].id,\r\n        absentId: editorValues.absentId,\r\n        absentTimeMinutes: editorValues.absentTimeMinutes\r\n      });\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [editorValues.position]);\r\n\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (editorValues.scheduleEventId === -1) {\r\n      return;\r\n    }\r\n\r\n    if (locSettings) {\r\n      setAbsentTimeString(\r\n        editorValues.absentTimeMinutes === null\r\n          ? null\r\n          : getTimeStringFromMinutes(\r\n              locSettings,\r\n              editorValues.absentTimeMinutes\r\n            )\r\n      );\r\n    }\r\n  }, [\r\n    locSettings,\r\n    editorValues.absentTimeMinutes,\r\n    editorValues.scheduleEventId,\r\n  ]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (editorValues.scheduleEventId === -1) {\r\n      return;\r\n    }\r\n\r\n    if (locSettings && editorValues.locationId === locSettings.LocationId) {\r\n      return;\r\n    }\r\n\r\n    if (!auth || !auth.locations || auth.locations.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const newLocSettings = authHelper.getLocSettingsForLocationId(\r\n      auth,\r\n      editorValues.locationId\r\n    );\r\n    setLocSettings(newLocSettings);\r\n    setAbsentHoursPlaceholderText(\r\n      newLocSettings.TimeFormat === TimeFormat.HoursMinutes\r\n        ? \"Ex: 00:00\"\r\n        : \"Ex: 0.0\"\r\n    );\r\n    // eslint-disable-next-line\r\n  }, [editorValues.locationId, editorValues.scheduleEventId]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onEventTypeChange = (newEventType: EventType) => {\r\n    if (newEventType === editorValues.eventType) {\r\n      return;\r\n    }\r\n\r\n    const newAbsentMinutes =\r\n      newEventType !== EventType.Absent && newEventType < 100\r\n        ? null\r\n        : editorValues.absentTimeMinutes;\r\n\r\n    update({\r\n      type: \"TYPESTATUS-UPDATED\",\r\n      eventType: newEventType >= 100 ? EventType.Absent : newEventType,\r\n      eventStatus: editorValues.eventStatus,\r\n      absentId: newEventType >= 100 ? newEventType : undefined,\r\n      absentTimeMinutes: newAbsentMinutes,\r\n    });\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onEventStatusChange = (newEventStatus: EventStatus) => {\r\n    if (newEventStatus === editorValues.eventStatus) {\r\n      return;\r\n    }\r\n\r\n    update({\r\n      type: \"TYPESTATUS-UPDATED\",\r\n      eventType: editorValues.eventType,\r\n      eventStatus: newEventStatus,\r\n      absentId: editorValues.absentId,\r\n      absentTimeMinutes: editorValues.absentTimeMinutes,\r\n    });\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onAbsentTimeChange = (input?: string | null) => {\r\n    if (input === undefined) {\r\n      input = null;\r\n    }\r\n\r\n    if (input == null) {\r\n      update({\r\n        type: \"TYPESTATUS-UPDATED\",\r\n        eventType: editorValues.eventType,\r\n        eventStatus: editorValues.eventStatus,\r\n        absentId: editorValues.absentId,\r\n        absentTimeMinutes: null,\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    const min = getMinutesFromTimeString(locSettings!, input!);\r\n    if (min === editorValues.absentTimeMinutes) {\r\n      return;\r\n    }\r\n\r\n    update({\r\n      type: \"TYPESTATUS-UPDATED\",\r\n      eventType: editorValues.eventType,\r\n      eventStatus: editorValues.eventStatus,\r\n      absentId: editorValues.absentId,\r\n      absentTimeMinutes: min,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <IonRow className=\"edit-row\">\r\n        <IonCol size=\"3\">\r\n          <IonLabel className=\"label\">Type</IonLabel>\r\n        </IonCol>\r\n        <IonCol size=\"9\">\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            className=\"select\"\r\n            interface=\"action-sheet\"\r\n            disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n            value={getSelectedEventTypeId(editorValues)}\r\n            onIonChange={(e) => {\r\n              onEventTypeChange(e.detail.value);\r\n            }}\r\n          >\r\n            {getEventTypes(auth, editorValues).map((et) => (\r\n              <IonSelectOption key={et.id} value={et.id}>\r\n                {et.name}\r\n              </IonSelectOption>\r\n            ))}\r\n          </IonSelect>\r\n        </IonCol>\r\n      </IonRow>\r\n\r\n      <IonRow className=\"edit-row\">\r\n        <IonCol size=\"3\">\r\n          <IonLabel className=\"label\">Status</IonLabel>\r\n        </IonCol>\r\n        <IonCol size=\"9\">\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            className=\"select\"\r\n            interface=\"action-sheet\"\r\n            disabled={\r\n              editorValues.isReadonly  || editorValues.isConfirmed ||\r\n              (auth.role === Role.Employee && editorValues.scheduleEventId <= 0)\r\n            }\r\n            value={editorValues.eventStatus}\r\n            onIonChange={(e) => {\r\n              onEventStatusChange(e.detail.value);\r\n            }}\r\n          >\r\n            {getEventStatuses(auth, editorValues).map((es) => (\r\n                <IonSelectOption key={es.id} value={es.id}>\r\n                  {es.name}\r\n                </IonSelectOption>\r\n              ))}\r\n          </IonSelect>\r\n        </IonCol>\r\n      </IonRow>\r\n\r\n      <IonRow\r\n        className={editorValues.eventType === EventType.Absent ? \"visible edit-row\" : \"invisible\"}\r\n      >\r\n        <IonCol size=\"3\">\r\n          <IonLabel className=\"label\">Hours</IonLabel>\r\n        </IonCol>\r\n        <IonCol size=\"9\">\r\n          <IonInput\r\n            className=\"input-textbox\"\r\n            placeholder={absentHoursPlaceholderText}\r\n            disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n            value={absentTimeString}\r\n            onIonChange={(e) => {\r\n              if (e.detail.value) {\r\n                setAbsentTimeString(e.detail.value);\r\n              }\r\n            }}\r\n            onIonBlur={() => {\r\n              onAbsentTimeChange(absentTimeString);\r\n            }}\r\n          />\r\n        </IonCol>\r\n      </IonRow>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EventTypeStatusEditor;\r\n","import React, {useState, useEffect, useRef} from \"react\";\r\nimport {\r\n  IonLabel,\r\n  IonSelect,\r\n  IonRow,\r\n  IonCol,\r\n  IonSelectOption,\r\n} from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport \"./EventPositionEditor\";\r\nimport {\r\n  AuthorizedItems,\r\n  AuthorizedLocation,\r\n} from \"../../../orbital-interfaces/authorized-items\";\r\nimport { EditorValues, EditorReducerAction } from \"../EditEventModalState\";\r\nimport authHelper from \"../../../util/authitems-helper\";\r\n\r\ninterface EventPositionEditorProps {\r\n  auth: AuthorizedItems;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n}\r\n\r\ninterface Option {\r\n  id: number;\r\n  name: string;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst createPositionList = (loc: AuthorizedLocation[]): Option[] => {\r\n  const isMultiLoc = loc.length > 1;\r\n  return loc.flatMap((l) =>\r\n    l.departments.flatMap((d) =>\r\n      d.positions.map((p) => {\r\n        const isMultiDep = l.departments.length > 1;\r\n        let name = \"\";\r\n        if (isMultiLoc) {\r\n          name += (l.abbr ? l.abbr : l.name) + \"/\";\r\n        }\r\n\r\n        if (isMultiDep) {\r\n          name += (d.abbr ? d.abbr : d.name) + \"/\";\r\n        }\r\n\r\n        name += p.name;\r\n        return { id: p.id, name: name };\r\n      })\r\n    )\r\n  );\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst EventPositionEditor: React.FC<EventPositionEditorProps> = ({\r\n  auth,\r\n  editorValues,\r\n  update,\r\n}: EventPositionEditorProps) => {\r\n  const [positionList, setPositionList] = useState([] as Option[]);\r\n  const posIdRef = useRef(null as number | null);\r\n\r\n  useEffect(() => {\r\n    if (editorValues.scheduleEventId === -1) {\r\n      return;\r\n    }\r\n\r\n    if (auth && auth.locations && auth.locations.length > 0) {\r\n      setPositionList(createPositionList(auth.locations));\r\n    }\r\n  }, [auth, editorValues.scheduleEventId]);\r\n\r\n  const updatePosition = (posId: number) => {\r\n    if (posId === posIdRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (posId === editorValues.position.position.id) {\r\n      return;\r\n    }\r\n\r\n    const selected = authHelper.getSelectedPosition(auth.locations, posId);\r\n    update({ type: \"POSITION-UPDATED\", selectedPosition: selected });\r\n  };\r\n\r\n  return (\r\n    <IonRow className=\"edit-row\">\r\n      <IonCol size=\"3\">\r\n        <IonLabel className=\"label\">Position</IonLabel>\r\n      </IonCol>\r\n      <IonCol size=\"9\">\r\n        <IonSelect\r\n          mode=\"ios\"\r\n          className=\"select\"\r\n          interface=\"action-sheet\"\r\n          disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n          value={editorValues.position.position.id}\r\n          onIonChange={(e) => updatePosition(e.detail.value)}\r\n        >\r\n          {positionList.map((p) => (\r\n            <IonSelectOption key={p.id} value={p.id}>\r\n              {p.name}\r\n            </IonSelectOption>\r\n          ))}\r\n        </IonSelect>\r\n      </IonCol>\r\n    </IonRow>\r\n  );\r\n};\r\n\r\nexport default EventPositionEditor;\r\n","import React, {useContext, useEffect, useRef, useState} from \"react\";\r\nimport {IonCol, IonLabel, IonRow, IonSelect, IonSelectOption,} from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport \"./EventEmployeeEditor\";\r\nimport {\r\n  AdminAuthorization,\r\n  AuthorizedItems,\r\n  Role} from \"../../../orbital-interfaces/authorized-items\";\r\nimport employeeAPI from \"../../../api/EmployeesAPI\";\r\nimport {ApplicationUserContext} from \"../../../context/ApplicationUserContext\";\r\nimport {parseISO} from \"date-fns\";\r\nimport {EditorReducerAction, EditorValues} from \"../EditEventModalState\";\r\nimport {IdName} from \"../../../orbital-interfaces/IdName\";\r\nimport {useShowLoading} from \"../../../hooks/useShowLoading\";\r\nimport {log} from \"../../../util/logger\";\r\nimport authHelper from \"../../../util/authitems-helper\";\r\n\r\ninterface EventEmployeeEditorProps {\r\n  auth: AuthorizedItems;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst EventEmployeeEditor: React.FC<EventEmployeeEditorProps> = ({\r\n  auth,\r\n  editorValues,\r\n  update,\r\n}: EventEmployeeEditorProps) => {\r\n  const [employeeList, setEmployeeList] = useState([] as IdName[]);\r\n  const loading = useShowLoading(\"Please wait...\");\r\n  const { user } = useContext(ApplicationUserContext);\r\n  const empIdRef = useRef(null as number | null);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (user && user.isLoggedin && editorValues.scheduleEventId !== -1) {\r\n      log(\"edit_event_get_employeeList\", { user: user.username});\r\n      loading.setShowLoading(true);\r\n      getEmployees(editorValues);\r\n    }\r\n    // eslint-disable-next-line\r\n  }, [user, editorValues.position.position.id, editorValues.scheduleEventId, editorValues.employee.id]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onChange = (employeeId: number) => {\r\n    if (employeeId === -5 || employeeId === editorValues.employee.id) {\r\n      return;\r\n    }\r\n\r\n    if (employeeId === empIdRef.current) {\r\n      return;\r\n    }\r\n\r\n    empIdRef.current = employeeId;\r\n    const emp = employeeList.filter((e) => e.id === employeeId)[0];\r\n    if (employeeId === -1) {\r\n      update({\r\n        type: \"EMPLOYEE-UPDATED\",\r\n        employee: { id: -1, name: \"SELECT EMPLOYEE\" },\r\n      });\r\n    } else {\r\n      update({\r\n        type: \"EMPLOYEE-UPDATED\",\r\n        employee: { id: employeeId, name: emp.name },\r\n      });\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const getEmployees = (ev: EditorValues) => {\r\n    const justEmployee = [{ id: auth.employeeId, name: auth.fullName}];\r\n\r\n    if (auth.role === Role.Employee) {\r\n      setEmployeeList(justEmployee);\r\n      loading.setShowLoading(false);\r\n      return;\r\n    }\r\n\r\n    if (auth.role === Role.Admin) {\r\n      const dept = authHelper.getDepartmentFromPositionId(auth, ev.position.position.id);\r\n      if (dept === null) {\r\n        loading.setShowLoading(false);\r\n        setEmployeeList(justEmployee);\r\n        return;\r\n      }\r\n\r\n      if (!authHelper.isAdminAuthorizedFor(\r\n        auth,\r\n        ev.locationId,\r\n        dept.id,\r\n        AdminAuthorization.CanEditSchedules)) {\r\n        setEmployeeList(justEmployee);\r\n        loading.setShowLoading(false);\r\n        return;\r\n      }\r\n\r\n    }\r\n\r\n    employeeAPI\r\n      .getEmployeesByLocationIdPositionIdAndActiveDateRange(\r\n        user,\r\n        ev.position.location.id,\r\n        ev.position.position.id,\r\n        parseISO(ev.eventStart),\r\n        parseISO(ev.eventEnd),\r\n        ev.position.location.settings.EmployeeSort\r\n      )\r\n      .then((employees) => {\r\n        setEmployeeList(employees);\r\n        const empIds = employees.map((e) => e.id);\r\n\r\n        if (!empIds.includes(ev.employee.id))\r\n        {\r\n          update({\r\n            type: \"EMPLOYEE-UPDATED\",\r\n            employee: { id: -1, name: \"SELECT EMPLOYEE\" }\r\n          });\r\n        }\r\n\r\n        loading.setShowLoading(false);\r\n      });\r\n  };\r\n\r\n  if (employeeList.length === 0) {\r\n    return (\r\n      <>\r\n        <IonRow className=\"edit-row\">\r\n          <IonCol size=\"3\">\r\n            <IonLabel className=\"label\">Employee</IonLabel>\r\n          </IonCol>\r\n          <IonCol size=\"9\">\r\n            <IonSelect\r\n            mode=\"ios\"\r\n            className=\"select\"\r\n            interface=\"action-sheet\"\r\n            value={-5}\r\n            >\r\n              <IonSelectOption key=\"-5\" value=\"-5\">\r\n                {editorValues.employee.name}\r\n              </IonSelectOption>\r\n            </IonSelect>\r\n          </IonCol>\r\n        </IonRow>\r\n        {loading.showLoadingJsx}\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IonRow className=\"edit-row\">\r\n        <IonCol size=\"3\">\r\n          <IonLabel className=\"label\">Employee</IonLabel>\r\n        </IonCol>\r\n        <IonCol size=\"9\">\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            className=\"select\"\r\n            interface=\"action-sheet\"\r\n            disabled={editorValues.isReadonly || auth.role === Role.Employee  || editorValues.isConfirmed}\r\n            value={editorValues.employee.id}\r\n            onIonChange={(e) => {\r\n              onChange(e.detail.value);\r\n            }}\r\n          >\r\n            {employeeList.length > 1 && (\r\n                <IonSelectOption key={-1} value={-1}>\r\n                  Select Employee\r\n                </IonSelectOption>\r\n            )}\r\n            {employeeList.map((emp) => (\r\n              <IonSelectOption key={emp.id} value={emp.id}>\r\n                {emp.name}\r\n              </IonSelectOption>\r\n            ))}\r\n          </IonSelect>\r\n        </IonCol>\r\n      </IonRow>\r\n      {loading.showLoadingJsx}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EventEmployeeEditor;\r\n","import React from \"react\";\r\nimport { IonLabel, IonRow, IonCol, IonDatetime } from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport \"./EventStartEndEditor\";\r\nimport { AuthorizedItems } from \"../../../orbital-interfaces/authorized-items\";\r\nimport { parseISO } from \"date-fns\";\r\nimport { EditorValues, EditorReducerAction } from \"../EditEventModalState\";\r\n\r\ninterface EventStartEndEditorProps {\r\n  auth: AuthorizedItems;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst EventStartEndEditor: React.FC<EventStartEndEditorProps> = ({\r\n  editorValues,\r\n  update,\r\n}: EventStartEndEditorProps) => {\r\n  const onStartChange = (newEventStart?: string | null) => {\r\n    if (!newEventStart) {\r\n      return;\r\n    }\r\n\r\n    if (parseISO(newEventStart) === parseISO(editorValues.eventStart)) {\r\n      return;\r\n    }\r\n\r\n    update({\r\n      type: \"START-UPDATED\",\r\n      eventStart: newEventStart,\r\n    });\r\n  };\r\n\r\n  const onEndChange = (newEventEnd?: string | null) => {\r\n    if (!newEventEnd) {\r\n      return;\r\n    }\r\n\r\n    if (parseISO(newEventEnd) === parseISO(editorValues.eventEnd)) {\r\n      return;\r\n    }\r\n\r\n    update({\r\n      type: \"END-UPDATED\",\r\n      eventEnd: newEventEnd,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <IonRow className=\"edit-row\">\r\n        <IonCol size=\"3\">\r\n          <IonLabel className=\"label\">Start</IonLabel>\r\n        </IonCol>\r\n        <IonCol size=\"9\">\r\n          <IonDatetime\r\n            mode=\"ios\"\r\n            className=\"select\"\r\n            displayFormat=\"h:mm A, M/D DDD\"\r\n            disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n            pickerFormat=\"h:mm A MMM D\"\r\n            minuteValues=\"0,5,10,15,20,25,30,35,40,45,50,55\"\r\n            value={editorValues.eventStart}\r\n            onIonChange={(e) => {\r\n              onStartChange(e.detail.value);\r\n            }}\r\n          />\r\n        </IonCol>\r\n      </IonRow>\r\n\r\n      <IonRow className=\"edit-row\">\r\n        <IonCol size=\"3\">\r\n          <IonLabel className=\"label\">End</IonLabel>\r\n        </IonCol>\r\n        <IonCol size=\"9\">\r\n          <IonDatetime\r\n            mode=\"ios\"\r\n            className=\"select\"\r\n            displayFormat=\"h:mm A, M/D DDD\"\r\n            disabled={editorValues.isReadonly || editorValues.isClockedIn || editorValues.isConfirmed}\r\n            pickerFormat=\"h:mm A MMM D\"\r\n            minuteValues=\"0,5,10,15,20,25,30,35,40,45,50,55\"\r\n            value={editorValues.eventEnd}\r\n            onIonChange={(e) => {\r\n              onEndChange(e.detail.value);\r\n            }}\r\n          />\r\n        </IonCol>\r\n      </IonRow>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EventStartEndEditor;\r\n","import React, { useState } from \"react\";\r\nimport {\r\n  IonCheckbox,\r\n  IonDatetime,\r\n  IonContent,\r\n  IonRow,\r\n  IonCol,\r\n  IonButtons,\r\n  IonButton,\r\n  IonIcon,\r\n  IonFooter,\r\n  IonGrid,\r\n  IonHeader,\r\n  IonTitle,\r\n  IonToolbar,\r\n} from \"@ionic/react\";\r\nimport { close } from \"ionicons/icons\";\r\nimport \"../../../global-styles.scss\";\r\nimport {\r\n  setHours,\r\n  setMinutes,\r\n  parseISO,\r\n  isAfter,\r\n  isBefore,\r\n  addMinutes,\r\n} from \"date-fns\";\r\nimport useDialogBox from \"../../../hooks/useDialogBox\";\r\nimport { EventBreak } from \"../../../orbital-interfaces/EventBreak\";\r\n\r\ninterface AddBreakModalProps {\r\n  onCancel: () => void;\r\n  onAdd: (\r\n    startDate: Date,\r\n    endDate: Date,\r\n    isRestricted: boolean,\r\n    isPaid: boolean\r\n  ) => void;\r\n  currentBreaks: EventBreak[];\r\n  eventStart: string;\r\n  eventEnd: string;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst hasOverlap = (start: Date, end: Date, breaks: EventBreak[]) => {\r\n  const startA = start;\r\n  const endA = end;\r\n  let found = false;\r\n  breaks.map((brk) => {\r\n    const startB = addMinutes(parseISO(brk.BreakStart), 3);\r\n    const endB = brk.BreakEnd\r\n      ? addMinutes(parseISO(brk.BreakEnd!), -3)\r\n      : new Date(2200, 1, 1);\r\n    if (startA < endB && endA > startB) {\r\n      found = true;\r\n    }\r\n\r\n    return found;\r\n  });\r\n  return found;\r\n};\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst AddBreakModal: React.FC<AddBreakModalProps> = ({\r\n  onCancel,\r\n  onAdd,\r\n  currentBreaks,\r\n  eventStart,\r\n  eventEnd,\r\n}: AddBreakModalProps) => {\r\n  const [startDate, setStartDate] = useState(\r\n    setMinutes(setHours(new Date(), 12), 0)\r\n  );\r\n  const [endDate, setEndDate] = useState(\r\n    setMinutes(setHours(new Date(), 13), 0)\r\n  );\r\n  const [isRestricted, setIsRestricted] = useState(false);\r\n  const [isPaid, setIsPaid] = useState(false);\r\n  const [errorMessage, setErrorMessage] = useState(\"\");\r\n  const [isValid, setIsValid] = useState(true);\r\n  const alert = useDialogBox();\r\n\r\n  const onAddClick = () => {\r\n    if (startDate > endDate) {\r\n      alert.showAlert(\r\n        \"Invalid Start / End\",\r\n        \"Break Start cannot come after Break End.\",\r\n        () => {}\r\n      );\r\n    } else {\r\n      onAdd(startDate, endDate, isRestricted, isPaid);\r\n    }\r\n  };\r\n\r\n  const onStartUpdate = (newStart: string) => {\r\n    const newStartDate = parseISO(newStart);\r\n    setStartDate(newStartDate);\r\n    if (!isBefore(newStartDate, endDate)) {\r\n      setIsValid(false);\r\n      setErrorMessage(\"Start must be before End\");\r\n    } else if (parseISO(eventStart) > newStartDate) {\r\n      setIsValid(false);\r\n      setErrorMessage(\"Start before Event begins\");\r\n    } else if (hasOverlap(newStartDate, endDate, currentBreaks)) {\r\n      setIsValid(false);\r\n      setErrorMessage(\"Pre-existing break overlaps\");\r\n    } else {\r\n      setIsValid(true);\r\n      setErrorMessage(\"\");\r\n    }\r\n  };\r\n\r\n  const onEndUpdate = (newEnd: string) => {\r\n    const newEndDate = parseISO(newEnd);\r\n    setEndDate(newEndDate);\r\n\r\n    if (!isAfter(newEndDate, startDate)) {\r\n      setIsValid(false);\r\n      setErrorMessage(\"End must be after Start\");\r\n    } else if (newEndDate > parseISO(eventEnd)) {\r\n      setIsValid(false);\r\n      setErrorMessage(\"End after Event ends\");\r\n    } else if (hasOverlap(startDate, newEndDate, currentBreaks)) {\r\n      setIsValid(false);\r\n      setErrorMessage(\"Pre-existing break overlaps\");\r\n    } else {\r\n      setIsValid(true);\r\n      setErrorMessage(\"\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <IonHeader mode=\"ios\">\r\n        <IonToolbar>\r\n          <IonTitle>Add Break</IonTitle>\r\n          <IonButtons slot=\"end\">\r\n            <IonButton onClick={onCancel}>\r\n              <IonIcon icon={close} mode=\"ios\" slot=\"icon-only\" />\r\n            </IonButton>\r\n          </IonButtons>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n      <IonContent>\r\n        <IonGrid>\r\n          <IonRow>\r\n            <IonCol className=\"label\" size=\"3\">\r\n              Start\r\n            </IonCol>\r\n            <IonCol size=\"9\">\r\n              <IonDatetime\r\n                className=\"select\"\r\n                displayFormat=\"h:mm a\"\r\n                pickerFormat=\"h:mm A\"\r\n                min=\"2005-01-01\"\r\n                max=\"2030-01-01\"\r\n                minuteValues=\"0,5,10,15,20,25,30,35,40,45,50,55\"\r\n                value={startDate.toISOString()}\r\n                onIonChange={(e) => onStartUpdate(e.detail.value!)}\r\n              />\r\n            </IonCol>\r\n          </IonRow>\r\n\r\n          <IonRow>\r\n            <IonCol className=\"label\" size=\"3\">\r\n              End\r\n            </IonCol>\r\n            <IonCol size=\"9\">\r\n              <IonDatetime\r\n                className=\"select\"\r\n                displayFormat=\"h:mm a\"\r\n                pickerFormat=\"h:mm A\"\r\n                min=\"2005-01-01\"\r\n                max=\"2030-01-01\"\r\n                minuteValues=\"0,5,10,15,20,25,30,35,40,45,50,55\"\r\n                value={endDate.toISOString()}\r\n                onIonChange={(e) => onEndUpdate(e.detail.value!)}\r\n              />\r\n            </IonCol>\r\n          </IonRow>\r\n\r\n          <IonRow>\r\n            <IonCol size=\"3\">\r\n              <IonCheckbox\r\n                className=\"checkbox\"\r\n                checked={isRestricted}\r\n                onIonChange={(e) => {\r\n                  setIsRestricted(e.detail.checked);\r\n                }}\r\n              />\r\n            </IonCol>\r\n            <IonCol className=\"label\" size=\"9\">\r\n              Restricted Break\r\n            </IonCol>\r\n          </IonRow>\r\n\r\n          <IonRow>\r\n            <IonCol size=\"3\">\r\n              <IonCheckbox\r\n                className=\"checkbox\"\r\n                onIonChange={(e) => {\r\n                  setIsPaid(e.detail.checked);\r\n                }}\r\n              />\r\n            </IonCol>\r\n            <IonCol className=\"label\" size=\"9\">\r\n              Paid Break\r\n            </IonCol>\r\n          </IonRow>\r\n\r\n          <IonRow>\r\n            <IonCol size=\"12\" className=\"error-message\">\r\n              {errorMessage}\r\n            </IonCol>\r\n          </IonRow>\r\n        </IonGrid>\r\n      </IonContent>\r\n      <IonFooter>\r\n        <IonButton\r\n          expand=\"block\"\r\n          color=\"secondary\"\r\n          onClick={onAddClick}\r\n          disabled={!isValid}\r\n        >\r\n          ADD\r\n        </IonButton>\r\n      </IonFooter>\r\n      {alert.alertBoxJsx}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AddBreakModal;\r\n","import React, { useState, useEffect } from \"react\";\r\nimport { IonModal, IonRow, IonCol, IonButton, IonIcon, IonLabel, } from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport { add, trash, lockClosed, logoUsd } from \"ionicons/icons\";\r\nimport { AuthorizedItems } from \"../../../orbital-interfaces/authorized-items\";\r\nimport { EventBreak } from \"../../../orbital-interfaces/EventBreak\";\r\nimport {\r\n  getBreakStartEnd,\r\n  formatDateTimeAsMvcString,\r\n} from \"../../../util/time-helper\";\r\nimport AddBreakModal from \"./AddBreakModal\";\r\nimport { EditorValues, EditorReducerAction } from \"../EditEventModalState\";\r\nimport EventType from \"../../../enums/EventType\";\r\nimport authHelper from \"../../../util/authitems-helper\";\r\n\r\ninterface EventBreakEditorProps {\r\n  auth: AuthorizedItems;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst EventBreakEditor: React.FC<EventBreakEditorProps> = ({\r\n  editorValues,\r\n  update,\r\n}: EventBreakEditorProps) => {\r\n  const [breakList, setBreakList] = useState([] as EventBreak[]);\r\n  const [showBreakModal, setShowBreakModal] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (editorValues.scheduleEventId === -1) {\r\n      return;\r\n    }\r\n\r\n    setBreakList(editorValues.eventBreaks);\r\n  }, [editorValues.eventBreaks, editorValues.scheduleEventId]);\r\n\r\n  const showRestricted = (b: EventBreak) => {\r\n    return b.IsRestricted ? (\r\n      <IonIcon className=\"restricted-icon\" icon={lockClosed} />\r\n    ) : (\r\n        <span />\r\n      );\r\n  };\r\n\r\n  const showPaid = (b: EventBreak) => {\r\n    return b.IsPaidBreak ? (\r\n      <IonIcon className=\"paid-icon\" icon={logoUsd} />\r\n    ) : (\r\n        <span />\r\n      );\r\n  };\r\n\r\n  const onAddBreakModalCancel = () => {\r\n    setShowBreakModal(false);\r\n  };\r\n\r\n  const onAddBreakModalApply = (\r\n    startDate: Date,\r\n    endDate: Date,\r\n    isRestricted: boolean,\r\n    isPaid: boolean\r\n  ) => {\r\n    setShowBreakModal(false);\r\n    const brk: EventBreak = {\r\n      BreakStart: formatDateTimeAsMvcString(startDate),\r\n      BreakEnd: formatDateTimeAsMvcString(endDate),\r\n      IsRestricted: isRestricted,\r\n      IsPaidBreak: isPaid,\r\n      ScheduleEventId: editorValues.scheduleEventId,\r\n    };\r\n\r\n    const newBreakList = [...breakList, brk];\r\n    setBreakList(newBreakList);\r\n    update({ type: \"EVENTBREAKS-UPDATED\", breaks: newBreakList });\r\n  };\r\n\r\n  const onDeleteBreak = (breakStart: string) => {\r\n    const newBreakList = breakList.filter((b) => b.BreakStart !== breakStart);\r\n    setBreakList(newBreakList);\r\n    update({ type: \"EVENTBREAKS-UPDATED\", breaks: newBreakList });\r\n  };\r\n\r\n  if (\r\n    editorValues.eventType !== EventType.Clock &&\r\n    !authHelper.isShiftTypeEvent(\r\n      editorValues.eventType,\r\n      editorValues.eventStatus\r\n    )\r\n  ) {\r\n    return <div />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IonRow className=\"edit-row\">\r\n        <IonCol size=\"3\">\r\n          <IonLabel className=\"label\">(B)reaks</IonLabel>\r\n        </IonCol>\r\n\r\n        <IonCol size=\"2\">\r\n          <IonButton\r\n            size=\"small\"\r\n            color=\"light\"\r\n            disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n            onClick={() => {\r\n              setShowBreakModal(true);\r\n            }}\r\n          >\r\n            <IonIcon slot=\"icon-only\" icon={add} color=\"dark\" />\r\n          </IonButton>\r\n        </IonCol>\r\n      </IonRow>\r\n\r\n      <IonRow>\r\n        <IonCol size=\"3\">\r\n        </IonCol>\r\n        <IonCol size=\"9\">\r\n          {/* {(!breakList || breakList.length === 0) && (\r\n            <div className=\"break-div\">(B) NONE</div>\r\n          )} */}\r\n\r\n          {breakList &&\r\n            breakList.map((brk) => (\r\n              <div key={brk.BreakStart} className=\"break-div\">\r\n                (B) {getBreakStartEnd(brk)}\r\n                {showPaid(brk)}\r\n                {showRestricted(brk)}\r\n                <button\r\n                  disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n                  onClick={() => {\r\n                    onDeleteBreak(brk.BreakStart);\r\n                  }}\r\n                >\r\n                  <IonIcon\r\n                    slot=\"icon-only\"\r\n                    mode=\"ios\"\r\n                    icon={trash}\r\n                    color=\"gray\"\r\n                  />\r\n                </button>\r\n              </div>\r\n            ))}\r\n        </IonCol>\r\n      </IonRow>\r\n\r\n      <IonRow>\r\n        <IonCol size=\"12\">\r\n          <div style={{ borderBottom: \"1px solid #ddd\", width: \"100%\" }} />\r\n        </IonCol>\r\n      </IonRow>\r\n\r\n      <IonModal\r\n        mode=\"ios\"\r\n        isOpen={showBreakModal}\r\n        cssClass=\"mini-modal add-break-modal\"\r\n        onDidDismiss={() => setShowBreakModal(false)}\r\n      >\r\n        <AddBreakModal\r\n          onCancel={onAddBreakModalCancel}\r\n          onAdd={onAddBreakModalApply}\r\n          currentBreaks={breakList}\r\n          eventStart={editorValues.eventStart}\r\n          eventEnd={editorValues.eventEnd}\r\n        />\r\n      </IonModal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EventBreakEditor;\r\n","import React, { useState, useEffect } from \"react\";\r\nimport {\r\n  IonLabel,\r\n  IonSelect,\r\n  IonRow,\r\n  IonCol,\r\n  IonSelectOption,\r\n} from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport \"./EventTagEditor\";\r\nimport { AuthorizedItems } from \"../../../orbital-interfaces/authorized-items\";\r\nimport { EditorValues, EditorReducerAction } from \"../EditEventModalState\";\r\n\r\ninterface EventTagEditorProps {\r\n  auth: AuthorizedItems;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n}\r\n\r\ninterface TagList {\r\n  id: number;\r\n  name: string;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst EventTagEditor: React.FC<EventTagEditorProps> = ({\r\n  auth,\r\n  editorValues,\r\n  update,\r\n}: EventTagEditorProps) => {\r\n  const [selectedTagId, setSelectedTagId] = useState(-1);\r\n  const [tagList, setTagList] = useState([] as TagList[]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (editorValues.scheduleEventId === -1) {\r\n      return;\r\n    }\r\n\r\n    if (auth && auth.locations && auth.locations.length > 0) {\r\n      const tags = auth.tags\r\n        .filter((t) =>\r\n          t.positionIds.includes(editorValues.position.position.id)\r\n        )\r\n        .map((t) => {\r\n          return { id: t.id, name: t.name };\r\n        });\r\n      setTagList(tags);\r\n\r\n      const tagIds = tags.map((t) => t.id);\r\n      if (!tagIds.includes(selectedTagId)) {\r\n        if (\r\n          editorValues.tag &&\r\n          editorValues.tag.id &&\r\n          tagIds.includes(editorValues.tag.id)\r\n        ) {\r\n          setSelectedTagId(editorValues.tag.id);\r\n        } else {\r\n          setSelectedTagId(-1);\r\n        }\r\n      }\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [auth, editorValues.position, editorValues.scheduleEventId]);\r\n\r\n  const onUpdateTag = (tagId: number) => {\r\n    setSelectedTagId(tagId);\r\n\r\n    if (tagId === editorValues.tag.id) {\r\n      return;\r\n    }\r\n\r\n    if (tagId === -1) {\r\n      update({ type: \"TAG-UPDATED\", tag: { id: -1, name: \"NONE\" } });\r\n    } else {\r\n      const tag = tagList.filter((t) => t.id === tagId)[0];\r\n      update({ type: \"TAG-UPDATED\", tag });\r\n    }\r\n  };\r\n\r\n  if (tagList.length === 0) {\r\n    return <></>;\r\n  }\r\n\r\n  return (\r\n    <IonRow className=\"edit-row\">\r\n      <IonCol size=\"3\">\r\n        <IonLabel className=\"label\">~Tag</IonLabel>\r\n      </IonCol>\r\n      <IonCol size=\"9\">\r\n        <IonSelect\r\n          mode=\"ios\"\r\n          className=\"select\"\r\n          interface=\"action-sheet\"\r\n          disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n          value={selectedTagId}\r\n          onIonChange={(e) => {\r\n            onUpdateTag(e.detail.value);\r\n          }}\r\n        >\r\n          <IonSelectOption value={-1}>NONE</IonSelectOption>\r\n\r\n          {tagList.map((tag) => (\r\n            <IonSelectOption key={tag.id} value={tag.id}>\r\n              {tag.name}\r\n            </IonSelectOption>\r\n          ))}\r\n        </IonSelect>\r\n      </IonCol>\r\n    </IonRow>\r\n  );\r\n};\r\n\r\nexport default EventTagEditor;\r\n","import React from \"react\";\r\nimport {IonButton, IonCheckbox, IonCol, IonIcon, IonLabel} from \"@ionic/react\";\r\nimport \"./EventStartEndEditor\";\r\nimport {AdminAuthorization, AuthorizedItems, Role} from \"../../../orbital-interfaces/authorized-items\";\r\nimport {EditorReducerAction, EditorValues} from \"../EditEventModalState\";\r\nimport EventType from \"../../../enums/EventType\";\r\nimport EventStatus from \"../../../enums/EventStatus\";\r\nimport {checkmark} from \"ionicons/icons\";\r\nimport authHelper from \"../../../util/authitems-helper\";\r\n\r\ninterface EventConfirmEditorProps {\r\n  auth: AuthorizedItems;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n  onEmployeeUpdated: () => void;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction shouldShowButton(auth: AuthorizedItems, ev:EditorValues): boolean  {\r\n  if (!authHelper.isAuthItemsValid(auth)) {\r\n    return false;\r\n  }\r\n\r\n  if (auth.role === Role.Employee) {\r\n    return true;\r\n  }\r\n\r\n  if (auth.role === Role.LocationAdmin || auth.role === Role.BusinessAdmin) {\r\n    return false;\r\n  }\r\n\r\n  const dept = authHelper.getDepartmentFromPositionId(auth, ev.position.position.id);\r\n  if (dept === null) {\r\n    return false;\r\n  }\r\n\r\n  return !authHelper.isAdminAuthorizedFor(\r\n    auth,\r\n    ev.locationId,\r\n    dept!.id,\r\n    AdminAuthorization.CanEditSchedules);\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction shouldShowConfirmed(auth: AuthorizedItems, ev: EditorValues) {\r\n  if (!authHelper.isAuthItemsValid(auth)) {\r\n    return false;\r\n  }\r\n\r\n  if (ev.scheduleEventId === -1) {\r\n    return false;\r\n  }\r\n\r\n  if (ev.scheduleEventId <= 0 ) {\r\n    if (auth.role === Role.Employee) {\r\n      return false;\r\n    }\r\n\r\n    if (auth.role === Role.Admin) {\r\n      const dept = authHelper.getDepartmentFromPositionId(auth, ev.position.position.id);\r\n      if (dept === null) {\r\n        return false;\r\n      }\r\n\r\n      if (!authHelper.isAdminAuthorizedFor(\r\n        auth,\r\n        ev.locationId,\r\n        dept!.id,\r\n        AdminAuthorization.CanEditSchedules)) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  return (ev.eventType === EventType.Shift && ev.eventStatus === EventStatus.Approved) ||\r\n    (ev.eventType === EventType.Cover &&\r\n        (ev.eventStatus === EventStatus.Request ||\r\n        ev.eventStatus === EventStatus.RequestDenied));\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst EventConfirmEditor: React.FC<EventConfirmEditorProps> = ({\r\n  auth,\r\n  editorValues,\r\n  update,\r\n  onEmployeeUpdated\r\n}: EventConfirmEditorProps) => {\r\n\r\n\r\n  // ---------------------------------------------------------------------------------\r\n  function onCheckChange() {\r\n    update({\r\n      type: \"CONFIRM-UPDATED\",\r\n      isConfirmed: !editorValues.isConfirmed,\r\n    });\r\n  }\r\n\r\n  // ---------------------------------------------------------------------------------\r\n  function onButtonClick() {\r\n    onEmployeeUpdated();\r\n  }\r\n\r\n  if (!shouldShowConfirmed(auth, editorValues)) {\r\n    return (\r\n      <>\r\n      </>\r\n    );\r\n  }\r\n\r\n  if (shouldShowButton(auth, editorValues)) {\r\n    return (\r\n      <>\r\n        <IonCol size=\"3\">\r\n          <IonLabel className=\"label\">\r\n            Confirm\r\n          </IonLabel>\r\n        </IonCol>\r\n        <IonCol size=\"3\">\r\n          <IonButton\r\n            onClick={onButtonClick}\r\n          >\r\n            {editorValues.isConfirmed ? \"Unconfirm\" : \"Confirm\"}\r\n            <IonIcon\r\n              className=\"icon-right-of-checkbox\"\r\n              icon={checkmark}\r\n            />\r\n          </IonButton>\r\n        </IonCol>\r\n      </>\r\n    );\r\n  } else {\r\n    return (\r\n      <>\r\n        <IonCol size=\"3\">\r\n          <IonLabel className=\"label\">\r\n\r\n            Confirm</IonLabel>\r\n        </IonCol>\r\n        <IonCol size=\"3\">\r\n          <IonCheckbox\r\n            checked={editorValues.isConfirmed}\r\n            onClick={() => onCheckChange()}\r\n          />\r\n          <IonIcon\r\n            className=\"icon-right-of-checkbox\"\r\n            icon={checkmark}\r\n          />\r\n        </IonCol>\r\n      </>\r\n    );\r\n  }\r\n\r\n};\r\n\r\nexport default EventConfirmEditor;\r\n","export enum RecurrenceType {\r\n  Daily = 0,\r\n  Weekly = 1,\r\n  MonthlyByDayOfMonth = 2,\r\n  MonthlyByDayOfWeek = 3,\r\n  Yearly = 4,\r\n}\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { IonLabel, IonCheckbox, IonCol, IonIcon } from \"@ionic/react\";\r\nimport \"./EventStartEndEditor\";\r\nimport { AuthorizedItems } from \"../../../orbital-interfaces/authorized-items\";\r\nimport { EditorValues, EditorReducerAction } from \"../EditEventModalState\";\r\nimport EventType from \"../../../enums/EventType\";\r\nimport { time } from \"ionicons/icons\";\r\n\r\ninterface EventIsClockedInEditorProps {\r\n  auth: AuthorizedItems;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst EventIsClockedInEditor: React.FC<EventIsClockedInEditorProps> = ({\r\n  auth,\r\n  editorValues,\r\n  update,\r\n}: EventIsClockedInEditorProps) => {\r\n  const [isClockedIn, setIsClockedIn] = useState(false);\r\n  const [showIsClockedIn, setShowIsClockedIn] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (editorValues.scheduleEventId === -1) {\r\n      return;\r\n    }\r\n\r\n    if (auth && auth.locations && auth.locations.length > 0) {\r\n      setIsClockedIn(editorValues.isClockedIn);\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [\r\n    auth,\r\n    editorValues.eventStart,\r\n    editorValues.eventEnd,\r\n    editorValues.isClockedIn,\r\n    editorValues.scheduleEventId,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (editorValues.scheduleEventId === -1) {\r\n      return;\r\n    }\r\n\r\n    setShowIsClockedIn(editorValues.eventType === EventType.Clock);\r\n  }, [\r\n    editorValues.eventType,\r\n    editorValues.eventStatus,\r\n    editorValues.scheduleEventId,\r\n  ]);\r\n\r\n  const onCheckChange = (checked: boolean) => {\r\n    if (checked === isClockedIn || !showIsClockedIn) {\r\n      return;\r\n    }\r\n\r\n    setIsClockedIn(checked);\r\n    update({\r\n      type: \"ISCLOCKEDIN-UPDATED\",\r\n      isClockedIn: checked,\r\n    });\r\n  };\r\n\r\n  if (!showIsClockedIn) {\r\n    return (\r\n      <>\r\n        {/* <IonCol size=\"0\">\r\n          <span />\r\n        </IonCol>\r\n        <IonCol size=\"0\">\r\n          <span />\r\n        </IonCol> */}\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n\r\n      <IonCol size=\"3\">\r\n        <IonLabel className=\"label\">\r\n\r\n          Clocked In\r\n        </IonLabel>\r\n      </IonCol>\r\n\r\n      <IonCol size=\"3\" >\r\n        <IonCheckbox\r\n          checked={isClockedIn}\r\n          onIonChange={(e) => {\r\n            onCheckChange(e.detail.checked);\r\n          }}\r\n        />\r\n        <IonIcon\r\n          className=\"icon-right-of-checkbox\"\r\n          icon={time}\r\n        />\r\n      </IonCol>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EventIsClockedInEditor;\r\n","import {ScheduleEvent} from \"../../orbital-interfaces/ScheduleEvent\";\nimport authHelper, {SelectedPosition} from \"../../util/authitems-helper\";\nimport {EventBreak} from \"../../orbital-interfaces/EventBreak\";\nimport {isAfter, isBefore, isEqual, parseISO, setHours, setMinutes,} from \"date-fns\";\nimport {formatDateTimeAsMvcString} from \"../../util/time-helper\";\nimport EventType from \"../../enums/EventType\";\nimport EventStatus from \"../../enums/EventStatus\";\nimport {\n  AuthorizedItems,\n  AuthorizedLocation,\n  AuthorizedPosition,\n  LocationSettings,\n} from \"../../orbital-interfaces/authorized-items\";\nimport {EventEditAuthorization} from \"./EditEventAuthorization\";\nimport {RecurrenceType} from \"../../enums/RecurrenceType\";\nimport {EventInformation} from \"../../orbital-interfaces/TEC\";\nimport {IdName} from \"../../orbital-interfaces/IdName\";\n\nconst getLocationById = (auth: AuthorizedItems, locId: number) => {\n  return auth.locations.filter((l) => l.id === locId)[0];\n};\n\nconst getPositionById = (auth: AuthorizedItems, posId: number) => {\n  return auth.locations.flatMap((l) =>\n    l.departments.flatMap((d) => d.positions.filter((p) => p.id === posId))\n  )[0];\n};\n\nconst getValidStartEnd = (startStr: string, endStr: string) => {\n  const start = parseISO(startStr);\n  const end = parseISO(endStr);\n\n  if (isEqual(start, end)) {\n    return true;\n  }\n\n  return isAfter(end, start);\n};\n\nexport interface EditorValues {\n  isFromEventInfo: boolean;\n  scheduleEventId: number;\n  locationId: number;\n  isUpdating: boolean;\n  eventType: EventType;\n  eventStatus: EventStatus;\n  isConfirmed: boolean;\n  position: SelectedPosition;\n  employee: IdName;\n  eventStart: string;\n  eventEnd: string;\n  tag: IdName;\n  eventBreaks: EventBreak[];\n  isClockedIn: boolean;\n  valid: boolean;\n  validEventStartEnd: boolean;\n  validEmployee: boolean;\n  validTag: boolean;\n  validEventTypeStatus: boolean;\n  validClockoutValue: boolean;\n  validRecurrenceStartEnd: boolean;\n  validRepeatInterval: boolean;\n  validRepeatWeekdays: boolean;\n  absentId?: number;\n  absentName?: string;\n  absentTimeMinutes: number | null;\n  notes: string;\n  clockoutValue?: string;\n  isReadonly: boolean;\n  recurrenceId?: number;\n  recurrenceStart?: string;\n  recurrenceEnd?: string;\n  recurrenceType?: RecurrenceType;\n  repeatInterval?: number;\n  repeatWeekdays?: string;\n}\n\nexport function getEditorValuesFromEventInformation(\n  auth: AuthorizedItems,\n  ev: EventInformation\n): EditorValues {\n  return {\n    ...INITIAL_EDITOR_VAUES,\n    isFromEventInfo: true,\n    eventStatus: ev.EventStatusId,\n    eventType: ev.EventTypeId,\n    eventStart: ev.EventStart,\n    eventEnd: ev.EventEnd,\n    notes: ev.Notes,\n    isClockedIn: ev.IsClockedIn,\n    isConfirmed: ev.IsConfirmed,\n    scheduleEventId: ev.ScheduleEventId,\n    position: authHelper.getSelectedPositionWithLocId(\n      auth.locations,\n      ev.LocationId,\n      ev.PositionId\n    ),\n    employee: { id: ev.EmployeeId, name: ev.FirstName + \" \" + ev.LastName },\n    eventBreaks: ev.EventBreaks,\n  };\n}\n\nconst isClockoutValueValid = (\n  state: EditorValues,\n  locSettings: LocationSettings,\n  val?: string\n) => {\n  if (!val) {\n    return true;\n  }\n\n  // clockout values are not enabled\n  if (\n    !locSettings.ClockOutValueLabel ||\n    locSettings.ClockOutValueLabel.length === 0\n  ) {\n    return false;\n  }\n\n  const regEx = /^\\d*(\\.\\d{0,2})?$/;\n  return regEx.test(val);\n};\n\nconst isAllValid = (v: EditorValues): boolean => {\n  return (\n    v.validEventStartEnd &&\n    v.validEmployee &&\n    v.validTag &&\n    v.validEventTypeStatus &&\n    v.validClockoutValue &&\n    v.validRecurrenceStartEnd &&\n    v.validRepeatInterval &&\n    v.validRepeatWeekdays\n  );\n};\n\nexport const INITIAL_EDITOR_VAUES: EditorValues = {\n  isFromEventInfo: false,\n  scheduleEventId: -1,\n  locationId: 0,\n  isUpdating: false,\n  eventType: EventType.Shift,\n  eventStatus: EventStatus.Approved,\n  isConfirmed: false,\n  position: {\n    location: {} as AuthorizedLocation,\n    position: {} as AuthorizedPosition,\n  },\n  employee: { id: -1, name: \"SELECT EMPLOYEE\" },\n  eventStart: formatDateTimeAsMvcString(setHours(setMinutes(new Date(), 0), 8)),\n  eventEnd: formatDateTimeAsMvcString(setHours(setMinutes(new Date(), 0), 17)),\n  tag: { id: -1, name: \"SELECT TAG\" },\n  eventBreaks: [] as EventBreak[],\n  isClockedIn: false,\n  valid: true,\n  validEventStartEnd: true,\n  validEmployee: true,\n  validTag: true,\n  validEventTypeStatus: true,\n  validClockoutValue: true,\n  validRecurrenceStartEnd: true,\n  validRepeatInterval: true,\n  validRepeatWeekdays: true,\n  absentId: undefined,\n  absentName: undefined,\n  absentTimeMinutes: null,\n  notes: \"\",\n  clockoutValue: undefined,\n  isReadonly: false,\n};\n\nexport type EditorReducerAction =\n  | { type: \"LOADING\"; data: \"we're loading \" }\n  | {\n      type: \"BEGIN-UPDATE\";\n      auth: AuthorizedItems;\n      ev: ScheduleEvent;\n      eventEditAuth: EventEditAuthorization;\n    }\n  | { type: \"CANCEL\" }\n  | { type: \"CREATE-EVENT\"; auth: AuthorizedItems }\n  | {\n      type: \"TYPESTATUS-UPDATED\";\n      eventType: EventType;\n      eventStatus: EventStatus;\n      absentId?: number;\n      absentTimeMinutes: number | null;\n    }\n  | { type: \"POSITION-UPDATED\"; selectedPosition: SelectedPosition }\n  | { type: \"EMPLOYEE-UPDATED\"; employee: IdName }\n  | { type: \"START-UPDATED\"; eventStart: string }\n  | { type: \"END-UPDATED\"; eventEnd: string }\n  | { type: \"EVENTBREAKS-UPDATED\"; breaks: EventBreak[] }\n  | { type: \"TAG-UPDATED\"; tag: IdName }\n  | { type: \"CONFIRM-UPDATED\"; isConfirmed: boolean }\n  | { type: \"ISCLOCKEDIN-UPDATED\"; isClockedIn: boolean }\n  | { type: \"NOTES-UPDATED\"; notes: string }\n  | {\n      type: \"CLOCKOUTVALUE-UPDATED\";\n      clockoutValue?: string;\n      locSettings: LocationSettings;\n    }\n  | { type: \"SET-READONLY\"; isReadonly: boolean }\n  | {\n      type: \"REPEATING-UPDATED\";\n      recurrenceStart?: string;\n      recurrenceEnd?: string;\n      recurrenceType?: RecurrenceType;\n      repeatInterval?: number;\n      repeatWeekDays?: string;\n    };\n\nconst getIsClockedIn = (ev: ScheduleEvent) => {\n  const end = parseISO(ev.EventEnd);\n  return end > new Date(2199, 1, 1);\n};\n\n// ------------------------------------------------------------------------------------------------\nexport const editorValueReducer = (\n  currentState: EditorValues,\n  action: EditorReducerAction\n): EditorValues => {\n  console.log(\n    \"REDUCER: ACTION =\",\n    action.type,\n    \"   Current State Emp =\",\n    currentState.employee.id\n  );\n  switch (action.type) {\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"BEGIN-UPDATE\":\n      const { ev, auth } = action;\n      const isClockedIn = getIsClockedIn(ev);\n      return {\n        isFromEventInfo: false,\n        scheduleEventId: ev.ScheduleEventId,\n        locationId: ev.LocationId,\n        isUpdating: false,\n        eventType: ev.EventTypeId,\n        eventStatus: ev.EventStatusId,\n        isConfirmed: ev.ConfirmedBy !== undefined && ev.ConfirmedBy !== null,\n        position: {\n          location: getLocationById(auth, ev.LocationId),\n          position: getPositionById(auth, ev.PositionId),\n        },\n        employee: { id: ev.EmployeeId, name: ev.FirstName + \" \" + ev.LastName },\n        eventStart: ev.EventStart,\n        eventEnd: isClockedIn\n          ? formatDateTimeAsMvcString(new Date())\n          : ev.EventEnd,\n        tag: { id: ev.TagId ? ev!.TagId : -1, name: \"\" },\n        eventBreaks: ev.EventBreaks,\n        isClockedIn: isClockedIn,\n        valid: true,\n        validEventStartEnd: true,\n        validEmployee: true,\n        validTag: true,\n        validEventTypeStatus: true,\n        validClockoutValue: true,\n        absentName: ev.AbsentName,\n        absentId: ev.AbsentId,\n        absentTimeMinutes: ev.AbsentTimeMinutes !== null && ev.AbsentTimeMinutes !== undefined\n          ? ev!.AbsentTimeMinutes\n          : null,\n        notes: ev.Notes,\n        clockoutValue: ev.ClockOutValue,\n        isReadonly: action.eventEditAuth.isReadonly,\n        recurrenceId: ev.EventRecurrenceId,\n        recurrenceStart: ev.EventRecurrenceStart,\n        recurrenceEnd: ev.EventRecurrenceEnd,\n        recurrenceType: ev.RepeatType,\n        repeatInterval: ev.RepeatInterval,\n        repeatWeekdays: ev.RepeatWeekdays,\n        validRecurrenceStartEnd: true,\n        validRepeatInterval: true,\n        validRepeatWeekdays: true,\n      };\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"CANCEL\":\n      return INITIAL_EDITOR_VAUES;\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"POSITION-UPDATED\":\n      const { selectedPosition } = action;\n      return {\n        ...currentState,\n        position: selectedPosition,\n      };\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"CREATE-EVENT\":\n      const loc = action.auth.locations[0];\n\n      return {\n        ...INITIAL_EDITOR_VAUES,\n        employee: { id: action.auth.employeeId, name: action.auth.fullName},\n        position: {\n          location: loc,\n          position: loc.departments[0].positions[0],\n        },\n        scheduleEventId: 0,\n      };\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"SET-READONLY\":\n      return {\n        ...currentState,\n        isReadonly: action.isReadonly,\n      };\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"TYPESTATUS-UPDATED\":\n      const clockedInOnTypeStatusUpdate = currentState.isClockedIn &&\n        action.eventType === EventType.Clock &&\n        action.eventStatus === EventStatus.Approved;\n\n      const newTypeStatusState = {\n        ...currentState,\n        eventType: action.eventType,\n        eventStatus: action.eventStatus,\n        absentId: action.absentId,\n        absentTimeMinutes: action.absentTimeMinutes,\n        isClockedIn: clockedInOnTypeStatusUpdate,\n        validEventTypeStatus: !(\n          action.absentId && action.absentTimeMinutes === null\n        ),\n      };\n\n      newTypeStatusState.valid = isAllValid(newTypeStatusState);\n      return newTypeStatusState;\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"CLOCKOUTVALUE-UPDATED\":\n      const newClockoutValueState = {\n        ...currentState,\n        clockoutValue: action.clockoutValue,\n        validClockoutValue: isClockoutValueValid(\n          currentState,\n          action.locSettings,\n          action.clockoutValue\n        ),\n      };\n\n      newClockoutValueState.valid = isAllValid(newClockoutValueState);\n      return newClockoutValueState;\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"EMPLOYEE-UPDATED\":\n      const newState = {\n        ...currentState,\n        employee: action.employee,\n        validEmployee: action.employee.id > 0,\n      };\n\n      newState.valid = isAllValid(newState);\n      return newState;\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"START-UPDATED\":\n      const newStartState = {\n        ...currentState,\n        eventStart: action.eventStart,\n        validEventStartEnd: getValidStartEnd(\n          action.eventStart,\n          currentState.eventEnd\n        ),\n      };\n\n      newStartState.valid = isAllValid(newStartState);\n      return newStartState;\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"END-UPDATED\":\n      const newEndState = {\n        ...currentState,\n        eventEnd: action.eventEnd,\n        validEventStartEnd: getValidStartEnd(\n          currentState.eventStart,\n          action.eventEnd\n        ),\n      };\n\n      newEndState.valid = isAllValid(newEndState);\n      return newEndState;\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"EVENTBREAKS-UPDATED\":\n      return {\n        ...currentState,\n        eventBreaks: action.breaks,\n      };\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    case \"TAG-UPDATED\":\n      const newTagState = {\n        ...currentState,\n        tag: action.tag,\n        validTag: true,\n      };\n\n      newTagState.valid = isAllValid(newTagState);\n      return newTagState;\n\n    case \"CONFIRM-UPDATED\":\n      const newConfirmState = {\n        ...currentState,\n        isConfirmed: action.isConfirmed,\n      };\n\n      newConfirmState.valid = isAllValid(newConfirmState);\n      return newConfirmState;\n\n    case \"NOTES-UPDATED\":\n      return {\n        ...currentState,\n        notes: action.notes,\n      };\n\n    case \"ISCLOCKEDIN-UPDATED\":\n      const newClockedInState = {\n        ...currentState,\n        isClockedIn: action.isClockedIn,\n      };\n\n      if (action.isClockedIn) {\n        const now = formatDateTimeAsMvcString(new Date());\n        newClockedInState.eventEnd = now;\n      }\n\n      newClockedInState.valid = isAllValid(newClockedInState);\n      return newClockedInState;\n\n    case \"REPEATING-UPDATED\":\n      const newRepeatState = {\n        ...currentState,\n        recurrenceStart: action.recurrenceStart,\n        recurrenceEnd: action.recurrenceEnd,\n        recurrenceType: action.recurrenceType,\n        repeatInterval: action.repeatInterval,\n        repeatWeekdays: action.repeatWeekDays,\n      };\n\n      if (newRepeatState.recurrenceStart) {\n        if (newRepeatState.repeatInterval === RecurrenceType.Weekly) {\n          newRepeatState.validRepeatWeekdays =\n            newRepeatState.repeatWeekdays !== null &&\n            newRepeatState.repeatWeekdays !== undefined &&\n            newRepeatState.repeatWeekdays.length > 0;\n        } else {\n          newRepeatState.repeatWeekdays = undefined;\n          newRepeatState.validRepeatWeekdays = true;\n        }\n\n        if (!newRepeatState.recurrenceEnd) {\n          newRepeatState.validRecurrenceStartEnd = false;\n        } else {\n          newRepeatState.validRecurrenceStartEnd = isBefore(\n            parseISO(newRepeatState.recurrenceStart),\n            parseISO(newRepeatState.recurrenceEnd)\n          );\n        }\n\n        newRepeatState.validRepeatInterval =\n          newRepeatState.repeatInterval !== null &&\n          newRepeatState.repeatInterval !== undefined &&\n          newRepeatState.repeatInterval > 0;\n      }\n\n      newRepeatState.valid = isAllValid(newRepeatState);\n      return newRepeatState;\n\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    default:\n      console.error(\n        \"ERROR in editorValueReducer, could not find action for \" + action.type\n      );\n      return currentState;\n  }\n};\n","export enum RecurrenceUpdateType {\r\n  UpdateSingleEvent,\r\n  UpdateEntireSeries,\r\n  UpdateSeriesForward,\r\n}\r\n","import React from \"react\";\r\nimport { IonLabel, IonTextarea, IonCol, IonRow } from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport \"./EventStartEndEditor\";\r\nimport { AuthorizedItems } from \"../../../orbital-interfaces/authorized-items\";\r\nimport { EditorValues, EditorReducerAction } from \"../EditEventModalState\";\r\n\r\ninterface EventNotesEditorProps {\r\n  auth: AuthorizedItems;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst EventNotesEditor: React.FC<EventNotesEditorProps> = ({\r\n  editorValues,\r\n  update,\r\n}: EventNotesEditorProps) => {\r\n  const onNotesUpdate = (newNote?: string | null) => {\r\n    if (!newNote) {\r\n      newNote = \"\";\r\n    }\r\n\r\n    if (newNote !== editorValues.notes) {\r\n      update({ type: \"NOTES-UPDATED\", notes: newNote });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <IonRow>\r\n        <IonCol size=\"3\">\r\n          <IonLabel className=\"label\">Notes</IonLabel>\r\n        </IonCol>\r\n        <IonCol size=\"9\">\r\n          <IonTextarea\r\n            className=\"textarea\"\r\n            placeholder=\"Enter event note\"\r\n            maxlength={120}\r\n            spellcheck={true}\r\n            rows={4}\r\n            value={editorValues.notes}\r\n            disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n            onIonChange={(e) => onNotesUpdate(e.detail.value)}\r\n          />\r\n        </IonCol>\r\n      </IonRow>\r\n      <div className=\"character-counter\">{editorValues.notes?.length ?? 0}/120</div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EventNotesEditor;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { IonLabel, IonCol, IonRow, IonInput } from \"@ionic/react\";\r\nimport \"./EventStartEndEditor\";\r\nimport {\r\n  AuthorizedItems,\r\n  LocationSettings,\r\n} from \"../../../orbital-interfaces/authorized-items\";\r\nimport { EditorValues, EditorReducerAction } from \"../EditEventModalState\";\r\nimport authHelper from \"../../../util/authitems-helper\";\r\nimport { EventType } from \"../../../orbital-interfaces\";\r\n\r\ninterface EventClockoutValueEditorProps {\r\n  auth: AuthorizedItems;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst EventClockoutValueEditor: React.FC<EventClockoutValueEditorProps> = ({\r\n  auth,\r\n  editorValues,\r\n  update,\r\n}: EventClockoutValueEditorProps) => {\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [locSettings, setLocSettings] = useState(\r\n    null as LocationSettings | null\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (\r\n      editorValues.locationId === 0 ||\r\n      (locSettings && editorValues.locationId === locSettings.LocationId)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    if (!auth || !auth.locations || auth.locations.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!editorValues.locationId) {\r\n      return;\r\n    }\r\n\r\n    const newLocSettings = authHelper.getLocSettingsForLocationId(\r\n      auth,\r\n      editorValues.locationId\r\n    );\r\n    setLocSettings(newLocSettings);\r\n    // eslint-disable-next-line\r\n  }, [editorValues.locationId, auth]);\r\n\r\n  useEffect(() => {\r\n    if (!locSettings) {\r\n      return;\r\n    }\r\n\r\n    setIsVisible(\r\n      locSettings!.ClockOutValueLabel !== undefined &&\r\n        locSettings!.ClockOutValueLabel !== null &&\r\n        locSettings!.ClockOutValueLabel.length > 0 &&\r\n        editorValues.eventType === EventType.Clock &&\r\n        !editorValues.isClockedIn\r\n    );\r\n  }, [editorValues.eventType, editorValues.isClockedIn, locSettings]);\r\n\r\n  const onClockoutValueUpdated = (newValue?: string | null) => {\r\n    if (newValue === null) {\r\n      newValue = undefined;\r\n    }\r\n\r\n    if (newValue === editorValues.clockoutValue) {\r\n      return;\r\n    }\r\n\r\n    update({\r\n      type: \"CLOCKOUTVALUE-UPDATED\",\r\n      locSettings: locSettings!,\r\n      clockoutValue: newValue,\r\n    });\r\n  };\r\n\r\n  if (!isVisible || locSettings === null) {\r\n    return <div />;\r\n  }\r\n\r\n  return (\r\n    <IonRow className=\"edit-row\">\r\n      <IonCol size=\"3\">\r\n        <IonLabel className=\"label\">{locSettings.ClockOutValueLabel}</IonLabel>\r\n      </IonCol>\r\n      <IonCol size=\"9\">\r\n        <IonInput\r\n          className=\"input-textbox\"\r\n          placeholder=\"Enter value\"\r\n          disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n          value={editorValues.clockoutValue}\r\n          onIonChange={(e) => onClockoutValueUpdated(e.detail.value)}\r\n        />\r\n      </IonCol>\r\n    </IonRow>\r\n  );\r\n};\r\n\r\nexport default EventClockoutValueEditor;\r\n","import { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport apiHelper from \"./OrbitalApiHelper\";\r\nimport EventType from \"../enums/EventType\";\r\nimport EventStatus from \"../enums/EventStatus\";\r\nimport { RecurrenceUpdateType } from \"../enums/RecurrenceUpdateType\";\r\n\r\ninterface CoverRequestModel {\r\n  ScheduleEventId: number;\r\n  LocationId: number;\r\n  BusinessId: number;\r\n  BroadcastCoverRequestMessage: boolean;\r\n  CoverMessage: string;\r\n}\r\n\r\ninterface DeleteEventModel {\r\n  LocationId: number;\r\n  ScheduleEventId: number;\r\n  EventTypeId: EventType;\r\n  EventStatusId: EventStatus;\r\n  RecUpdateType?: RecurrenceUpdateType;\r\n}\r\n\r\nexport interface ErrorResponse {\r\n  error: boolean;\r\n  message: string;\r\n}\r\n\r\nexport interface CoverListItem {\r\n  value: number;\r\n  text: string;\r\n  disabled: boolean;\r\n  style: string | null;\r\n}\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst undoCoverRequest = async (\r\n  user: ApplicationUser,\r\n  scheduleEventId: number\r\n) => {\r\n  // eslint-disable-next-line max-len\r\n  const url = `api/v1/employee/schedule-events/cover-request/undo?scheduleEventId=${scheduleEventId}`;\r\n  return await apiHelper.put(user, url);\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst createCoverRequest = async (\r\n  user: ApplicationUser,\r\n  scheduleEventId: number,\r\n  locationId: number,\r\n  businessId: number,\r\n  broadCastMessage: boolean,\r\n  coverMessage: string,\r\n  toEmployeeId: number | null\r\n) => {\r\n  const url = \"api/v1/employee/schedule-events/cover-request/submit\";\r\n\r\n  const data = {\r\n    ScheduleEventId: scheduleEventId,\r\n    LocationId: locationId,\r\n    BusinessId: businessId,\r\n    BroadcastCoverRequestMessage: broadCastMessage,\r\n    CoverMessage: coverMessage,\r\n    DirectToEmployeeId: toEmployeeId,\r\n  } as CoverRequestModel;\r\n\r\n  return await apiHelper.put(user, url, data);\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst makeShiftRequest = async (\r\n  user: ApplicationUser,\r\n  scheduleEventId: number,\r\n  locationId: number,\r\n  businessId: number,\r\n  broadCastMessage: boolean,\r\n  coverMessage: string\r\n) => {\r\n  const url = \"api/v2/requests/shift-request/submit\";\r\n\r\n  const data = {\r\n    ScheduleEventId: scheduleEventId,\r\n    LocationId: locationId,\r\n    BusinessId: businessId,\r\n    BroadcastCoverRequestMessage: broadCastMessage,\r\n    CoverMessage: coverMessage,\r\n  } as CoverRequestModel;\r\n\r\n  return (await apiHelper.put(user, url, data)) as ErrorResponse;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst removeShiftRequest = async (\r\n  user: ApplicationUser,\r\n  locationId: number,\r\n  scheduleEventId: number,\r\n  eventType: EventType,\r\n  eventStatus: EventStatus,\r\n  recUpdateType?: RecurrenceUpdateType\r\n) => {\r\n  const url = \"api/v1/employee/schedule-events/delete\";\r\n\r\n  const data = {\r\n    LocationId: locationId,\r\n    ScheduleEventId: scheduleEventId,\r\n    EventTypeId: eventType,\r\n    EventStatusId: eventStatus,\r\n    RecUpdateType: recUpdateType,\r\n  } as DeleteEventModel;\r\n\r\n  return await apiHelper.post(user, url, data);\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst deleteEvent = async (\r\n  user: ApplicationUser,\r\n  locationId: number,\r\n  scheduleEventId: number,\r\n  eventType: EventType,\r\n  eventStatus: EventStatus,\r\n  recUpdateType?: RecurrenceUpdateType\r\n) => {\r\n  const url = \"api/v1/employee/schedule-events/delete\";\r\n\r\n  const data = {\r\n    LocationId: locationId,\r\n    ScheduleEventId: scheduleEventId,\r\n    EventTypeId: eventType,\r\n    EventStatusId: eventStatus,\r\n    RecUpdateType: recUpdateType,\r\n  } as DeleteEventModel;\r\n\r\n  return await apiHelper.post(user, url, data);\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getCoverRequestListItems = async (\r\n  user: ApplicationUser,\r\n  scheduleEventId: number,\r\n  isDirectCoverList: boolean\r\n) => {\r\n  const url = \"api/v2/requests/transfers/to-list\";\r\n\r\n  const data = {\r\n    scheduleEventId,\r\n    directCoverList: isDirectCoverList,\r\n  };\r\n\r\n  return (await apiHelper.post(user, url, data)) as CoverListItem[];\r\n};\r\n\r\nexport default {\r\n  undoCoverRequest,\r\n  createCoverRequest,\r\n  makeShiftRequest,\r\n  removeShiftRequest,\r\n  deleteEvent,\r\n  getCoverRequestListItems,\r\n};\r\n","import React, { useContext, useEffect, useState } from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonCol,\r\n  IonContent,\r\n  IonFooter,\r\n  IonGrid,\r\n  IonHeader,\r\n  IonRow,\r\n  IonSelect,\r\n  IonSelectOption,\r\n  IonTextarea,\r\n  IonTitle,\r\n  IonToolbar,\r\n} from \"@ionic/react\";\r\n// import \"./EventRequestModal.scss\";\r\nimport \"../../../global-styles.scss\";\r\nimport {\r\n  AuthorizedItems,\r\n  LocationSettings,\r\n} from \"../../../orbital-interfaces/authorized-items\";\r\nimport {\r\n  EventEditAuthorization,\r\n  EventEditEnum,\r\n} from \"../EditEventAuthorization\";\r\nimport requestAPI, { CoverListItem } from \"../../../api/RequestsAPI\";\r\nimport { ApplicationUserContext } from \"../../../context/ApplicationUserContext\";\r\n\r\ninterface EventRequestModalProps {\r\n  onCancel: () => void;\r\n  onOk: (\r\n    employeeId: number | null,\r\n    notes: string,\r\n    sendMessage: boolean\r\n  ) => void;\r\n  auth: AuthorizedItems;\r\n  eventEditAuth: EventEditAuthorization;\r\n  locSettings: LocationSettings;\r\n  scheduleEventId: number;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst EventRequestModal: React.FC<EventRequestModalProps> = ({\r\n  onCancel,\r\n  onOk,\r\n  eventEditAuth,\r\n  locSettings,\r\n  scheduleEventId,\r\n}: EventRequestModalProps) => {\r\n  const { user } = useContext(ApplicationUserContext);\r\n  const [notes, setNotes] = useState(\"\" as string | null | undefined);\r\n  const [selectedEmployeeId, setSelectedEmployeeId] = useState(\r\n    null as number | null\r\n  );\r\n  const [coverList, setCoverList] = useState(null as CoverListItem[] | null);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (\r\n      eventEditAuth.usage === EventEditEnum.CreateCoverRequest &&\r\n      scheduleEventId > 0\r\n    ) {\r\n      requestAPI\r\n        .getCoverRequestListItems(user, scheduleEventId, true)\r\n        .then((results) => {\r\n          setCoverList(results);\r\n          if (results && results.length > 0) {\r\n            setSelectedEmployeeId(results[0].value);\r\n          }\r\n        });\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [scheduleEventId, eventEditAuth.usage]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onOkClick = () => {\r\n    const newNotes = notes ?? \"\";\r\n    onOk(selectedEmployeeId, newNotes, false);\r\n  };\r\n\r\n  if (eventEditAuth.usage === EventEditEnum.None) {\r\n    return <div />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IonContent>\r\n        <IonHeader mode=\"ios\">\r\n          <IonToolbar>\r\n            <IonTitle>{eventEditAuth.buttonText}</IonTitle>\r\n          </IonToolbar>\r\n        </IonHeader>\r\n        <IonGrid>\r\n          <IonRow\r\n            hidden={\r\n              !locSettings.EnableDirectCoverRequest ||\r\n              eventEditAuth.usage !== EventEditEnum.CreateCoverRequest\r\n            }\r\n          >\r\n            <IonCol className=\"label\" size=\"3\">\r\n              To\r\n            </IonCol>\r\n            <IonCol size=\"9\">\r\n              <IonSelect\r\n                className=\"select\"\r\n                value={selectedEmployeeId}\r\n                onIonChange={(e) => {\r\n                  setSelectedEmployeeId(parseInt(e.detail.value));\r\n                }}\r\n              >\r\n                {coverList &&\r\n                  coverList.map((cover) => (\r\n                    <IonSelectOption\r\n                      key={cover.value}\r\n                      value={cover.value}\r\n                      disabled={cover.disabled}\r\n                    >\r\n                      {cover.text}\r\n                    </IonSelectOption>\r\n                  ))}\r\n              </IonSelect>\r\n            </IonCol>\r\n          </IonRow>\r\n\r\n          <IonRow\r\n            hidden={eventEditAuth.usage === EventEditEnum.CreateCoverRequest}\r\n          >\r\n            <IonCol size=\"12\">\r\n              <div className=\"usage-message\">{eventEditAuth.text}</div>\r\n            </IonCol>\r\n          </IonRow>\r\n\r\n          <IonRow\r\n            hidden={eventEditAuth.usage !== EventEditEnum.CreateCoverRequest}\r\n          >\r\n            <IonCol className=\"label\" size=\"3\">\r\n              Notes\r\n            </IonCol>\r\n            <IonCol size=\"9\">\r\n              <IonTextarea\r\n                className=\"select\"\r\n                maxlength={200}\r\n                rows={4}\r\n                value={notes}\r\n                onIonChange={(e) => {\r\n                  setNotes(e.detail.value);\r\n                }}\r\n              />\r\n            </IonCol>\r\n          </IonRow>\r\n\r\n          <IonRow>\r\n            <IonCol className=\"label\" size=\"3\" />\r\n            <IonCol size=\"9\" className=\"error-message\">\r\n              <div />\r\n            </IonCol>\r\n          </IonRow>\r\n        </IonGrid>\r\n      </IonContent>\r\n      <IonFooter>\r\n        <IonButton expand=\"block\" color=\"secondary\" onClick={onOkClick}>\r\n          OK\r\n        </IonButton>\r\n\r\n        <IonButton expand=\"block\" onClick={onCancel}>\r\n          CANCEL\r\n        </IonButton>\r\n      </IonFooter>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EventRequestModal;\r\n","import React, { useContext, useState } from \"react\";\r\nimport { IonButton, IonModal } from \"@ionic/react\";\r\n// import \"./EventRequestEditor.scss\";\r\nimport \"../../../global-styles.scss\";\r\nimport { AuthorizedItems } from \"../../../orbital-interfaces/authorized-items\";\r\nimport { EditorReducerAction } from \"../EditEventModalState\";\r\nimport EventRequestModal from \"./EventRequestModal\";\r\nimport authHelper from \"../../../util/authitems-helper\";\r\nimport reqApi from \"../../../api/RequestsAPI\";\r\nimport { ApplicationUserContext } from \"../../../context/ApplicationUserContext\";\r\nimport EventType from \"../../../enums/EventType\";\r\nimport EventStatus from \"../../../enums/EventStatus\";\r\nimport useDialogBox from \"../../../hooks/useDialogBox\";\r\nimport {\r\n  EventEditAuthorization,\r\n  EventEditEnum,\r\n} from \"../EditEventAuthorization\";\r\n\r\ninterface EventRequestEditorProps {\r\n  auth: AuthorizedItems;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n  cancelEditModal: (message: string) => void;\r\n  setUsageText: (usageText: string) => void;\r\n  eventEnd: string;\r\n  eventType: EventType;\r\n  eventStatus: EventStatus;\r\n  eventEmployeeId: number;\r\n  eventPositionId: number;\r\n  scheduleEventId: number;\r\n  locationId: number;\r\n  eventEditAuth: EventEditAuthorization | null;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst EventRequestEditor: React.FC<EventRequestEditorProps> = ({\r\n  auth,\r\n  cancelEditModal,\r\n  eventType,\r\n  eventStatus,\r\n  scheduleEventId,\r\n  locationId,\r\n  eventEditAuth,\r\n}: EventRequestEditorProps) => {\r\n  const { user } = useContext(ApplicationUserContext);\r\n  const [showRequestModal, setShowRequestModal] = useState(false);\r\n  const dlg = useDialogBox();\r\n\r\n  const onComplete = (message: string) => {\r\n    setShowRequestModal(false);\r\n    cancelEditModal(message);\r\n  };\r\n\r\n  const onApply = (\r\n    employeeId: number | null,\r\n    notes: string,\r\n    sendMessage: boolean\r\n  ) => {\r\n    switch (eventEditAuth!.usage) {\r\n      case EventEditEnum.CreateCoverRequest:\r\n        reqApi\r\n          .createCoverRequest(\r\n            user,\r\n            scheduleEventId,\r\n            locationId,\r\n            0,\r\n            sendMessage,\r\n            notes,\r\n            employeeId\r\n          )\r\n          .then(() => {\r\n            onComplete(\"Cover-Request Created\");\r\n          });\r\n        break;\r\n\r\n      case EventEditEnum.CreateShiftRequest:\r\n        reqApi\r\n          .makeShiftRequest(\r\n            user,\r\n            scheduleEventId,\r\n            locationId,\r\n            0,\r\n            sendMessage,\r\n            notes\r\n          )\r\n          .then((results) => {\r\n            if (results.error) {\r\n              dlg.showAlert(\"Shift-Request Failed\", results.message, () => {});\r\n            } else {\r\n              onComplete(results.message); // \"Shift-Request Created\"\r\n            }\r\n          });\r\n        break;\r\n\r\n      case EventEditEnum.DeleteShiftRequest:\r\n        reqApi\r\n          .removeShiftRequest(\r\n            user,\r\n            locationId,\r\n            scheduleEventId,\r\n            eventType,\r\n            eventStatus,\r\n            undefined\r\n          )\r\n          .then(() => {\r\n            onComplete(\"Shift-Request Removed\");\r\n          });\r\n        break;\r\n\r\n      case EventEditEnum.UndoCoverRequest:\r\n        reqApi.undoCoverRequest(user, scheduleEventId).then(() => {\r\n          onComplete(\"Removed Cover-Request\");\r\n        });\r\n        break;\r\n\r\n      case EventEditEnum.Delete:\r\n        reqApi\r\n          .deleteEvent(\r\n            user,\r\n            locationId,\r\n            scheduleEventId,\r\n            eventType,\r\n            eventStatus,\r\n            undefined\r\n          )\r\n          .then(() => {\r\n            onComplete(\"Deleted\");\r\n          });\r\n        break;\r\n    }\r\n  };\r\n\r\n  if (\r\n    !eventEditAuth ||\r\n    !auth ||\r\n    !auth.locations ||\r\n    auth.locations.length === 0 ||\r\n    eventEditAuth.usage === EventEditEnum.None ||\r\n    scheduleEventId <= 0\r\n  ) {\r\n    return <div />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IonButton\r\n        className=\"apply-button\"\r\n        expand=\"block\"\r\n        onClick={() => {\r\n          setShowRequestModal(true);\r\n        }}\r\n      >\r\n        {eventEditAuth.buttonText}\r\n      </IonButton>\r\n\r\n      <IonModal\r\n        isOpen={showRequestModal}\r\n        cssClass=\"mini-modal event-request-modal\"\r\n        onDidDismiss={() => setShowRequestModal(false)}\r\n      >\r\n        <EventRequestModal\r\n          onCancel={() => {\r\n            setShowRequestModal(false);\r\n          }}\r\n          onOk={onApply}\r\n          auth={auth}\r\n          eventEditAuth={eventEditAuth}\r\n          scheduleEventId={scheduleEventId}\r\n          locSettings={authHelper.getLocSettingsForLocationId(auth, locationId)}\r\n        />\r\n        {dlg.alertBoxJsx}\r\n      </IonModal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EventRequestEditor;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { IonCheckbox } from \"@ionic/react\";\r\n// import \"./WeekdayList.scss\";\r\nimport \"../../../global-styles.scss\";\r\nimport { LocationSettings } from \"../../../orbital-interfaces/authorized-items\";\r\nimport { getWeekStart } from \"../../../util/time-helper\";\r\nimport { addDays, format, getDay } from \"date-fns\";\r\nimport { EditorReducerAction, EditorValues } from \"../EditEventModalState\";\r\n\r\ninterface WeekdayListProps {\r\n  locSettings: LocationSettings | null;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst WeekdayList: React.FC<WeekdayListProps> = ({\r\n  locSettings,\r\n  editorValues,\r\n  update,\r\n}: WeekdayListProps) => {\r\n  const [checkList, setCheckList] = useState([\r\n    false,\r\n    false,\r\n    false,\r\n    false,\r\n    false,\r\n    false,\r\n    false,\r\n  ]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (!editorValues.repeatWeekdays) {\r\n      setCheckList([false, false, false, false, false, false, false]);\r\n    } else {\r\n      const newState = [false, false, false, false, false, false, false];\r\n      for (let i = 0; i < editorValues.repeatWeekdays.length; i++) {\r\n        newState[parseInt(editorValues.repeatWeekdays[i])] = true;\r\n      }\r\n\r\n      setCheckList(newState);\r\n    }\r\n  }, [editorValues.repeatWeekdays]);\r\n\r\n  if (locSettings === null) {\r\n    return <div />;\r\n  }\r\n\r\n  const weekStart = getWeekStart(\r\n    new Date(),\r\n    locSettings.DayWeekStartsOn,\r\n    locSettings.DayStartTime\r\n  );\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onCheckboxChecked(dayOfWeek: number) {\r\n    const newCheckState = checkList.slice();\r\n    newCheckState[dayOfWeek] = !checkList[dayOfWeek];\r\n    setCheckList(newCheckState);\r\n\r\n    let repeatWeekdays = \"\";\r\n    for (let i = 0; i < newCheckState.length; i++) {\r\n      if (newCheckState[i]) {\r\n        repeatWeekdays += i;\r\n      }\r\n    }\r\n\r\n    update({\r\n      type: \"REPEATING-UPDATED\",\r\n      repeatWeekDays: repeatWeekdays,\r\n      repeatInterval: editorValues.repeatInterval,\r\n      recurrenceType: editorValues.recurrenceType,\r\n      recurrenceEnd: editorValues.recurrenceEnd,\r\n      recurrenceStart: editorValues.recurrenceStart,\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div className=\"weeklist-container\">\r\n      {[0, 1, 2, 3, 4, 5, 6].map((num: number) => {\r\n        const thisDate = addDays(weekStart, num);\r\n        const dayOfWeek = getDay(thisDate);\r\n\r\n        return (\r\n          <span key={num} className=\"day\">\r\n            <IonCheckbox\r\n              className=\"day-checkbox\"\r\n              disabled={editorValues.isReadonly}\r\n              onClick={() => onCheckboxChecked(dayOfWeek)}\r\n              checked={checkList[dayOfWeek]}\r\n            />\r\n            <span className=\"day-abbr\">\r\n              {format(thisDate, \"EE\").substr(0, 2)}\r\n            </span>\r\n          </span>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default WeekdayList;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport {\r\n  IonCheckbox,\r\n  IonCol,\r\n  IonDatetime,\r\n  IonIcon,\r\n  IonInput,\r\n  IonLabel,\r\n  IonRow,\r\n  IonSelect,\r\n  IonSelectOption,\r\n} from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport { calendar, refresh } from \"ionicons/icons\";\r\nimport {\r\n  AuthorizedItems,\r\n  LocationSettings,\r\n} from \"../../../orbital-interfaces/authorized-items\";\r\nimport EventType from \"../../../enums/EventType\";\r\nimport authHelper from \"../../../util/authitems-helper\";\r\nimport WeekdayList from \"./WeekdayList\";\r\nimport { EditorReducerAction, EditorValues } from \"../EditEventModalState\";\r\nimport { RecurrenceType } from \"../../../enums/RecurrenceType\";\r\nimport { formatDateTimeAsMvcString } from \"../../../util/time-helper\";\r\n\r\ninterface RecurringEventSectionProps {\r\n  auth: AuthorizedItems;\r\n  editorValues: EditorValues;\r\n  update: React.Dispatch<EditorReducerAction>;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst RecurringEventSection: React.FC<RecurringEventSectionProps> = ({\r\n  auth,\r\n  editorValues,\r\n  update,\r\n}: RecurringEventSectionProps) => {\r\n  const [locSettings, setLocSettings] = useState(\r\n    null as LocationSettings | null\r\n  );\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [isChecked, setIsChecked] = useState(false);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (editorValues.scheduleEventId === -1) {\r\n      return;\r\n    }\r\n\r\n    if (editorValues.locationId > 0) {\r\n      setLocSettings(\r\n        authHelper.getLocSettingsForLocationId(auth, editorValues.locationId)\r\n      );\r\n    } else if (editorValues.locationId === 0) {\r\n      setLocSettings(auth.locations[0].settings);\r\n    }\r\n    // eslint-disable-next-line\r\n  }, [editorValues.locationId, editorValues.scheduleEventId]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (editorValues.scheduleEventId === -1) {\r\n      return;\r\n    }\r\n\r\n    setIsVisible(\r\n      editorValues.eventType === EventType.Shift ||\r\n      editorValues.eventType === EventType.Unavailable\r\n    );\r\n  }, [editorValues.eventType, editorValues.scheduleEventId]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (!isVisible || editorValues.scheduleEventId === -1) {\r\n      return;\r\n    }\r\n\r\n    if (editorValues.recurrenceStart) {\r\n      setIsChecked(true);\r\n    } else {\r\n      if (isChecked) {\r\n      } else {\r\n      }\r\n    }\r\n  }, [\r\n    isChecked,\r\n    isVisible,\r\n    editorValues.recurrenceStart,\r\n    editorValues.scheduleEventId,\r\n  ]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onRepeatingChecked() {\r\n    if (!isChecked) {\r\n      update({\r\n        type: \"REPEATING-UPDATED\",\r\n        repeatWeekDays: undefined,\r\n        repeatInterval: 1,\r\n        recurrenceType: RecurrenceType.Weekly,\r\n        recurrenceEnd: undefined,\r\n        recurrenceStart: formatDateTimeAsMvcString(new Date()),\r\n      });\r\n    } else {\r\n      update({\r\n        type: \"REPEATING-UPDATED\",\r\n        repeatWeekDays: undefined,\r\n        repeatInterval: undefined,\r\n        recurrenceType: undefined,\r\n        recurrenceEnd: undefined,\r\n        recurrenceStart: undefined,\r\n      });\r\n    }\r\n\r\n    setIsChecked(!isChecked);\r\n  }\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onRecurrenceStartChanged(newValue: string | null | undefined) {\r\n    if (!newValue) {\r\n      update({\r\n        type: \"REPEATING-UPDATED\",\r\n        repeatWeekDays: editorValues.repeatWeekdays,\r\n        repeatInterval: editorValues.repeatInterval,\r\n        recurrenceType: editorValues.recurrenceType,\r\n        recurrenceEnd: editorValues.recurrenceEnd,\r\n        recurrenceStart: undefined,\r\n      });\r\n    } else {\r\n      update({\r\n        type: \"REPEATING-UPDATED\",\r\n        repeatWeekDays: editorValues.repeatWeekdays,\r\n        repeatInterval: editorValues.repeatInterval,\r\n        recurrenceType: editorValues.recurrenceType,\r\n        recurrenceEnd: editorValues.recurrenceEnd,\r\n        recurrenceStart: newValue,\r\n      });\r\n    }\r\n  }\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onRecurrenceEndChanged(newValue: string | null | undefined) {\r\n    if (!newValue) {\r\n      update({\r\n        type: \"REPEATING-UPDATED\",\r\n        repeatWeekDays: editorValues.repeatWeekdays,\r\n        repeatInterval: editorValues.repeatInterval,\r\n        recurrenceType: editorValues.recurrenceType,\r\n        recurrenceEnd: undefined,\r\n        recurrenceStart: editorValues.recurrenceStart,\r\n      });\r\n    } else {\r\n      update({\r\n        type: \"REPEATING-UPDATED\",\r\n        repeatWeekDays: editorValues.repeatWeekdays,\r\n        repeatInterval: editorValues.repeatInterval,\r\n        recurrenceType: editorValues.recurrenceType,\r\n        recurrenceEnd: newValue,\r\n        recurrenceStart: editorValues.recurrenceStart,\r\n      });\r\n    }\r\n  }\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onRecurrenceTypeChanged(newValue: string | null | undefined) {\r\n    if (!newValue) {\r\n      update({\r\n        type: \"REPEATING-UPDATED\",\r\n        repeatWeekDays: editorValues.repeatWeekdays,\r\n        repeatInterval: editorValues.repeatInterval,\r\n        recurrenceType: undefined,\r\n        recurrenceEnd: editorValues.recurrenceEnd,\r\n        recurrenceStart: editorValues.recurrenceStart,\r\n      });\r\n    } else {\r\n      update({\r\n        type: \"REPEATING-UPDATED\",\r\n        repeatWeekDays: editorValues.repeatWeekdays,\r\n        repeatInterval: editorValues.repeatInterval,\r\n        recurrenceType: parseInt(newValue),\r\n        recurrenceEnd: editorValues.recurrenceEnd,\r\n        recurrenceStart: editorValues.recurrenceStart,\r\n      });\r\n    }\r\n  }\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onRepeatIntervalChanged(newValue: string | null | undefined) {\r\n    if (!newValue) {\r\n      update({\r\n        type: \"REPEATING-UPDATED\",\r\n        repeatWeekDays: editorValues.repeatWeekdays,\r\n        repeatInterval: undefined,\r\n        recurrenceType: editorValues.recurrenceType,\r\n        recurrenceEnd: editorValues.recurrenceEnd,\r\n        recurrenceStart: editorValues.recurrenceStart,\r\n      });\r\n    } else {\r\n      update({\r\n        type: \"REPEATING-UPDATED\",\r\n        repeatWeekDays: editorValues.repeatWeekdays,\r\n        repeatInterval: parseInt(newValue),\r\n        recurrenceType: editorValues.recurrenceType,\r\n        recurrenceEnd: editorValues.recurrenceEnd,\r\n        recurrenceStart: editorValues.recurrenceStart,\r\n      });\r\n    }\r\n  }\r\n\r\n  if (!isVisible) {\r\n    return <span />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IonRow>\r\n        <IonCol size=\"3\">\r\n          <IonLabel className=\"label\">(R)epeats</IonLabel>\r\n        </IonCol>\r\n\r\n        <IonCol size=\"2\">\r\n          <IonCheckbox\r\n            checked={isChecked}\r\n            onClick={onRepeatingChecked}\r\n            disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n          />\r\n        </IonCol>\r\n      </IonRow>\r\n\r\n      {isChecked && (\r\n        <>\r\n          <IonRow className=\"edit-row\">\r\n            <IonCol size=\"1\">\r\n              <IonIcon icon={calendar} mode=\"md\" />\r\n            </IonCol>\r\n            <IonCol size=\"5\">\r\n              <IonDatetime\r\n                mode=\"ios\"\r\n                value={editorValues.recurrenceStart}\r\n                className=\"select\"\r\n                displayFormat=\"M/D/YY, DDD\"\r\n                pickerFormat=\"MMM DD YYYY\"\r\n                disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n                min=\"2005-01-01\"\r\n                max=\"2030-01-01\"\r\n                onIonChange={(e) => {\r\n                  onRecurrenceStartChanged(e.detail.value);\r\n                }}\r\n              />\r\n            </IonCol>\r\n            <IonCol size=\"1\">\r\n              <IonIcon\r\n                icon={calendar}\r\n                mode=\"md\"\r\n                style={{ textAlign: \"right\" }}\r\n              />\r\n            </IonCol>\r\n            <IonCol size=\"5\">\r\n              <IonDatetime\r\n                mode=\"ios\"\r\n                value={editorValues.recurrenceEnd}\r\n                className=\"select\"\r\n                displayFormat=\"M/D/YY, DDD\"\r\n                pickerFormat=\"MMM DD YYYY\"\r\n                disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n                min=\"2005-01-01\"\r\n                max=\"2030-01-01\"\r\n                onIonChange={(e) => {\r\n                  onRecurrenceEndChanged(e.detail.value);\r\n                }}\r\n              />\r\n            </IonCol>\r\n          </IonRow>\r\n          <IonRow className=\"edit-row\">\r\n            <IonCol size=\"1\">\r\n              <IonIcon icon={refresh} mode=\"md\" />\r\n            </IonCol>\r\n            <IonCol size=\"5\">\r\n              <IonSelect\r\n                mode=\"ios\"\r\n                interface=\"action-sheet\"\r\n                className=\"select\"\r\n                value={editorValues.recurrenceType}\r\n                disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n                onIonChange={(e) => {\r\n                  onRecurrenceTypeChanged(e.detail.value);\r\n                }}\r\n              >\r\n                <IonSelectOption value={RecurrenceType.Weekly}>\r\n                  Weekly\r\n                </IonSelectOption>\r\n                <IonSelectOption value={RecurrenceType.MonthlyByDayOfMonth}>\r\n                  Monthly (Day of Month)\r\n                </IonSelectOption>\r\n                <IonSelectOption value={RecurrenceType.MonthlyByDayOfWeek}>\r\n                  Monthly (Day of Week)\r\n                </IonSelectOption>\r\n              </IonSelect>\r\n            </IonCol>\r\n            <IonCol size=\"1\">#</IonCol>\r\n            <IonCol size=\"5\">\r\n              <IonInput\r\n                className=\"input-textbox\"\r\n                disabled={editorValues.isReadonly || editorValues.isConfirmed}\r\n                value={\r\n                  editorValues.repeatInterval\r\n                    ? editorValues.repeatInterval.toString()\r\n                    : undefined\r\n                }\r\n                onIonChange={(e) => onRepeatIntervalChanged(e.detail.value)}\r\n              />\r\n            </IonCol>\r\n          </IonRow>\r\n          <IonRow>\r\n            <IonCol size=\"12\">\r\n              <WeekdayList\r\n                locSettings={locSettings}\r\n                editorValues={editorValues}\r\n                update={update}\r\n              />\r\n            </IonCol>\r\n          </IonRow>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RecurringEventSection;\r\n","import React from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonCol,\r\n  IonContent,\r\n  IonGrid,\r\n  IonHeader,\r\n  IonRow,\r\n  IonTitle,\r\n  IonToolbar,\r\n  IonFooter,\r\n} from \"@ionic/react\";\r\nimport { RecurrenceUpdateType } from \"../../enums/RecurrenceUpdateType\";\r\nimport \"../../global-styles.scss\";\r\n\r\ninterface RecurrenceUpdateTypeSelectorProps {\r\n  onSelect: (selection: RecurrenceUpdateType | null) => void;\r\n  updateType: \"NO\" | \"UPDATE\" | \"DELETE\";\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst RecurrenceUpdateTypeSelector: React.FC<RecurrenceUpdateTypeSelectorProps> = ({\r\n  onSelect,\r\n  updateType,\r\n}: RecurrenceUpdateTypeSelectorProps) => {\r\n  if (updateType === \"NO\") {\r\n    return <div />;\r\n  }\r\n\r\n  const onButtonClick = (choice: RecurrenceUpdateType | null) => {\r\n    onSelect(choice);\r\n  };\r\n\r\n  const titleText =\r\n    updateType === \"UPDATE\" ? \"Update Repeating\" : \"Delete Repeating\";\r\n\r\n  return (\r\n    <>\r\n      <IonHeader mode=\"ios\">\r\n        <IonToolbar>\r\n          <IonTitle>{titleText}</IonTitle>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n      <IonContent>\r\n        <IonGrid>\r\n          <IonRow>\r\n            <IonCol size=\"12\">\r\n              <IonButton\r\n                expand=\"block\"\r\n                color=\"danger\"\r\n                className=\"apply-button\"\r\n                onClick={() =>\r\n                  onButtonClick(RecurrenceUpdateType.UpdateSingleEvent)\r\n                }\r\n              >\r\n                This event\r\n              </IonButton>\r\n            </IonCol>\r\n          </IonRow>\r\n          <IonRow>\r\n            <IonCol size=\"12\">\r\n              <IonButton\r\n                expand=\"block\"\r\n                color=\"danger\"\r\n                className=\"apply-button\"\r\n                onClick={() =>\r\n                  onButtonClick(RecurrenceUpdateType.UpdateEntireSeries)\r\n                }\r\n              >\r\n                Entire series\r\n              </IonButton>\r\n            </IonCol>\r\n          </IonRow>\r\n          <IonRow>\r\n            <IonCol size=\"12\">\r\n              <IonButton\r\n                expand=\"block\"\r\n                color=\"danger\"\r\n                className=\"apply-button\"\r\n                onClick={() =>\r\n                  onButtonClick(RecurrenceUpdateType.UpdateSeriesForward)\r\n                }\r\n              >\r\n                This event forward\r\n              </IonButton>\r\n            </IonCol>\r\n          </IonRow>\r\n        </IonGrid>\r\n      </IonContent>\r\n      <IonFooter>\r\n        <IonButton\r\n          expand=\"block\"\r\n          className=\"cancel-button\"\r\n          onClick={() => onButtonClick(null)}\r\n        >\r\n          Cancel\r\n        </IonButton>\r\n      </IonFooter>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RecurrenceUpdateTypeSelector;\r\n","import React, { useEffect, useReducer, useState } from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonButtons,\r\n  IonIcon,\r\n  IonContent,\r\n  IonFooter,\r\n  IonHeader,\r\n  IonGrid,\r\n  IonRow,\r\n  IonCol,\r\n  IonTitle,\r\n  IonToolbar,\r\n  IonModal,\r\n} from \"@ionic/react\";\r\nimport { arrowBackOutline } from \"ionicons/icons\";\r\n// import \"./EditEventModal.scss\";\r\nimport \"../../global-styles.scss\";\r\nimport {AuthorizedItems} from \"../../orbital-interfaces/authorized-items\";\r\nimport EventTypeStatusEditor from \"./editor/EventTypeStatusEditor\";\r\nimport EventPositionEditor from \"./editor/EventPositionEditor\";\r\nimport EventEmployeeEditor from \"./editor/EventEmployeeEditor\";\r\nimport EventStartEndEditor from \"./editor/EventStartEndEditor\";\r\nimport EventBreakEditor from \"./editor/EventBreakEditor\";\r\nimport EventTagEditor from \"./editor/EventTagEditor\";\r\nimport EventConfirmEditor from \"./editor/EventConfirmEditor\";\r\nimport EventIsClockedInEditor from \"./editor/EventIsClockedInEditor\";\r\nimport { editorValueReducer, EditorValues } from \"./EditEventModalState\";\r\nimport scheduleEventApi from \"../../api/ScheduleEventsAPI\";\r\nimport { ApplicationUserContext } from \"../../context/ApplicationUserContext\";\r\nimport useDialogBox from \"../../hooks/useDialogBox\";\r\nimport { ScheduleEvent } from \"../../orbital-interfaces/ScheduleEvent\";\r\nimport EventNotesEditor from \"./editor/EventNotesEditor\";\r\nimport EventClockoutValueEditor from \"./editor/EventClockoutValueEditor\";\r\nimport EventReqeustEditor from \"./editor/EventRequestEditor\";\r\nimport { createBrowserHistory } from \"history\";\r\nimport { EventEditAuthorization } from \"./EditEventAuthorization\";\r\nimport RecurringEventSection from \"./editor/RecurringEventSection\";\r\nimport { RecurrenceUpdateType } from \"../../enums/RecurrenceUpdateType\";\r\nimport RecurrenceUpdateTypeSelector from \"./RecurrenceUpdateTypeSelector\";\r\nimport useOrbitalDialogBox from \"../../hooks/useOrbitalDialogBox\";\r\nimport { useShowLoading } from \"../../hooks/useShowLoading\";\r\nimport {log} from \"../../util/logger\";\r\nimport {convertTimeWithoutTimeZoneToLocalTime} from \"../../util/time-helper\";\r\n\r\ninterface ScheduleFilterModalProps {\r\n  scheduleEventId: number | null;\r\n  auth: AuthorizedItems;\r\n  onDismissModal: (toastMessage?: string) => void;\r\n  onCancelModal: () => void;\r\n  isOpen: boolean;\r\n  eventEditAuth: EventEditAuthorization;\r\n  initialEvent: EditorValues;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction fixDatesForIPhone(se: ScheduleEvent): void {\r\n  se.EventStart = convertTimeWithoutTimeZoneToLocalTime(se.EventStart);\r\n  se.EventEnd = convertTimeWithoutTimeZoneToLocalTime(se.EventEnd);\r\n\r\n  if (se.EventBreaks) {\r\n    for(let i = 0; i < se.EventBreaks.length; i++) {\r\n      se.EventBreaks[i].BreakStart =\r\n        convertTimeWithoutTimeZoneToLocalTime(se.EventBreaks[i].BreakStart);\r\n\r\n      if (se.EventBreaks[i].BreakEnd) {\r\n        convertTimeWithoutTimeZoneToLocalTime(se.EventBreaks[i].BreakEnd);\r\n      }\r\n    }\r\n  }}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst EditEventModal: React.FC<ScheduleFilterModalProps> = ({\r\n  auth,\r\n  scheduleEventId,\r\n  onDismissModal,\r\n  onCancelModal,\r\n  isOpen,\r\n  eventEditAuth,\r\n  initialEvent,\r\n}) => {\r\n  const loading = useShowLoading(\"Please wait...\");\r\n  const dlg = useDialogBox();\r\n  const { user } = React.useContext(ApplicationUserContext);\r\n  const [editorValues, updateEditorValues] = useReducer(\r\n    editorValueReducer,\r\n    initialEvent\r\n  );\r\n\r\n  const [scheduleEvent, setScheduleEvent] = useState(\r\n    null as ScheduleEvent | null\r\n  );\r\n\r\n  const [recurrenceUpdateType, setRecurrenceUpdateType] = useState(\r\n    null as RecurrenceUpdateType | null\r\n  );\r\n\r\n  const [\r\n    showRecurrenceUpdateTypeSelector,\r\n    setShowRecurrenceUpdateTypeSelector,\r\n  ] = useState(\"NO\" as \"NO\" | \"UPDATE\" | \"DELETE\");\r\n\r\n  const [buttonClicked, setButtonClicked] = useState(\r\n    \"NONE\" as \"NONE\" | \"CREATEUPDATE\" | \"DELETE\"\r\n  );\r\n\r\n  const isEditing = scheduleEventId !== null;\r\n  const dialog = useOrbitalDialogBox();\r\n  let title = \"New Event\";\r\n  let buttonText = \"CREATE\";\r\n\r\n  if (isEditing) {\r\n    title = \"Edit Event\";\r\n    buttonText = \"UPDATE\";\r\n  }\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      return;\r\n    }\r\n\r\n    if (!auth || !auth.locations || auth.locations.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (scheduleEventId &&\r\n       (scheduleEvent === null || (scheduleEventId !== scheduleEvent.ScheduleEventId))) {\r\n\r\n      loading.setShowLoading(true);\r\n      log(\"edit_event_get_scheduleevent\", { user: user.username, scheduleEventId: scheduleEventId});\r\n      scheduleEventApi\r\n        .getScheduleEvent(user, scheduleEventId)\r\n        .then((scheduleEvent) => {\r\n          loading.setShowLoading(false);\r\n          if (!scheduleEvent) {\r\n            dlg.showAlert(\r\n              \"No Event\",\r\n              \"The event may have been removed or you no longer have access\",\r\n              onCancel\r\n            );\r\n            return;\r\n          }\r\n\r\n          fixDatesForIPhone(scheduleEvent);\r\n\r\n\r\n          setScheduleEvent(scheduleEvent);\r\n          updateEditorValues({\r\n            type: \"BEGIN-UPDATE\",\r\n            ev: scheduleEvent,\r\n            auth,\r\n            eventEditAuth,\r\n          });\r\n        });\r\n    } else {\r\n      if (scheduleEvent !== null) {\r\n        setScheduleEvent(null);\r\n      }\r\n\r\n      updateEditorValues({ type: \"CREATE-EVENT\", auth });\r\n    }\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [scheduleEventId, user, isOpen, auth]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (recurrenceUpdateType !== null && buttonClicked !== \"NONE\") {\r\n      if (buttonClicked === \"CREATEUPDATE\") {\r\n        createOrUpdate();\r\n      } else {\r\n        deleteEvent(\r\n          editorValues.recurrenceId !== null &&\r\n          editorValues.recurrenceId !== undefined\r\n        );\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [recurrenceUpdateType, buttonClicked]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const createOrUpdate = () => {\r\n    const apiCall =\r\n      editorValues.scheduleEventId === 0\r\n        ? scheduleEventApi.createScheduleEvent\r\n        : scheduleEventApi.updateScheduleEvent;\r\n\r\n    const logEvent = editorValues.scheduleEventId === 0 ? \"edit_event_create\" : \"edit_event_update\";\r\n\r\n\r\n    apiCall(user, editorValues, recurrenceUpdateType).then((result) => {\r\n      if (result.error) {\r\n        dlg.showAlert(\"Cannot update\", result.message, () => {});\r\n      } else {\r\n        log(logEvent, { user: user.username, scheduleEventId: scheduleEventId});\r\n        onDismissModal(\"Event Updated\");\r\n      }\r\n    });\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onConfirmButtonClicked = () => {\r\n    // Since the update has not updated editor values, we're essentially toggling\r\n    // the confirmed setting.  Update with what it is currently *not* set to.\r\n    const confirmed = !editorValues.isConfirmed;\r\n    scheduleEventApi.updateConfirmedScheduleEvent(\r\n      user,\r\n      editorValues.scheduleEventId,\r\n      confirmed).then(res => {\r\n        if (res.error) {\r\n          dlg.showAlert(\"Could not \" + confirmed ? \"confirm\" : \"unconfirm\",\r\n            res.message, () => {});\r\n        } else {\r\n          onDismissModal(confirmed ? \"Confirmed\" : \"Unconfirmed\");\r\n        }\r\n      });\r\n  }\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const deleteEvent = (skipPrompt: boolean) => {\r\n    const goDelete = () => {\r\n      scheduleEventApi\r\n        .deleteScheduleEvent(\r\n          user,\r\n          editorValues.scheduleEventId,\r\n          recurrenceUpdateType\r\n        )\r\n        .then((result) => {\r\n          if (result.error) {\r\n            dlg.showAlert(\"Cannot delete\", result.message, () => {\r\n              onDismissModal(\"Could not delete event\");\r\n            });\r\n          } else {\r\n            log(\"edit_event_delete\", { user: user.username, scheduleEventId: scheduleEventId});\r\n            onDismissModal(\"Deleted Event\");\r\n          }\r\n        });\r\n    };\r\n\r\n    if (skipPrompt) {\r\n      goDelete();\r\n    } else {\r\n      dialog.showDialog(\r\n        \"Delete event?\",\r\n        \"\",\r\n        [{ text: \"Delete\", color: \"danger\", value: 1 }],\r\n        (selection) => {\r\n          if (selection === 1) {\r\n            goDelete();\r\n          }\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onCreateOrUpdateClick = () => {\r\n    setButtonClicked(\"CREATEUPDATE\");\r\n    if (editorValues.recurrenceId) {\r\n      if (recurrenceUpdateType !== null) {\r\n        createOrUpdate();\r\n      } else {\r\n        setShowRecurrenceUpdateTypeSelector(\"UPDATE\");\r\n      }\r\n    } else {\r\n      createOrUpdate();\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onRecurrenceUpdateTypeSelect = (\r\n    selection: RecurrenceUpdateType | null\r\n  ) => {\r\n    setShowRecurrenceUpdateTypeSelector(\"NO\");\r\n    setRecurrenceUpdateType(selection);\r\n    if (selection === null) {\r\n      setButtonClicked(\"NONE\");\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onDeleteClick = () => {\r\n    setButtonClicked(\"DELETE\");\r\n    if (editorValues.recurrenceId) {\r\n      if (recurrenceUpdateType !== null) {\r\n        deleteEvent(true);\r\n      } else {\r\n        setShowRecurrenceUpdateTypeSelector(\"DELETE\");\r\n      }\r\n    } else {\r\n      deleteEvent(\r\n        editorValues.recurrenceId !== null &&\r\n        editorValues.recurrenceId !== undefined\r\n      );\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onCancel = () => {\r\n    updateEditorValues({ type: \"CANCEL\" });\r\n    const history = createBrowserHistory();\r\n    history.push(\"/tabs/schedule\");\r\n    onCancelModal();\r\n  };\r\n\r\n  if (!isOpen || !auth || !auth.locations || auth.locations.length === 0) {\r\n    return (\r\n      <>\r\n        <div>Loading</div>\r\n        {dlg.alertBoxJsx}\r\n      </>\r\n    );\r\n  } else {\r\n    return (\r\n      <>\r\n        <IonHeader className=\"ion-no-border\">\r\n          <IonToolbar>\r\n            <IonButtons slot=\"start\">\r\n              <IonButton onClick={onCancel}>\r\n                <IonIcon icon={arrowBackOutline} mode=\"md\" slot=\"icon-only\" />\r\n              </IonButton>\r\n            </IonButtons>\r\n            <IonTitle>{title}</IonTitle>\r\n          </IonToolbar>\r\n        </IonHeader>\r\n\r\n        <IonContent class=\"outer-content\">\r\n          <IonGrid>\r\n            <EventTypeStatusEditor\r\n              editorValues={editorValues}\r\n              update={updateEditorValues}\r\n              auth={auth}\r\n            />\r\n\r\n            <IonRow className=\"edit-row\">\r\n              <EventConfirmEditor\r\n                auth={auth}\r\n                editorValues={editorValues}\r\n                update={updateEditorValues}\r\n                onEmployeeUpdated={onConfirmButtonClicked}\r\n              />\r\n              <EventIsClockedInEditor\r\n                auth={auth}\r\n                editorValues={editorValues}\r\n                update={updateEditorValues}\r\n              />\r\n            </IonRow>\r\n\r\n            <IonRow className=\"edit-row\">\r\n              <IonCol size=\"12\">\r\n                <div style={{ width: \"100%\", borderBottom: \"1px solid #ddd\" }} />\r\n              </IonCol>\r\n            </IonRow>\r\n\r\n            <EventPositionEditor\r\n              auth={auth}\r\n              editorValues={editorValues}\r\n              update={updateEditorValues}\r\n            />\r\n\r\n            <EventEmployeeEditor\r\n              auth={auth}\r\n              editorValues={editorValues}\r\n              update={updateEditorValues}\r\n            />\r\n\r\n            <EventStartEndEditor\r\n              auth={auth}\r\n              editorValues={editorValues}\r\n              update={updateEditorValues}\r\n            />\r\n\r\n            <RecurringEventSection\r\n              auth={auth}\r\n              editorValues={editorValues}\r\n              update={updateEditorValues}\r\n            />\r\n\r\n            <IonRow className=\"edit-row\">\r\n              <IonCol size=\"12\">\r\n                <div style={{ width: \"100%\", borderBottom: \"1px solid #ddd\" }} />\r\n              </IonCol>\r\n            </IonRow>\r\n\r\n            <EventBreakEditor\r\n              auth={auth}\r\n              editorValues={editorValues}\r\n              update={updateEditorValues}\r\n            />\r\n\r\n            <EventTagEditor\r\n              auth={auth}\r\n              editorValues={editorValues}\r\n              update={updateEditorValues}\r\n            />\r\n\r\n            <EventClockoutValueEditor\r\n              auth={auth}\r\n              editorValues={editorValues}\r\n              update={updateEditorValues}\r\n            />\r\n\r\n            <EventNotesEditor\r\n              auth={auth}\r\n              editorValues={editorValues}\r\n              update={updateEditorValues}\r\n            />\r\n          </IonGrid>\r\n\r\n          {dlg.alertBoxJsx}\r\n          {dialog.dialogBoxJsx}\r\n          {loading.showLoadingJsx}\r\n\r\n          <IonModal\r\n            isOpen={showRecurrenceUpdateTypeSelector !== \"NO\"}\r\n            onDidDismiss={() => {\r\n              onRecurrenceUpdateTypeSelect(null);\r\n            }}\r\n            cssClass=\"mini-modal recurrence-update-modal\"\r\n          >\r\n            <RecurrenceUpdateTypeSelector\r\n              onSelect={onRecurrenceUpdateTypeSelect}\r\n              updateType={showRecurrenceUpdateTypeSelector}\r\n            />\r\n          </IonModal>\r\n        </IonContent>\r\n\r\n        <IonFooter>\r\n          <EventReqeustEditor\r\n            auth={auth}\r\n            eventType={editorValues.eventType}\r\n            eventEnd={editorValues.eventEnd}\r\n            eventStatus={editorValues.eventStatus}\r\n            eventEmployeeId={editorValues.employee.id}\r\n            eventPositionId={editorValues.position.position.id}\r\n            scheduleEventId={editorValues.scheduleEventId}\r\n            locationId={editorValues.locationId}\r\n            eventEditAuth={eventEditAuth}\r\n            update={updateEditorValues}\r\n            cancelEditModal={(message) => onDismissModal(message)}\r\n            setUsageText={() => { }}\r\n          />\r\n          <IonButton\r\n            className=\"apply-button\"\r\n            expand=\"block\"\r\n            onClick={onCreateOrUpdateClick}\r\n            disabled={!editorValues.valid}\r\n            hidden={editorValues.isReadonly}\r\n          >\r\n            {buttonText}\r\n          </IonButton>\r\n          <IonButton\r\n            className=\"delete-button\"\r\n            expand=\"block\"\r\n            onClick={onDeleteClick}\r\n            hidden={\r\n              editorValues.isReadonly || editorValues.scheduleEventId <= 0\r\n            }\r\n          >\r\n            DELETE\r\n          </IonButton>\r\n        </IonFooter>\r\n      </>\r\n    );\r\n  }\r\n};\r\n\r\nexport default EditEventModal;\r\n","import React from \"react\";\r\n// import \"./EventCard.scss\";\r\nimport \"../../global-styles.scss\";\r\nimport Skeleton from \"react-loading-skeleton\";\r\n\r\ninterface EventCardSkeletonProps {\r\n  threeRows?: boolean;\r\n}\r\n\r\nconst EventCardSkeleton: React.FC<EventCardSkeletonProps> = ({\r\n  threeRows,\r\n}: EventCardSkeletonProps) => {\r\n  return (\r\n    <button className=\"card\">\r\n      <div className=\"card-first-col\">\r\n        <div className=\"day-name\">\r\n          <Skeleton />{\" \"}\r\n        </div>\r\n        <div className=\"day-number\">\r\n          <Skeleton />\r\n        </div>\r\n      </div>\r\n      <div style={{ padding: \"3px\" }}>\r\n        <Skeleton width={5} height={45} />\r\n      </div>\r\n      <div className=\"card-second-col\">\r\n        <div className=\"time-row\">\r\n          <span>\r\n            <Skeleton width={150} height={9} />\r\n            &nbsp;&nbsp;\r\n          </span>\r\n          <Skeleton />\r\n        </div>\r\n        {threeRows && (\r\n          <div>\r\n            <Skeleton width={80} height={10} />\r\n          </div>\r\n        )}\r\n        <div className=\"dept-position-row\">\r\n          <Skeleton width={150} height={10} />\r\n          &nbsp;&nbsp;\r\n        </div>\r\n      </div>\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default EventCardSkeleton;\r\n","import { useEffect, useRef } from \"react\";\r\n\r\nexport function useInterval(\r\n  callback: () => void,\r\n  isRunning: boolean,\r\n  delay: number\r\n) {\r\n  const savedProps = useRef<() => void>();\r\n\r\n  // Remember the latest callback.\r\n  useEffect(() => {\r\n    savedProps.current = callback;\r\n  }, [callback]);\r\n\r\n  // Set up the interval.\r\n  useEffect(() => {\r\n    function tick() {\r\n      if (savedProps.current && isRunning) {\r\n        savedProps.current();\r\n      }\r\n    }\r\n\r\n    if (delay !== null) {\r\n      const id = setInterval(tick, delay);\r\n      return () => clearInterval(id);\r\n    }\r\n  }, [delay, isRunning]);\r\n}\r\n","import React, {useCallback, useEffect, useRef, useState} from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonButtons,\r\n  IonContent,\r\n  IonHeader,\r\n  IonIcon,\r\n  IonMenuButton,\r\n  IonModal,\r\n  IonPage,\r\n  IonSegment,\r\n  IonSegmentButton,\r\n  IonTitle,\r\n  IonToolbar,\r\n  useIonViewWillEnter,\r\n  useIonViewWillLeave,\r\n} from \"@ionic/react\";\r\nimport {add, funnel} from \"ionicons/icons\";\r\nimport \"../global-styles.scss\";\r\nimport {getWeekStart} from \"../util/time-helper\";\r\nimport {addDays, startOfDay} from \"date-fns\";\r\nimport {AuthorizedItems} from \"../orbital-interfaces/authorized-items\";\r\nimport ScheduleEventsAPI from \"../api/ScheduleEventsAPI\";\r\nimport {DailyNotes} from \"../orbital-interfaces/DailyNotes\";\r\nimport {RefresherEventDetail} from \"@ionic/core\";\r\nimport {EventInformation, HoursList} from \"../orbital-interfaces/TEC\";\r\nimport {EventFilter, EventFilterView} from \"../orbital-interfaces/EventFilter\";\r\nimport WeekChooser from \"../components/SchedulePageComponents/WeekChooser\";\r\nimport EventList from \"../components/SchedulePageComponents/EventList\";\r\nimport ScheduleFilterModal from \"../components/SchedulePageComponents/ScheduleFilterModal\";\r\nimport useIonicRefresher from \"../hooks/useIonicRefresher\";\r\nimport EditEventModal from \"../components/EditEvent/EditEventModal\";\r\nimport useSimpleToast from \"../hooks/useSimpleToast\";\r\nimport {AuthorizedItemsContext} from \"../context/AuthorizedItemsContext\";\r\nimport {ApplicationUserContext} from \"../context/ApplicationUserContext\";\r\nimport {RouteComponentProps} from \"react-router\";\r\nimport Skeleton from \"react-loading-skeleton\";\r\nimport EventCardSkeleton from \"../components/SchedulePageComponents/EventCardSkeleton\";\r\nimport {EventEditAuthorization, getEventNewAuthorization,} from \"../components/EditEvent/EditEventAuthorization\";\r\nimport NoEventsToShow from \"../components/SchedulePageComponents/NoEventsToShow\";\r\nimport {useInterval} from \"../hooks/useInterval\";\r\nimport {getEditorValuesFromEventInformation, INITIAL_EDITOR_VAUES,} from \"../components/EditEvent/EditEventModalState\";\r\nimport EventGroup from \"../enums/EventGroup\";\r\nimport EventStatus from \"../enums/EventStatus\";\r\nimport {eventMatchesFilter} from \"../util/scheduleevent-helper\";\r\nimport {getConstants} from \"../api/environment\";\r\nimport authHelper from \"../util/authitems-helper\";\r\nimport {filterStore} from \"../data/filterStore\";\r\n\r\nconst initialEvents: EventInformation[] = [];\r\nconst initialDailyNotes: DailyNotes[] = [];\r\n\r\ninterface SchedulePageProps\r\n  extends RouteComponentProps<{\r\n    scheduleEventId?: string;\r\n  }> {}\r\n\r\n\r\ninterface EventListRef {\r\n  scrollToDate: (d: Date) => void;\r\n}\r\n\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction eventPassesFilter(ev: EventInformation, filter: EventFilter): boolean {\r\n  if (!filter.positionIds.includes(ev.PositionId)) {\r\n    return false;\r\n  }\r\n\r\n  if (filter.tagId !== undefined && filter.tagId !== -1)\r\n  {\r\n    if (filter.tagId !== ev.TagId)\r\n    {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return eventMatchesFilter(\r\n    filter.eventTypeId,\r\n    filter.eventStatusId,\r\n    ev.EventTypeId,\r\n    ev.EventStatusId\r\n  )\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction dailyNotePassesFilter(auth: AuthorizedItems, dn: DailyNotes, filter: EventFilter): boolean {\r\n  if (dn.DepartmentId === -1) {\r\n    if (!filter.positionIds\r\n      .map(pid => {return authHelper.getLocationIdFromPositionid(auth, pid)})\r\n      .includes(dn.LocationId)) {\r\n      return false;\r\n    }\r\n  } else if (dn.DepartmentId > 0) {\r\n    if (!filter.positionIds\r\n      .map(pid => {return authHelper.getDepartmentFromPositionId(auth, pid)?.id})\r\n      .includes(dn.DepartmentId)) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction getAllScheduleEvents(events: EventInformation[], f: EventFilter) {\r\n  return events.filter((ev) =>\r\n    eventMatchesFilter(\r\n      f.eventTypeId,\r\n      f.eventStatusId,\r\n      ev.EventTypeId,\r\n      ev.EventStatusId\r\n    )\r\n  );\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction getMyScheduleEvents(\r\n  events: EventInformation[],\r\n  auth: AuthorizedItems,\r\n  f: EventFilter\r\n) {\r\n  return events.filter(\r\n    (ev) =>\r\n      eventMatchesFilter(\r\n        f.eventTypeId,\r\n        f.eventStatusId,\r\n        ev.EventTypeId,\r\n        ev.EventStatusId\r\n      ) && ev.EmployeeId === auth.employeeId\r\n  );\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction getRequestScheduleEvents(events: EventInformation[]) {\r\n  return events.filter((ev) => ev.EventStatusId === EventStatus.Request);\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\n//\r\n// ------------------------------------------------------------------------------------\r\n// eslint-disable-next-line react/prop-types\r\nconst SchedulePage: React.FC<SchedulePageProps> = ({ match }) => {\r\n  const eventListRef = useRef(null as EventListRef | null);\r\n  const { user } = React.useContext(ApplicationUserContext);\r\n  const { auth, refreshAuth } = React.useContext(AuthorizedItemsContext);\r\n  const toast = useSimpleToast();\r\n  const refresher = useIonicRefresher(\r\n    (e: CustomEvent<RefresherEventDetail>) => {\r\n      getScheduleEvents(auth, filter, e);\r\n    }\r\n  );\r\n\r\n  const startDate =\r\n    auth && auth.locations && auth.locations.length > 0\r\n      ? getWeekStart(\r\n          startOfDay(new Date()),\r\n          auth.locations[0].settings.DayWeekStartsOn,\r\n          auth.locations[0].settings.DayStartTime\r\n        )\r\n      : getWeekStart(startOfDay(new Date()), \"Monday\", \"\");\r\n\r\n  const [myScheduleEvents, setMyScheduleEvents] = useState(initialEvents);\r\n  const [myDailyNotes, setMyDailyNotes] = useState(initialDailyNotes);\r\n  const [myFilteredScheduleEvents, setMyFilteredScheduleEvents] = useState(initialEvents);\r\n  const [myFilteredDailyNotes, setMyFilteredDailyNotes] = useState(initialDailyNotes);\r\n  const [myTotalTime, setMyTotalTime] = useState([] as HoursList[]);\r\n\r\n  const [requestScheduleEvents, setRequestScheduleEvents] = useState(initialEvents);\r\n  const [requestDailyNotes, setRequestDailyNotes] = useState(initialDailyNotes);\r\n  const [requestFilteredScheduleEvents, setRequestFilteredScheduleEvents] = useState(initialEvents);\r\n  const [requestFilteredDailyNotes, setRequestFilteredDailyNotes] = useState(initialDailyNotes);\r\n  const [requestHoursPerDay, setRequestHoursPerDay] = useState([] as HoursList[]);\r\n\r\n  const [allScheduleEvents, setAllScheduleEvents] = useState(initialEvents);\r\n  const [allDailyNotes, setAllDailyNotes] = useState(initialDailyNotes);\r\n  const [allFilteredScheduleEvents, setAllFilteredScheduleEvents] = useState(initialEvents);\r\n  const [allFilteredDailyNotes, setAllFilteredDailyNotes] = useState(initialDailyNotes);\r\n  const [allHoursPerDay, setAllHoursPerDay] = useState([] as HoursList[]);\r\n\r\n  const [showLoading, setShowLoading] = useState(true);\r\n  const [isShowing, setIsShowing] = useState(false);\r\n  const [segment, setSegment] = useState<\"my\" | \"requests\" | \"all\">(\"my\");\r\n  const [showFilterModal, setShowFilterModal] = useState(false);\r\n  const [showEventModal, setShowEventModal] = useState(false);\r\n  const [editEventId, setEditEventId] = useState(null as number | null);\r\n  const [initialEditEvent, setInitialEditEvent] = useState(INITIAL_EDITOR_VAUES);\r\n  const [eventEditAuth, setEventEditAuth] = useState(\r\n    null as EventEditAuthorization | null\r\n  );\r\n\r\n  const storedFilter = filterStore.getFilter(auth);\r\n\r\n  const [filter, setFilter] = useState({\r\n    tagId: storedFilter.tagId,\r\n    positionIds: storedFilter.positionIds,\r\n    dnLocIds: storedFilter.dnLocIds,\r\n    settingsLocId: storedFilter.settingsLocId,\r\n    eventTypeId: storedFilter.eventTypeId,\r\n    eventStatusId: storedFilter.eventStatusId,\r\n    start: startDate,\r\n    end: addDays(startDate, 7),\r\n    filterByEmployee: false,\r\n    view: EventFilterView.schedule\r\n  } as EventFilter);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useIonViewWillEnter(() => {\r\n    setIsShowing(true);\r\n  });\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useIonViewWillLeave(() => {\r\n    setIsShowing(false);\r\n  });\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useInterval(\r\n    () => {\r\n      refreshAuth(false, user).then((newAuth) => {\r\n        if (newAuth) {\r\n          getScheduleEvents(newAuth, filter);\r\n        }\r\n      });\r\n    },\r\n    isShowing && !showEventModal && !showFilterModal,\r\n    getConstants(user).refreshScheduleTimer\r\n  );\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (user.isLoggedin && filter !== undefined) {\r\n      setShowLoading(true);\r\n      console.log(\"getScheduleEvents: from useEffect\");\r\n      getScheduleEvents(auth, filter);\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [user.isLoggedin]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    // eslint-disable-next-line react/prop-types\r\n    if (match.params.scheduleEventId) {\r\n      // eslint-disable-next-line react/prop-types\r\n      setEditEventId(parseInt(match.params.scheduleEventId));\r\n      setShowEventModal(true);\r\n    }\r\n\r\n    // eslint-disable-next-line react/prop-types\r\n  }, [match.params.scheduleEventId]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onEventClick = useCallback(\r\n    (ev: EventInformation, newEventEditAuth: EventEditAuthorization) => {\r\n      setEditEventId(ev.ScheduleEventId);\r\n      setEventEditAuth(newEventEditAuth);\r\n      setInitialEditEvent(getEditorValuesFromEventInformation(auth, ev));\r\n      setShowEventModal(true);\r\n    },\r\n\r\n    // eslint-disable-next-line\r\n    [auth.locations]\r\n  );\r\n\r\n  if (!authHelper.isAuthItemsValid(auth)) {\r\n    console.log(\"auth items not valid yet\");\r\n    return <div />;\r\n  }\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const getScheduleEvents = (\r\n    auth: AuthorizedItems,\r\n    f: EventFilter,\r\n    e?: CustomEvent<RefresherEventDetail>\r\n  ) => {\r\n    const defaultFilter = filterStore.getDefaultFilter(auth, f);\r\n    const apiFilter: EventFilter = {\r\n      ...defaultFilter,\r\n      start: f.start,\r\n      end: f.end,\r\n      filterByEmployee: false,\r\n      eventTypeId: EventGroup.All,\r\n      eventStatusId: EventGroup.All,\r\n    };\r\n\r\n    ScheduleEventsAPI.getScheduleEventsByFilter(user, apiFilter).then((res) => {\r\n      setShowLoading(false);\r\n\r\n      if (e) {\r\n        e.detail.complete();\r\n      }\r\n\r\n      const mySE = getMyScheduleEvents(res.events, auth, apiFilter);\r\n      setMyScheduleEvents(mySE);\r\n      setMyDailyNotes(res.dailyNotes);\r\n      setMyFilteredScheduleEvents(mySE.filter(se => eventPassesFilter(se, f)));\r\n      const filteredDailyNotes = res.dailyNotes.filter(dn => dailyNotePassesFilter(auth, dn, f));\r\n      setMyFilteredDailyNotes(filteredDailyNotes);\r\n      setMyTotalTime([res.totalTimeForEmployee]);\r\n\r\n      const requestSE = getRequestScheduleEvents(res.events);\r\n      setRequestScheduleEvents(requestSE);\r\n      setRequestDailyNotes([]);\r\n      setRequestFilteredScheduleEvents(requestSE.filter(se => eventPassesFilter(se, {\r\n        ...f,\r\n        eventStatusId: EventStatus.Request,\r\n        eventTypeId: EventGroup.All\r\n      })));\r\n      setRequestFilteredDailyNotes([]);\r\n      setRequestHoursPerDay(res.hoursPerDay);\r\n\r\n      const allSE = getAllScheduleEvents(res.events, apiFilter);\r\n      setAllScheduleEvents(allSE);\r\n      setAllDailyNotes(res.dailyNotes);\r\n      setAllFilteredScheduleEvents(allSE.filter(se => eventPassesFilter(se, f)));\r\n      setAllFilteredDailyNotes(filteredDailyNotes);\r\n      setAllHoursPerDay(res.hoursPerDay);\r\n    });\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onDismissFilterModal = (f: EventFilter, filterApplied: boolean) => {\r\n    setFilter(f);\r\n    if (filterApplied) {\r\n      toast.showToast(\"Filter applied\");\r\n      filterStore.putFilter(f);\r\n\r\n      setMyFilteredScheduleEvents(myScheduleEvents.filter(se => eventPassesFilter(se, f)));\r\n      setMyFilteredDailyNotes(myDailyNotes.filter(dn => dailyNotePassesFilter(auth, dn, f)));\r\n\r\n      setRequestFilteredScheduleEvents(requestScheduleEvents.filter(se => eventPassesFilter(se, {\r\n        ...f,\r\n        eventStatusId: EventStatus.Request,\r\n        eventTypeId: EventGroup.All\r\n        })));\r\n      setRequestFilteredDailyNotes(requestDailyNotes.filter(dn => dailyNotePassesFilter(auth, dn, f)));\r\n\r\n      setAllFilteredScheduleEvents(allScheduleEvents.filter(se => eventPassesFilter(se, f)));\r\n      setAllFilteredDailyNotes(allDailyNotes.filter(dn => dailyNotePassesFilter(auth, dn, f)));\r\n\r\n    } else {\r\n      filterStore.clear();\r\n\r\n      setMyFilteredScheduleEvents(myScheduleEvents);\r\n      setMyFilteredDailyNotes(myDailyNotes);\r\n\r\n      setRequestFilteredScheduleEvents(requestScheduleEvents);\r\n      setRequestFilteredDailyNotes(requestDailyNotes);\r\n\r\n      setAllFilteredScheduleEvents(allScheduleEvents);\r\n      setAllFilteredDailyNotes(allDailyNotes);\r\n    }\r\n\r\n    setShowFilterModal(false);\r\n\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onEventUpdated = (toastMessage?: string) => {\r\n    if (toastMessage) {\r\n      toast.showToast(toastMessage!);\r\n    }\r\n\r\n    console.log(\"getScheduleEvents: onEventUpdated\");\r\n    getScheduleEvents(auth, filter);\r\n    setShowEventModal(false);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const setStartDate = (date: Date) => {\r\n    if (date === filter.start) {\r\n      return;\r\n    }\r\n\r\n    const newFilter = {\r\n      ...filter,\r\n      start: date,\r\n      end: addDays(date, 7),\r\n    };\r\n\r\n    setFilter(newFilter);\r\n    setShowLoading(true);\r\n    console.log(\"getScheduleEvents: setStartDate\");\r\n    getScheduleEvents(auth, newFilter);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onSegmentChange = (segmentName: \"my\" | \"requests\" | \"all\") => {\r\n    setSegment(segmentName);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const forceRefresh = (toastMessage: string) => {\r\n    if (toastMessage && toastMessage.length > 0) {\r\n      toast.showToast(toastMessage);\r\n    }\r\n\r\n    console.log(\"getScheduleEvents: from forceRefresh\");\r\n    getScheduleEvents(auth, filter);\r\n  };\r\n\r\n  const onWeekdayClick = (date: Date) => {\r\n    eventListRef.current!.scrollToDate(date);\r\n  }\r\n\r\n  return (\r\n    <IonPage id=\"schedule-page\">\r\n      <IonHeader className=\"ion-no-border\">\r\n        <IonToolbar mode=\"md\">\r\n          <IonButtons slot=\"start\">\r\n            <IonMenuButton />\r\n          </IonButtons>\r\n          <IonTitle slot=\"start\">Schedule</IonTitle>\r\n          <IonButtons slot=\"end\">\r\n            <IonButton\r\n              onClick={() => {\r\n                setEditEventId(null);\r\n                setEventEditAuth(getEventNewAuthorization(auth));\r\n                setShowEventModal(true);\r\n              }}\r\n            >\r\n              <IonIcon icon={add} mode=\"md\" slot=\"icon-only\" />\r\n            </IonButton>\r\n            <IonButton onClick={() => setShowFilterModal(true)}>\r\n              <div className={filterStore.isFilterApplied(auth, filter) ? \"filter-applied\" : \"filter-not-applied\"}>&#183;</div>\r\n              <IonIcon icon={funnel} mode=\"ios\" slot=\"icon-only\" />\r\n            </IonButton>\r\n          </IonButtons>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n\r\n      <IonSegment mode=\"md\" value={segment}>\r\n        <IonSegmentButton\r\n          mode=\"md\"\r\n          value=\"my\"\r\n          onClick={() => onSegmentChange(\"my\")}\r\n        >\r\n          MY\r\n        </IonSegmentButton>\r\n        <IonSegmentButton\r\n          mode=\"md\"\r\n          value=\"requests\"\r\n          onClick={() => onSegmentChange(\"requests\")}\r\n        >\r\n          REQUESTS\r\n        </IonSegmentButton>\r\n        <IonSegmentButton\r\n          mode=\"md\"\r\n          value=\"all\"\r\n          onClick={() => onSegmentChange(\"all\")}\r\n        >\r\n          ALL\r\n        </IonSegmentButton>\r\n      </IonSegment>\r\n      <WeekChooser\r\n        startDate={getWeekStart(\r\n          filter.start,\r\n          auth.locations[0].settings.DayWeekStartsOn,\r\n          \"\"\r\n        )}\r\n        setStartDate={setStartDate}\r\n        onWeekdayClick={onWeekdayClick}\r\n      />\r\n      <IonContent>\r\n        {refresher.ionicRefresherJsx}\r\n        {!showLoading && segment === \"my\" && myScheduleEvents?.length === 0 && (\r\n          <NoEventsToShow />\r\n        )}\r\n\r\n        {!showLoading && segment === \"my\" && myScheduleEvents?.length > 0 && (\r\n          <EventList\r\n            events={myFilteredScheduleEvents}\r\n            listType={segment}\r\n            notes={myFilteredDailyNotes}\r\n            hoursPerDay={myTotalTime}\r\n            auth={auth}\r\n            onEdit={onEventClick}\r\n            onForceRefresh={forceRefresh}\r\n            ref={eventListRef}\r\n            weekStart={filter.start}\r\n          />\r\n        )}\r\n\r\n        {!showLoading &&\r\n          segment === \"requests\" &&\r\n          requestScheduleEvents.length === 0 && <NoEventsToShow />}\r\n\r\n        {!showLoading &&\r\n          segment === \"requests\" &&\r\n          requestScheduleEvents.length > 0 && (\r\n            <EventList\r\n              events={requestFilteredScheduleEvents}\r\n              listType={segment}\r\n              notes={requestFilteredDailyNotes}\r\n              hoursPerDay={requestHoursPerDay}\r\n              auth={auth}\r\n              onEdit={onEventClick}\r\n              onForceRefresh={forceRefresh}\r\n              ref={eventListRef}\r\n              weekStart={filter.start}\r\n            />\r\n          )}\r\n\r\n        {!showLoading &&\r\n          segment === \"all\" &&\r\n          allScheduleEvents?.length === 0 && <NoEventsToShow />}\r\n\r\n        {!showLoading && segment === \"all\" && allScheduleEvents?.length > 0 && (\r\n          <EventList\r\n            events={allFilteredScheduleEvents}\r\n            listType={segment}\r\n            notes={allFilteredDailyNotes}\r\n            hoursPerDay={allHoursPerDay}\r\n            auth={auth}\r\n            onEdit={onEventClick}\r\n            onForceRefresh={forceRefresh}\r\n            ref={eventListRef}\r\n            weekStart={filter.start}\r\n          />\r\n        )}\r\n\r\n        {showLoading && (\r\n          <>\r\n            <div style={{ marginTop: \"10px\" }} />\r\n            <Skeleton height={24} width={220} />\r\n            <br />\r\n            <EventCardSkeleton threeRows={segment !== \"my\"} />\r\n            <EventCardSkeleton threeRows={segment !== \"my\"} />\r\n            <EventCardSkeleton threeRows={segment !== \"my\"} />\r\n          </>\r\n        )}\r\n      </IonContent>\r\n\r\n      {toast.simpleToastJsx}\r\n\r\n      <IonModal\r\n        isOpen={showFilterModal}\r\n        onDidDismiss={() => setShowFilterModal(false)}\r\n      >\r\n        <ScheduleFilterModal\r\n          filter={filter}\r\n          auth={auth}\r\n          onDismissModal={onDismissFilterModal}\r\n          isOpen={showFilterModal}\r\n          onCancelModal={() => setShowFilterModal(false)}\r\n        />\r\n      </IonModal>\r\n\r\n      <IonModal\r\n        isOpen={showEventModal}\r\n        onDidDismiss={() => setShowEventModal(false)}\r\n      >\r\n        <EditEventModal\r\n          isOpen={showEventModal}\r\n          auth={auth}\r\n          onCancelModal={() => setShowEventModal(false)}\r\n          onDismissModal={(toastMessage) => onEventUpdated(toastMessage)}\r\n          scheduleEventId={editEventId}\r\n          initialEvent={initialEditEvent}\r\n          eventEditAuth={eventEditAuth!}\r\n        />\r\n      </IonModal>\r\n    </IonPage>\r\n  );\r\n};\r\n\r\nexport default SchedulePage;\r\n","export enum ClockInRequirement {\r\n  MatchingShift = 1,\r\n  AnyShift = 2,\r\n  NoShift = 3,\r\n}\r\n","import React, { useEffect, useState } from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonButtons,\r\n  IonIcon,\r\n  IonContent,\r\n  IonHeader,\r\n  IonTitle,\r\n  IonToolbar,\r\n} from \"@ionic/react\";\r\nimport { close } from \"ionicons/icons\";\r\nimport \"../../global-styles.scss\";\r\nimport {\r\n  AuthorizedItems,\r\n  UnscheduledBreakOptions,\r\n  BreakType,\r\n} from \"../../orbital-interfaces/authorized-items\";\r\nimport { TimeClockSettingsData } from \"../../orbital-interfaces/TimeClockSettingsData\";\r\nimport { getEventBreakStartEndString } from \"../../util/time-helper\";\r\n\r\ninterface ScheduleFilterModalProps {\r\n  auth: AuthorizedItems;\r\n  tcData: TimeClockSettingsData;\r\n  onDismissModal: (selection: BreakItem) => void;\r\n}\r\n\r\nexport interface BreakItem {\r\n  key: string;\r\n  name: string;\r\n  breakType: BreakType;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst BreakSelectionModal: React.FC<ScheduleFilterModalProps> = ({\r\n  auth,\r\n  onDismissModal,\r\n  tcData,\r\n}: ScheduleFilterModalProps) => {\r\n  const [breakList, setBreakList] = useState([] as BreakItem[]);\r\n  const cancelOption = {\r\n    key: \"Cancel\",\r\n    name: \"\",\r\n    breakType: BreakType.UnscheduledUnpaid,\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (auth.locations.length === 0 || !tcData.ClockedInScheduleEvent) {\r\n      return;\r\n    }\r\n\r\n    const locSettings = auth.locations.filter(\r\n      (l) => l.id === tcData.ClockedInScheduleEvent!.LocationId\r\n    )[0].settings;\r\n    const breaks: BreakItem[] = [];\r\n\r\n    if (tcData.ScheduleEventsForClockIn.length > 0) {\r\n      tcData.ScheduleEventsForClockIn[0].EventBreaks.map((b) => {\r\n        return breaks.push({\r\n          key: b.BreakStart,\r\n          name: getEventBreakStartEndString(b),\r\n          breakType: BreakType.Scheduled,\r\n        });\r\n      });\r\n    }\r\n\r\n    switch (locSettings.UnscheduledBreakOptions) {\r\n      case UnscheduledBreakOptions.Both:\r\n        breaks.push({\r\n          key: \"UnScheduledUnpaid\",\r\n          name: \"Unscheduled\",\r\n          breakType: BreakType.UnscheduledUnpaid,\r\n        });\r\n        breaks.push({\r\n          key: \"UnScheduledPaid\",\r\n          name: \"Unscheduled $\",\r\n          breakType: BreakType.UnscheduledPaid,\r\n        });\r\n        break;\r\n\r\n      case UnscheduledBreakOptions.Paid:\r\n        breaks.push({\r\n          key: \"UnScheduledPaid\",\r\n          name: \"Unscheduled $\",\r\n          breakType: BreakType.UnscheduledPaid,\r\n        });\r\n        break;\r\n\r\n      case UnscheduledBreakOptions.Unpaid:\r\n        breaks.push({\r\n          key: \"UnScheduledUnpaid\",\r\n          name: \"Unscheduled\",\r\n          breakType: BreakType.UnscheduledUnpaid,\r\n        });\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n\r\n    setBreakList(breaks);\r\n  }, [tcData, auth]);\r\n\r\n  return (\r\n    <>\r\n      <IonHeader mode=\"ios\">\r\n        <IonToolbar>\r\n          <IonTitle>Choose Break</IonTitle>\r\n          <IonButtons slot=\"end\">\r\n            <IonButton onClick={() => onDismissModal(cancelOption)}>\r\n              <IonIcon icon={ close } mode=\"ios\" slot=\"icon-only\" />\r\n            </IonButton>\r\n          </IonButtons>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n\r\n      <IonContent class=\"outer-content\">\r\n        {breakList.map((brk) => (\r\n          <IonButton\r\n            className=\"apply-button\"\r\n            expand=\"block\"\r\n            key={brk.key}\r\n            color=\"secondary\"\r\n            onClick={() => {\r\n              onDismissModal(brk);\r\n            }}\r\n          >\r\n            {brk.name}\r\n          </IonButton>\r\n        ))}\r\n      </IonContent>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default BreakSelectionModal;\r\n","export enum StartBreakResponseCode {\r\n  Success,\r\n  BreakAlreadyExists,\r\n  AlreadyOnBreak,\r\n  ErrorInsertingBreak,\r\n  UserNotAtSpecifiedLocation,\r\n  EventDoesNotMatchCurrentUser,\r\n  InvalidUnscheduledBreak,\r\n}\r\n","export enum EndBreakResponseCode {\r\n  Success,\r\n  CannotEndRestrictedBreakEarly,\r\n  ErrorUpdatingEventBreak,\r\n  UserNotAtSpecifiedLocation,\r\n  EventDoesNotMatchCurrentUser,\r\n  BreakNoLongerExists,\r\n}\r\n","import { EndBreakResponse } from \"../orbital-interfaces/EndBreakResponse\";\r\nimport { StartBreakResponse } from \"../orbital-interfaces/StartBreakResponse\";\r\nimport { BreakType } from \"../orbital-interfaces/authorized-items\";\r\nimport { ScheduleEvent } from \"../orbital-interfaces/ScheduleEvent\";\r\nimport { ClockOutResponse } from \"../orbital-interfaces/ClockOutResponse\";\r\nimport { ClockInResponse } from \"../orbital-interfaces/ClockInResponse\";\r\n// eslint-disable-next-line max-len\r\nimport { SwitchPositionOrTagResponse } from \"../orbital-interfaces/SwitchPositionOrTagResponse\";\r\nimport { TimeClockSettingsData } from \"../orbital-interfaces/TimeClockSettingsData\";\r\nimport { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport apiHelper from \"./OrbitalApiHelper\";\r\nimport { ClockInGeoLocations } from \"../orbital-interfaces/ClockInGeoLocations\";\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getTimeClockSettings = async (\r\n  user: ApplicationUser,\r\n  lat: number | undefined,\r\n  lng: number | undefined\r\n) => {\r\n  return (await apiHelper.get(\r\n    user,\r\n    `api/v1/employee/timeclock/?lat=${lat}&lng=${lng}`\r\n  )) as TimeClockSettingsData;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst clockIn = async (\r\n  user: ApplicationUser,\r\n  positionId: number,\r\n  tagId: number | null,\r\n  lat: number | undefined,\r\n  lng: number | undefined\r\n) => {\r\n  // eslint-disable-next-line max-len\r\n  const baseUrl = `/api/v2/employee/timeclock/clockin/${positionId}/${tagId}?lat=${lat}&lng=${lng}`;\r\n  return (await apiHelper.post(user, baseUrl, {})) as ClockInResponse;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst clockOut = async (\r\n  user: ApplicationUser,\r\n  lat: number | undefined,\r\n  lng: number | undefined,\r\n  clockOutValue?: number,\r\n) => {\r\n  const clockoutDataModel = {\r\n    ClockOutValue: clockOutValue,\r\n    TimeClockBreak: null,\r\n    BreakStart: null,\r\n  };\r\n\r\n  return (await apiHelper.post(\r\n    user,\r\n    `/api/v2/employee/timeclock/clockout?lat=${lat}&lng=${lng}`,\r\n    clockoutDataModel\r\n  )) as ClockOutResponse;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst switchPositionOrTag = async (\r\n  user: ApplicationUser,\r\n  positionId: number,\r\n  tagId: number | null,\r\n  lat: number | undefined,\r\n  lng: number | undefined  ,\r\n  clockOutValue?: number\r\n) => {\r\n  // eslint-disable-next-line max-len\r\n  const baseUrl = `/api/v2/employee/timeclock/switch/${positionId}/${tagId}?lat=${lat}&lng=${lng}`;\r\n  const clockoutDataModel = {\r\n    ClockOutValue: clockOutValue,\r\n    TimeClockBreak: null,\r\n    BreakStart: null,\r\n  };\r\n\r\n  return (await apiHelper.post(\r\n    user,\r\n    baseUrl,\r\n    clockoutDataModel\r\n  )) as SwitchPositionOrTagResponse;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst startBreak = async (\r\n  user: ApplicationUser,\r\n  clockEvent: ScheduleEvent,\r\n  shiftEvent: ScheduleEvent | null,\r\n  breakType: BreakType,\r\n  lat: number | undefined,\r\n  lng: number | undefined,\r\n  breakStart?: string\r\n) => {\r\n  // eslint-disable-next-line max-len\r\n  const baseUrl = `/api/v2/employee/timeclock/startbreak?lat=${lat}&lng=${lng}`;\r\n  const breakStartOptions = {\r\n    clockEventId: clockEvent.ScheduleEventId,\r\n    shiftEventId: shiftEvent ? shiftEvent!.ScheduleEventId : null,\r\n    shiftBreakStart: breakStart,\r\n    breakType,\r\n  };\r\n\r\n  return (await apiHelper.post(\r\n    user,\r\n    baseUrl,\r\n    breakStartOptions\r\n  )) as StartBreakResponse;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst endBreak = async (\r\n  user: ApplicationUser,\r\n  clockEvent: ScheduleEvent,\r\n  shiftEvent: ScheduleEvent | null,\r\n  lat: number | undefined,\r\n  lng: number | undefined\r\n) => {\r\n  const shiftEventId = shiftEvent ? shiftEvent.ScheduleEventId : \"\";\r\n  // eslint-disable-next-line max-len\r\n  const baseUrl =\r\n    shiftEvent !== null\r\n      ? `/api/v2/employee/timeclock/endbreak/${clockEvent.ScheduleEventId}/${shiftEventId}?lat=${lat}&lng=${lng}`\r\n      : `/api/v2/employee/timeclock/endbreak/${clockEvent.ScheduleEventId}/-1?lat=${lat}&lng=${lng}`;\r\n\r\n  return (await apiHelper.post(user, baseUrl, {})) as EndBreakResponse;\r\n};\r\n\r\nconst getGeoLocations = async (user: ApplicationUser) => {\r\n  const baseUrl = \"/api/v2/employee/timeclock/geolocations\";\r\n  return (await apiHelper.get(user, baseUrl)) as ClockInGeoLocations[];\r\n};\r\n\r\nexport default {\r\n  getTimeClockSettings,\r\n  clockIn,\r\n  clockOut,\r\n  switchPositionOrTag,\r\n  startBreak,\r\n  endBreak,\r\n  getGeoLocations,\r\n};\r\n","import React, { useState } from \"react\";\r\nimport {\r\n  IonButtons,\r\n  IonButton,\r\n  IonIcon,\r\n  IonCol,\r\n  IonContent,\r\n  IonFooter,\r\n  IonInput,\r\n  IonGrid,\r\n  IonHeader,\r\n  IonRow,\r\n  IonTitle,\r\n  IonToolbar,\r\n} from \"@ionic/react\";\r\nimport \"../../global-styles.scss\";\r\nimport { close } from \"ionicons/icons\";\r\nimport { LocationSettings } from \"../../orbital-interfaces/authorized-items\";\r\n\r\ninterface ClockoutModalProps {\r\n  onCancel: () => void;\r\n  onOk: (clockoutValue?: number) => void;\r\n  locSettings: LocationSettings;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst ClockoutModal: React.FC<ClockoutModalProps> = ({\r\n  onCancel,\r\n  onOk,\r\n  locSettings,\r\n}: ClockoutModalProps) => {\r\n  const [clockoutValue, setClockoutValue] = useState(\r\n    undefined as number | undefined\r\n  );\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onOkClick = () => {\r\n    onOk(clockoutValue);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onClockoutValueUpdate(val: string | undefined | null) {\r\n    if (!val) {\r\n      if (clockoutValue !== undefined) {\r\n        setClockoutValue(undefined);\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    setClockoutValue(parseFloat(val));\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IonHeader mode=\"ios\">\r\n        <IonToolbar>\r\n          <IonTitle>Clock Out</IonTitle>\r\n          <IonButtons slot=\"end\">\r\n            <IonButton onClick={onCancel}>\r\n              <IonIcon icon={close} mode=\"ios\" slot=\"icon-only\" />\r\n            </IonButton>\r\n          </IonButtons>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n      <IonContent>\r\n        <IonGrid>\r\n          <IonRow>\r\n            <IonCol className=\"label\" size=\"5\">\r\n              {locSettings.ClockOutValueLabel}\r\n            </IonCol>\r\n            <IonCol size=\"7\">\r\n              <IonInput\r\n                placeholder=\"Enter value\"\r\n                type=\"number\"\r\n                className=\"input\"\r\n                autoCorrect=\"off\"\r\n                clearInput={true}\r\n                value={clockoutValue?.toString()}\r\n                onIonChange={(e) => {\r\n                  onClockoutValueUpdate(e.detail.value);\r\n                }}\r\n              />\r\n            </IonCol>\r\n          </IonRow>\r\n        </IonGrid>\r\n      </IonContent>\r\n      <IonFooter>\r\n        <IonButton\r\n          expand=\"block\"\r\n          onClick={onOkClick}\r\n          className=\"clockout-button\"\r\n        >\r\n          CLOCK OUT\r\n        </IonButton>\r\n      </IonFooter>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ClockoutModal;\r\n","import React, { useState, useEffect } from \"react\";\r\n// import \"./ClockPanel.scss\";\r\nimport \"../../global-styles.scss\";\r\nimport { IonButton } from \"@ionic/react\";\r\nimport { LocationSettings } from \"../../orbital-interfaces/authorized-items\";\r\nimport { TimeClockSettingsData } from \"../../orbital-interfaces/TimeClockSettingsData\";\r\n\r\ninterface SwitchPositionOrTagButtonProps {\r\n  tcData: TimeClockSettingsData;\r\n  locSettings: LocationSettings;\r\n  selectedPosId: number;\r\n  selectedTagId: number | null;\r\n  onSwitch: () => void;\r\n}\r\n\r\nconst SwitchPositionOrTagButton: React.FC<SwitchPositionOrTagButtonProps> = ({\r\n  tcData,\r\n  locSettings,\r\n  selectedPosId,\r\n  selectedTagId,\r\n  onSwitch,\r\n}: SwitchPositionOrTagButtonProps) => {\r\n  const [disabled, setDisabled] = useState(true);\r\n\r\n  const hiddenJsx = <span />;\r\n\r\n  useEffect(() => {\r\n    if (tcData.UserClockedIn) {\r\n      const curPosId = tcData.ClockedInScheduleEvent!.PositionId;\r\n      let curTagId = tcData.ClockedInScheduleEvent!.TagId;\r\n      if (!curTagId) {\r\n        curTagId = -1;\r\n      }\r\n\r\n      if (curPosId !== selectedPosId) {\r\n        setDisabled(false);\r\n      } else if (curTagId !== selectedTagId) {\r\n        setDisabled(false);\r\n      } else {\r\n        setDisabled(true);\r\n      }\r\n    }\r\n  }, [\r\n    tcData.UserClockedIn,\r\n    tcData.ClockedInScheduleEvent,\r\n    selectedPosId,\r\n    selectedTagId,\r\n  ]);\r\n\r\n  if (\r\n    !locSettings.ClockInWithDifferentTag &&\r\n    !locSettings.EnablePositionChangeForEmployeePosition\r\n  ) {\r\n    return hiddenJsx;\r\n  }\r\n\r\n  if (!tcData.UserClockedIn) {\r\n    return hiddenJsx;\r\n  }\r\n\r\n  return (\r\n    <IonButton\r\n      className=\"ion-no-margin\"\r\n      disabled={disabled}\r\n      color=\"secondary\"\r\n      expand=\"block\"\r\n      onClick={onSwitch}\r\n    >\r\n      SWITCH\r\n    </IonButton>\r\n  );\r\n};\r\n\r\nexport default SwitchPositionOrTagButton;\r\n","import React, { useRef, useEffect, useState } from \"react\";\r\n// import \"./Map.scss\";\r\nimport \"../../global-styles.scss\";\r\nimport { ApplicationUserContext } from \"../../context/ApplicationUserContext\";\r\nimport timeclockApi from \"../../api/TimeClockAPI\";\r\nimport { ClockInGeoLocations } from \"../../orbital-interfaces/ClockInGeoLocations\";\r\nimport { IonButton, IonIcon } from \"@ionic/react\";\r\nimport { arrowUpCircle, arrowDownCircle } from \"ionicons/icons\";\r\nimport {GeolocationPosition} from \"@capacitor/core\";\r\n\r\n// -----------------------------------------------------------------------------------------------\r\nfunction calculateNearestLocationMessage(\r\n  lat: number | undefined,\r\n  lng: number | undefined,\r\n  locations: ClockInGeoLocations[]\r\n): string {\r\n  if (!lat || !lng || locations.length === 0) {\r\n    return \"\";\r\n  }\r\n\r\n  if (\r\n    !google ||\r\n    !google.maps ||\r\n    !google.maps.geometry ||\r\n    !google.maps.geometry.spherical ||\r\n    !google.maps.geometry.spherical.computeDistanceBetween\r\n  ) {\r\n    return \"\";\r\n  }\r\n\r\n  const userPos = new google.maps.LatLng(lat, lng);\r\n  const MAX_DISTANCE = 999999999;\r\n  let closestLocation = null as ClockInGeoLocations | null;\r\n  let minDistance = MAX_DISTANCE;\r\n  for (let i = 0; i < locations.length; i++) {\r\n    const curLoc = locations[i];\r\n    if (!curLoc.lat || !curLoc.lng) {\r\n      continue;\r\n    }\r\n    const locPos = new google.maps.LatLng(curLoc.lat, curLoc.lng);\r\n    const distance =\r\n      google.maps.geometry.spherical.computeDistanceBetween(userPos, locPos) *\r\n        3.28084 -\r\n      curLoc.proximity;\r\n    if (distance < minDistance) {\r\n      minDistance = distance;\r\n      closestLocation = curLoc;\r\n    }\r\n  }\r\n\r\n  if (minDistance === MAX_DISTANCE) {\r\n    return \"\";\r\n  }\r\n\r\n  if (minDistance < 0) {\r\n    return \"At \" + closestLocation!.locationName;\r\n  }\r\n\r\n  const miles = minDistance * 0.000189394;\r\n  if (miles > 0.1) {\r\n    return `${Math.round((miles + Number.EPSILON) * 10) / 10} mi to ${\r\n      closestLocation!.locationName\r\n    }`;\r\n  }\r\n\r\n  return `${Math.round(minDistance)} ft to ${closestLocation!.locationName}`;\r\n}\r\n\r\n// -----------------------------------------------------------------------------------------------\r\nfunction validPos(p: GeolocationPosition | Position | null) {\r\n  if (p === null) {\r\n    return false;\r\n  }\r\n\r\n  if (p.coords.latitude === undefined || p.coords.longitude === undefined) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\ninterface MapComponentProps {\r\n  pos: GeolocationPosition | Position | null;\r\n}\r\n\r\n// -----------------------------------------------------------------------------------------------\r\n//\r\n// -----------------------------------------------------------------------------------------------\r\nconst Map: React.FC<MapComponentProps> = ({pos}: MapComponentProps) => {\r\n  const mapEle = useRef<HTMLDivElement | null>(null);\r\n  const map = useRef<google.maps.Map>();\r\n  const userCircle = useRef<google.maps.Circle>();\r\n  const { user } = React.useContext(ApplicationUserContext);\r\n  const [message, setMessage] = useState(\"\");\r\n  const [geoLocations, setGeoLocations] = useState([] as ClockInGeoLocations[]);\r\n  const [showMap, setShowMap] = useState(false);\r\n\r\n  // -----------------------------------------------------------------------------------------------\r\n  function onShowMapButtonClick() {\r\n    const newShowMap = !showMap;\r\n\r\n    if (pos !== null) {\r\n      setShowMap(newShowMap);\r\n      setMessage(\r\n        calculateNearestLocationMessage(\r\n          pos.coords.latitude,\r\n          pos.coords.longitude,\r\n          geoLocations\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  // -----------------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (mapEle.current === null || !validPos(pos)) {\r\n      return;\r\n    }\r\n\r\n    if (map.current !== undefined) {\r\n      if (map.current && validPos(pos!)) {\r\n        const userPos = new google.maps.LatLng(pos!.coords.latitude, pos!.coords.longitude);\r\n        map.current.setCenter(userPos);\r\n        if (userCircle.current) {\r\n          userCircle.current.setMap(null);\r\n        }\r\n\r\n        userCircle.current = new google.maps.Circle({\r\n          strokeColor: \"#FF0000\",\r\n          strokeOpacity: 0.8,\r\n          strokeWeight: 2,\r\n          fillColor: \"#FF0000\",\r\n          fillOpacity: 0.25,\r\n          radius: 6.5,\r\n          center: userPos,\r\n          map: map.current,\r\n        });\r\n      }\r\n\r\n      setMessage(\r\n        calculateNearestLocationMessage(\r\n          pos!.coords.latitude,\r\n          pos!.coords.longitude,\r\n          geoLocations\r\n        )\r\n      );\r\n\r\n      return;\r\n    }\r\n\r\n    map.current = new google.maps.Map(mapEle.current, {\r\n      center: {\r\n        lat: pos!.coords.latitude,\r\n        lng: pos!.coords.longitude,\r\n      },\r\n      zoom: 16,\r\n      disableDefaultUI: true,\r\n      fullscreenControl: false,\r\n    });\r\n\r\n    addMarkers();\r\n\r\n    google.maps.event.addListenerOnce(map.current, \"idle\", () => {\r\n      if (mapEle.current) {\r\n        mapEle.current.classList.add(\"show-map\");\r\n      }\r\n    });\r\n\r\n    function addMarkers() {\r\n      if (validPos(pos)) {\r\n        userCircle.current = new google.maps.Circle({\r\n          strokeColor: \"#FF0000\",\r\n          strokeOpacity: 0.8,\r\n          strokeWeight: 2,\r\n          fillColor: \"#FF0000\",\r\n          fillOpacity: 0.25,\r\n          radius: 6.5,\r\n          center: { lat: pos!.coords.latitude, lng: pos!.coords.longitude },\r\n          map: map.current,\r\n        });\r\n      }\r\n\r\n      timeclockApi.getGeoLocations(user).then((clockLocations) => {\r\n        setGeoLocations(clockLocations);\r\n        clockLocations.forEach((markerData) => {\r\n          const infoWindow = new google.maps.InfoWindow({\r\n            content: `<h5>${markerData.addr}</h5>`,\r\n          });\r\n\r\n          if (markerData.lat && markerData.lng) {\r\n            const position = new google.maps.LatLng(\r\n              markerData!.lat,\r\n              markerData!.lng\r\n            );\r\n\r\n            const marker = new google.maps.Marker({\r\n              position,\r\n              map: map.current!,\r\n              title: markerData.addr,\r\n            });\r\n\r\n            new google.maps.Circle({\r\n              strokeColor: \"#FF0000\",\r\n              strokeOpacity: 0.5,\r\n              strokeWeight: 1,\r\n              fillColor: \"#DD0000\",\r\n              fillOpacity: 0.2,\r\n              radius: markerData.proximity * 0.3048, // feet to meters\r\n              center: position,\r\n              map: map.current,\r\n            });\r\n            marker.addListener(\"click\", () => {\r\n              infoWindow.open(map.current!, marker);\r\n            });\r\n          }\r\n        });\r\n\r\n        if (validPos(pos))\r\n        {\r\n          setMessage(\r\n            calculateNearestLocationMessage(\r\n              pos!.coords.latitude,\r\n              pos!.coords.longitude,\r\n              clockLocations\r\n            )\r\n          );\r\n        }\r\n      });\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [pos, google, google.maps]);\r\n\r\n  return (\r\n    <>\r\n      <IonButton className=\"map-button\" onClick={onShowMapButtonClick}>\r\n        {message}\r\n        <IonIcon\r\n          id=\"show-map-button\"\r\n          icon={showMap ? arrowDownCircle : arrowUpCircle}\r\n        />\r\n      </IonButton>\r\n      <div id=\"map-container\" hidden={!showMap}>\r\n        <div ref={mapEle} className=\"map-canvas\" />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Map;\r\n","import { IonAlert } from \"@ionic/react\";\r\nimport React, { useState } from \"react\";\r\n\r\nfunction useYesOrCancelDialogBox() {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [alertData, setAlertData] = useState({\r\n    message: \"\",\r\n    onCancel: () => {},\r\n    onYes: () => {},\r\n  });\r\n\r\n  const showDialog = (\r\n    message: string,\r\n    onYes: () => void,\r\n    onCancel: () => void\r\n  ) => {\r\n    setAlertData({\r\n      message,\r\n      onYes,\r\n      onCancel,\r\n    });\r\n\r\n    setIsOpen(true);\r\n  };\r\n\r\n  const dialogJsx = (\r\n    <IonAlert\r\n      mode=\"ios\"\r\n      isOpen={isOpen}\r\n      onDidDismiss={() => {\r\n        setIsOpen(false);\r\n      }}\r\n      message={alertData.message}\r\n      buttons={[\r\n        {\r\n          text: \"Cancel\",\r\n          role: \"cancel\",\r\n          cssClass: \"secondary\",\r\n          handler: alertData.onCancel,\r\n        },\r\n\r\n        {\r\n          text: \"Yes\",\r\n          handler: alertData.onYes,\r\n        },\r\n      ]}\r\n    />\r\n  );\r\n\r\n  return {\r\n    showDialog,\r\n    dialogJsx,\r\n  };\r\n}\r\n\r\nexport default useYesOrCancelDialogBox;\r\n","import React, { useEffect, useState } from \"react\";\r\n// import \"./ClockPanel.scss\";\r\nimport \"../../global-styles.scss\";\r\nimport { ApplicationUserContext } from \"../../context/ApplicationUserContext\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\nimport authHelper from \"../../util/authitems-helper\";\r\nimport Map from \"./Map\";\r\nimport useYesOrCancelDialogBox from \"../../hooks/useYesOrCancelDialogBox\";\r\nimport useSimpleToast from \"../../hooks/useSimpleToast\";\r\nimport {Capacitor, Geolocation, GeolocationPosition} from \"@capacitor/core\";\r\nimport env, {getConstants} from \"../../api/environment\";\r\n\r\ninterface GeoLocationComponentProps {\r\n  updateCallback: (lat?: number, lng?: number) => void;\r\n  isShowing: boolean;\r\n}\r\n\r\n// Possible values for code, https://developer.mozilla.org/en-US/docs/Web/API/GeolocationPositionError\r\n// 1: PERMISSION_DENIED\r\n// 2: POSITION_UNAVAILABLE\r\n// 3: TIMEOUT\r\ninterface GeolocationPositionError {\r\n  code: number;\r\n}\r\n\r\nconst geoPositionOptions = {\r\n  enableHighAccuracy: true,\r\n  maximumAge: 1000,\r\n};\r\n\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction isGoogleMapsLoaded(): boolean {\r\n  const loaded = !(\r\n    google === undefined ||\r\n    google.maps === undefined ||\r\n    google.maps.geometry === undefined ||\r\n    google.maps.geometry.spherical === undefined ||\r\n    google.maps.geometry.spherical.computeDistanceBetween === undefined ||\r\n    google.maps.LatLng === undefined\r\n  );\r\n\r\n  if (!loaded) {\r\n    console.log(\"WARNING: google maps not yet loaded\");\r\n  }\r\n\r\n  return loaded;\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\n//\r\n// ------------------------------------------------------------------------------------\r\nconst GeoLocationComponent: React.FC<GeoLocationComponentProps> = ({\r\n  updateCallback,\r\n  isShowing\r\n}: GeoLocationComponentProps) => {\r\n  const { user } = React.useContext(ApplicationUserContext);\r\n  const { auth } = React.useContext(AuthorizedItemsContext);\r\n  const [watchPositionId, setWatchPositionId] = useState(\"\" as string | number);\r\n  const [currentPosition, setCurrentPosition] = useState(null as GeolocationPosition | Position | null);\r\n  const yesCancelDlg = useYesOrCancelDialogBox();\r\n  const toast = useSimpleToast();\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n\r\n    // ----------------------------------------------------------------------------------------------\r\n    function startWatchPosition(\r\n      callback: (lat?: number, lng?: number) => void\r\n    ): string | number {\r\n\r\n      const watchPositionCallBack = (position: GeolocationPosition | Position) => {\r\n        if (!position || !position.coords) {\r\n          return;\r\n        }\r\n\r\n        let positionChanged = false;\r\n        if (currentPosition === null) {\r\n          positionChanged = true;\r\n        } else {\r\n          if (isGoogleMapsLoaded())\r\n          {\r\n            const oldPos = new google.maps.LatLng(\r\n              currentPosition.coords.latitude,\r\n              currentPosition.coords.longitude\r\n            );\r\n\r\n            const newPos = new google.maps.LatLng(\r\n              position.coords.latitude,\r\n              position.coords.longitude\r\n            );\r\n\r\n            const distance =\r\n              google.maps.geometry.spherical.computeDistanceBetween(\r\n                oldPos,\r\n                newPos\r\n              ) * 3.28084;\r\n\r\n            const minChange = getConstants(user).minimumFeetForGeolocationUpdate;\r\n            positionChanged = distance > minChange;\r\n          } else {\r\n            positionChanged = true;\r\n          }\r\n        }\r\n\r\n        if (positionChanged)\r\n        {\r\n          console.log(\"GEO: position changed\");\r\n          setCurrentPosition(position);\r\n          callback(position.coords.latitude, position.coords.longitude);\r\n        }\r\n      };\r\n\r\n      const errCallback = (err: GeolocationPositionError) => {\r\n        console.log(\"GEO: Could not get geolocation, error code \" + err.code);\r\n        if (err.code === 1) {\r\n          // permission denied\r\n          callback();\r\n        }\r\n      };\r\n\r\n      let watchId = \"\" as string | number;\r\n      if (\r\n        env.settings.hasCapacitor &&\r\n        Capacitor.isPluginAvailable(\"Geolocation\")\r\n      ) {\r\n        console.log(\"GEO: Using Cap plugin to watch position\");\r\n        try {\r\n          watchId = Geolocation.watchPosition(\r\n            geoPositionOptions,\r\n            watchPositionCallBack\r\n          );\r\n\r\n          Geolocation.getCurrentPosition(geoPositionOptions).then(pos => {\r\n            watchPositionCallBack(pos);\r\n          });\r\n        } catch (err) {\r\n          errCallback({ code: 1 });\r\n        }\r\n      } else if (navigator && navigator.geolocation) {\r\n        console.log(\"GEO: Using browser API\");\r\n        watchId = navigator.geolocation.watchPosition(\r\n          // @ts-ignore  (watchPositionCallBack's GeolocationPosition param is wonky between Cap & Nav\r\n          watchPositionCallBack,\r\n          errCallback,\r\n          geoPositionOptions\r\n        );\r\n\r\n        navigator.geolocation.getCurrentPosition((pos) => {\r\n          watchPositionCallBack(pos);\r\n        });\r\n      } else {\r\n        console.log(\r\n          \"GEO: Location unavailable via cap/nav\"\r\n        );\r\n        return \"\";\r\n      }\r\n\r\n      console.log(\"GEO: start watching, watchId \" + watchId);\r\n      return watchId;\r\n    }\r\n\r\n    // ----------------------------------------------------------------------------------------------\r\n    function clearWatchPosition(watchId: string | number) {\r\n      if (watchId === \"\") {\r\n        return;\r\n      }\r\n\r\n      if (\r\n        env.settings.hasCapacitor &&\r\n        Capacitor.isPluginAvailable(\"Geolocation\")\r\n      ) {\r\n        Geolocation.clearWatch({ id: watchId as string }).then(() => {\r\n          console.log(`GEO: cleared watchId ${watchId} from Capacitor plugin`);\r\n        });\r\n      } else if (navigator && navigator.geolocation) {\r\n        navigator.geolocation.clearWatch(watchId as number);\r\n        console.log(`GEO: cleared watchId ${watchId} from browser API`);\r\n      }\r\n    }\r\n\r\n    if (authHelper.requiresGeolocation(auth.locations)) {\r\n      if (isShowing) {\r\n        setWatchPositionId(startWatchPosition(updateCallback));\r\n      } else {\r\n        clearWatchPosition(watchPositionId);\r\n        setCurrentPosition(null);\r\n        setWatchPositionId(\"\");\r\n      }\r\n    }\r\n    // eslint-disable-next-line\r\n  }, [\r\n    isShowing, user.isLoggedin\r\n  ]);\r\n\r\n  return (\r\n    <>\r\n      {auth &&\r\n      auth.locations &&\r\n      auth.locations.length > 0 &&\r\n      authHelper.requiresGeolocation(auth.locations) && <Map pos={currentPosition} />}\r\n      {yesCancelDlg.dialogJsx}\r\n      {toast.simpleToastJsx}\r\n    </>\r\n  );\r\n\r\n\r\n\r\n};\r\n\r\nexport default GeoLocationComponent;\r\n","import React, { useState, useEffect, useRef } from \"react\";\r\nimport {\r\n  IonAlert,\r\n  IonLoading,\r\n  IonSelect,\r\n  IonModal,\r\n  IonLabel,\r\n  IonSelectOption,\r\n  IonIcon,\r\n  IonButton,\r\n  useIonViewWillEnter,\r\n  useIonViewWillLeave,\r\n  IonGrid,\r\n  IonRow,\r\n  IonCol,\r\n} from \"@ionic/react\";\r\n// import \"./ClockPanel.scss\";\r\nimport \"../../global-styles.scss\";\r\nimport {\r\n  UnscheduledBreakOptions,\r\n  LocationSettings,\r\n  BreakType,\r\n} from \"../../orbital-interfaces/authorized-items\";\r\nimport { TimeClockSettingsData } from \"../../orbital-interfaces/TimeClockSettingsData\";\r\nimport { time, cafe } from \"ionicons/icons\";\r\nimport { ClockInRequirement } from \"../../enums/ClockInRequirement\";\r\nimport BreakSelectorModal, { BreakItem } from \"./BreakSelectorModal\";\r\nimport arrayHelper from \"../../util/array-helper\";\r\nimport timeClockApi from \"../../api/TimeClockAPI\";\r\nimport { format, parseISO } from \"date-fns\";\r\nimport { StartBreakResponseCode } from \"../../enums/StartBreakResponseCode\";\r\nimport { EndBreakResponseCode } from \"../../enums/EndBreakResponseCode\";\r\nimport { ApplicationUserContext } from \"../../context/ApplicationUserContext\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\nimport ClockoutModal from \"./ClockoutModal\";\r\nimport SwitchPositionOrTagButton from \"./SwitchPositionOrTagButton\";\r\nimport { useInterval } from \"../../hooks/useInterval\";\r\nimport GeoLocationComponent from \"./GeoLocationComponent\";\r\nimport useSimpleToast from \"../../hooks/useSimpleToast\";\r\nimport { getConstants } from \"../../api/environment\";\r\nimport authHelper from \"../../util/authitems-helper\";\r\n\r\ninterface ClockPanelProps {\r\n  onUpdate: () => void;\r\n  refreshToggle: boolean;\r\n}\r\n\r\ninterface List {\r\n  id: number;\r\n  name: string;\r\n}\r\n\r\nconst ClockPanel: React.FC<ClockPanelProps> = ({\r\n  onUpdate,\r\n  refreshToggle,\r\n}: ClockPanelProps) => {\r\n  const { user } = React.useContext(ApplicationUserContext);\r\n  const { auth } = React.useContext(AuthorizedItemsContext);\r\n  const [posList, setPosList] = useState([] as List[]);\r\n  const [selectedPosId, setSelectedPosId] = useState(0);\r\n  const positionRef = useRef(0);\r\n  const [tagSwitchingEnabled, setTagSwitchingEnabled] = useState(false);\r\n  const [tagList, setTagList] = useState([] as List[]);\r\n  const [selectedTagId, setSelectedTagId] = useState(null as number | null);\r\n  const tagRef = useRef(null as number | null);\r\n  const [breakSetting, setBreakSetting] = useState<\r\n    \"START BREAK\" | \"END BREAK\" | \"NONE\"\r\n  >(\"START BREAK\");\r\n  const [locSettings, setLocSettings] = useState({} as LocationSettings);\r\n  const [showBreakSelectorModal, setShowBreakSelectorModal] = useState(false);\r\n  const [showLoading, setShowLoading] = useState(false);\r\n  const [loadingMessage, setLoadingMessage] = useState(\"Please wait...\");\r\n  const [showAlertData, setShowAlertData] = useState({\r\n    show: false,\r\n    header: \"Alert\",\r\n    message: \"\",\r\n  });\r\n  const [tcData, setTCData] = useState(null as TimeClockSettingsData | null);\r\n  const [showClockoutModal, setShowClockoutModal] = useState(false);\r\n  const [refresh, setRefresh] = useState(false);\r\n  const [isShowing, setIsShowing] = useState(false);\r\n  const toast = useSimpleToast();\r\n  const [lat, setLat] = useState(undefined as number | undefined);\r\n  const [lng, setLng] = useState(undefined as number | undefined);\r\n\r\n  useIonViewWillEnter(() => {\r\n    setIsShowing(true);\r\n  });\r\n\r\n  useIonViewWillLeave(() => {\r\n    setIsShowing(false);\r\n  });\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (refresh !== refreshToggle) {\r\n      setRefresh(refreshToggle);\r\n    }\r\n\r\n    updateTimeClockData(lat, lng);\r\n\r\n    // eslint-disable-next-line\r\n  }, [refreshToggle]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (!tcData || !auth || !auth.locations || auth.locations.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (tcData.ShowTimeClock) {\r\n      const uniqueLocationIds = arrayHelper.unique(\r\n        tcData.PositionsToClockInto.map((p) => p.LocationId)\r\n      );\r\n      const uniqueDeptIds = arrayHelper.unique(\r\n        tcData.PositionsToClockInto.map((p) => p.DepartmentId)\r\n      );\r\n      let plist: List[];\r\n      if (uniqueLocationIds.length > 1) {\r\n        plist = tcData.PositionsToClockInto.map((p) => {\r\n          return {\r\n            id: p.PositionId,\r\n            name: p.PositionNameWithLocAndDeptAbbreviation,\r\n          };\r\n        });\r\n      } else if (uniqueDeptIds.length > 1) {\r\n        plist = tcData.PositionsToClockInto.map((p) => {\r\n          return { id: p.PositionId, name: p.PositionNameWithDeptAbbreviation };\r\n        });\r\n      } else {\r\n        plist = tcData.PositionsToClockInto.map((p) => {\r\n          return { id: p.PositionId, name: p.PositionName };\r\n        });\r\n      }\r\n\r\n      let curPosId = selectedPosId;\r\n      if (curPosId === 0) {\r\n        if (tcData.UserClockedIn) {\r\n          curPosId = tcData.ClockedInScheduleEvent!.PositionId;\r\n          setSelectedPosId(curPosId);\r\n        } else if (\r\n          tcData.ScheduleEventsForClockIn &&\r\n          tcData.ScheduleEventsForClockIn.length > 0\r\n        ) {\r\n          curPosId = tcData.ScheduleEventsForClockIn[0].PositionId;\r\n          setSelectedPosId(curPosId);\r\n        } else if (plist.length > 0) {\r\n          curPosId = plist[0].id;\r\n          setSelectedPosId(curPosId);\r\n        } else {\r\n          curPosId = 0;\r\n        }\r\n      }\r\n\r\n      const curLocId = tcData.UserClockedIn\r\n        ? tcData.ClockedInScheduleEvent!.LocationId\r\n        : curPosId !== 0\r\n        ? auth.locations.filter((l) =>\r\n            l.departments.flatMap((d) =>\r\n              d.positions.flatMap((p) => p.id === curPosId)\r\n            )\r\n          )[0].id\r\n        : auth.locations[0].id;\r\n\r\n      const locSettings = auth.locations.filter((l) => l.id === curLocId)[0]\r\n        .settings;\r\n      setLocSettings(locSettings);\r\n\r\n      if (\r\n        locSettings.EnableEnhancedBreakManagement &&\r\n        (locSettings.UnscheduledBreakOptions !== UnscheduledBreakOptions.None ||\r\n          (tcData.ClockedInScheduleEvent!.EventBreaks &&\r\n            tcData.ClockedInScheduleEvent!.EventBreaks.length > 0))\r\n      ) {\r\n        setBreakSetting(\r\n          tcData.UserClockedIn && tcData.CurrentEventBreak\r\n            ? \"END BREAK\"\r\n            : \"START BREAK\"\r\n        );\r\n      } else {\r\n        setBreakSetting(\"NONE\");\r\n      }\r\n\r\n      setPosList(plist);\r\n      setTags(curPosId);\r\n    }\r\n    // eslint-disable-next-line\r\n  }, [auth, tcData, lat, lng]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useInterval(\r\n    () => {\r\n      updateTimeClockData(lat, lng);\r\n    },\r\n    isShowing,\r\n    getConstants(user).refreshTimeclockSettingsTimer\r\n  );\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onGeoLocationUpdated = (newLat?: number, newLng?: number) => {\r\n    if (lat !== newLat) {\r\n      setLat(newLat);\r\n    }\r\n\r\n    if (lng !== newLng) {\r\n      setLng(newLng);\r\n    }\r\n\r\n    updateTimeClockData(newLat, newLng);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const updateTimeClockData = (\r\n    curLat?: number | undefined,\r\n    curLng?: number | undefined\r\n  ) => {\r\n    timeClockApi.getTimeClockSettings(user, curLat, curLng).then((results) => {\r\n      setTCData(results);\r\n    });\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const setTags = (currentPositionId: number): number => {\r\n    if (!tcData) {\r\n      return -1;\r\n    }\r\n\r\n    const curLocId = tcData.UserClockedIn\r\n      ? tcData.ClockedInScheduleEvent!.LocationId\r\n      : auth.locations.filter((l) =>\r\n          l.departments.flatMap((d) =>\r\n            d.positions.flatMap((p) => p.id === currentPositionId)\r\n          )\r\n        )[0].id;\r\n    const locSettings = auth.locations.filter((l) => l.id === curLocId)[0]\r\n      .settings;\r\n\r\n    if (\r\n      locSettings.ClockInWithDifferentTag &&\r\n      tcData.TagsPerPosition[currentPositionId] &&\r\n      tcData.TagsPerPosition[currentPositionId].length > 1\r\n    ) {\r\n      setTagSwitchingEnabled(true);\r\n      const tagList = tcData.TagsPerPosition[currentPositionId].map((t) => {\r\n        return { id: t.TagId, name: t.TagName };\r\n      });\r\n      tagList.unshift({ id: -1, name: \"NONE\" });\r\n      setTagList(tagList);\r\n    } else {\r\n      setTagSwitchingEnabled(false);\r\n      return -1;\r\n    }\r\n\r\n    let tagId = -1;\r\n    if (tcData.UserClockedIn) {\r\n      if (tcData.ClockedInScheduleEvent!.TagId) {\r\n        tagId = tcData.ClockedInScheduleEvent!.TagId;\r\n      } else if (tcData.ClockedInScheduleEvent!.TagId === null) {\r\n        tagId = -1;\r\n      } else {\r\n        tagId = -1;\r\n      }\r\n    } else if (\r\n      tcData.TagsPerPosition[currentPositionId] &&\r\n      tcData.TagsPerPosition[currentPositionId].length > 0\r\n    ) {\r\n      if (\r\n        tcData.ScheduleEventsForClockIn &&\r\n        tcData.ScheduleEventsForClockIn[0] &&\r\n        tcData.ScheduleEventsForClockIn[0].TagId\r\n      ) {\r\n        tagId = tcData.ScheduleEventsForClockIn[0].TagId;\r\n      } else {\r\n        tagId = -1;\r\n      }\r\n    }\r\n\r\n    setSelectedTagId(tagId);\r\n    return tagId;\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onPositionChange = (newVal: number) => {\r\n    if (newVal !== selectedPosId && newVal !== positionRef.current) {\r\n      setSelectedPosId(newVal);\r\n      setTags(newVal);\r\n    }\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onTagChange = (newVal: number) => {\r\n    if (newVal !== selectedTagId && newVal !== tagRef.current) {\r\n      setSelectedTagId(newVal);\r\n    }\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const showAlert = (header: string, message: string) => {\r\n    setShowAlertData({ show: true, header, message });\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onBreakSelectorModalClose = (brk: BreakItem) => {\r\n    if (!tcData) {\r\n      return;\r\n    }\r\n\r\n    setShowBreakSelectorModal(false);\r\n    if (brk.key === \"Cancel\") {\r\n      return;\r\n    }\r\n\r\n    setLoadingMessage(\"Starting Break...\");\r\n    setShowLoading(true);\r\n\r\n    timeClockApi\r\n      .startBreak(\r\n        user,\r\n        tcData.ClockedInScheduleEvent!,\r\n        tcData.ScheduleEventsForClockIn[0],\r\n        brk.breakType,\r\n        lat,\r\n        lng,\r\n        brk.breakType === BreakType.Scheduled ? brk.key : undefined\r\n      )\r\n      .then((response) => {\r\n        setShowLoading(false);\r\n        if (\r\n          response.StartBreakResponseCode === StartBreakResponseCode.Success\r\n        ) {\r\n          toast.showToast(\r\n            \"Break started at \" +\r\n              format(parseISO(response.BreakStart), \"h:mmaaa\")\r\n          );\r\n          onUpdate();\r\n          updateTimeClockData(lat, lng);\r\n        } else {\r\n          showAlert(\r\n            \"Could not start break\",\r\n            `Unable to start break, ${response.Message}`\r\n          );\r\n        }\r\n      });\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const clockout = (clockOutValue?: number) => {\r\n    if (showClockoutModal) {\r\n      setShowClockoutModal(false);\r\n    }\r\n\r\n    setLoadingMessage(\"Clocking Out...\");\r\n    setShowLoading(true);\r\n\r\n    timeClockApi.clockOut(user, lat, lng, clockOutValue).then((response) => {\r\n      setShowLoading(false);\r\n      if (response.ClockOutResponseCode === 0) {\r\n        toast.showToast(\r\n          \"Clocked out at \" +\r\n            format(parseISO(response.ClockOutEvent.EventEnd), \"h:mmaaa\")\r\n        );\r\n        onUpdate();\r\n        updateTimeClockData(lat, lng);\r\n      } else {\r\n        showAlert(\r\n          \"Could not Clock Out\",\r\n          `Unable to Clock out, ${response.Message}`\r\n        );\r\n      }\r\n    });\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onClockOutClick = () => {\r\n    if (locSettings.ClockOutValueLabel) {\r\n      setShowClockoutModal(true);\r\n    } else {\r\n      clockout();\r\n    }\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onClockInClick = () => {\r\n    setLoadingMessage(\"Clocking in...\");\r\n    setShowLoading(true);\r\n\r\n    timeClockApi\r\n      .clockIn(user, selectedPosId, selectedTagId, lat, lng)\r\n      .then((response) => {\r\n        setShowLoading(false);\r\n        if (response.ClockInResponseCode === 0) {\r\n          toast.showToast(\r\n            \"Clocked in at \" +\r\n              format(parseISO(response.ClockInEvent.EventStart), \"h:mmaaa\")\r\n          );\r\n          onUpdate();\r\n          updateTimeClockData(lat, lng);\r\n        } else {\r\n          showAlert(\r\n            \"Could not Clock In\",\r\n            `Unable to Clock in, ${response.Message}`\r\n          );\r\n        }\r\n      });\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onBreakButtonClick = () => {\r\n    if (breakSetting === \"NONE\" || !tcData) {\r\n      return;\r\n    }\r\n\r\n    if (breakSetting === \"END BREAK\") {\r\n      setLoadingMessage(\"Ending Break...\");\r\n      setShowLoading(true);\r\n\r\n      timeClockApi\r\n        .endBreak(\r\n          user,\r\n          tcData.ClockedInScheduleEvent!,\r\n          tcData.ScheduleEventsForClockIn.length > 0\r\n            ? tcData.ScheduleEventsForClockIn[0]\r\n            : null,\r\n          lat,\r\n          lng\r\n        )\r\n        .then((response) => {\r\n          setShowLoading(false);\r\n          if (response.EndBreakResponseCode === EndBreakResponseCode.Success) {\r\n            toast.showToast(\r\n              `Ended break at ${format(parseISO(response.BreakEnd), \"h:mmaaa\")}`\r\n            );\r\n            onUpdate();\r\n            updateTimeClockData(lat, lng);\r\n          } else {\r\n            showAlert(\"Did not come off break\", response.Message);\r\n          }\r\n        });\r\n\r\n      return;\r\n    }\r\n\r\n    if (\r\n      locSettings.UnscheduledBreakOptions !== UnscheduledBreakOptions.None ||\r\n      (tcData.ClockedInScheduleEvent!.EventBreaks &&\r\n        tcData.ClockedInScheduleEvent!.EventBreaks.length > 0)\r\n    ) {\r\n      setShowBreakSelectorModal(true);\r\n    } else {\r\n      showAlert(\r\n        \"No implemented\",\r\n        \"Not implemented in ClockPanel.tsx for this scenario\"\r\n      );\r\n    }\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onSwitchClick = () => {\r\n    setLoadingMessage(\"Switching...\");\r\n    setShowLoading(true);\r\n\r\n    timeClockApi\r\n      .switchPositionOrTag(user, selectedPosId, selectedTagId, lat, lng)\r\n      .then((response) => {\r\n        setShowLoading(false);\r\n        if (response.AllowedToSwitchPositions || response.AllowedToSwitchTags) {\r\n          toast.showToast(\"Switched\");\r\n          onUpdate();\r\n          updateTimeClockData(lat, lng);\r\n        } else {\r\n          showAlert(\r\n            \"Could not switch\",\r\n            `${response.ClockInMessage} ${response.ClockOutMessage}`\r\n          );\r\n        }\r\n      });\r\n  };\r\n\r\n  if (!auth || !tcData) {\r\n    return <div>Loading...</div>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IonGrid className=\"clock-controls\">\r\n        {toast.simpleToastJsx}\r\n        <IonLoading\r\n          isOpen={showLoading}\r\n          onDidDismiss={() => setShowLoading(false)}\r\n          spinner=\"dots\"\r\n          message={loadingMessage}\r\n        />\r\n        {authHelper.requiresGeolocation(auth.locations) && (\r\n          <IonRow>\r\n            <IonCol size=\"12\">\r\n              <GeoLocationComponent\r\n                updateCallback={onGeoLocationUpdated}\r\n                isShowing={isShowing}\r\n              />\r\n            </IonCol>\r\n          </IonRow>\r\n        )}\r\n        {tcData.PositionsToClockInto && tcData.PositionsToClockInto.length > 1 && (\r\n          <IonRow>\r\n            <IonCol size=\"3\">\r\n              <IonLabel>Position</IonLabel>\r\n            </IonCol>\r\n            <IonCol size=\"9\">\r\n              <IonSelect\r\n                className=\"select\"\r\n                mode=\"ios\"\r\n                interface=\"action-sheet\"\r\n                onIonChange={(e) => onPositionChange(e.detail.value)}\r\n                disabled={\r\n                  !(\r\n                    ((tcData.UserClockedIn && tcData.UserMayClockOut) ||\r\n                      (!tcData.UserClockedIn && tcData.UserMayClockIn)) &&\r\n                    locSettings.ClockInRequirement !==\r\n                      ClockInRequirement.MatchingShift\r\n                  )\r\n                }\r\n                value={selectedPosId}\r\n              >\r\n                {posList.map((pos) => (\r\n                  <IonSelectOption key={pos.id} value={pos.id}>\r\n                    {pos.name}\r\n                  </IonSelectOption>\r\n                ))}\r\n              </IonSelect>\r\n            </IonCol>\r\n          </IonRow>\r\n        )}\r\n        {tagSwitchingEnabled && (\r\n          <IonRow>\r\n            <IonCol size=\"3\">\r\n              <IonLabel>~Tag</IonLabel>\r\n            </IonCol>\r\n            <IonCol size=\"9\">\r\n              <IonSelect\r\n                className=\"select\"\r\n                mode=\"ios\"\r\n                interface=\"action-sheet\"\r\n                onIonChange={(e) => onTagChange(e.detail.value)}\r\n                disabled={\r\n                  !(\r\n                    ((tcData.UserClockedIn && tcData.UserMayClockOut) ||\r\n                      (!tcData.UserClockedIn && tcData.UserMayClockIn)) &&\r\n                    locSettings.ClockInRequirement !==\r\n                      ClockInRequirement.MatchingShift\r\n                  )\r\n                }\r\n                value={selectedTagId}\r\n              >\r\n                {tagList.map((t) => (\r\n                  <IonSelectOption key={t.id} value={t.id}>\r\n                    {t.name}\r\n                  </IonSelectOption>\r\n                ))}\r\n              </IonSelect>\r\n            </IonCol>\r\n          </IonRow>\r\n        )}\r\n        {((tcData.PositionsToClockInto && tcData.PositionsToClockInto.length > 1) || tagSwitchingEnabled) && (\r\n          <IonRow>\r\n            <IonCol size=\"12\" className=\"ion-no-margin\">\r\n              <SwitchPositionOrTagButton\r\n                tcData={tcData}\r\n                locSettings={locSettings}\r\n                selectedPosId={selectedPosId}\r\n                selectedTagId={selectedTagId}\r\n                onSwitch={onSwitchClick}\r\n              />\r\n            </IonCol>\r\n          </IonRow>\r\n        )}\r\n        {!tcData.UserClockedIn && (\r\n          <IonRow>\r\n            <IonCol size=\"12\" className=\"ion-no-margin\">\r\n              <IonButton\r\n                className=\"clockin-button\"\r\n                onClick={onClockInClick}\r\n                disabled={!tcData.UserMayClockIn}\r\n              >\r\n                <IonIcon mode=\"md\" icon={time} /> CLOCK IN\r\n              </IonButton>\r\n            </IonCol>\r\n          </IonRow>\r\n        )}\r\n\r\n        {tcData.UserClockedIn && (\r\n          <IonRow>\r\n            <IonCol className=\"clockout-button-container\">\r\n              <IonButton\r\n                className=\"clockout-button\"\r\n                disabled={!tcData.UserMayClockOut}\r\n                expand=\"block\"\r\n                onClick={onClockOutClick}\r\n              >\r\n                <IonIcon mode=\"md\" icon={time} /> CLOCK OUT\r\n              </IonButton>\r\n\r\n              {breakSetting !== \"NONE\" && (\r\n                <IonButton\r\n                  onClick={onBreakButtonClick}\r\n                  expand=\"block\"\r\n                  className=\"break-button\"\r\n                  disabled={!tcData.UserMayClockOut}\r\n                >\r\n                  <IonIcon icon={cafe} />\r\n                  {breakSetting}\r\n                </IonButton>\r\n              )}\r\n            </IonCol>\r\n          </IonRow>\r\n        )}\r\n      </IonGrid>\r\n\r\n      <IonModal\r\n        isOpen={showBreakSelectorModal}\r\n        cssClass=\"mini-modal break-selector-modal\"\r\n      >\r\n        <BreakSelectorModal\r\n          auth={auth}\r\n          tcData={tcData}\r\n          onDismissModal={(selection) => onBreakSelectorModalClose(selection)}\r\n        />\r\n      </IonModal>\r\n\r\n      <IonModal\r\n        cssClass=\"mini-modal clockout-modal\"\r\n        isOpen={showClockoutModal}\r\n        onDidDismiss={() => {\r\n          setShowClockoutModal(false);\r\n        }}\r\n      >\r\n        <ClockoutModal\r\n          onCancel={() => {\r\n            setShowClockoutModal(false);\r\n          }}\r\n          onOk={clockout}\r\n          locSettings={locSettings}\r\n        />\r\n      </IonModal>\r\n\r\n      <IonAlert\r\n        isOpen={showAlertData.show}\r\n        onDidDismiss={() => setShowAlertData({ ...showAlertData, show: false })}\r\n        header={showAlertData.header}\r\n        message={showAlertData.message}\r\n        buttons={[\"OK\"]}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ClockPanel;\r\n","import React from \"react\";\n// import \"./PayrollPeriodChooser.scss\";\nimport \"../../global-styles.scss\";\nimport { IonIcon } from \"@ionic/react\";\nimport { arrowBack, arrowForward } from \"ionicons/icons\";\nimport { addDays, format } from \"date-fns\";\n\ninterface PayrollPeriodChooserProps {\n  startDate: Date | null;\n  endDate: Date | null;\n  onNextPayPeriod: () => void;\n  onPrevPayPeriod: () => void;\n}\n\nfunction getPayPeriodDateText(start: Date | null, end: Date | null) {\n  if (!start || !end) {\n    return \" \";\n  }\n\n  if (start.getMonth() !== end.getMonth()) {\n    return (\n      format(start, \"MMM d\").toUpperCase() +\n      \" - \" +\n      format(addDays(end, -1), \"MMM d\").toUpperCase()\n    );\n  }\n\n  return (\n    format(start, \"MMM d\").toUpperCase() + \" - \" + format(addDays(end, -1), \"d\")\n  );\n}\n\n// --------------------------------------------------------------------------------------\n//\n// --------------------------------------------------------------------------------------\nconst PayrollPeriodChooser: React.FC<PayrollPeriodChooserProps> = ({\n  startDate,\n  endDate,\n  onNextPayPeriod,\n  onPrevPayPeriod,\n}: PayrollPeriodChooserProps) => {\n  const isLoading = startDate === null || endDate === null;\n  const payPeriodDateText = isLoading\n    ? \"\"\n    : getPayPeriodDateText(startDate, endDate);\n\n  return (\n    <div className=\"chooser\">\n      <div className=\"top\">\n        <button onClick={onPrevPayPeriod} className=\"arrow\" key={-1}>\n          <IonIcon mode=\"ios\" icon={arrowBack} />\n        </button>\n\n        <div className=\"month-year-container\">\n          <div className=\"datetime-picker-container\">\n            <div className=\"datetime-picker\">{payPeriodDateText}</div>\n          </div>\n        </div>\n\n        <button onClick={onNextPayPeriod} className=\"arrow\" key={7}>\n          <IonIcon mode=\"ios\" icon={arrowForward} />\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default PayrollPeriodChooser;\n","import { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport apiHelper from \"./OrbitalApiHelper\";\r\nimport { formatDateTimeAsMvcString } from \"../util/time-helper\";\r\nimport { OrbitalTime } from \"../orbital-interfaces/OrbitalTime\";\r\n\r\nexport interface PayrollPeriodHoursPerAbsent {\r\n  absentId: number;\r\n  time: OrbitalTime;\r\n}\r\n\r\nexport interface PayrollPeriodDateItem {\r\n  date: string;\r\n  regular: OrbitalTime;\r\n  dailyOvertime: OrbitalTime;\r\n  weeklyOvertime: OrbitalTime;\r\n  special: OrbitalTime;\r\n  absent: OrbitalTime;\r\n  timePerAbsent: PayrollPeriodHoursPerAbsent[];\r\n}\r\n\r\nexport interface PayrollPeriodData {\r\n  start: string;\r\n  end: string;\r\n  list: PayrollPeriodDateItem[];\r\n  error: boolean;\r\n  message: string;\r\n  totalRegular: OrbitalTime;\r\n  totalWeeklyOvertime: OrbitalTime;\r\n  totalDailyOvertime: OrbitalTime;\r\n  totalAbsent: OrbitalTime;\r\n  totalSpecial: OrbitalTime;\r\n}\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getPayPeriodDateForEmployee = async (\r\n  user: ApplicationUser,\r\n  locationId: number,\r\n  date: Date\r\n) => {\r\n  const dateStr = formatDateTimeAsMvcString(date);\r\n  return (await apiHelper.get(\r\n    user,\r\n    \"api/v2/payroll/get/\" + locationId + \"/\" + dateStr\r\n  )) as PayrollPeriodData;\r\n};\r\n\r\nexport default {\r\n  getPayPeriodDateForEmployee,\r\n};\r\n","import React from \"react\";\r\nimport { OrbitalTime } from \"../../orbital-interfaces/OrbitalTime\";\r\nimport { LocationSettings } from \"../../orbital-interfaces/authorized-items\";\r\nimport { getTimeStringFromOrbitalTime } from \"../../util/time-helper\";\r\ninterface PayrollDetailListProps {\r\n  time: OrbitalTime | null;\r\n  locSettings: LocationSettings;\r\n  fontColor: string;\r\n}\r\n\r\nfunction getHoursString(locsettings: LocationSettings, time: OrbitalTime) {\r\n  return getTimeStringFromOrbitalTime(locsettings, time);\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst PayrollOrbitalTimeItem: React.FC<PayrollDetailListProps> = ({\r\n  time,\r\n  locSettings,\r\n  fontColor,\r\n}: PayrollDetailListProps) => {\r\n  if (time === null) {\r\n    return <span> -- </span>;\r\n  }\r\n\r\n  const displayColor = time.ActualHours === 0.0 ? \"#ddd\" : fontColor;\r\n\r\n  return (\r\n    <span style={{ color: displayColor }}>\r\n      {getHoursString(locSettings, time)}\r\n    </span>\r\n  );\r\n};\r\n\r\nexport default PayrollOrbitalTimeItem;\r\n","import React, { useContext } from \"react\";\r\nimport {\r\n  IonContent,\r\n  IonRow,\r\n  IonCol,\r\n  IonButtons,\r\n  IonButton,\r\n  IonIcon,\r\n  IonGrid,\r\n  IonHeader,\r\n  IonTitle,\r\n  IonToolbar,\r\n} from \"@ionic/react\";\r\nimport \"../../global-styles.scss\";\r\nimport { close } from \"ionicons/icons\";\r\nimport { parseISO } from \"date-fns\";\r\nimport { PayrollPeriodDateItem } from \"../../api/PayrollPeriodAPI\";\r\nimport { getDateString } from \"../../util/time-helper\";\r\nimport {\r\n  AuthorizedItems,\r\n  LocationSettings,\r\n} from \"../../orbital-interfaces/authorized-items\";\r\nimport PayrollOrbitalTimeItem from \"./PayrollOrbitalTimeItem\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\n\r\ninterface AddBreakModalProps {\r\n  onClose: () => void;\r\n  data: PayrollPeriodDateItem;\r\n  locSettings: LocationSettings;\r\n}\r\n\r\nfunction getAbsentName(auth: AuthorizedItems, id: number) {\r\n  return auth.payrollEvents.filter((pe) => pe.id === id)[0].name;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst PayrollDetailModal: React.FC<AddBreakModalProps> = ({\r\n  onClose,\r\n  data,\r\n  locSettings,\r\n}: AddBreakModalProps) => {\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n\r\n  if (!data) {\r\n    return <div>loading</div>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IonHeader mode=\"ios\">\r\n        <IonToolbar>\r\n          <IonTitle>{getDateString(parseISO(data.date))}</IonTitle>\r\n          <IonButtons slot=\"end\">\r\n            <IonButton onClick={onClose}>\r\n              <IonIcon icon={ close } mode=\"ios\" slot=\"icon-only\" />\r\n            </IonButton>\r\n          </IonButtons>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n      <IonContent>\r\n        <IonGrid>\r\n          {data.regular.ActualHours > 0.0 && (\r\n            <IonRow>\r\n              <IonCol size=\"7\">Regular</IonCol>\r\n              <IonCol size=\"5\">\r\n                <PayrollOrbitalTimeItem\r\n                  time={data.regular}\r\n                  locSettings={locSettings}\r\n                  fontColor=\"black\"\r\n                />\r\n              </IonCol>\r\n            </IonRow>\r\n          )}\r\n\r\n          {data.dailyOvertime.ActualHours > 0.0 && (\r\n            <IonRow>\r\n              <IonCol size=\"7\">Daily Overtime</IonCol>\r\n              <IonCol size=\"5\">\r\n                <PayrollOrbitalTimeItem\r\n                  time={data.dailyOvertime}\r\n                  locSettings={locSettings}\r\n                  fontColor=\"red\"\r\n                />\r\n              </IonCol>\r\n            </IonRow>\r\n          )}\r\n\r\n          {data.weeklyOvertime.ActualHours > 0.0 && (\r\n            <IonRow>\r\n              <IonCol size=\"7\">Weekly Overtime</IonCol>\r\n              <IonCol size=\"5\">\r\n                <PayrollOrbitalTimeItem\r\n                  time={data.weeklyOvertime}\r\n                  locSettings={locSettings}\r\n                  fontColor=\"red\"\r\n                />\r\n              </IonCol>\r\n            </IonRow>\r\n          )}\r\n\r\n          {data.special.ActualHours > 0.0 && (\r\n            <IonRow>\r\n              <IonCol size=\"7\">Special Dates</IonCol>\r\n              <IonCol size=\"5\">\r\n                <PayrollOrbitalTimeItem\r\n                  time={data.special}\r\n                  locSettings={locSettings}\r\n                  fontColor=\"black\"\r\n                />\r\n              </IonCol>\r\n            </IonRow>\r\n          )}\r\n\r\n          {data.timePerAbsent &&\r\n            data.timePerAbsent.map((hpa) => {\r\n              return (\r\n                <IonRow key={hpa.absentId}>\r\n                  <IonCol size=\"7\">{getAbsentName(auth, hpa.absentId)}</IonCol>\r\n                  <IonCol size=\"5\">\r\n                    <PayrollOrbitalTimeItem\r\n                      time={hpa.time}\r\n                      locSettings={locSettings}\r\n                      fontColor=\"#AD850C\"\r\n                    />\r\n                  </IonCol>\r\n                </IonRow>\r\n              );\r\n            })}\r\n        </IonGrid>\r\n      </IonContent>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PayrollDetailModal;\r\n","import React, { useContext, useState } from \"react\";\r\nimport { IonRow, IonCol, IonModal } from \"@ionic/react\";\r\nimport { format, parseISO } from \"date-fns\";\r\nimport { PayrollPeriodDateItem } from \"../../api/PayrollPeriodAPI\";\r\nimport PayrollOrbitalTimeItem from \"./PayrollOrbitalTimeItem\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\nimport authHelper from \"../../util/authitems-helper\";\r\nimport { ColumnEnum } from \"./PayrollDetailList\";\r\nimport PayrollDetailModal from \"./PayrollDetailModal\";\r\nimport Skeleton from \"react-loading-skeleton\";\r\n\r\ninterface PayrollDetailListProps {\r\n  payrollRow: PayrollPeriodDateItem | null;\r\n  colsToDisplay: ColumnEnum;\r\n  colSize: string;\r\n}\r\n\r\nfunction formatDateString(d: string) {\r\n  // return format(parseISO(d), \"EEE d\").toUpperCase();\r\n  return format(parseISO(d), \"EEE d\");\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst PayrollDetailRow: React.FC<PayrollDetailListProps> = ({\r\n  payrollRow,\r\n  colsToDisplay,\r\n  colSize,\r\n}: PayrollDetailListProps) => {\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n  const locSettings = authHelper.getLocSettingsForLocationId(\r\n    auth,\r\n    auth.locations[0].id\r\n  );\r\n  const [showDetailModal, setShowDetailModal] = useState(false);\r\n\r\n  if (payrollRow === null) {\r\n    return (\r\n      <IonRow>\r\n        <IonCol size=\"3\">\r\n          <Skeleton width={50} />\r\n        </IonCol>\r\n        <IonCol size=\"3\">\r\n          <Skeleton width={50} />\r\n        </IonCol>\r\n        <IonCol size=\"3\">\r\n          <Skeleton width={50} />\r\n        </IonCol>\r\n        <IonCol size=\"3\">\r\n          <Skeleton width={50} />\r\n        </IonCol>\r\n      </IonRow>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IonRow>\r\n        <IonCol size={colSize}>\r\n          <button\r\n            className=\"payperiod-list-buttons\"\r\n            onClick={() => setShowDetailModal(true)}\r\n          >\r\n            {formatDateString(payrollRow!.date)}\r\n          </button>\r\n        </IonCol>\r\n\r\n        <IonCol\r\n          size={colSize}\r\n          color=\"secondary\"\r\n          hidden={(colsToDisplay & ColumnEnum.Regular) !== ColumnEnum.Regular}\r\n        >\r\n          <PayrollOrbitalTimeItem\r\n            time={payrollRow?.regular}\r\n            locSettings={locSettings}\r\n            fontColor=\"black\"\r\n          />\r\n        </IonCol>\r\n\r\n        <IonCol\r\n          size={colSize}\r\n          hidden={\r\n            (colsToDisplay & ColumnEnum.DailyOvertime) !==\r\n            ColumnEnum.DailyOvertime\r\n          }\r\n        >\r\n          <PayrollOrbitalTimeItem\r\n            time={payrollRow?.dailyOvertime}\r\n            locSettings={locSettings}\r\n            fontColor=\"red\"\r\n          />\r\n        </IonCol>\r\n\r\n        <IonCol\r\n          size={colSize}\r\n          hidden={\r\n            (colsToDisplay & ColumnEnum.WeeklyOvertime) !==\r\n            ColumnEnum.WeeklyOvertime\r\n          }\r\n        >\r\n          <PayrollOrbitalTimeItem\r\n            time={payrollRow?.weeklyOvertime}\r\n            locSettings={locSettings}\r\n            fontColor=\"red\"\r\n          />\r\n        </IonCol>\r\n\r\n        <IonCol\r\n          size={colSize}\r\n          hidden={(colsToDisplay & ColumnEnum.Special) !== ColumnEnum.Special}\r\n        >\r\n          <PayrollOrbitalTimeItem\r\n            time={payrollRow?.special}\r\n            locSettings={locSettings}\r\n            fontColor=\"black\"\r\n          />\r\n        </IonCol>\r\n\r\n        <IonCol\r\n          size={colSize}\r\n          hidden={(colsToDisplay & ColumnEnum.Absent) !== ColumnEnum.Absent}\r\n        >\r\n          <PayrollOrbitalTimeItem\r\n            time={payrollRow?.absent}\r\n            locSettings={locSettings}\r\n            fontColor=\"black\"\r\n          />\r\n        </IonCol>\r\n      </IonRow>\r\n\r\n      <IonModal\r\n        cssClass=\"mini-modal detail-modal\"\r\n        isOpen={showDetailModal}\r\n        onDidDismiss={() => setShowDetailModal(false)}\r\n      >\r\n        <PayrollDetailModal\r\n          onClose={() => setShowDetailModal(false)}\r\n          locSettings={locSettings}\r\n          data={payrollRow!}\r\n        />\r\n      </IonModal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PayrollDetailRow;\r\n","import React, { useContext, useEffect, useState } from \"react\";\r\nimport { IonGrid, IonRow, IonCol } from \"@ionic/react\";\r\nimport { PayrollPeriodData } from \"../../api/PayrollPeriodAPI\";\r\n// import \"./PayrollDetailList.scss\";\r\nimport \"../../global-styles.scss\";\r\nimport PayrollDetailRow from \"./PayrollDetailRow\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\nimport authHelper from \"../../util/authitems-helper\";\r\nimport PayrollOrbitalTimeItem from \"./PayrollOrbitalTimeItem\";\r\nimport Skeleton from \"react-loading-skeleton\";\r\n\r\ninterface PayrollDetailListProps {\r\n  payrollData: PayrollPeriodData | null;\r\n}\r\n\r\nexport enum ColumnEnum {\r\n  None = 0,\r\n  Regular = 1 << 0,\r\n  DailyOvertime = 1 << 1,\r\n  WeeklyOvertime = 1 << 2,\r\n  Special = 1 << 3,\r\n  Absent = 1 << 4,\r\n  All = ~(~0 << 5),\r\n}\r\n\r\nfunction getColumnsToDisplay(\r\n  payrollData: PayrollPeriodData\r\n): { count: number; cols: ColumnEnum } {\r\n  let cols = ColumnEnum.Regular;\r\n  let count = 2;\r\n\r\n  if (payrollData.totalDailyOvertime.ActualHours > 0.0) {\r\n    cols |= ColumnEnum.DailyOvertime;\r\n    count++;\r\n  }\r\n\r\n  if (payrollData.totalWeeklyOvertime.ActualHours > 0.0) {\r\n    cols |= ColumnEnum.WeeklyOvertime;\r\n    count++;\r\n  }\r\n\r\n  if (payrollData.totalSpecial.ActualHours > 0.0) {\r\n    cols |= ColumnEnum.Special;\r\n    count++;\r\n  }\r\n\r\n  if (payrollData.totalAbsent.ActualHours > 0.0) {\r\n    cols |= ColumnEnum.Absent;\r\n    count++;\r\n  }\r\n\r\n  return { cols, count };\r\n}\r\n// --------------------------------------------------------------------------------------\r\nconst PayrollDetailList: React.FC<PayrollDetailListProps> = ({\r\n  payrollData,\r\n}: PayrollDetailListProps) => {\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n  const locSettings = authHelper.getLocSettingsForLocationId(\r\n    auth,\r\n    auth.locations[0].id\r\n  );\r\n  const [colsToDisplay, setColsToDisplay] = useState(ColumnEnum.None);\r\n  const [colSize, setColSize] = useState(\"3\");\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (!payrollData) {\r\n      return;\r\n    }\r\n\r\n    const { count, cols } = getColumnsToDisplay(payrollData);\r\n    setColsToDisplay(cols);\r\n    setColSize(count >= 5 ? \"2\" : \"3\");\r\n  }, [payrollData]);\r\n\r\n  if (payrollData === null) {\r\n    return (\r\n      <div className=\"grid-container\">\r\n        <IonGrid class=\"ion-text-end\">\r\n          <IonRow className=\"list-header\" class=\"ion-text-center\">\r\n            <IonCol size=\"3\">\r\n              <Skeleton width={60} />\r\n            </IonCol>\r\n            <IonCol size=\"3\">\r\n              <Skeleton width={60} />\r\n            </IonCol>\r\n            <IonCol size=\"3\">\r\n              <Skeleton width={60} />\r\n            </IonCol>\r\n            <IonCol size=\"3\">\r\n              <Skeleton width={60} />\r\n            </IonCol>\r\n          </IonRow>\r\n          {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((x) => {\r\n            return (\r\n              <PayrollDetailRow\r\n                payrollRow={null}\r\n                colSize=\"3\"\r\n                colsToDisplay={ColumnEnum.None}\r\n                key={x}\r\n              />\r\n            );\r\n          })}\r\n        </IonGrid>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"grid-container\">\r\n      <IonGrid class=\"ion-text-end\">\r\n        <IonRow className=\"list-header\" class=\"ion-text-center\">\r\n          <IonCol size={colSize}>DATE</IonCol>\r\n          <IonCol\r\n            size={colSize}\r\n            hidden={(colsToDisplay & ColumnEnum.Regular) !== ColumnEnum.Regular}\r\n          >\r\n            REG\r\n          </IonCol>\r\n          <IonCol\r\n            size={colSize}\r\n            hidden={\r\n              (colsToDisplay & ColumnEnum.DailyOvertime) !==\r\n              ColumnEnum.DailyOvertime\r\n            }\r\n          >\r\n            DAILY OT\r\n          </IonCol>\r\n          <IonCol\r\n            size={colSize}\r\n            hidden={\r\n              (colsToDisplay & ColumnEnum.WeeklyOvertime) !==\r\n              ColumnEnum.WeeklyOvertime\r\n            }\r\n          >\r\n            WKLY OT\r\n          </IonCol>\r\n          <IonCol\r\n            size={colSize}\r\n            hidden={(colsToDisplay & ColumnEnum.Special) !== ColumnEnum.Special}\r\n          >\r\n            SPECIAL\r\n          </IonCol>\r\n          <IonCol\r\n            size={colSize}\r\n            hidden={(colsToDisplay & ColumnEnum.Absent) !== ColumnEnum.Absent}\r\n          >\r\n            ABSENT\r\n          </IonCol>\r\n        </IonRow>\r\n        {payrollData?.list.map((row) => (\r\n          <PayrollDetailRow\r\n            key={row.date}\r\n            payrollRow={row}\r\n            colsToDisplay={colsToDisplay}\r\n            colSize={colSize}\r\n          />\r\n        ))}\r\n        <IonRow className=\"list-footer\">\r\n          <IonCol size={colSize}>TOTAL</IonCol>\r\n          <IonCol\r\n            size={colSize}\r\n            hidden={(colsToDisplay & ColumnEnum.Regular) !== ColumnEnum.Regular}\r\n          >\r\n            <PayrollOrbitalTimeItem\r\n              time={payrollData?.totalRegular}\r\n              locSettings={locSettings}\r\n              fontColor=\"black\"\r\n            />\r\n          </IonCol>\r\n          <IonCol\r\n            size={colSize}\r\n            hidden={\r\n              (colsToDisplay & ColumnEnum.DailyOvertime) !==\r\n              ColumnEnum.DailyOvertime\r\n            }\r\n          >\r\n            <PayrollOrbitalTimeItem\r\n              time={payrollData?.totalDailyOvertime}\r\n              locSettings={locSettings}\r\n              fontColor=\"red\"\r\n            />\r\n          </IonCol>\r\n          <IonCol\r\n            size={colSize}\r\n            hidden={\r\n              (colsToDisplay & ColumnEnum.WeeklyOvertime) !==\r\n              ColumnEnum.WeeklyOvertime\r\n            }\r\n          >\r\n            <PayrollOrbitalTimeItem\r\n              time={payrollData?.totalWeeklyOvertime}\r\n              locSettings={locSettings}\r\n              fontColor=\"red\"\r\n            />\r\n          </IonCol>\r\n          <IonCol\r\n            size={colSize}\r\n            hidden={(colsToDisplay & ColumnEnum.Special) !== ColumnEnum.Special}\r\n          >\r\n            <PayrollOrbitalTimeItem\r\n              time={payrollData?.totalSpecial}\r\n              locSettings={locSettings}\r\n              fontColor=\"black\"\r\n            />\r\n          </IonCol>\r\n          <IonCol\r\n            size={colSize}\r\n            hidden={(colsToDisplay & ColumnEnum.Absent) !== ColumnEnum.Absent}\r\n          >\r\n            <PayrollOrbitalTimeItem\r\n              time={payrollData?.totalAbsent}\r\n              locSettings={locSettings}\r\n              fontColor=\"black\"\r\n            />\r\n          </IonCol>\r\n        </IonRow>\r\n      </IonGrid>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PayrollDetailList;\r\n","import React, { useState, useEffect } from \"react\";\r\n// import \"./ClockPanel.scss\";\r\nimport \"../../global-styles.scss\";\r\nimport { addDays, parseISO } from \"date-fns\";\r\nimport { ApplicationUserContext } from \"../../context/ApplicationUserContext\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\nimport PayrollPeriodChooser from \"./PayrollPeriodChooser\";\r\nimport PayrollPeriodAPI, {\r\n  PayrollPeriodData,\r\n} from \"../../api/PayrollPeriodAPI\";\r\nimport useDialogBox from \"../../hooks/useDialogBox\";\r\nimport PayrollDetailList from \"./PayrollDetailList\";\r\nimport { RefresherEventDetail } from \"@ionic/core\";\r\nimport useIonicRefresher from \"../../hooks/useIonicRefresher\";\r\nimport { IonContent } from \"@ionic/react\";\r\n\r\ninterface PayrollPeriodsTabProps {\r\n  date: Date | null;\r\n}\r\n\r\nconst PayrollPeriodsTab: React.FC<PayrollPeriodsTabProps> = ({\r\n  date,\r\n}: PayrollPeriodsTabProps) => {\r\n  const { user } = React.useContext(ApplicationUserContext);\r\n  const { auth } = React.useContext(AuthorizedItemsContext);\r\n  const [currentDate, setCurrentDate] = useState(null as Date | null);\r\n  const [startDate, setStartDate] = useState(null as Date | null);\r\n  const [endDate, setEndDate] = useState(null as Date | null);\r\n  const [payrollData, setPayrollData] = useState(\r\n    null as PayrollPeriodData | null\r\n  );\r\n  const dlg = useDialogBox();\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const doRefresh = (e: CustomEvent<RefresherEventDetail>) => {\r\n    getData(e);\r\n  };\r\n\r\n  const refresher = useIonicRefresher(doRefresh);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    let newStartDate = date;\r\n    if (date === null) {\r\n      newStartDate = new Date();\r\n    }\r\n\r\n    setCurrentDate(newStartDate);\r\n  }, [date]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (currentDate == null) {\r\n      return;\r\n    }\r\n\r\n    getData();\r\n    // eslint-disable-next-line\r\n  }, [currentDate]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  function getData(e?: CustomEvent<RefresherEventDetail>) {\r\n    PayrollPeriodAPI.getPayPeriodDateForEmployee(\r\n      user,\r\n      auth.locations[0].id,\r\n      currentDate!\r\n    ).then((data) => {\r\n      if (data.error) {\r\n        dlg.showAlert(\r\n          \"Error\",\r\n          \"Could not retrieve Payroll data: \" + data.message,\r\n          () => {}\r\n        );\r\n        return;\r\n      }\r\n\r\n      setStartDate(parseISO(data.start));\r\n      setEndDate(parseISO(data.end));\r\n      setPayrollData(data);\r\n      if (e) {\r\n        e.detail.complete();\r\n      }\r\n    });\r\n  }\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onNextPayPeriod = () => {\r\n    setCurrentDate(addDays(endDate!, 1));\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onPrevPayPeriod = () => {\r\n    setCurrentDate(addDays(startDate!, -1));\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <PayrollPeriodChooser\r\n        startDate={startDate}\r\n        endDate={endDate}\r\n        onNextPayPeriod={onNextPayPeriod}\r\n        onPrevPayPeriod={onPrevPayPeriod}\r\n      />\r\n      <IonContent>\r\n        {refresher.ionicRefresherJsx}\r\n        {auth && auth.locations && auth.locations.length > 0 && (\r\n          <PayrollDetailList payrollData={payrollData} />\r\n        )}\r\n        {dlg.alertBoxJsx}\r\n      </IonContent>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PayrollPeriodsTab;\r\n","import React, {useContext, useEffect, useState} from \"react\";\r\nimport \"../../global-styles.scss\";\r\nimport {ApplicationUserContext} from \"../../context/ApplicationUserContext\";\r\nimport useDialogBox from \"../../hooks/useDialogBox\";\r\nimport {IonContent, IonModal, IonSpinner, useIonViewWillEnter, useIonViewWillLeave,} from \"@ionic/react\";\r\nimport {getTodayStartForLocation} from \"../../util/time-helper\";\r\nimport {EventInformation, HoursList} from \"../../orbital-interfaces/TEC\";\r\nimport EditEventModal from \"../EditEvent/EditEventModal\";\r\nimport {RefresherEventDetail} from \"@ionic/core\";\r\nimport useIonicRefresher from \"../../hooks/useIonicRefresher\";\r\nimport {AuthorizedItems} from \"../../orbital-interfaces/authorized-items\";\r\nimport EventCardSkeleton from \"../../components/SchedulePageComponents/EventCardSkeleton\";\r\nimport {EventEditAuthorization} from \"../EditEvent/EditEventAuthorization\";\r\nimport {getEditorValuesFromEventInformation, INITIAL_EDITOR_VAUES,} from \"../EditEvent/EditEventModalState\";\r\nimport {AuthorizedItemsContext} from \"../../context/AuthorizedItemsContext\";\r\nimport {useInterval} from \"../../hooks/useInterval\";\r\nimport {getConstants} from \"../../api/environment\";\r\nimport {EventFilter, EventFilterView} from \"../../orbital-interfaces/EventFilter\";\r\nimport EventGroup from \"../../enums/EventGroup\";\r\nimport ScheduleEventsAPI from \"../../api/ScheduleEventsAPI\";\r\nimport authHelper from \"../../util/authitems-helper\";\r\nimport {addHours} from \"date-fns\";\r\nimport {DailyNotes} from \"../../orbital-interfaces/DailyNotes\";\r\nimport EventList from \"../SchedulePageComponents/EventList\";\r\nimport useSimpleToast from \"../../hooks/useSimpleToast\";\r\n\r\ninterface ClockTodayTabProps {\r\n  refreshToggle: boolean;\r\n  onUpdate: () => void;\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction createTodayFilter(auth: AuthorizedItems): EventFilter {\r\n  const positionIds = authHelper.getPositionIdsForEmployee(auth);\r\n  const locationIds = [] as number[];\r\n  for (let i = 0; i < positionIds.length; i++) {\r\n    const locId = authHelper.getLocationIdFromPositionid(auth, positionIds[i]);\r\n    if (!locationIds.includes(locId)) {\r\n      locationIds.push(locId);\r\n    }\r\n  }\r\n\r\n  const locSettings = authHelper.getLocSettingsForLocationId(auth, locationIds[0]);\r\n  const start = getTodayStartForLocation(new Date(), locSettings);\r\n  const end = addHours(start, 24);\r\n\r\n  const filter: EventFilter = {\r\n    settingsLocId: locationIds[0],\r\n    positionIds,\r\n    start,\r\n    end,\r\n    filterByEmployee: true,\r\n    dnLocIds: locationIds,\r\n    tagId: undefined,\r\n    eventTypeId: EventGroup.All,\r\n    eventStatusId: EventGroup.All,\r\n    view: EventFilterView.clock,\r\n  };\r\n\r\n  return filter;\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\n//\r\n// ------------------------------------------------------------------------------------\r\nconst ClockTodayTab: React.FC<ClockTodayTabProps> = ({\r\n  refreshToggle,\r\n  onUpdate,\r\n}: ClockTodayTabProps) => {\r\n  const doRefresh = (e: CustomEvent<RefresherEventDetail>) => {\r\n    getData(e);\r\n  };\r\n\r\n  const [scheduleEvents, setScheduleEvents] = useState(\r\n    [] as EventInformation[]\r\n  );\r\n  const [dailyNotes, setDailyNotes] = useState([] as DailyNotes[]);\r\n  const [hoursPerDay, setHoursPerDay] = useState([] as HoursList[]);\r\n  const toast = useSimpleToast();\r\n  const refresher = useIonicRefresher(doRefresh);\r\n  const { user } = React.useContext(ApplicationUserContext);\r\n  const dlg = useDialogBox();\r\n  const [showEventModal, setShowEventModal] = useState(false);\r\n  const [editEventId, setEditEventId] = useState(null as number | null);\r\n  const [eventEditAuth, setEventEditAuth] = useState(\r\n    null as EventEditAuthorization | null\r\n  );\r\n  const [initialEditEvent, setInitialEditEvent] = useState(\r\n    INITIAL_EDITOR_VAUES\r\n  );\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isShowing, setIsShowing] = useState(false);\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useIonViewWillEnter(() => {\r\n    setIsShowing(true);\r\n  });\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useIonViewWillLeave(() => {\r\n    setIsShowing(false);\r\n  });\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const forceRefresh = (toastMessage: string) => {\r\n    if (toastMessage && toastMessage.length > 0) {\r\n      toast.showToast(toastMessage);\r\n    }\r\n\r\n    getData();\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useInterval(\r\n    () => {\r\n      getData();\r\n    },\r\n    isShowing && !showEventModal,\r\n    getConstants(user).refreshScheduleTimer\r\n  );\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onEventClick = (\r\n    ev: EventInformation,\r\n    newEventEditAuth: EventEditAuthorization | null\r\n  ) => {\r\n    setEditEventId(ev.ScheduleEventId);\r\n    setEventEditAuth(newEventEditAuth);\r\n    setInitialEditEvent(getEditorValuesFromEventInformation(auth, ev));\r\n    setShowEventModal(true);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  function getData(e?: CustomEvent<RefresherEventDetail>) {\r\n    try {\r\n      const apiFilter = createTodayFilter(auth);\r\n      ScheduleEventsAPI.getScheduleEventsByFilter(user, apiFilter).then(\r\n        (res) => {\r\n          setIsLoading(false);\r\n\r\n          if (e) {\r\n            e.detail.complete();\r\n          }\r\n\r\n          onUpdate();\r\n          setScheduleEvents(res.events);\r\n          setDailyNotes(res.dailyNotes);\r\n          setHoursPerDay(res.hoursPerDay);\r\n        }\r\n      );\r\n    } catch (e) {\r\n      console.log(\"Error in ClockTodayTab.getData: \" + e.message);\r\n    }\r\n  }\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    // eslint-disable-next-line\r\n    if (user && user.isLoggedin) {\r\n      setIsLoading(true);\r\n      getData(undefined);\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [refreshToggle]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onEventUpdated = () => {\r\n    getData(undefined);\r\n    setShowEventModal(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <IonContent>\r\n        {refresher.ionicRefresherJsx}\r\n        {isLoading &&\r\n          ((dailyNotes && dailyNotes.length > 0) ||\r\n            (scheduleEvents && scheduleEvents.length > 0)) && (\r\n            <IonSpinner className=\"center\" name=\"dots\" />\r\n          )}\r\n\r\n        {isLoading && (dailyNotes.length === 0 || scheduleEvents.length === 0) && (\r\n          <>\r\n            <EventCardSkeleton threeRows={false} />\r\n            <EventCardSkeleton threeRows={false} />\r\n          </>\r\n        )}\r\n\r\n        {!isLoading && (\r\n            <EventList\r\n              events={scheduleEvents}\r\n              listType={\"today\"}\r\n              notes={dailyNotes}\r\n              hoursPerDay={hoursPerDay}\r\n              auth={auth}\r\n              onEdit={onEventClick}\r\n              onForceRefresh={forceRefresh}\r\n              weekStart={new Date()}\r\n            />\r\n          )}\r\n      </IonContent>\r\n\r\n      {toast.simpleToastJsx}\r\n\r\n      <IonModal\r\n        isOpen={showEventModal}\r\n        onDidDismiss={() => setShowEventModal(false)}\r\n      >\r\n        <EditEventModal\r\n          isOpen={showEventModal}\r\n          auth={auth}\r\n          onCancelModal={() => setShowEventModal(false)}\r\n          onDismissModal={() => onEventUpdated()}\r\n          scheduleEventId={editEventId}\r\n          eventEditAuth={eventEditAuth!}\r\n          initialEvent={initialEditEvent}\r\n        />\r\n      </IonModal>\r\n\r\n      {dlg.alertBoxJsx}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ClockTodayTab;\r\n","import React, { useState } from \"react\";\r\nimport {\r\n  IonFooter,\r\n  IonSegment,\r\n  IonSegmentButton,\r\n  IonHeader,\r\n  IonToolbar,\r\n  IonTitle,\r\n  IonPage,\r\n  IonButtons,\r\n  IonMenuButton,\r\n} from \"@ionic/react\";\r\n// import \"./ClockPage.scss\";\r\nimport \"../global-styles.scss\";\r\nimport ClockPanel from \"../components/ClockPageComponents/ClockPanel\";\r\nimport PayrollPeriodsTab from \"../components/ClockPageComponents/PayrollPeriodsTab\";\r\nimport ClockTodayTab from \"../components/ClockPageComponents/ClockTodayTab\";\r\n\r\nconst ClockPage: React.FC = () => {\r\n  const [segment, setSegment] = useState<\"today\" | \"pay-periods\">(\"today\");\r\n  const [refreshToggle, setRefreshToggle] = useState(false);\r\n  const [refreshTimeClockToggle, setRefreshTimeClockToggle] = useState(false);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onClockPanelUpdate = () => {\r\n    setRefreshToggle(!refreshToggle);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onTodayPanelUpdate = () => {\r\n    console.log(\"onTodayPanelUpdate\");\r\n    setRefreshTimeClockToggle(!refreshTimeClockToggle);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onSegmentChange = (segmentName: any) => {\r\n    setSegment(segmentName);\r\n  };\r\n\r\n  return (\r\n    <IonPage>\r\n      <IonHeader className=\"ion-no-border\">\r\n        <IonToolbar mode=\"md\">\r\n          <IonButtons slot=\"start\">\r\n            <IonMenuButton />\r\n          </IonButtons>\r\n          <IonTitle slot=\"start\">Clock</IonTitle>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n\r\n      <IonSegment\r\n        mode=\"md\"\r\n        onIonChange={(e) => onSegmentChange(e.detail.value)}\r\n      >\r\n        <IonSegmentButton mode=\"md\" value=\"today\">\r\n          TODAY\r\n        </IonSegmentButton>\r\n\r\n        <IonSegmentButton mode=\"md\" value=\"pay-periods\">\r\n          PAY PERIOD\r\n        </IonSegmentButton>\r\n      </IonSegment>\r\n\r\n      {segment === \"today\" && (\r\n        <ClockTodayTab\r\n          refreshToggle={refreshToggle}\r\n          onUpdate={onTodayPanelUpdate}\r\n        />\r\n      )}\r\n\r\n      {segment === \"pay-periods\" && <PayrollPeriodsTab date={null} />}\r\n\r\n      <IonFooter>\r\n        {segment === \"today\" && (\r\n          <ClockPanel\r\n            refreshToggle={refreshTimeClockToggle}\r\n            onUpdate={onClockPanelUpdate}\r\n          />\r\n        )}\r\n      </IonFooter>\r\n    </IonPage>\r\n  );\r\n};\r\n\r\nexport default ClockPage;\r\n","import React from \"react\";\r\nimport { Message } from \"../../orbital-interfaces/Message\";\r\nimport { messageDateString } from \"../../util/time-helper\";\r\n// import \"./MessageItem.scss\";\r\nimport \"../../global-styles.scss\";\r\nimport { bookmark } from \"ionicons/icons\";\r\nimport { IonIcon } from \"@ionic/react\";\r\n\r\ninterface MessageItemProps {\r\n  message: Message;\r\n  onMessageClick: () => void;\r\n}\r\n\r\n// ==============================================================================\r\nconst MessageItem: React.FC<MessageItemProps> = ({\r\n  message,\r\n  onMessageClick,\r\n}: MessageItemProps) => {\r\n  if (!message) {\r\n    return <div />;\r\n  }\r\n\r\n  const fontWeightForSubject = message.isViewed ? \"normal\" : \"bold\";\r\n\r\n  return (\r\n    <button className=\"message\" onClick={onMessageClick}>\r\n      <div className=\"top-line\">\r\n        <span className=\"subject\" style={{ fontWeight: fontWeightForSubject }}>\r\n          {message.isPinned && (\r\n            <IonIcon icon={bookmark} style={{ color: \"gray\" }} />\r\n          )}\r\n          {message.subject}\r\n        </span>\r\n        <span className=\"time\">\r\n          {messageDateString(message.deliveryDateTime)}{\" \"}\r\n        </span>\r\n      </div>\r\n      <div className=\"bottom-line\">{message.previewLine}</div>\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default MessageItem;\r\n","import React, { useState } from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonButtons,\r\n  IonIcon,\r\n  IonContent,\r\n  IonFooter,\r\n  IonHeader,\r\n  IonItem,\r\n  IonLabel,\r\n  IonSelect,\r\n  IonSelectOption,\r\n  IonTitle,\r\n  IonToolbar,\r\n} from \"@ionic/react\";\r\nimport \"../../global-styles.scss\";\r\nimport { arrowBackOutline } from \"ionicons/icons\";\r\nimport ToggleListEx from \"../ToggleListEx\";\r\nimport { NotificationTypeModel } from \"../../orbital-interfaces/NotificationTypeModel\";\r\n\r\nexport interface FilterData {\r\n  msgTypes: { messageTypeId: number; name: string }[];\r\n  employees: { employeeId: number; name: string }[];\r\n}\r\n\r\nexport interface FilterResult {\r\n  msgTypeIds: number[];\r\n  employeeId: number;\r\n}\r\n\r\ninterface MessagesFilterModalProps {\r\n  onDismissModal: (result: FilterResult) => void;\r\n  onCancelModal: () => void;\r\n  filterData: FilterData;\r\n}\r\n\r\nconst MessagesFilterModal: React.FC<MessagesFilterModalProps> = ({\r\n  onDismissModal,\r\n  onCancelModal,\r\n  filterData,\r\n}: MessagesFilterModalProps) => {\r\n  const [filterResult, setFilterResult] = useState({\r\n    msgTypeIds: filterData.msgTypes\r\n      ? filterData.msgTypes.map((mt) => mt.messageTypeId)\r\n      : ([] as number[]),\r\n    employeeId: -1,\r\n  } as FilterResult);\r\n\r\n  const [isDirty, setIsDirty] = useState(false);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onCloseModal = () => {\r\n    onDismissModal(filterResult);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onCancel = () => {\r\n    onCancelModal();\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onResetAll = () => {\r\n    setFilterResult({\r\n      msgTypeIds: filterData.msgTypes.map((mt) => mt.messageTypeId),\r\n      employeeId: -1,\r\n    });\r\n    setIsDirty(false);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onMessageTypeChange = (newSelection: NotificationTypeModel[]) => {\r\n    setFilterResult({\r\n      ...filterResult,\r\n      msgTypeIds: newSelection.map((mt) => mt.id),\r\n    });\r\n    setIsDirty(true);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <IonHeader className=\"ion-no-border\">\r\n        <IonToolbar>\r\n          <IonButtons slot=\"start\">\r\n            <IonButton onClick={onCancel}>\r\n              <IonIcon icon={arrowBackOutline} slot=\"icon-only\" />\r\n            </IonButton>\r\n          </IonButtons>\r\n          <IonTitle>Filter</IonTitle>\r\n          <IonButtons slot=\"end\">\r\n            <IonButton onClick={onResetAll}>RESET</IonButton>\r\n          </IonButtons>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n\r\n      <IonContent class=\"outer-content\">\r\n        <IonItem>\r\n          <IonLabel>From</IonLabel>\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            interface=\"action-sheet\"\r\n            value={filterResult.employeeId}\r\n            onIonChange={(e) => {\r\n              setFilterResult({ ...filterResult, employeeId: e.detail.value });\r\n              setIsDirty(true);\r\n            }}\r\n          >\r\n            <IonSelectOption key={-1} value={-1}>\r\n              EVERYONE\r\n            </IonSelectOption>\r\n            {filterData &&\r\n              filterData.employees &&\r\n              filterData.employees.map((emp) => (\r\n                <IonSelectOption key={emp.employeeId} value={emp.employeeId}>\r\n                  {emp.name}\r\n                </IonSelectOption>\r\n              ))}\r\n          </IonSelect>\r\n        </IonItem>\r\n        <IonItem lines=\"none\">\r\n          <IonLabel>Message Types</IonLabel>\r\n        </IonItem>\r\n        {filterData.msgTypes && (\r\n          <ToggleListEx\r\n            list={filterData.msgTypes.map((mt) => {\r\n              return { id: mt.messageTypeId, name: mt.name, description: \"\" };\r\n            })}\r\n            selected={filterData.msgTypes\r\n              .filter((mt) =>\r\n                filterResult.msgTypeIds.includes(mt.messageTypeId)\r\n              )\r\n              .map((mt) => {\r\n                return { id: mt.messageTypeId, name: mt.name, description: \"\" };\r\n              })}\r\n            selectionChanged={onMessageTypeChange}\r\n          />\r\n        )}\r\n      </IonContent>\r\n\r\n      <IonFooter>\r\n        <IonButton\r\n          className=\"apply-button\"\r\n          expand=\"block\"\r\n          onClick={onCloseModal}\r\n          disabled={!isDirty}\r\n        >\r\n          APPLY FILTER\r\n        </IonButton>\r\n      </IonFooter>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MessagesFilterModal;\r\n","import { KeyedCollection } from \"../util/KeyedCollection\";\r\n\r\nexport interface MessageType {\r\n  id: number;\r\n  typeName: string;\r\n  description: string;\r\n}\r\n\r\nconst types: MessageType[] = [\r\n  { id: 1, typeName: \"CoverRequestMessage\", description: \"Cover-Request\" },\r\n  { id: 2, typeName: \"CoverApprovedMessage\", description: \"Cover-Approved\" },\r\n  {\r\n    id: 3,\r\n    typeName: \"DirectCoverRequestMessage\",\r\n    description: \"Direct Cover-Request\",\r\n  },\r\n  { id: 5, typeName: \"ShiftRequestMessage\", description: \"Shift-Request\" },\r\n  { id: 6, typeName: \"ShiftRequestDeniedMessage\", description: \"Shift-Denied\" },\r\n  {\r\n    id: 10,\r\n    typeName: \"ShiftRequestReceivedMessage\",\r\n    description: \"Shift-Request Received\",\r\n  },\r\n  {\r\n    id: 20,\r\n    typeName: \"NoClockInAlertMessage\",\r\n    description: \"No Clock In Alert\",\r\n  },\r\n  {\r\n    id: 21,\r\n    typeName: \"NoClockOutAlertMessage\",\r\n    description: \"No Clock Out Alert\",\r\n  },\r\n  {\r\n    id: 22,\r\n    typeName: \"LateClockInMessage\",\r\n    description: \"Late Clock In Alert\",\r\n  },\r\n  {\r\n    id: 23,\r\n    typeName: \"EarlyClockOutAlertMessage\",\r\n    description: \"Early Clock Out Alert\",\r\n  },\r\n  {\r\n    id: 50,\r\n    typeName: \"ScheduleEventUpdatedMessage\",\r\n    description: \"Schedule Event Updated\",\r\n  },\r\n  {\r\n    id: 60,\r\n    typeName: \"PublishedScheduleUpdatedMessage\",\r\n    description: \"Published Schedule Updated\",\r\n  },\r\n  {\r\n    id: 80,\r\n    typeName: \"PasswordRecoveryMessage\",\r\n    description: \"Password Recovery\",\r\n  },\r\n  {\r\n    id: 81,\r\n    typeName: \"VerifyCellPhoneMessage\",\r\n    description: \"Verify Cell Phone\",\r\n  },\r\n  {\r\n    id: 82,\r\n    typeName: \"VerifyCellPhoneCompleteMessage\",\r\n    description: \"Verify Cell Phone Completed\",\r\n  },\r\n  { id: 83, typeName: \"VerifyEmailMessage\", description: \"Verify Email\" },\r\n  { id: 100, typeName: \"CustomMessage\", description: \"Custom Messages\" },\r\n  {\r\n    id: 101,\r\n    typeName: \"WeeklyScheduleForEmployeeMessage\",\r\n    description: \"Employee Weekly Schedule\",\r\n  },\r\n  { id: 555, typeName: \"WelcomeMessage\", description: \"Welcome\" },\r\n  {\r\n    id: 603,\r\n    typeName: \"UpdatePaymentInformationMessage\",\r\n    description: \"Update Payment Information\",\r\n  },\r\n  {\r\n    id: 700,\r\n    typeName: \"UpgradeSubscriptionMessage\",\r\n    description: \"Upgrade Subscription (to Orbital)\",\r\n  },\r\n  { id: 701, typeName: \"FailedSignupMessage\", description: \"Failed Signup\" },\r\n  { id: 702, typeName: \"GenericErrorMessage\", description: \"Error Message\" },\r\n  { id: 704, typeName: \"SignupMessage\", description: \"Signup Completed\" },\r\n  {\r\n    id: 705,\r\n    typeName: \"DatesOutOfSyncMessage\",\r\n    description: \"Dates Out of Sync\",\r\n  },\r\n  {\r\n    id: 708,\r\n    typeName: \"CancelSubscriptionMessage\",\r\n    description: \"Canceled Subscription  \",\r\n  },\r\n];\r\n\r\nexport const messageTypes = new KeyedCollection<MessageType>();\r\n\r\ntypes.map((t) => messageTypes.add(\"\" + t.id, t));\r\n","import { Message } from \"../orbital-interfaces/Message\";\r\nimport { ApplicationUser } from \"../context/ApplicationUserContext\";\r\nimport apiHelper from \"./OrbitalApiHelper\";\r\nimport { ErrorResponse } from \"./RequestsAPI\";\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getUserMessage = async (user: ApplicationUser, msgId: number) => {\r\n  return (await apiHelper.get(\r\n    user,\r\n    \"api/v2/employee/messages/\" + msgId\r\n  )) as Message;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getUserMessages = async (user: ApplicationUser) => {\r\n  return (await apiHelper.get(user, \"api/v2/employee/messages\")) as Message[];\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getReadCount = async (user: ApplicationUser, msgId: number) => {\r\n  return (await apiHelper.get(\r\n    user,\r\n    \"api/v1/employee/messages/\" + msgId + \"/readCount\"\r\n  )) as number;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst setIsPinned = async (\r\n  user: ApplicationUser,\r\n  msgId: number,\r\n  isPinned: boolean\r\n) => {\r\n  return await apiHelper.post(\r\n    user,\r\n    \"api/v1/employee/messages/\" + msgId + \"/togglePin\",\r\n    { isPinned }\r\n  );\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst setIsViewed = async (\r\n  user: ApplicationUser,\r\n  msgId: number,\r\n  isViewed: boolean\r\n) => {\r\n  return await apiHelper.post(\r\n    user,\r\n    \"api/v1/employee/messages/\" + msgId + \"/toggleView\",\r\n    { isViewed }\r\n  );\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst deleteMessage = async (user: ApplicationUser, msgId: number) => {\r\n  return await apiHelper.del(user, \"api/v1/employee/messages/\" + msgId);\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst getUnreadCount = async (user: ApplicationUser) => {\r\n  if (!user.isLoggedin) {\r\n    return 0;\r\n  }\r\n\r\n  return (await apiHelper.get(\r\n    user,\r\n    \"api/v2/employee/messages/unreadCount\"\r\n  )) as number;\r\n};\r\n\r\n// ----------------------------------------------------------------------------------------------\r\nconst sendMessage = async (\r\n  user: ApplicationUser,\r\n  locId: number,\r\n  channel: number,\r\n  empIds: number[],\r\n  text: string\r\n) => {\r\n  return (await apiHelper.post(user, \"api/v2/employee/messages/send\", {\r\n    locId,\r\n    channel,\r\n    empIds,\r\n    text,\r\n  })) as ErrorResponse;\r\n};\r\n\r\nexport default {\r\n  getUserMessage,\r\n  getUserMessages,\r\n  getReadCount,\r\n  setIsPinned,\r\n  setIsViewed,\r\n  deleteMessage,\r\n  getUnreadCount,\r\n  sendMessage,\r\n};\r\n","import React, { useState, useEffect, useContext } from \"react\";\r\nimport { ApplicationUserContext } from \"./ApplicationUserContext\";\r\nimport messagesApi from \"../api/MessageAPI\";\r\nimport { useInterval } from \"../hooks/useInterval\";\r\nimport { getConstants } from \"../api/environment\";\r\n\r\nexport interface IMessagesState {\r\n  unreadMessagesCount: number;\r\n  unreadMessageCountWhenViewed: number;\r\n\r\n}\r\n\r\nexport interface IMessagesContext extends IMessagesState {\r\n  refreshCount: () => void;\r\n  messagesViewed: () => void;\r\n  hasNewMessages: boolean;\r\n}\r\n\r\nconst INITIAL_MESSAGES_CONTEXT: IMessagesContext = {\r\n  unreadMessagesCount: 0,\r\n  unreadMessageCountWhenViewed: 0,\r\n  refreshCount: () => {},\r\n  messagesViewed: () => {},\r\n  hasNewMessages: false\r\n};\r\n\r\nexport const MessagesContext = React.createContext<IMessagesContext>(\r\n  INITIAL_MESSAGES_CONTEXT\r\n);\r\n\r\nconst COUNT_STORAGE_KEY = \"unreadMessageCountWhenViewed\";\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction getCountFromStorage(): number {\r\n  const fromStorageCount = localStorage.getItem(COUNT_STORAGE_KEY);\r\n  if (fromStorageCount !== null) {\r\n    return parseInt(fromStorageCount);\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\n// ------------------------------------------------------------------------------------\r\nfunction putCountIntoStorage(cnt: number) {\r\n  localStorage.setItem(COUNT_STORAGE_KEY, cnt.toString());\r\n}\r\n\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nexport const MessagesContextProvider = (props: any) => {\r\n  const { user } = useContext(ApplicationUserContext);\r\n  const [messagesState, internalSetMessagesState] = useState<IMessagesState>({\r\n    unreadMessagesCount: 0,\r\n    unreadMessageCountWhenViewed: 0\r\n  });\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  function refreshCount() {\r\n    getUnreadCount();\r\n  }\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  function messagesViewed() {\r\n    const newViewCount = messagesState.unreadMessagesCount;\r\n\r\n    if (newViewCount !== messagesState.unreadMessageCountWhenViewed) {\r\n      internalSetMessagesState({\r\n        ...messagesState,\r\n        unreadMessageCountWhenViewed: newViewCount\r\n      });\r\n\r\n      putCountIntoStorage(newViewCount);\r\n    }\r\n  }\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  function getUnreadCount() {\r\n    if (user.isLoggedin) {\r\n      messagesApi.getUnreadCount(user).then((newUnreadCount) => {\r\n\r\n        let newUnreadMessageCountWhenViewed = messagesState.unreadMessageCountWhenViewed;\r\n        if (newUnreadMessageCountWhenViewed === 0) {\r\n          newUnreadMessageCountWhenViewed = getCountFromStorage();\r\n        }\r\n\r\n        if (newUnreadCount < newUnreadMessageCountWhenViewed) {\r\n          newUnreadMessageCountWhenViewed = newUnreadCount;\r\n          putCountIntoStorage(newUnreadMessageCountWhenViewed);\r\n        }\r\n\r\n        if (newUnreadCount !== messagesState.unreadMessagesCount ||\r\n            newUnreadMessageCountWhenViewed !== messagesState.unreadMessageCountWhenViewed) {\r\n          const newState: IMessagesState = {\r\n            unreadMessageCountWhenViewed: newUnreadMessageCountWhenViewed,\r\n            unreadMessagesCount: newUnreadCount\r\n          };\r\n\r\n          internalSetMessagesState(newState);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (user.isLoggedin) {\r\n      getUnreadCount();\r\n    }\r\n    // eslint-disable-next-line\r\n  }, [user.isLoggedin]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useInterval(\r\n    () => {\r\n      getUnreadCount();\r\n    },\r\n    true,\r\n    getConstants(user).checkUnreadMessageCountTimer\r\n  );\r\n\r\n  return (\r\n    <MessagesContext.Provider\r\n      value={{\r\n        refreshCount,\r\n        messagesViewed,\r\n        unreadMessagesCount: messagesState.unreadMessagesCount,\r\n        unreadMessageCountWhenViewed: messagesState.unreadMessageCountWhenViewed,\r\n        hasNewMessages:\r\n          messagesState.unreadMessagesCount > messagesState.unreadMessageCountWhenViewed\r\n      }}\r\n    >\r\n      {props.children}\r\n    </MessagesContext.Provider>\r\n  );\r\n};\r\n","import React, { useContext, useEffect, useState } from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonButtons,\r\n  IonIcon,\r\n  IonContent,\r\n  IonFooter,\r\n  IonHeader,\r\n  IonGrid,\r\n  IonRow,\r\n  IonCol,\r\n  IonToolbar,\r\n} from \"@ionic/react\";\r\nimport { arrowBackOutline, bookmark, trash } from \"ionicons/icons\";\r\nimport \"../../global-styles.scss\";\r\nimport { ApplicationUserContext } from \"../../context/ApplicationUserContext\";\r\nimport useDialogBox from \"../../hooks/useDialogBox\";\r\nimport { Message } from \"../../orbital-interfaces/Message\";\r\nimport { AuthorizedItemsContext } from \"../../context/AuthorizedItemsContext\";\r\nimport { getMessageDeliveryTimeString } from \"../../util/time-helper\";\r\nimport scheduleEventAPI from \"../../api/ScheduleEventsAPI\";\r\nimport messageAPI from \"../../api/MessageAPI\";\r\nimport { ScheduleEvent } from \"../../orbital-interfaces/ScheduleEvent\";\r\nimport EventReqeustEditor from \"../EditEvent/editor/EventRequestEditor\";\r\nimport { MessagesReducerAction } from \"../../pages/MessagesPage\";\r\nimport useYesOrCancelDialogBox from \"../../hooks/useYesOrCancelDialogBox\";\r\nimport {\r\n  getEventEditAuthorization,\r\n  EventEditAuthorization,\r\n} from \"../EditEvent/EditEventAuthorization\";\r\nimport { MessagesContext } from \"../../context/MessagesContext\";\r\n\r\ninterface ViewMessageModalProps {\r\n  message: Message | null;\r\n  onCloseModal: (msg: string | null) => void;\r\n  updateMessages: React.Dispatch<MessagesReducerAction>;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nconst ViewMessagetModal: React.FC<ViewMessageModalProps> = ({\r\n  message,\r\n  onCloseModal,\r\n  updateMessages,\r\n}) => {\r\n  const dlg = useDialogBox();\r\n  const yesCancelDlg = useYesOrCancelDialogBox();\r\n  const { user } = React.useContext(ApplicationUserContext);\r\n  const { auth } = React.useContext(AuthorizedItemsContext);\r\n  const [scheduleEvent, setScheduleEvent] = useState(\r\n    null as ScheduleEvent | null\r\n  );\r\n  const [eventEditAuth, setEventEditAuth] = useState(\r\n    null as EventEditAuthorization | null\r\n  );\r\n  const [readCount, setReadCount] = useState(null as number | null);\r\n  const [usageText, setUsageText] = useState(null as string | null);\r\n  const [pinned, setPinned] = useState(false);\r\n  const { refreshCount } = useContext(MessagesContext);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (!message) {\r\n      return;\r\n    }\r\n\r\n    if (message.scheduleEventId) {\r\n      scheduleEventAPI\r\n        .getScheduleEvent(user, message.scheduleEventId)\r\n        .then((event) => {\r\n          if (event) {\r\n            setScheduleEvent(event);\r\n            const newEventEditAuth = getEventEditAuthorization(\r\n              event.EventTypeId,\r\n              event.EventStatusId,\r\n              event.EmployeeId,\r\n              event.EventStart,\r\n              event.EventEnd,\r\n              event.LocationId,\r\n              event.DepartmentId,\r\n              event.PositionId,\r\n              event.ConfirmedBy !== null &&\r\n              event.ConfirmedBy !== undefined &&\r\n              event.ConfirmedBy !== \"\",\r\n              auth\r\n            );\r\n            setEventEditAuth(newEventEditAuth);\r\n          }\r\n        });\r\n    } else {\r\n      if (scheduleEvent) {\r\n        setScheduleEvent(null);\r\n        setUsageText(null);\r\n      }\r\n    }\r\n\r\n    messageAPI.getReadCount(user, message.messageId).then((newReadCount) => {\r\n      setReadCount(newReadCount);\r\n    });\r\n\r\n    if (!message.isViewed) {\r\n      messageAPI.setIsViewed(user, message.messageId, true).then(() => {\r\n        updateMessages({\r\n          type: \"UPDATE-VIEWED\",\r\n          msgId: message.messageId,\r\n          isViewed: true,\r\n        });\r\n      });\r\n    }\r\n\r\n    setPinned(message.isPinned);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [message?.messageId]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onPinnedClick = () => {\r\n    const newPinValue = !pinned;\r\n    messageAPI.setIsPinned(user, message!.messageId, newPinValue).then(() => {\r\n      setPinned(newPinValue);\r\n      updateMessages({\r\n        type: \"UPDATE-PINNED\",\r\n        msgId: message!.messageId,\r\n        isPinned: newPinValue,\r\n      });\r\n    });\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onDeleteClick = () => {\r\n    yesCancelDlg.showDialog(\r\n      \"Delete this message?\",\r\n      () => {\r\n        messageAPI.deleteMessage(user, message!.messageId).then(() => {\r\n          updateMessages({ type: \"DELETE\", msgId: message!.messageId });\r\n          onCancel(\"Message Deleted\");\r\n        });\r\n      },\r\n      () => { }\r\n    );\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onCancel = (msg: string | null) => {\r\n    if (!message?.isViewed) {\r\n      refreshCount();\r\n    }\r\n\r\n    onCloseModal(msg);\r\n  };\r\n\r\n  if (!message || !auth || !auth.locations || auth.locations.length === 0) {\r\n    return (\r\n      <>\r\n        <div>Loading</div>\r\n        {dlg.alertBoxJsx}\r\n      </>\r\n    );\r\n  } else {\r\n    return (\r\n      <>\r\n        <IonHeader className=\"ion-no-border\">\r\n          <IonToolbar>\r\n            <IonButtons slot=\"start\">\r\n              <IonButton\r\n                onClick={() => {\r\n                  onCancel(null);\r\n                }}\r\n              >\r\n                <IonIcon icon={arrowBackOutline} mode=\"md\" slot=\"icon-only\" />\r\n              </IonButton>\r\n            </IonButtons>\r\n            <IonButtons slot=\"end\">\r\n              <IonButton\r\n                onClick={() => {\r\n                  onPinnedClick();\r\n                }}\r\n              >\r\n                <IonIcon\r\n                  icon={bookmark}\r\n                  style={pinned ? { color: \"black\" } : { color: \"lightgray\" }}\r\n                />\r\n              </IonButton>\r\n              <IonButton\r\n                onClick={() => {\r\n                  onDeleteClick();\r\n                }}\r\n              >\r\n                <IonIcon icon={trash} />\r\n              </IonButton>\r\n            </IonButtons>\r\n          </IonToolbar>\r\n        </IonHeader>\r\n\r\n        <IonContent class=\"outer-contentMessage\">\r\n          <IonGrid>\r\n            <IonRow class=\"messageIonRow-header\">\r\n              <IonCol class=\"messageHeaderSubject\" size=\"12\" >\r\n                {message!.subject}\r\n              </IonCol>\r\n\r\n              <IonCol class=\"messageHeaderDetails\" size=\"12\">\r\n                From: {message!.fromEmployeeFirstName}{\" \"}\r\n                {message!.fromEmployeeLastName}\r\n              </IonCol>\r\n\r\n              <IonCol class=\"messageHeaderDetails\" size=\"9\" >\r\n                {getMessageDeliveryTimeString(message!.deliveryDateTime)}\r\n              </IonCol>\r\n\r\n              <IonCol class=\"readCounter\" size=\"3\" >\r\n                {readCount !== null && <span>{readCount} Read</span>}\r\n              </IonCol>\r\n            </IonRow>\r\n            <div></div>\r\n            \r\n            <IonRow class=\"messageIonRow-content\">\r\n              <IonCol class=\"messageBlock\" size=\"12\">\r\n                <div\r\n                  dangerouslySetInnerHTML={{ __html: message?.messageText }}\r\n                />\r\n              </IonCol>\r\n            </IonRow>\r\n\r\n            {usageText !== null && (\r\n              <IonRow>\r\n                <IonCol size=\"12\">{usageText}</IonCol>\r\n              </IonRow>\r\n            )}\r\n          </IonGrid>\r\n\r\n          {dlg.alertBoxJsx}\r\n          {yesCancelDlg.dialogJsx}\r\n        </IonContent>\r\n\r\n        <IonFooter>\r\n          {scheduleEvent !== null && (\r\n            <EventReqeustEditor\r\n              auth={auth}\r\n              eventEnd={scheduleEvent.EventEnd}\r\n              eventType={scheduleEvent.EventTypeId}\r\n              eventStatus={scheduleEvent.EventStatusId}\r\n              eventEmployeeId={scheduleEvent.EmployeeId}\r\n              eventPositionId={scheduleEvent.PositionId}\r\n              scheduleEventId={scheduleEvent.ScheduleEventId}\r\n              locationId={scheduleEvent.LocationId}\r\n              update={() => { }}\r\n              cancelEditModal={onCancel}\r\n              eventEditAuth={eventEditAuth}\r\n              setUsageText={setUsageText}\r\n            />\r\n          )}\r\n        </IonFooter>\r\n      </>\r\n    );\r\n  }\r\n};\r\n\r\nexport default ViewMessagetModal;\r\n","import React, { useContext, useState } from \"react\";\r\nimport { IonItem, IonLabel, IonSelect, IonSelectOption } from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport { AuthorizedItemsContext } from \"../../../context/AuthorizedItemsContext\";\r\nimport authHelper, { PositionEx } from \"../../../util/authitems-helper\";\r\nimport {\r\n  AuthorizedItems,\r\n  AuthorizedLocation,\r\n  AuthorizedPosition,\r\n  Role,\r\n} from \"../../../orbital-interfaces/authorized-items\";\r\n\r\ninterface PositionSelectorProps {\r\n  currentPosition: PositionEx;\r\n  onPositionUpdate: (pos: PositionEx) => void;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction isAdminAtLocation(\r\n  auth: AuthorizedItems,\r\n  location: AuthorizedLocation\r\n) {\r\n  if (auth.role === Role.LocationAdmin || auth.role === Role.BusinessAdmin) {\r\n    return true;\r\n  }\r\n\r\n  if (auth.role === Role.Employee) {\r\n    return false;\r\n  }\r\n\r\n  return location.departments.find((d) => d.isDeptAdmin) !== undefined;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction setPositionForLocation(\r\n  auth: AuthorizedItems,\r\n  locationId: number\r\n): PositionEx {\r\n  const location = authHelper.getLocationFromLocationId(auth, locationId);\r\n  if (location === null) {\r\n    throw new Error(\"Can't find location\");\r\n  }\r\n\r\n  return {\r\n    location,\r\n    department: null,\r\n    position: null,\r\n  };\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction setPositionForDepartment(\r\n  auth: AuthorizedItems,\r\n  pos: PositionEx,\r\n  departmentId: number | null\r\n): PositionEx {\r\n  if (departmentId === null) {\r\n    return setPositionForLocation(auth, pos.location.id);\r\n  }\r\n\r\n  const department = pos.location.departments.filter(\r\n    (d) => d.id === departmentId\r\n  )[0];\r\n  return {\r\n    location: pos.location,\r\n    department,\r\n    position: null,\r\n  };\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction setPositionForPosition(\r\n  auth: AuthorizedItems,\r\n  pos: PositionEx,\r\n  positionId: number | null\r\n): PositionEx {\r\n  if (positionId === null) {\r\n    return {\r\n      location: pos.location,\r\n      department: pos.department,\r\n      position: null,\r\n    };\r\n  }\r\n\r\n  const position = pos.department!.positions.filter(\r\n    (p) => p.id === positionId\r\n  )[0];\r\n  return {\r\n    location: pos.location,\r\n    department: pos.department,\r\n    position,\r\n  };\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction getPositionListForSelection(sel: PositionEx): AuthorizedPosition[] {\r\n  if (sel.department !== null) {\r\n    return sel.department.positions;\r\n  }\r\n\r\n  return sel.location.departments.flatMap((d) => d.positions);\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst PositionSelector: React.FC<PositionSelectorProps> = ({\r\n  currentPosition,\r\n  onPositionUpdate,\r\n}) => {\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n  const [selectedPosition, setSelectedPosition] = useState(currentPosition);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const updateLocation = (locId: number | undefined | null) => {\r\n    if (!locId) {\r\n      return;\r\n    }\r\n\r\n    const newPos = setPositionForLocation(auth, locId);\r\n    setSelectedPosition(newPos);\r\n    onPositionUpdate(newPos);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const updateDepartment = (depId: number | undefined | null) => {\r\n    if (depId === undefined) {\r\n      return;\r\n    }\r\n\r\n    const newPos = setPositionForDepartment(auth, selectedPosition, depId);\r\n    setSelectedPosition(newPos);\r\n    onPositionUpdate(newPos);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const updatePosition = (posId: number | undefined | null) => {\r\n    if (posId === undefined) {\r\n      return;\r\n    }\r\n\r\n    const newPos = setPositionForPosition(auth, selectedPosition, posId);\r\n    setSelectedPosition(newPos);\r\n    onPositionUpdate(newPos);\r\n  };\r\n\r\n  if (!auth || !auth.locations || auth.locations.length === 0) {\r\n    return (\r\n      <>\r\n        <div>Loading</div>\r\n      </>\r\n    );\r\n  } else {\r\n    return (\r\n      <>\r\n        <IonItem>\r\n          <IonLabel>Location</IonLabel>\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            interface=\"action-sheet\"\r\n            value={selectedPosition.location.id}\r\n            onIonChange={(e) => updateLocation(e.detail.value)}\r\n          >\r\n            {auth.locations\r\n              .filter((l) => isAdminAtLocation(auth, l))\r\n              .map((loc) => (\r\n                <IonSelectOption key={loc.id} value={loc.id}>\r\n                  {loc.name}\r\n                </IonSelectOption>\r\n              ))}\r\n          </IonSelect>\r\n        </IonItem>\r\n        <IonItem>\r\n          <IonLabel>Department</IonLabel>\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            interface=\"action-sheet\"\r\n            value={\r\n              selectedPosition.department === null\r\n                ? null\r\n                : selectedPosition.department.id\r\n            }\r\n            onIonChange={(e) => updateDepartment(e.detail.value)}\r\n          >\r\n            <IonSelectOption key={-1} value={null}>\r\n              All Departments\r\n            </IonSelectOption>\r\n            {selectedPosition.location.departments &&\r\n              selectedPosition.location.departments\r\n                .filter((dep) => authHelper.isDeptAdmin(auth, dep.id))\r\n                .map((dep) => (\r\n                  <IonSelectOption key={dep.id} value={dep.id}>\r\n                    {dep.name}\r\n                  </IonSelectOption>\r\n                ))}\r\n          </IonSelect>\r\n        </IonItem>\r\n        <IonItem>\r\n          <IonLabel>Position</IonLabel>\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            interface=\"action-sheet\"\r\n            value={\r\n              selectedPosition.position === null\r\n                ? null\r\n                : selectedPosition.position.id\r\n            }\r\n            onIonChange={(e) => updatePosition(e.detail.value)}\r\n          >\r\n            <IonSelectOption key={-1} value={null}>\r\n              All Positions\r\n            </IonSelectOption>\r\n            {getPositionListForSelection(selectedPosition).map((pos) => (\r\n              <IonSelectOption key={pos.id} value={pos.id}>\r\n                {selectedPosition.department === null\r\n                  ? authHelper.getDepartmentFromPositionId(auth, pos.id)!.abbr +\r\n                    \"/\" +\r\n                    pos.name\r\n                  : pos.name}\r\n              </IonSelectOption>\r\n            ))}\r\n          </IonSelect>\r\n        </IonItem>\r\n      </>\r\n    );\r\n  }\r\n};\r\n\r\nexport default PositionSelector;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport {\r\n  IonCheckbox,\r\n  IonContent,\r\n  IonRow,\r\n  IonCol,\r\n  IonButtons,\r\n  IonButton,\r\n  IonFooter,\r\n  IonGrid,\r\n  IonHeader,\r\n  IonTitle,\r\n  IonToolbar,\r\n  IonIcon,\r\n} from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport { EmployeeCommunication } from \"../../../api/EmployeesAPI\";\r\nimport { mail, notifications, phonePortrait, close } from \"ionicons/icons\";\r\n\r\ninterface EmployeeSelectorModalProps {\r\n  onCancel: () => void;\r\n  onOk: (employees: EmployeeCommunication[]) => void;\r\n  employeeList: EmployeeCommunication[];\r\n  selectedEmployeeList: EmployeeCommunication[];\r\n  channel: number;\r\n}\r\n\r\nconst emailIcon = <IonIcon icon={mail} />;\r\nconst textIcon = <IonIcon icon={phonePortrait} />;\r\nconst pushIcon = <IonIcon icon={notifications} />;\r\n\r\n// --------------------------------------------------------------------------------------\r\nexport function isEmployeeEnabled(\r\n  emp: EmployeeCommunication,\r\n  channel: number\r\n): boolean {\r\n  switch (channel) {\r\n    case -1:\r\n      return emp.hasEmail || emp.hasText || emp.hasPush;\r\n    case 1:\r\n      return emp.hasEmail;\r\n    case 2:\r\n      return emp.hasText;\r\n    case 3:\r\n      return emp.hasPush;\r\n    default:\r\n      return false;\r\n  }\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst EmployeeSelectorModal: React.FC<EmployeeSelectorModalProps> = ({\r\n  onCancel,\r\n  onOk,\r\n  employeeList,\r\n  selectedEmployeeList,\r\n  channel,\r\n}: EmployeeSelectorModalProps) => {\r\n  const [list, setList] = useState([] as EmployeeCommunication[]);\r\n  const [isAllChecked, setIsAllChecked] = useState(false);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    const newList = employeeList.map((e) => {\r\n      return {\r\n        id: e.id,\r\n        name: e.name,\r\n        hasEmail: e.hasEmail,\r\n        hasText: e.hasText,\r\n        hasPush: e.hasPush,\r\n        isChecked: selectedEmployeeList.some((s) => s.id === e.id),\r\n      };\r\n    });\r\n\r\n    setList(newList);\r\n  }, [employeeList, selectedEmployeeList]);\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onOkClick() {\r\n    onOk(list.filter((e) => e.isChecked));\r\n  }\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onEmployeeChecked(empId: number) {\r\n    let checkCount = 0;\r\n    const newList = list.map((e) => {\r\n      if (!isEmployeeEnabled(e, channel)) {\r\n        return { ...e, isChecked: false };\r\n      }\r\n\r\n      if (e.isChecked) {\r\n        if (e.id === empId) {\r\n          return { ...e, isChecked: false };\r\n        } else {\r\n          checkCount++;\r\n          return { ...e, isChecked: isEmployeeEnabled(e, channel) };\r\n        }\r\n      } else {\r\n        if (e.id === empId) {\r\n          checkCount++;\r\n          return { ...e, isChecked: isEmployeeEnabled(e, channel) };\r\n        } else {\r\n          return { ...e, isChecked: false };\r\n        }\r\n      }\r\n    });\r\n\r\n    const allCheckCount = employeeList.filter((e) =>\r\n      isEmployeeEnabled(e, channel)\r\n    ).length;\r\n\r\n    setIsAllChecked(checkCount === allCheckCount);\r\n    setList(newList);\r\n  }\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function onAllClick() {\r\n    const newValue = !isAllChecked;\r\n\r\n    const newList = list.map((e) => {\r\n      if (!isEmployeeEnabled(e, channel)) {\r\n        return { ...e, isChecked: false };\r\n      }\r\n\r\n      return { ...e, isChecked: newValue };\r\n    });\r\n\r\n    setList(newList);\r\n    setIsAllChecked(newValue);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IonHeader mode=\"ios\">\r\n        <IonToolbar>\r\n          <IonTitle>Employees</IonTitle>\r\n          <IonButtons slot=\"end\">\r\n            <IonButton onClick={onCancel}>\r\n              <IonIcon icon={close} mode=\"ios\" slot=\"icon-only\" />\r\n            </IonButton>\r\n          </IonButtons>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n      <IonContent>\r\n        <IonGrid>\r\n          <IonRow key={-1}>\r\n            <IonCol size=\"3\">\r\n              <IonCheckbox\r\n                className=\"checkbox\"\r\n                checked={isAllChecked}\r\n                onClick={onAllClick}\r\n              />\r\n            </IonCol>\r\n            <IonCol className=\"label\" size=\"6\">\r\n              Select All\r\n            </IonCol>\r\n            <IonCol size=\"1\">{emailIcon}</IonCol>\r\n            <IonCol size=\"1\">{textIcon}</IonCol>\r\n            <IonCol size=\"1\">{pushIcon}</IonCol>\r\n          </IonRow>\r\n          {list.map((emp) => (\r\n            <IonRow key={emp.id}>\r\n              <IonCol size=\"3\">\r\n                <IonCheckbox\r\n                  className=\"checkbox\"\r\n                  checked={emp.isChecked}\r\n                  disabled={!isEmployeeEnabled(emp, channel)}\r\n                  onClick={() => {\r\n                    onEmployeeChecked(emp.id);\r\n                  }}\r\n                />\r\n              </IonCol>\r\n              <IonCol className=\"label\" size=\"6\">\r\n                {emp.name}\r\n              </IonCol>\r\n              <IonCol size=\"1\">{emp.hasEmail && emailIcon}</IonCol>\r\n              <IonCol size=\"1\">{emp.hasText && textIcon}</IonCol>\r\n              <IonCol size=\"1\">{emp.hasText && pushIcon}</IonCol>\r\n            </IonRow>\r\n          ))}\r\n        </IonGrid>\r\n      </IonContent>\r\n      <IonFooter>\r\n        <IonButton expand=\"block\" color=\"secondary\" onClick={onOkClick}>\r\n          OK\r\n        </IonButton>\r\n      </IonFooter>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EmployeeSelectorModal;\r\n","import React, { useContext, useEffect, useState } from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonItem,\r\n  IonLabel,\r\n  IonSelect,\r\n  IonSelectOption,\r\n  IonModal,\r\n} from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport { AuthorizedItemsContext } from \"../../../context/AuthorizedItemsContext\";\r\nimport {\r\n  AuthorizedItems,\r\n  Role,\r\n} from \"../../../orbital-interfaces/authorized-items\";\r\nimport { PositionEx } from \"../../../util/authitems-helper\";\r\nimport PositionSelector from \"./PositionSelector\";\r\nimport employeeApi, { EmployeeCommunication } from \"../../../api/EmployeesAPI\";\r\nimport { ApplicationUserContext } from \"../../../context/ApplicationUserContext\";\r\nimport EmployeeSelectorModal, {\r\n  isEmployeeEnabled,\r\n} from \"./EmployeeSelectorModal\";\r\nimport { useShowLoading } from \"../../../hooks/useShowLoading\";\r\n\r\ninterface MessageChannel {\r\n  id: number;\r\n  text: string;\r\n}\r\n\r\nconst messageChannels: MessageChannel[] = [\r\n  { id: -1, text: \"All Channels\" },\r\n  { id: 1, text: \"Email\" },\r\n  { id: 2, text: \"Text\" },\r\n  { id: 3, text: \"Push Notification\" },\r\n];\r\n\r\ninterface EmployeesSelectorProps {\r\n  onUpdate: (\r\n    empList: EmployeeCommunication[],\r\n    locId: number,\r\n    channel: number\r\n  ) => void;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction getFirstAvailablePosition(auth: AuthorizedItems): PositionEx {\r\n  for (let i = 0; i < auth.locations.length; i++) {\r\n    const curLoc = auth.locations[i];\r\n\r\n    if (curLoc.adminAllDepts) {\r\n      return {\r\n        location: curLoc,\r\n        department: null,\r\n        position: null,\r\n      };\r\n    }\r\n\r\n    for (let j = 0; j < curLoc.departments.length; j++) {\r\n      const curDep = curLoc.departments[j];\r\n      if (curDep.isDeptAdmin) {\r\n        return {\r\n          location: curLoc,\r\n          department: curDep,\r\n          position: null,\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  throw new Error(\r\n    \"Could not find a department where this user could send messages\"\r\n  );\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\nfunction getEmployeeButtonName(selList: EmployeeCommunication[]) {\r\n  if (selList.length === 0) {\r\n    return \"None Selected\";\r\n  }\r\n\r\n  if (selList.length === 1) {\r\n    return selList[0].name;\r\n  }\r\n\r\n  return `${selList.length} Selected`;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst EmployeesSelector: React.FC<EmployeesSelectorProps> = ({ onUpdate }) => {\r\n  const { user } = useContext(ApplicationUserContext);\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n  const [selectedRole, setSelectedRole] = useState(\"All\" as \"All\" | Role);\r\n  const [selectedPosition, setSelectedPosition] = useState(\r\n    getFirstAvailablePosition(auth)\r\n  );\r\n  const [selectedChannel, setSelectedChannel] = useState(-1);\r\n  const [selectedEmployees, setSelectedEmployees] = useState(\r\n    [] as EmployeeCommunication[]\r\n  );\r\n  const [employeeList, setEmployeeList] = useState(\r\n    [] as EmployeeCommunication[]\r\n  );\r\n\r\n  const [showEmployeeModal, setShowEmployeeModal] = useState(false);\r\n\r\n  const onAddMessageModalCancel = () => {\r\n    setShowEmployeeModal(false);\r\n  };\r\n\r\n  const loading = useShowLoading(\"Retreiving employee list\");\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  function fetchEmployees(\r\n    locId: number,\r\n    depId: number,\r\n    posId: number,\r\n    channel: number,\r\n    role: string\r\n  ) {\r\n    loading.setShowLoading(true);\r\n    employeeApi\r\n      .getEmployeeListForCommunication(user, locId, depId, posId, channel, role)\r\n      .then((emp) => {\r\n        setEmployeeList(emp);\r\n      })\r\n      .finally(() => {\r\n        loading.setShowLoading(false);\r\n      });\r\n  }\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onRoleUpdate = (newRole: \"All\" | Role) => {\r\n    if (newRole !== selectedRole) {\r\n      setSelectedRole(newRole);\r\n      setSelectedEmployees([]);\r\n      fetchEmployees(\r\n        selectedPosition.location.id,\r\n        selectedPosition.department === null\r\n          ? -1\r\n          : selectedPosition.department.id,\r\n        selectedPosition.position === null ? -1 : selectedPosition.position.id,\r\n        selectedChannel,\r\n        newRole\r\n      );\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onPositionUpdate = (posEx: PositionEx) => {\r\n    setSelectedPosition(posEx);\r\n    setSelectedEmployees([]);\r\n    fetchEmployees(\r\n      posEx.location.id,\r\n      posEx.department === null ? -1 : posEx.department.id,\r\n      posEx.position === null ? -1 : posEx.position.id,\r\n      selectedChannel,\r\n      selectedRole\r\n    );\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onChannelUpdate = (newChannelId: number | null | undefined) => {\r\n    if (newChannelId === null || newChannelId === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (newChannelId !== selectedChannel) {\r\n      setSelectedEmployees([]);\r\n      setSelectedChannel(newChannelId);\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onEmployeeUpdate = (newEmployeeList: EmployeeCommunication[]) => {\r\n    setSelectedEmployees(newEmployeeList);\r\n    setShowEmployeeModal(false);\r\n    onUpdate(newEmployeeList, selectedPosition.location.id, selectedChannel);\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (auth.locations && auth.locations.length > 0) {\r\n      fetchEmployees(auth.locations[0].id, -1, -1, 0, \"All\");\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [auth.locations]);\r\n\r\n  if (!auth || !auth.locations || auth.locations.length === 0) {\r\n    return (\r\n      <>\r\n        <div>Loading</div>\r\n      </>\r\n    );\r\n  } else {\r\n    return (\r\n      <>\r\n        <IonItem>\r\n          <IonLabel>Role</IonLabel>\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            interface=\"action-sheet\"\r\n            value={selectedRole}\r\n            onIonChange={(e) => {\r\n              onRoleUpdate(e.detail.value);\r\n            }}\r\n          >\r\n            <IonSelectOption value={\"All\"} key={-1}>\r\n              All\r\n            </IonSelectOption>\r\n            <IonSelectOption value={Role.BusinessAdmin} key={2}>\r\n              Business Admin\r\n            </IonSelectOption>\r\n            <IonSelectOption value={Role.LocationAdmin} key={3}>\r\n              Location Admin\r\n            </IonSelectOption>\r\n            <IonSelectOption value={Role.Admin} key={4}>\r\n              Admin\r\n            </IonSelectOption>\r\n            <IonSelectOption value={Role.Employee} key={5}>\r\n              Employee\r\n            </IonSelectOption>\r\n          </IonSelect>\r\n        </IonItem>\r\n        <PositionSelector\r\n          currentPosition={selectedPosition}\r\n          onPositionUpdate={onPositionUpdate}\r\n        />\r\n        <IonItem>\r\n          <IonLabel>Send To</IonLabel>\r\n          <IonSelect\r\n            mode=\"ios\"\r\n            interface=\"action-sheet\"\r\n            value={selectedChannel}\r\n            onIonChange={(e) => onChannelUpdate(e.detail.value)}\r\n          >\r\n            {messageChannels.map((channel) => (\r\n              <IonSelectOption key={channel.id} value={channel.id}>\r\n                {channel.text}\r\n              </IonSelectOption>\r\n            ))}\r\n          </IonSelect>\r\n        </IonItem>\r\n        <IonItem>\r\n          <IonLabel>\r\n            Employees (\r\n            {\r\n              employeeList.filter((e) => isEmployeeEnabled(e, selectedChannel))\r\n                .length\r\n            }{\" \"}\r\n            / {employeeList.length})\r\n          </IonLabel>\r\n          <IonButton \r\n          className=\"button-selectEmployees-messages\"\r\n          onClick={() => setShowEmployeeModal(true)}>\r\n            {getEmployeeButtonName(selectedEmployees)}\r\n          </IonButton>\r\n        </IonItem>\r\n        {loading.showLoadingJsx}\r\n        <IonModal\r\n          mode=\"ios\"\r\n          cssClass=\"mini-modal add-break-modal\"\r\n          onDidDismiss={() => setShowEmployeeModal(false)}\r\n          isOpen={showEmployeeModal}\r\n        >\r\n          <EmployeeSelectorModal\r\n            channel={selectedChannel}\r\n            onCancel={onAddMessageModalCancel}\r\n            onOk={onEmployeeUpdate}\r\n            employeeList={employeeList}\r\n            selectedEmployeeList={selectedEmployees}\r\n          />\r\n        </IonModal>\r\n      </>\r\n    );\r\n  }\r\n};\r\n\r\nexport default EmployeesSelector;\r\n","import React, { useContext, useState } from \"react\";\r\nimport {\r\n  IonButton,\r\n  IonButtons,\r\n  IonIcon,\r\n  IonContent,\r\n  IonHeader,\r\n  IonTitle,\r\n  IonToolbar,\r\n  IonList,\r\n  IonItem,\r\n  IonTextarea,\r\n  IonFooter,\r\n} from \"@ionic/react\";\r\nimport \"../../../global-styles.scss\";\r\nimport { arrowBackOutline } from \"ionicons/icons\";\r\nimport { AuthorizedItemsContext } from \"../../../context/AuthorizedItemsContext\";\r\nimport EmployeesSelector from \"./EmployeesSelector\";\r\nimport { EmployeeCommunication } from \"../../../api/EmployeesAPI\";\r\nimport messageApi from \"../../../api/MessageAPI\";\r\nimport { useShowLoading } from \"../../../hooks/useShowLoading\";\r\nimport { ApplicationUserContext } from \"../../../context/ApplicationUserContext\";\r\nimport useDialogBox from \"../../../hooks/useDialogBox\";\r\n\r\ninterface CreateMessageModalProps {\r\n  onCloseModal: (toastMessage: string) => void;\r\n  isOpen: boolean;\r\n}\r\n\r\n// --------------------------------------------------------------------------------------\r\n//\r\n// --------------------------------------------------------------------------------------\r\nconst CreateMessageModal: React.FC<CreateMessageModalProps> = ({\r\n  onCloseModal,\r\n  isOpen,\r\n}) => {\r\n  const { user } = useContext(ApplicationUserContext);\r\n  const { auth } = useContext(AuthorizedItemsContext);\r\n  const [messageText, setMessageText] = useState(\"\");\r\n  const [employeeIds, setEmployeeIds] = useState([] as number[]);\r\n  const [locationId, setLocationId] = useState(0);\r\n  const [channel, setChannel] = useState(0);\r\n  const sendingMessage = useShowLoading(\"Sending\");\r\n  const dialog = useDialogBox();\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onSendClick = () => {\r\n    sendingMessage.setShowLoading(true);\r\n    messageApi\r\n      .sendMessage(user, locationId, channel, employeeIds, messageText)\r\n      .then((res) => {\r\n        sendingMessage.setShowLoading(false);\r\n        if (res.error) {\r\n          dialog.showAlert(\r\n            \"Could not send\",\r\n            \"Could not send message. \" + res.message,\r\n            () => {}\r\n          );\r\n        } else {\r\n          if (employeeIds.length === 1) {\r\n            onCloseModal(\"Message sent\");\r\n          } else {\r\n            onCloseModal(\"Messages sent\");\r\n          }\r\n        }\r\n      });\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onMessageTextUpdate = (newText: string | undefined | null) => {\r\n    if (newText !== null && newText !== undefined && newText !== messageText) {\r\n      setMessageText(newText);\r\n    }\r\n  };\r\n\r\n  // --------------------------------------------------------------------------------------\r\n  const onEmployeeListUpdate = (\r\n    newEmpList: EmployeeCommunication[],\r\n    newLocId: number,\r\n    newChannel: number\r\n  ) => {\r\n    setEmployeeIds(\r\n      newEmpList.map((e) => {\r\n        return e.id;\r\n      })\r\n    );\r\n\r\n    if (newLocId !== locationId) {\r\n      setLocationId(newLocId);\r\n    }\r\n\r\n    if (newChannel !== channel) {\r\n      setChannel(newChannel);\r\n    }\r\n  };\r\n\r\n  if (!isOpen || !auth || !auth.locations || auth.locations.length === 0) {\r\n    return <div>Loading</div>;\r\n  } else {\r\n    return (\r\n      <>\r\n        <IonHeader className=\"ion-no-border\">\r\n          <IonToolbar>\r\n            <IonButtons slot=\"start\">\r\n              <IonButton onClick={() => onCloseModal(\"\")}>\r\n                <IonIcon icon={arrowBackOutline} slot=\"icon-only\" />\r\n              </IonButton>\r\n            </IonButtons>\r\n            <IonTitle>New Message</IonTitle>\r\n          </IonToolbar>\r\n        </IonHeader>\r\n\r\n        <IonContent class=\"edit-daily-modal-content\">\r\n          <IonList>\r\n            <EmployeesSelector onUpdate={onEmployeeListUpdate} />\r\n            <IonItem\r\n              lines=\"none\"\r\n            >\r\n              <IonTextarea           \r\n                value={messageText}\r\n                placeholder={\"Enter message\"}\r\n                spellcheck={true}\r\n                wrap=\"hard\"\r\n                autoGrow={true}\r\n                debounce={250}\r\n                onIonChange={(e) => {\r\n                  onMessageTextUpdate(e.detail.value);\r\n                }}\r\n              />\r\n            </IonItem>\r\n          </IonList>\r\n          {sendingMessage.showLoadingJsx}\r\n        </IonContent>\r\n        <IonFooter>\r\n          <IonButton\r\n            className=\"apply-button\"\r\n            expand=\"block\"\r\n            onClick={onSendClick}\r\n            disabled={\r\n              employeeIds.length === 0 ||\r\n              messageText.length === 0 ||\r\n              sendingMessage.showLoading\r\n            }\r\n          >\r\n            Send\r\n          </IonButton>\r\n        </IonFooter>\r\n      </>\r\n    );\r\n  }\r\n};\r\n\r\nexport default CreateMessageModal;\r\n","import React, { useState, useEffect, useReducer } from \"react\";\r\nimport {\r\n  IonModal,\r\n  IonHeader,\r\n  IonButton,\r\n  IonIcon,\r\n  IonToolbar,\r\n  IonTitle,\r\n  IonContent,\r\n  IonPage,\r\n  IonButtons,\r\n  IonMenuButton, useIonViewDidEnter, useIonViewDidLeave,\r\n} from \"@ionic/react\";\r\nimport \"../global-styles.scss\";\r\nimport { funnel, add } from \"ionicons/icons\";\r\nimport useIonicRefresher from \"../hooks/useIonicRefresher\";\r\nimport { Message } from \"../orbital-interfaces/Message\";\r\nimport MessageItem from \"../components/MessagesPageComponents/MessageItem\";\r\nimport MessagesFilterModal, {\r\n  FilterData,\r\n  FilterResult,\r\n} from \"../components/MessagesPageComponents/MessagesFilterModal\";\r\nimport { messageTypes } from \"../orbital-interfaces/MessageTypes\";\r\nimport arrayHelper from \"../util/array-helper\";\r\nimport messageApi from \"../api/MessageAPI\";\r\nimport { ApplicationUserContext } from \"../context/ApplicationUserContext\";\r\nimport { RefresherEventDetail } from \"@ionic/core\";\r\nimport ViewMessagetModal from \"../components/MessagesPageComponents/ViewMessageModal\";\r\nimport useSimpleToast from \"../hooks/useSimpleToast\";\r\nimport { RouteComponentProps } from \"react-router\";\r\nimport Skeleton from \"react-loading-skeleton\";\r\nimport CreateMessageModal from \"../components/MessagesPageComponents/create/CreateMessageModal\";\r\nimport { AuthorizedItemsContext } from \"../context/AuthorizedItemsContext\";\r\nimport authHelper from \"../util/authitems-helper\";\r\nimport { MessagesContext } from \"../context/MessagesContext\";\r\n\r\nconst initialMessages: Message[] = [];\r\n\r\nexport type MessagesReducerAction =\r\n  | { type: \"LOADED-FROM-API\"; data: Message[] }\r\n  | { type: \"CLEAR\" }\r\n  | { type: \"UPDATE-PINNED\"; msgId: number; isPinned: boolean }\r\n  | { type: \"UPDATE-VIEWED\"; msgId: number; isViewed: boolean }\r\n  | { type: \"DELETE\"; msgId: number };\r\n\r\n// ------------------------------------------------------------------------------------------------\r\nexport const messagesReducer = (\r\n  currentState: Message[],\r\n  action: MessagesReducerAction\r\n): Message[] => {\r\n  console.log(\"REDUCER: ACTION =\", action.type);\r\n\r\n  switch (action.type) {\r\n    case \"LOADED-FROM-API\":\r\n      return action.data;\r\n    case \"CLEAR\":\r\n      return [] as Message[];\r\n    case \"UPDATE-PINNED\":\r\n      return currentState.map((m) =>\r\n        m.messageId === action.msgId ? { ...m, isPinned: action.isPinned } : m\r\n      );\r\n    case \"UPDATE-VIEWED\":\r\n      return currentState.map((m) => {\r\n        return m.messageId === action.msgId\r\n          ? { ...m, isViewed: action.isViewed }\r\n          : m;\r\n      });\r\n    case \"DELETE\":\r\n      return currentState.filter((m) => m.messageId !== action.msgId);\r\n  }\r\n};\r\n\r\ninterface MessagesPageProps\r\n  extends RouteComponentProps<{\r\n    messageId?: string;\r\n  }> {}\r\n\r\n// eslint-disable-next-line react/prop-types\r\nconst MessagesPage: React.FC<MessagesPageProps> = ({ match, history }) => {\r\n  const { user } = React.useContext(ApplicationUserContext);\r\n  const { auth, refreshAuth } = React.useContext(AuthorizedItemsContext);\r\n  const { unreadMessagesCount, messagesViewed } = React.useContext(MessagesContext);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useIonViewDidEnter(() => {\r\n    messagesViewed();\r\n  }, [messagesViewed]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useIonViewDidLeave(() => {\r\n    messagesViewed();\r\n  }, [messagesViewed]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (!auth || !auth.locations || auth.locations.length === 0) {\r\n      refreshAuth(false, user);\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [auth]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const doRefresh = (e: CustomEvent<RefresherEventDetail>) => {\r\n    refreshMessages(e);\r\n  };\r\n\r\n  const refresher = useIonicRefresher(doRefresh);\r\n  const [showFilterModal, setShowFilterModal] = useState(false);\r\n  const [isLoadingMessages, setIsLoadingMessages] = useState(true);\r\n  const [messages, updateMessages] = useReducer(messagesReducer, []);\r\n  const [filteredMessages, setFilteredMessages] = useState(initialMessages);\r\n  const [filterData, setFilterData] = useState({} as FilterData);\r\n  const [filterResult, setFilterResult] = useState({} as FilterResult);\r\n  const [viewMessage, setViewMessage] = useState(null as Message | null);\r\n  const toast = useSimpleToast();\r\n  const [showCreateMessage, setShowCreateMessage] = useState(false);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    if (\r\n      user &&\r\n      user.isLoggedin &&\r\n      auth &&\r\n      auth.locations &&\r\n      auth.locations.length > 0\r\n    ) {\r\n      return refreshMessages(undefined);\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [user.isLoggedin, unreadMessagesCount, auth]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    filterMessages(filterResult, messages);\r\n\r\n    // eslint-disable-next-line\r\n  }, [messages]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  useEffect(() => {\r\n    // eslint-disable-next-line react/prop-types\r\n    if (match.params.messageId && viewMessage === null) {\r\n      messageApi\r\n        // eslint-disable-next-line react/prop-types\r\n        .getUserMessage(user, parseInt(match.params.messageId))\r\n        .then((msg) => {\r\n          if (!msg) {\r\n            toast.showToast(\"The requested message has been removed\");\r\n            // eslint-disable-next-line react/prop-types\r\n            history.push(\"/tabs/messages/\");\r\n          }\r\n\r\n          setViewMessage(msg);\r\n        });\r\n    }\r\n\r\n    // eslint-disable-next-line\r\n  }, [match.params.messageId]);\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const refreshMessages = (e?: CustomEvent<RefresherEventDetail>) => {\r\n    let isSubscribed = true;\r\n\r\n    if (messages.length === 0 && isLoadingMessages === false) {\r\n      setIsLoadingMessages(true);\r\n    }\r\n\r\n    messageApi.getUserMessages(user).then((msgs) => {\r\n      if (!isSubscribed) {\r\n        return;\r\n      }\r\n\r\n      updateMessages({ type: \"LOADED-FROM-API\", data: msgs });\r\n      filterMessages(filterResult, msgs);\r\n      setIsLoadingMessages(false);\r\n\r\n      if (e) {\r\n        e.detail.complete();\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      isSubscribed = false;\r\n    };\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const filterClose = (updatedFilter: FilterResult) => {\r\n    setFilterResult(updatedFilter);\r\n    filterMessages(updatedFilter, messages);\r\n    setShowFilterModal(false);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const filterMessages = (f: FilterResult, msgs: Message[]) => {\r\n    if (!f || !f.msgTypeIds) {\r\n      setFilteredMessages(msgs);\r\n      return;\r\n    }\r\n\r\n    if (f.employeeId !== -1) {\r\n      if (f.msgTypeIds.length > 0) {\r\n        setFilteredMessages(\r\n          msgs.filter(\r\n            (m) =>\r\n              m.fromEmployeeId === f.employeeId &&\r\n              arrayHelper.contains(f.msgTypeIds, m.messageTypeId)\r\n          )\r\n        );\r\n      } else {\r\n        setFilteredMessages(\r\n          msgs.filter((m) => m.fromEmployeeId === f.employeeId)\r\n        );\r\n      }\r\n    } else if (f.msgTypeIds.length > 0) {\r\n      console.log(f.msgTypeIds);\r\n      setFilteredMessages(\r\n        msgs.filter((m) => arrayHelper.contains(f.msgTypeIds, m.messageTypeId))\r\n      );\r\n    } else {\r\n      setFilteredMessages(msgs);\r\n    }\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onCloseMessageModal = (msg: string | null) => {\r\n    setViewMessage(null);\r\n    if (msg) {\r\n      toast.showToast(msg);\r\n    }\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const onCloseCreateMessageModal = (toastMessage: string | null) => {\r\n    setShowCreateMessage(false);\r\n    if (toastMessage !== null && toastMessage.length > 0) {\r\n      toast.showToast(toastMessage);\r\n    }\r\n\r\n    setTimeout(() => {\r\n      refreshMessages();\r\n    }, 4000);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------------------\r\n  const showFilter = () => {\r\n    const employees = arrayHelper.uniqueObject(\r\n      messages.map((msg) => {\r\n        return {\r\n          employeeId: msg.fromEmployeeId,\r\n          name: msg.fromEmployeeFirstName + \" \" + msg.fromEmployeeLastName,\r\n        };\r\n      }),\r\n      (x, y) => {\r\n        return x.employeeId === y.employeeId;\r\n      }\r\n    );\r\n    const msgTypes = arrayHelper.uniqueObject(\r\n      messages.map((msg) => {\r\n        return {\r\n          messageTypeId: msg.messageTypeId,\r\n          name: messageTypes.item(String(msg.messageTypeId)).description,\r\n        };\r\n      }),\r\n      (x, y) => {\r\n        return x.messageTypeId === y.messageTypeId;\r\n      }\r\n    );\r\n\r\n    setFilterData({ msgTypes, employees });\r\n\r\n    setShowFilterModal(true);\r\n  };\r\n\r\n  return (\r\n    <IonPage>\r\n      <IonHeader className=\"ion-no-border\">\r\n        <IonToolbar mode=\"md\">\r\n          <IonButtons slot=\"start\">\r\n            <IonMenuButton />\r\n          </IonButtons>\r\n          <IonTitle slot=\"start\">Messages</IonTitle>\r\n          <IonButtons slot=\"end\">\r\n            <IonButton\r\n              hidden={\r\n                auth.locations.find((l) =>\r\n                  l.departments.find((d) => authHelper.isDeptAdmin(auth, d.id))\r\n                ) === undefined\r\n              }\r\n              onClick={() => {\r\n                setShowCreateMessage(true);\r\n              }}\r\n            >\r\n              <IonIcon icon={add} mode=\"md\" slot=\"icon-only\" />\r\n            </IonButton>\r\n            <IonButton onClick={showFilter}>\r\n              <IonIcon icon={funnel} mode=\"ios\" slot=\"icon-only\" />\r\n            </IonButton>\r\n          </IonButtons>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n\r\n      <IonContent className=\"outer-content\">\r\n        {refresher.ionicRefresherJsx}\r\n        {isLoadingMessages && (\r\n          <>\r\n            {[\r\n              1,\r\n              2,\r\n              3,\r\n              4,\r\n              5,\r\n              6,\r\n              7,\r\n              8,\r\n              9,\r\n              10,\r\n              11,\r\n              12,\r\n              13,\r\n              14,\r\n              15,\r\n              16,\r\n              17,\r\n              18,\r\n              19,\r\n              20,\r\n              21,\r\n            ].map((x) => {\r\n              return (\r\n                <div key={x} style={{ margin: \"10px 8px\" }}>\r\n                  <Skeleton width={360} height={45} />\r\n                </div>\r\n              );\r\n            })}\r\n          </>\r\n        )}\r\n        {!isLoadingMessages && filteredMessages.length === 0 && (\r\n          <div className=\"no-messagesOrEvents-text\">No Messages</div>\r\n        )}\r\n        <div className=\"message-list\">\r\n          {!isLoadingMessages &&\r\n            filteredMessages.length > 0 &&\r\n            filteredMessages\r\n              .filter((m) => m.isPinned)\r\n              .map((msg) => (\r\n                <MessageItem\r\n                  key={msg.messageId}\r\n                  message={msg}\r\n                  onMessageClick={() => setViewMessage(msg)}\r\n                />\r\n              ))}\r\n        </div>\r\n\r\n        <div className=\"message-list\">\r\n          {!isLoadingMessages &&\r\n            filteredMessages.length > 0 &&\r\n            filteredMessages\r\n              .filter((m) => !m.isPinned)\r\n              .map((msg) => (\r\n                <MessageItem\r\n                  key={msg.messageId}\r\n                  message={msg}\r\n                  onMessageClick={() => setViewMessage(msg)}\r\n                />\r\n              ))}\r\n        </div>\r\n      </IonContent>\r\n\r\n      <IonModal isOpen={showFilterModal}>\r\n        <MessagesFilterModal\r\n          filterData={filterData}\r\n          onDismissModal={filterClose}\r\n          onCancelModal={() => setShowFilterModal(false)}\r\n        />\r\n      </IonModal>\r\n\r\n      <IonModal isOpen={viewMessage !== null}>\r\n        <ViewMessagetModal\r\n          message={viewMessage}\r\n          updateMessages={updateMessages}\r\n          onCloseModal={onCloseMessageModal}\r\n        />\r\n      </IonModal>\r\n\r\n      <IonModal isOpen={showCreateMessage}>\r\n        <CreateMessageModal\r\n          onCloseModal={onCloseCreateMessageModal}\r\n          isOpen={showCreateMessage}\r\n        />\r\n      </IonModal>\r\n\r\n      {toast.simpleToastJsx}\r\n    </IonPage>\r\n  );\r\n};\r\n\r\nexport default MessagesPage;\r\n","import React, { useContext } from \"react\";\r\nimport { IonIcon, IonLabel } from \"@ionic/react\";\r\nimport { chatbubblesOutline } from \"ionicons/icons\";\r\n// import \"./MainTabs.scss\";\r\nimport \"../global-styles.scss\";\r\nimport { MessagesContext } from \"../context/MessagesContext\";\r\n\r\n// ------------------------------------------------------------------------------------\r\n//\r\n// ------------------------------------------------------------------------------------\r\nconst MessagesTabButton: React.FC = () => {\r\n  const { unreadMessagesCount, hasNewMessages } = useContext(MessagesContext);\r\n\r\n  return (\r\n    <>\r\n      <div className={hasNewMessages ? \"hasMessages\" : \"noMessages\"}>\r\n        {unreadMessagesCount}\r\n      </div>\r\n      <IonIcon icon={chatbubblesOutline} />\r\n      <IonLabel>Messages</IonLabel>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MessagesTabButton;\r\n","import React, {useContext} from \"react\";\r\nimport {\r\n  IonTabs,\r\n  IonRouterOutlet,\r\n  IonTabBar,\r\n  IonTabButton,\r\n  IonIcon,\r\n  IonLabel,\r\n} from \"@ionic/react\";\r\nimport { Route, Redirect } from \"react-router\";\r\nimport { calendarOutline, timeOutline } from \"ionicons/icons\";\r\nimport SchedulePage from \"./SchedulePage\";\r\nimport ClockPage from \"./ClockPage\";\r\nimport MessagesPage from \"./MessagesPage\";\r\nimport MessagesTabButton from \"./MessagesTabButton\";\r\n// import \"./MainTabs.scss\";\r\nimport \"../global-styles.scss\";\r\nimport {AuthorizedItemsContext} from \"../context/AuthorizedItemsContext\";\r\n\r\ninterface MainTabsProps {}\r\n\r\nconst MainTabs: React.FC<MainTabsProps> = () => {\r\n  const {auth} = useContext(AuthorizedItemsContext);\r\n\r\n  return (\r\n    <IonTabs>\r\n      <IonRouterOutlet>\r\n        <Redirect exact={true} path=\"/tabs\" to=\"/tabs/schedule\" />\r\n\r\n        <Route\r\n          path=\"/tabs/schedule/:scheduleEventId\"\r\n          render={(routeProps) => <SchedulePage {...routeProps} />}\r\n        />\r\n\r\n        <Route\r\n          path=\"/tabs/schedule\"\r\n          render={(routeProps) => <SchedulePage {...routeProps} />}\r\n          exact={true}\r\n        />\r\n\r\n        <Route\r\n          path=\"/tabs/messages/:messageId\"\r\n          render={(routeProps) => <MessagesPage {...routeProps} />}\r\n        />\r\n\r\n        <Route\r\n          path=\"/tabs/messages\"\r\n          render={(routeProps) => <MessagesPage {...routeProps} />}\r\n          exact={true}\r\n        />\r\n\r\n        <Route  path=\"/tabs/clock\" render={() => <ClockPage />} exact={true} />\r\n      </IonRouterOutlet>\r\n      <IonTabBar slot=\"bottom\">\r\n        <IonTabButton key=\"1\" tab=\"schedule\" href=\"/tabs/schedule\">\r\n          <IonIcon icon={calendarOutline} />\r\n          <IonLabel>Schedule</IonLabel>\r\n        </IonTabButton>\r\n        <IonTabButton hidden={!auth.timeClock} key=\"2\" tab=\"clock\" href=\"/tabs/clock\">\r\n          <IonIcon icon={timeOutline} />\r\n          <IonLabel>Clock</IonLabel>\r\n        </IonTabButton>\r\n        <IonTabButton key=\"3\" tab=\"map\" href=\"/tabs/messages\">\r\n          <MessagesTabButton />\r\n        </IonTabButton>\r\n      </IonTabBar>\r\n    </IonTabs>\r\n  );\r\n};\r\n\r\nexport default MainTabs;\r\n","import React from \"react\";\r\nimport { Redirect } from \"react-router\";\r\nimport MainTabs from \"./../pages/MainTabs\";\r\nimport { ApplicationUserContext } from \"../context/ApplicationUserContext\";\r\n\r\ninterface StateProps {}\r\n\r\nconst AuthGate: React.FC<StateProps> = () => {\r\n  const { user } = React.useContext(ApplicationUserContext);\r\n\r\n  if (user.loading) {\r\n    return <div></div>;\r\n  }\r\n\r\n  if (user.isLoggedin) {\r\n    return <MainTabs />;\r\n  }\r\n\r\n  return <Redirect to=\"/login\" />;\r\n};\r\n\r\nexport default AuthGate;\r\n","import React from \"react\";\r\nimport {IonContent, IonList, IonPage, useIonViewDidEnter} from \"@ionic/react\";\r\nimport { RouteComponentProps } from \"react-router\";\r\nimport { ApplicationUserContext } from \"../context/ApplicationUserContext\";\r\nimport \"../global-styles.scss\";\r\nimport { log } from \"../util/logger\";\r\nimport { AuthorizedItemsContext } from \"../context/AuthorizedItemsContext\";\r\n\r\ninterface LogoutProps extends RouteComponentProps {}\r\n\r\nconst Logout: React.FC<LogoutProps> = ({ history }: RouteComponentProps) => {\r\n  const { user, logout } = React.useContext(ApplicationUserContext);\r\n  const { clearAuth } = React.useContext(AuthorizedItemsContext);\r\n\r\n  useIonViewDidEnter(() => {\r\n    Promise.all([clearAuth(), logout()]).then(() => {\r\n      localStorage.clear();\r\n      log(\"logout\", { user: user.username });\r\n      console.log(`logged out (${user.username})`);\r\n      setTimeout(() => {\r\n        history.push(\"/login\", { direction: \"none\" });\r\n        history.goForward();\r\n      }, 250);\r\n    });\r\n  });\r\n\r\n  return (\r\n    <IonPage id=\"logout-page\">\r\n      <IonContent className=\"login-content\">\r\n        <div className=\"login-logo\">\r\n          <img\r\n            className=\"logo\"\r\n            src=\"assets/img/OS Logo - 4pt Rounded _ 2 Tone Orange.svg\"\r\n            alt=\"Orbital Shift Logo\"\r\n          />\r\n        </div>\r\n\r\n        <IonList className=\"form-list\" >\r\n          <div className=\"item\">\r\n            <div className=\"label\">User</div>\r\n          </div>\r\n        </IonList>\r\n      </IonContent>\r\n    </IonPage>\r\n  );\r\n};\r\n\r\nexport default Logout;\r\n","import React from \"react\";\r\nimport {IonContent, IonLoading} from \"@ionic/react\";\r\nimport \"../global-styles.scss\";\r\nimport env from '../api/environment';\r\n\r\nconst SplashComponent: React.FC = () => {\r\n  return (\r\n    <>\r\n      <IonContent id=\"splash\">\r\n        <div className=\"login-logo\">\r\n          <img\r\n            className=\"logo\"\r\n            src=\"assets/img/OS Logo - 4pt Rounded _ 2 Tone Orange.svg\"\r\n            alt=\"Orbital Shift Logo\"\r\n          />\r\n        </div>\r\n\r\n\r\n        <IonLoading\r\n          isOpen={true}\r\n          spinner=\"dots\"\r\n          message={\"Loading...\"}\r\n          showBackdrop={false}\r\n          duration={0}\r\n        />\r\n\r\n\r\n        <footer>\r\n          {env.settings.appVersionString} ({env.settings.buildDate})\r\n        </footer>\r\n      </IonContent>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SplashComponent;\r\n","import React, {useContext, useEffect} from \"react\";\r\nimport { Route, BrowserRouter, Redirect } from \"react-router-dom\";\r\nimport { IonApp, IonRouterOutlet, IonSplitPane } from \"@ionic/react\";\r\nimport { IonReactRouter } from \"@ionic/react-router\";\r\nimport Menu from \"./components/Menu\";\r\nimport { initialize, log } from \"./util/logger\";\r\n\r\n/* Core CSS required for Ionic components to work properly */\r\nimport \"@ionic/react/css/core.css\";\r\n\r\n/* Basic CSS for apps built with Ionic */\r\nimport \"@ionic/react/css/normalize.css\";\r\nimport \"@ionic/react/css/structure.css\";\r\nimport \"@ionic/react/css/typography.css\";\r\n\r\n/* Optional CSS utils that can be commented out */\r\nimport \"@ionic/react/css/padding.css\";\r\nimport \"@ionic/react/css/float-elements.css\";\r\nimport \"@ionic/react/css/text-alignment.css\";\r\nimport \"@ionic/react/css/text-transformation.css\";\r\nimport \"@ionic/react/css/flex-utils.css\";\r\nimport \"@ionic/react/css/display.css\";\r\n\r\n/* Theme variables */\r\nimport \"./theme/variables.css\";\r\nimport Login from \"./pages/Login\";\r\nimport AuthGate from \"./components/AuthGate\";\r\n\r\nimport {ApplicationUserContext, ApplicationUserContextProvider} from \"./context/ApplicationUserContext\";\r\nimport Logout from \"./pages/Logout\";\r\nimport {AuthorizedItemsContext, AuthorizedItemsContextProvider} from \"./context/AuthorizedItemsContext\";\r\nimport env from \"./api/environment\";\r\nimport { ScreenOrientation } from \"@ionic-native/screen-orientation\";\r\nimport { MessagesContextProvider } from \"./context/MessagesContext\";\r\nimport authHelper from \"./util/authitems-helper\";\r\nimport SplashComponent from \"./components/SplashComponent\";\r\n\r\nconst MyApp: React.FC = () => {\r\n  const {user} = useContext(ApplicationUserContext);\r\n  const {auth, refreshAuth} = useContext(AuthorizedItemsContext);\r\n  useEffect(() => {\r\n    if (env.settings.hasCapacitor) {\r\n      ScreenOrientation.lock(ScreenOrientation.ORIENTATIONS.PORTRAIT).then(\r\n        () => {\r\n          console.log(\"screen locked to portrait\");\r\n        }\r\n      );\r\n    }\r\n\r\n    initialize();\r\n    log(\"app_render\", {\r\n      vers: env.settings.appVersionString,\r\n      platform: env.settings.platform,\r\n    });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (user.isLoggedin && !authHelper.isAuthItemsValid(auth)) {\r\n      refreshAuth(false, user);\r\n    }\r\n  }, [user.isLoggedin, auth, refreshAuth, user]);\r\n\r\n  let authGate: JSX.Element;\r\n  if (!user.isLoggedin) {\r\n    authGate = (\r\n      <>\r\n        <Route\r\n          path=\"/tabs\"\r\n          render={(routeProps) => <AuthGate {...routeProps} />}\r\n        />\r\n\r\n        <Route path=\"/\" exact={true}>\r\n          <Redirect to=\"/tabs/schedule\" />\r\n        </Route>\r\n      </>\r\n    );\r\n  }\r\n  else if (user.isLoggedin && authHelper.isAuthItemsValid(auth))\r\n  {\r\n    authGate = (\r\n      <>\r\n      <Route\r\n        path=\"/tabs\"\r\n        render={(routeProps) => <AuthGate {...routeProps} />}\r\n      />\r\n\r\n      <Route path=\"/\" exact={true}>\r\n        <Redirect to=\"/tabs/schedule\" />\r\n      </Route>\r\n      </>\r\n    );\r\n  } else {\r\n    // authGate = <>...</>;\r\n    authGate = <SplashComponent />\r\n  }\r\n\r\n\r\n  return (\r\n    <IonApp>\r\n      <IonReactRouter>\r\n        <IonReactRouter>\r\n          <IonSplitPane contentId=\"main\">\r\n            <Menu />\r\n            <IonRouterOutlet id=\"main\">\r\n              <Route\r\n                path=\"/login\"\r\n                render={(routeProps) => <Login {...routeProps} />}\r\n              />\r\n\r\n              <Route\r\n                path=\"/logout\"\r\n                render={(routeProps) => <Logout {...routeProps} />}\r\n              />\r\n\r\n              {authGate}\r\n\r\n\r\n            </IonRouterOutlet>\r\n          </IonSplitPane>\r\n        </IonReactRouter>\r\n      </IonReactRouter>\r\n    </IonApp>\r\n  );\r\n};\r\n\r\nconst App: React.FC = () => {\r\n  return (\r\n    <BrowserRouter>\r\n      <ApplicationUserContextProvider>\r\n        <AuthorizedItemsContextProvider>\r\n          <MessagesContextProvider>\r\n            <MyApp />\r\n          </MessagesContextProvider>\r\n        </AuthorizedItemsContextProvider>\r\n      </ApplicationUserContextProvider>\r\n    </BrowserRouter>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}